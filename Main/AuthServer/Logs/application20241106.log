2024-11-06 10:23:30.510 -03:00 [INF] Aplicação iniciada - configuração de logs inicializada.
2024-11-06 10:23:30.793 -03:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2024-11-06 10:23:30.853 -03:00 [DBG] Hosting starting
2024-11-06 10:23:30.870 -03:00 [INF] User profile is available. Using 'C:\Users\gusta\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2024-11-06 10:23:30.878 -03:00 [DBG] Reading data from file 'C:\Users\gusta\AppData\Local\ASP.NET\DataProtection-Keys\key-bf4636f6-ef08-4ac9-8613-5c8299c406a4.xml'.
2024-11-06 10:23:30.887 -03:00 [DBG] Found key {bf4636f6-ef08-4ac9-8613-5c8299c406a4}.
2024-11-06 10:23:30.896 -03:00 [DBG] Considering key {bf4636f6-ef08-4ac9-8613-5c8299c406a4} with expiration date 2025-02-02 14:46:39Z as default key.
2024-11-06 10:23:30.901 -03:00 [DBG] Forwarded activator type request from Microsoft.AspNetCore.DataProtection.XmlEncryption.DpapiXmlDecryptor, Microsoft.AspNetCore.DataProtection, Version=8.0.0.0, Culture=neutral, PublicKeyToken=adb9793829ddae60 to Microsoft.AspNetCore.DataProtection.XmlEncryption.DpapiXmlDecryptor, Microsoft.AspNetCore.DataProtection, Culture=neutral, PublicKeyToken=adb9793829ddae60
2024-11-06 10:23:30.904 -03:00 [DBG] Decrypting secret element using Windows DPAPI.
2024-11-06 10:23:30.907 -03:00 [DBG] Forwarded activator type request from Microsoft.AspNetCore.DataProtection.AuthenticatedEncryption.ConfigurationModel.AuthenticatedEncryptorDescriptorDeserializer, Microsoft.AspNetCore.DataProtection, Version=8.0.0.0, Culture=neutral, PublicKeyToken=adb9793829ddae60 to Microsoft.AspNetCore.DataProtection.AuthenticatedEncryption.ConfigurationModel.AuthenticatedEncryptorDescriptorDeserializer, Microsoft.AspNetCore.DataProtection, Culture=neutral, PublicKeyToken=adb9793829ddae60
2024-11-06 10:23:30.913 -03:00 [DBG] Opening CNG algorithm 'AES' from provider 'null' with chaining mode CBC.
2024-11-06 10:23:30.915 -03:00 [DBG] Opening CNG algorithm 'SHA256' from provider 'null' with HMAC.
2024-11-06 10:23:30.917 -03:00 [DBG] Using key {bf4636f6-ef08-4ac9-8613-5c8299c406a4} as the default key.
2024-11-06 10:23:30.919 -03:00 [DBG] Key ring with default key {bf4636f6-ef08-4ac9-8613-5c8299c406a4} was loaded during application startup.
2024-11-06 10:23:31.009 -03:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2024-11-06 10:23:31.459 -03:00 [DBG] The index {'RoleId'} was not created on entity type 'UserRole (Dictionary<string, object>)' as the properties are already covered by the index {'RoleId', 'UserId'}.
2024-11-06 10:23:31.681 -03:00 [DBG] Entity Framework Core 8.0.10 initialized 'AuthServerContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:8.0.10' with options: None
2024-11-06 10:23:31.724 -03:00 [DBG] Compiling query expression: 
'DbSet<Role>()
    .Count()'
2024-11-06 10:23:31.922 -03:00 [DBG] Generated query execution expression: 
'queryContext => new SingleQueryingEnumerable<int>(
    (RelationalQueryContext)queryContext, 
    RelationalCommandCache.QueryExpression(
        Projection Mapping:
            EmptyProjectionMember -> 0
        SELECT COUNT(*)
        FROM Roles AS r), 
    null, 
    Func<QueryContext, DbDataReader, ResultContext, SingleQueryResultCoordinator, int>, 
    AuthServer.AuthServerContext, 
    False, 
    False, 
    True
)
    .Single()'
2024-11-06 10:23:31.948 -03:00 [DBG] Creating DbConnection.
2024-11-06 10:23:31.967 -03:00 [DBG] Created DbConnection. (17ms).
2024-11-06 10:23:31.971 -03:00 [DBG] Opening connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:23:32.127 -03:00 [DBG] Opened connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:23:32.132 -03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2024-11-06 10:23:32.141 -03:00 [DBG] Created DbCommand for 'ExecuteReader' (4ms).
2024-11-06 10:23:32.143 -03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (11ms).
2024-11-06 10:23:32.150 -03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*)
FROM [Roles] AS [r]
2024-11-06 10:23:32.178 -03:00 [INF] Executed DbCommand (26ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*)
FROM [Roles] AS [r]
2024-11-06 10:23:32.189 -03:00 [DBG] Closing data reader to 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:23:32.196 -03:00 [DBG] A data reader for 'AuthServer' on server 'localhost,1433' is being disposed after spending 11ms reading results.
2024-11-06 10:23:32.199 -03:00 [DBG] Closing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:23:32.205 -03:00 [DBG] Closed connection to database 'AuthServer' on server 'localhost,1433' (5ms).
2024-11-06 10:23:32.213 -03:00 [DBG] Compiling query expression: 
'DbSet<User>()
    .Include(user => user.Roles)'
2024-11-06 10:23:32.231 -03:00 [DBG] Including navigation: 'User.Roles'.
2024-11-06 10:23:32.350 -03:00 [DBG] Generated query execution expression: 
'queryContext => new SingleQueryingEnumerable<User>(
    (RelationalQueryContext)queryContext, 
    RelationalCommandCache.QueryExpression(
        Client Projections:
            0 -> Dictionary<IProperty, int> { [Property: User.ID (long) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: User.Email (string) Required Index, 1], [Property: User.Name (string) Required, 2], [Property: User.Password (string) Required, 3] }
            1 -> 0
            2 -> Dictionary<IProperty, int> { [Property: UserRole (Dictionary<string, object>).RoleId (no field, int) Indexer Required PK FK AfterSave:Throw, 4], [Property: UserRole (Dictionary<string, object>).UserId (no field, long) Indexer Required PK FK Index AfterSave:Throw, 5] }
            3 -> Dictionary<IProperty, int> { [Property: Role.Long (int) Required PK AfterSave:Throw ValueGenerated.OnAdd, 6], [Property: Role.Name (string) Required Index, 7] }
            4 -> 4
            5 -> 5
            6 -> 6
        SELECT u.ID, u.Email, u.Name, u.Password, t.RoleId, t.UserId, t.Long, t.Name
        FROM Users AS u
        LEFT JOIN 
        (
            SELECT u0.RoleId, u0.UserId, r.Long, r.Name
            FROM UserRole AS u0
            INNER JOIN Roles AS r ON u0.RoleId == r.Long
        ) AS t ON u.ID == t.UserId
        ORDER BY u.ID ASC, t.RoleId ASC, t.UserId ASC), 
    null, 
    Func<QueryContext, DbDataReader, ResultContext, SingleQueryResultCoordinator, User>, 
    AuthServer.AuthServerContext, 
    False, 
    False, 
    True
)'
2024-11-06 10:23:32.358 -03:00 [DBG] Opening connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:23:32.360 -03:00 [DBG] Opened connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:23:32.362 -03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2024-11-06 10:23:32.363 -03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2024-11-06 10:23:32.364 -03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (2ms).
2024-11-06 10:23:32.365 -03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[ID], [u].[Email], [u].[Name], [u].[Password], [t].[RoleId], [t].[UserId], [t].[Long], [t].[Name]
FROM [Users] AS [u]
LEFT JOIN (
    SELECT [u0].[RoleId], [u0].[UserId], [r].[Long], [r].[Name]
    FROM [UserRole] AS [u0]
    INNER JOIN [Roles] AS [r] ON [u0].[RoleId] = [r].[Long]
) AS [t] ON [u].[ID] = [t].[UserId]
ORDER BY [u].[ID], [t].[RoleId], [t].[UserId]
2024-11-06 10:23:32.371 -03:00 [INF] Executed DbCommand (6ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[ID], [u].[Email], [u].[Name], [u].[Password], [t].[RoleId], [t].[UserId], [t].[Long], [t].[Name]
FROM [Users] AS [u]
LEFT JOIN (
    SELECT [u0].[RoleId], [u0].[UserId], [r].[Long], [r].[Name]
    FROM [UserRole] AS [u0]
    INNER JOIN [Roles] AS [r] ON [u0].[RoleId] = [r].[Long]
) AS [t] ON [u].[ID] = [t].[UserId]
ORDER BY [u].[ID], [t].[RoleId], [t].[UserId]
2024-11-06 10:23:32.405 -03:00 [DBG] Context 'AuthServerContext' started tracking 'User' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 10:23:32.439 -03:00 [DBG] Context 'AuthServerContext' started tracking 'UserRole' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 10:23:32.456 -03:00 [DBG] Context 'AuthServerContext' started tracking 'Role' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 10:23:32.460 -03:00 [DBG] Closing data reader to 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:23:32.462 -03:00 [DBG] A data reader for 'AuthServer' on server 'localhost,1433' is being disposed after spending 87ms reading results.
2024-11-06 10:23:32.463 -03:00 [DBG] Closing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:23:32.465 -03:00 [DBG] Closed connection to database 'AuthServer' on server 'localhost,1433' (1ms).
2024-11-06 10:23:32.467 -03:00 [DBG] 'AuthServerContext' disposed.
2024-11-06 10:23:32.471 -03:00 [DBG] Disposing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:23:32.473 -03:00 [DBG] Disposed connection to database '' on server '' (2ms).
2024-11-06 10:23:32.580 -03:00 [INF] Now listening on: https://localhost:7011
2024-11-06 10:23:32.582 -03:00 [INF] Now listening on: http://localhost:5091
2024-11-06 10:23:32.583 -03:00 [DBG] Loaded hosting startup assembly AuthServer
2024-11-06 10:23:32.585 -03:00 [DBG] Loaded hosting startup assembly Microsoft.AspNetCore.Watch.BrowserRefresh
2024-11-06 10:23:32.586 -03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.BrowserLink.Net
2024-11-06 10:23:32.586 -03:00 [DBG] Connection id "0HN7UCOR008OQ" received FIN.
2024-11-06 10:23:32.587 -03:00 [INF] Application started. Press Ctrl+C to shut down.
2024-11-06 10:23:32.589 -03:00 [INF] Hosting environment: Development
2024-11-06 10:23:32.590 -03:00 [INF] Content root path: C:\Users\gusta\source\repos\AuthServer\AuthServer
2024-11-06 10:23:32.591 -03:00 [DBG] Hosting started
2024-11-06 10:23:32.592 -03:00 [DBG] Connection id "0HN7UCOR008OQ" accepted.
2024-11-06 10:23:32.594 -03:00 [DBG] Connection id "0HN7UCOR008OQ" started.
2024-11-06 10:23:32.599 -03:00 [DBG] Connection id "0HN7UCOR008OR" accepted.
2024-11-06 10:23:32.601 -03:00 [DBG] Connection id "0HN7UCOR008OR" started.
2024-11-06 10:23:32.607 -03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2024-11-06 10:23:32.623 -03:00 [DBG] Connection id "0HN7UCOR008OQ" stopped.
2024-11-06 10:23:32.625 -03:00 [DBG] Connection id "0HN7UCOR008OQ" sending FIN because: "The Socket transport's send loop completed gracefully."
2024-11-06 10:23:32.633 -03:00 [DBG] Connection 0HN7UCOR008OR established using the following protocol: "Tls13"
2024-11-06 10:23:32.672 -03:00 [INF] Request starting HTTP/2 GET https://localhost:7011/swagger/index.html - null null
2024-11-06 10:23:32.742 -03:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2024-11-06 10:23:32.765 -03:00 [DBG] No candidates found for the request path '/swagger/index.html'
2024-11-06 10:23:32.767 -03:00 [DBG] Request did not match any endpoints
2024-11-06 10:23:32.845 -03:00 [DBG] Response markup is scheduled to include Browser Link script injection.
2024-11-06 10:23:32.847 -03:00 [DBG] Response markup is scheduled to include browser refresh script injection.
2024-11-06 10:23:32.854 -03:00 [DBG] Response markup was updated to include Browser Link script injection.
2024-11-06 10:23:32.856 -03:00 [DBG] Response markup was updated to include browser refresh script injection.
2024-11-06 10:23:32.861 -03:00 [INF] Request finished HTTP/2 GET https://localhost:7011/swagger/index.html - 200 null text/html;charset=utf-8 189.8625ms
2024-11-06 10:23:32.919 -03:00 [INF] Request starting HTTP/2 GET https://localhost:7011/swagger/index.js - null null
2024-11-06 10:23:32.920 -03:00 [INF] Request starting HTTP/2 GET https://localhost:7011/_framework/aspnetcore-browser-refresh.js - null null
2024-11-06 10:23:32.922 -03:00 [DBG] No candidates found for the request path '/swagger/index.js'
2024-11-06 10:23:32.926 -03:00 [DBG] Request did not match any endpoints
2024-11-06 10:23:32.929 -03:00 [INF] Request finished HTTP/2 GET https://localhost:7011/swagger/index.js - 200 null application/javascript;charset=utf-8 9.8073ms
2024-11-06 10:23:32.932 -03:00 [INF] Request finished HTTP/2 GET https://localhost:7011/_framework/aspnetcore-browser-refresh.js - 200 13756 application/javascript; charset=utf-8 11.8466ms
2024-11-06 10:23:32.961 -03:00 [INF] Request starting HTTP/2 GET https://localhost:7011/_vs/browserLink - null null
2024-11-06 10:23:32.994 -03:00 [INF] Request finished HTTP/2 GET https://localhost:7011/_vs/browserLink - 200 null text/javascript; charset=UTF-8 33.795ms
2024-11-06 10:23:33.044 -03:00 [INF] Request starting HTTP/2 GET https://localhost:7011/swagger/v1/swagger.json - null null
2024-11-06 10:23:33.047 -03:00 [DBG] No candidates found for the request path '/swagger/v1/swagger.json'
2024-11-06 10:23:33.048 -03:00 [DBG] Request did not match any endpoints
2024-11-06 10:23:33.168 -03:00 [INF] Request finished HTTP/2 GET https://localhost:7011/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 123.9978ms
2024-11-06 10:24:12.751 -03:00 [DBG] Connection id "0HN7UCOR008OR" received FIN.
2024-11-06 10:24:12.754 -03:00 [DBG] Connection id "0HN7UCOR008OR" sending FIN because: "The Socket transport's send loop completed gracefully."
2024-11-06 10:24:12.755 -03:00 [DBG] Connection id "0HN7UCOR008OR" is closed. The last processed stream ID was 9.
2024-11-06 10:24:12.759 -03:00 [DBG] The connection queue processing loop for 0HN7UCOR008OR completed.
2024-11-06 10:24:12.762 -03:00 [DBG] Connection id "0HN7UCOR008OR" stopped.
2024-11-06 10:25:12.542 -03:00 [DBG] Connection id "0HN7UCOR008OS" accepted.
2024-11-06 10:25:12.544 -03:00 [DBG] Connection id "0HN7UCOR008OS" started.
2024-11-06 10:25:12.550 -03:00 [DBG] Connection 0HN7UCOR008OS established using the following protocol: "Tls13"
2024-11-06 10:25:12.581 -03:00 [INF] Request starting HTTP/2 POST https://localhost:7011/api/users/login - application/json 60
2024-11-06 10:25:12.591 -03:00 [DBG] 1 candidate(s) found for the request path '/api/users/login'
2024-11-06 10:25:12.593 -03:00 [DBG] Endpoint 'AuthServer.Users.UsersController.Login (AuthServer)' with route pattern 'api/users/login' is valid for the request path '/api/users/login'
2024-11-06 10:25:12.595 -03:00 [DBG] Request matched endpoint 'AuthServer.Users.UsersController.Login (AuthServer)'
2024-11-06 10:25:12.598 -03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2024-11-06 10:25:12.601 -03:00 [DBG] The request has an origin header: 'https://localhost:7011'.
2024-11-06 10:25:12.602 -03:00 [INF] CORS policy execution successful.
2024-11-06 10:25:12.637 -03:00 [DBG] AuthenticationScheme: Bearer was not authenticated.
2024-11-06 10:25:12.641 -03:00 [INF] Executing endpoint 'AuthServer.Users.UsersController.Login (AuthServer)'
2024-11-06 10:25:12.662 -03:00 [INF] Route matched with {action = "Login", controller = "Users"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult Login(AuthServer.Users.LoginRequest) on controller AuthServer.Users.UsersController (AuthServer).
2024-11-06 10:25:12.666 -03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2024-11-06 10:25:12.668 -03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2024-11-06 10:25:12.671 -03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)"]
2024-11-06 10:25:12.673 -03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2024-11-06 10:25:12.675 -03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)"]
2024-11-06 10:25:12.678 -03:00 [DBG] Executing controller factory for controller AuthServer.Users.UsersController (AuthServer)
2024-11-06 10:25:12.681 -03:00 [DBG] Executed controller factory for controller AuthServer.Users.UsersController (AuthServer)
2024-11-06 10:25:12.690 -03:00 [DBG] Attempting to bind parameter 'credentials' of type 'AuthServer.Users.LoginRequest' ...
2024-11-06 10:25:12.694 -03:00 [DBG] Attempting to bind parameter 'credentials' of type 'AuthServer.Users.LoginRequest' using the name '' in request data ...
2024-11-06 10:25:12.697 -03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2024-11-06 10:25:12.711 -03:00 [DBG] Connection id "0HN7UCOR008OS", Request id "0HN7UCOR008OS:00000001": started reading request body.
2024-11-06 10:25:12.713 -03:00 [DBG] Connection id "0HN7UCOR008OS", Request id "0HN7UCOR008OS:00000001": done reading request body.
2024-11-06 10:25:12.718 -03:00 [DBG] JSON input formatter succeeded, deserializing to type 'AuthServer.Users.LoginRequest'
2024-11-06 10:25:12.720 -03:00 [DBG] Done attempting to bind parameter 'credentials' of type 'AuthServer.Users.LoginRequest'.
2024-11-06 10:25:12.722 -03:00 [DBG] Done attempting to bind parameter 'credentials' of type 'AuthServer.Users.LoginRequest'.
2024-11-06 10:25:12.723 -03:00 [DBG] Attempting to validate the bound parameter 'credentials' of type 'AuthServer.Users.LoginRequest' ...
2024-11-06 10:25:12.730 -03:00 [DBG] Done attempting to validate the bound parameter 'credentials' of type 'AuthServer.Users.LoginRequest'.
2024-11-06 10:25:12.750 -03:00 [DBG] Entity Framework Core 8.0.10 initialized 'AuthServerContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:8.0.10' with options: None
2024-11-06 10:25:12.761 -03:00 [DBG] Compiling query expression: 
'DbSet<User>()
    .Include(u => u.Roles)
    .FirstOrDefault(u => u.Email == __email_0)'
2024-11-06 10:25:12.766 -03:00 [DBG] Including navigation: 'User.Roles'.
2024-11-06 10:25:12.790 -03:00 [DBG] Generated query execution expression: 
'queryContext => new SingleQueryingEnumerable<User>(
    (RelationalQueryContext)queryContext, 
    RelationalCommandCache.QueryExpression(
        Client Projections:
            0 -> Dictionary<IProperty, int> { [Property: User.ID (long) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: User.Email (string) Required Index, 1], [Property: User.Name (string) Required, 2], [Property: User.Password (string) Required, 3] }
            1 -> 0
            2 -> Dictionary<IProperty, int> { [Property: UserRole (Dictionary<string, object>).RoleId (no field, int) Indexer Required PK FK AfterSave:Throw, 4], [Property: UserRole (Dictionary<string, object>).UserId (no field, long) Indexer Required PK FK Index AfterSave:Throw, 5] }
            3 -> Dictionary<IProperty, int> { [Property: Role.Long (int) Required PK AfterSave:Throw ValueGenerated.OnAdd, 6], [Property: Role.Name (string) Required Index, 7] }
            4 -> 4
            5 -> 5
            6 -> 6
        SELECT t.ID, t.Email, t.Name, t.Password, t0.RoleId, t0.UserId, t0.Long, t0.Name
        FROM 
        (
            SELECT TOP(1) u.ID, u.Email, u.Name, u.Password
            FROM Users AS u
            WHERE u.Email == @__email_0
        ) AS t
        LEFT JOIN 
        (
            SELECT u0.RoleId, u0.UserId, r.Long, r.Name
            FROM UserRole AS u0
            INNER JOIN Roles AS r ON u0.RoleId == r.Long
        ) AS t0 ON t.ID == t0.UserId
        ORDER BY t.ID ASC, t0.RoleId ASC, t0.UserId ASC), 
    null, 
    Func<QueryContext, DbDataReader, ResultContext, SingleQueryResultCoordinator, User>, 
    AuthServer.AuthServerContext, 
    False, 
    False, 
    True
)
    .SingleOrDefault()'
2024-11-06 10:25:12.796 -03:00 [DBG] Creating DbConnection.
2024-11-06 10:25:12.797 -03:00 [DBG] Created DbConnection. (1ms).
2024-11-06 10:25:12.799 -03:00 [DBG] Opening connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:25:12.801 -03:00 [DBG] Opened connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:25:12.802 -03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2024-11-06 10:25:12.804 -03:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2024-11-06 10:25:12.809 -03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (6ms).
2024-11-06 10:25:12.812 -03:00 [DBG] Executing DbCommand [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[ID], [t].[Email], [t].[Name], [t].[Password], [t0].[RoleId], [t0].[UserId], [t0].[Long], [t0].[Name]
FROM (
    SELECT TOP(1) [u].[ID], [u].[Email], [u].[Name], [u].[Password]
    FROM [Users] AS [u]
    WHERE [u].[Email] = @__email_0
) AS [t]
LEFT JOIN (
    SELECT [u0].[RoleId], [u0].[UserId], [r].[Long], [r].[Name]
    FROM [UserRole] AS [u0]
    INNER JOIN [Roles] AS [r] ON [u0].[RoleId] = [r].[Long]
) AS [t0] ON [t].[ID] = [t0].[UserId]
ORDER BY [t].[ID], [t0].[RoleId], [t0].[UserId]
2024-11-06 10:25:12.831 -03:00 [INF] Executed DbCommand (20ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[ID], [t].[Email], [t].[Name], [t].[Password], [t0].[RoleId], [t0].[UserId], [t0].[Long], [t0].[Name]
FROM (
    SELECT TOP(1) [u].[ID], [u].[Email], [u].[Name], [u].[Password]
    FROM [Users] AS [u]
    WHERE [u].[Email] = @__email_0
) AS [t]
LEFT JOIN (
    SELECT [u0].[RoleId], [u0].[UserId], [r].[Long], [r].[Name]
    FROM [UserRole] AS [u0]
    INNER JOIN [Roles] AS [r] ON [u0].[RoleId] = [r].[Long]
) AS [t0] ON [t].[ID] = [t0].[UserId]
ORDER BY [t].[ID], [t0].[RoleId], [t0].[UserId]
2024-11-06 10:25:12.835 -03:00 [DBG] Context 'AuthServerContext' started tracking 'User' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 10:25:12.837 -03:00 [DBG] Context 'AuthServerContext' started tracking 'UserRole' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 10:25:12.839 -03:00 [DBG] Context 'AuthServerContext' started tracking 'Role' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 10:25:12.842 -03:00 [DBG] Closing data reader to 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:25:12.844 -03:00 [DBG] A data reader for 'AuthServer' on server 'localhost,1433' is being disposed after spending 9ms reading results.
2024-11-06 10:25:12.846 -03:00 [DBG] Closing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:25:12.848 -03:00 [DBG] Closed connection to database 'AuthServer' on server 'localhost,1433' (1ms).
2024-11-06 10:25:12.850 -03:00 [INF] User logged in. id=16 name=Auth Server Administrator
2024-11-06 10:25:12.961 -03:00 [DBG] List of registered output formatters, in the following order: ["Microsoft.AspNetCore.Mvc.Formatters.HttpNoContentOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StringOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StreamOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter"]
2024-11-06 10:25:12.964 -03:00 [DBG] No information found on request to perform content negotiation.
2024-11-06 10:25:12.965 -03:00 [DBG] Attempting to select an output formatter without using a content type as no explicit content types were specified for the response.
2024-11-06 10:25:12.966 -03:00 [DBG] Attempting to select the first formatter in the output formatters list which can write the result.
2024-11-06 10:25:12.967 -03:00 [DBG] Selected output formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter' and content type 'application/json' to write the response.
2024-11-06 10:25:12.969 -03:00 [INF] Executing OkObjectResult, writing value of type 'LoginResponse'.
2024-11-06 10:25:12.985 -03:00 [INF] Executed action AuthServer.Users.UsersController.Login (AuthServer) in 304.1076ms
2024-11-06 10:25:12.987 -03:00 [INF] Executed endpoint 'AuthServer.Users.UsersController.Login (AuthServer)'
2024-11-06 10:25:12.990 -03:00 [DBG] 'AuthServerContext' disposed.
2024-11-06 10:25:12.995 -03:00 [DBG] Disposing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:25:12.998 -03:00 [DBG] Disposed connection to database '' on server '' (3ms).
2024-11-06 10:25:13.000 -03:00 [INF] Request finished HTTP/2 POST https://localhost:7011/api/users/login - 200 null application/json; charset=utf-8 418.492ms
2024-11-06 10:25:32.869 -03:00 [DBG] Connection id "0HN7UCOR008OS" received FIN.
2024-11-06 10:25:32.871 -03:00 [DBG] Connection id "0HN7UCOR008OS" is closed. The last processed stream ID was 1.
2024-11-06 10:25:32.871 -03:00 [DBG] The connection queue processing loop for 0HN7UCOR008OS completed.
2024-11-06 10:25:32.873 -03:00 [DBG] Connection id "0HN7UCOR008OS" sending FIN because: "The Socket transport's send loop completed gracefully."
2024-11-06 10:25:32.886 -03:00 [DBG] Connection id "0HN7UCOR008OS" stopped.
2024-11-06 10:26:11.395 -03:00 [DBG] Connection id "0HN7UCOR008OT" accepted.
2024-11-06 10:26:11.397 -03:00 [DBG] Connection id "0HN7UCOR008OT" started.
2024-11-06 10:26:11.407 -03:00 [DBG] Connection 0HN7UCOR008OT established using the following protocol: "Tls13"
2024-11-06 10:26:11.409 -03:00 [INF] Request starting HTTP/2 DELETE https://localhost:7011/api/users/16 - null null
2024-11-06 10:26:11.413 -03:00 [DBG] 1 candidate(s) found for the request path '/api/users/16'
2024-11-06 10:26:11.415 -03:00 [DBG] Endpoint 'AuthServer.Users.UsersController.Delete (AuthServer)' with route pattern 'api/users/{id}' is valid for the request path '/api/users/16'
2024-11-06 10:26:11.417 -03:00 [DBG] Request matched endpoint 'AuthServer.Users.UsersController.Delete (AuthServer)'
2024-11-06 10:26:11.418 -03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2024-11-06 10:26:11.421 -03:00 [DBG] The request has an origin header: 'https://localhost:7011'.
2024-11-06 10:26:11.422 -03:00 [INF] CORS policy execution successful.
2024-11-06 10:26:11.425 -03:00 [DBG] AuthenticationScheme: Bearer was not authenticated.
2024-11-06 10:26:11.429 -03:00 [DBG] Policy authentication schemes  did not succeed
2024-11-06 10:26:11.435 -03:00 [INF] Authorization failed. These requirements were not met:
RolesAuthorizationRequirement:User.IsInRole must be true for one of the following roles: (ADMIN)
2024-11-06 10:26:11.441 -03:00 [INF] AuthenticationScheme: Bearer was challenged.
2024-11-06 10:26:11.443 -03:00 [INF] Request finished HTTP/2 DELETE https://localhost:7011/api/users/16 - 401 0 null 34.2034ms
2024-11-06 10:26:16.682 -03:00 [INF] Request starting HTTP/2 GET https://localhost:7011/api/users - null null
2024-11-06 10:26:16.688 -03:00 [DBG] 1 candidate(s) found for the request path '/api/users'
2024-11-06 10:26:16.689 -03:00 [DBG] Endpoint 'AuthServer.Users.UsersController.ListUsers (AuthServer)' with route pattern 'api/users' is valid for the request path '/api/users'
2024-11-06 10:26:16.691 -03:00 [DBG] Request matched endpoint 'AuthServer.Users.UsersController.ListUsers (AuthServer)'
2024-11-06 10:26:16.692 -03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2024-11-06 10:26:16.698 -03:00 [DBG] AuthenticationScheme: Bearer was not authenticated.
2024-11-06 10:26:16.701 -03:00 [INF] Executing endpoint 'AuthServer.Users.UsersController.ListUsers (AuthServer)'
2024-11-06 10:26:16.707 -03:00 [INF] Route matched with {action = "ListUsers", controller = "Users"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.ActionResult`1[System.Collections.Generic.List`1[AuthServer.Users.responses.UserResponse]] ListUsers(System.String) on controller AuthServer.Users.UsersController (AuthServer).
2024-11-06 10:26:16.709 -03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2024-11-06 10:26:16.711 -03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2024-11-06 10:26:16.713 -03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)"]
2024-11-06 10:26:16.715 -03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2024-11-06 10:26:16.717 -03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)"]
2024-11-06 10:26:16.718 -03:00 [DBG] Executing controller factory for controller AuthServer.Users.UsersController (AuthServer)
2024-11-06 10:26:16.721 -03:00 [DBG] Executed controller factory for controller AuthServer.Users.UsersController (AuthServer)
2024-11-06 10:26:16.723 -03:00 [DBG] Attempting to bind parameter 'role' of type 'System.String' ...
2024-11-06 10:26:16.725 -03:00 [DBG] Attempting to bind parameter 'role' of type 'System.String' using the name '' in request data ...
2024-11-06 10:26:16.728 -03:00 [DBG] Could not find a value in the request with name '' for binding parameter 'role' of type 'System.String'.
2024-11-06 10:26:16.730 -03:00 [DBG] Done attempting to bind parameter 'role' of type 'System.String'.
2024-11-06 10:26:16.731 -03:00 [DBG] Done attempting to bind parameter 'role' of type 'System.String'.
2024-11-06 10:26:16.733 -03:00 [DBG] Attempting to validate the bound parameter 'role' of type 'System.String' ...
2024-11-06 10:26:16.735 -03:00 [DBG] Done attempting to validate the bound parameter 'role' of type 'System.String'.
2024-11-06 10:26:16.805 -03:00 [DBG] Entity Framework Core 8.0.10 initialized 'AuthServerContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:8.0.10' with options: None
2024-11-06 10:26:16.811 -03:00 [DBG] Creating DbConnection.
2024-11-06 10:26:16.812 -03:00 [DBG] Created DbConnection. (1ms).
2024-11-06 10:26:16.814 -03:00 [DBG] Opening connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:26:16.815 -03:00 [DBG] Opened connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:26:16.817 -03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2024-11-06 10:26:16.818 -03:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2024-11-06 10:26:16.820 -03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (3ms).
2024-11-06 10:26:16.822 -03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[ID], [u].[Email], [u].[Name], [u].[Password], [t].[RoleId], [t].[UserId], [t].[Long], [t].[Name]
FROM [Users] AS [u]
LEFT JOIN (
    SELECT [u0].[RoleId], [u0].[UserId], [r].[Long], [r].[Name]
    FROM [UserRole] AS [u0]
    INNER JOIN [Roles] AS [r] ON [u0].[RoleId] = [r].[Long]
) AS [t] ON [u].[ID] = [t].[UserId]
ORDER BY [u].[ID], [t].[RoleId], [t].[UserId]
2024-11-06 10:26:16.828 -03:00 [INF] Executed DbCommand (6ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[ID], [u].[Email], [u].[Name], [u].[Password], [t].[RoleId], [t].[UserId], [t].[Long], [t].[Name]
FROM [Users] AS [u]
LEFT JOIN (
    SELECT [u0].[RoleId], [u0].[UserId], [r].[Long], [r].[Name]
    FROM [UserRole] AS [u0]
    INNER JOIN [Roles] AS [r] ON [u0].[RoleId] = [r].[Long]
) AS [t] ON [u].[ID] = [t].[UserId]
ORDER BY [u].[ID], [t].[RoleId], [t].[UserId]
2024-11-06 10:26:16.831 -03:00 [DBG] Context 'AuthServerContext' started tracking 'User' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 10:26:16.833 -03:00 [DBG] Context 'AuthServerContext' started tracking 'UserRole' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 10:26:16.835 -03:00 [DBG] Context 'AuthServerContext' started tracking 'Role' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 10:26:16.837 -03:00 [DBG] Closing data reader to 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:26:16.839 -03:00 [DBG] A data reader for 'AuthServer' on server 'localhost,1433' is being disposed after spending 8ms reading results.
2024-11-06 10:26:16.840 -03:00 [DBG] Closing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:26:16.842 -03:00 [DBG] Closed connection to database 'AuthServer' on server 'localhost,1433' (1ms).
2024-11-06 10:26:16.845 -03:00 [DBG] List of registered output formatters, in the following order: ["Microsoft.AspNetCore.Mvc.Formatters.HttpNoContentOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StringOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StreamOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter"]
2024-11-06 10:26:16.849 -03:00 [DBG] Attempting to select an output formatter based on Accept header '["text/plain"]'.
2024-11-06 10:26:16.851 -03:00 [DBG] Could not find an output formatter based on content negotiation. Accepted types were (["text/plain"])
2024-11-06 10:26:16.853 -03:00 [DBG] Attempting to select an output formatter without using a content type as no explicit content types were specified for the response.
2024-11-06 10:26:16.854 -03:00 [DBG] Attempting to select the first formatter in the output formatters list which can write the result.
2024-11-06 10:26:16.855 -03:00 [DBG] Selected output formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter' and content type 'application/json' to write the response.
2024-11-06 10:26:16.857 -03:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[AuthServer.Users.responses.UserResponse, AuthServer, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2024-11-06 10:26:16.864 -03:00 [INF] Executed action AuthServer.Users.UsersController.ListUsers (AuthServer) in 145.7754ms
2024-11-06 10:26:16.867 -03:00 [INF] Executed endpoint 'AuthServer.Users.UsersController.ListUsers (AuthServer)'
2024-11-06 10:26:16.869 -03:00 [DBG] 'AuthServerContext' disposed.
2024-11-06 10:26:16.871 -03:00 [DBG] Disposing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:26:16.873 -03:00 [DBG] Disposed connection to database '' on server '' (1ms).
2024-11-06 10:26:16.874 -03:00 [INF] Request finished HTTP/2 GET https://localhost:7011/api/users - 200 null application/json; charset=utf-8 192.2162ms
2024-11-06 10:28:01.114 -03:00 [INF] Aplicação iniciada - configuração de logs inicializada.
2024-11-06 10:28:01.407 -03:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2024-11-06 10:28:01.472 -03:00 [DBG] Hosting starting
2024-11-06 10:28:01.499 -03:00 [INF] User profile is available. Using 'C:\Users\gusta\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2024-11-06 10:28:01.507 -03:00 [DBG] Reading data from file 'C:\Users\gusta\AppData\Local\ASP.NET\DataProtection-Keys\key-bf4636f6-ef08-4ac9-8613-5c8299c406a4.xml'.
2024-11-06 10:28:01.517 -03:00 [DBG] Found key {bf4636f6-ef08-4ac9-8613-5c8299c406a4}.
2024-11-06 10:28:01.526 -03:00 [DBG] Considering key {bf4636f6-ef08-4ac9-8613-5c8299c406a4} with expiration date 2025-02-02 14:46:39Z as default key.
2024-11-06 10:28:01.530 -03:00 [DBG] Forwarded activator type request from Microsoft.AspNetCore.DataProtection.XmlEncryption.DpapiXmlDecryptor, Microsoft.AspNetCore.DataProtection, Version=8.0.0.0, Culture=neutral, PublicKeyToken=adb9793829ddae60 to Microsoft.AspNetCore.DataProtection.XmlEncryption.DpapiXmlDecryptor, Microsoft.AspNetCore.DataProtection, Culture=neutral, PublicKeyToken=adb9793829ddae60
2024-11-06 10:28:01.533 -03:00 [DBG] Decrypting secret element using Windows DPAPI.
2024-11-06 10:28:01.535 -03:00 [DBG] Forwarded activator type request from Microsoft.AspNetCore.DataProtection.AuthenticatedEncryption.ConfigurationModel.AuthenticatedEncryptorDescriptorDeserializer, Microsoft.AspNetCore.DataProtection, Version=8.0.0.0, Culture=neutral, PublicKeyToken=adb9793829ddae60 to Microsoft.AspNetCore.DataProtection.AuthenticatedEncryption.ConfigurationModel.AuthenticatedEncryptorDescriptorDeserializer, Microsoft.AspNetCore.DataProtection, Culture=neutral, PublicKeyToken=adb9793829ddae60
2024-11-06 10:28:01.543 -03:00 [DBG] Opening CNG algorithm 'AES' from provider 'null' with chaining mode CBC.
2024-11-06 10:28:01.545 -03:00 [DBG] Opening CNG algorithm 'SHA256' from provider 'null' with HMAC.
2024-11-06 10:28:01.548 -03:00 [DBG] Using key {bf4636f6-ef08-4ac9-8613-5c8299c406a4} as the default key.
2024-11-06 10:28:01.550 -03:00 [DBG] Key ring with default key {bf4636f6-ef08-4ac9-8613-5c8299c406a4} was loaded during application startup.
2024-11-06 10:28:01.635 -03:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2024-11-06 10:28:02.080 -03:00 [DBG] The index {'RoleId'} was not created on entity type 'UserRole (Dictionary<string, object>)' as the properties are already covered by the index {'RoleId', 'UserId'}.
2024-11-06 10:28:02.323 -03:00 [DBG] Entity Framework Core 8.0.10 initialized 'AuthServerContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:8.0.10' with options: None
2024-11-06 10:28:02.372 -03:00 [DBG] Compiling query expression: 
'DbSet<Role>()
    .Count()'
2024-11-06 10:28:02.564 -03:00 [DBG] Generated query execution expression: 
'queryContext => new SingleQueryingEnumerable<int>(
    (RelationalQueryContext)queryContext, 
    RelationalCommandCache.QueryExpression(
        Projection Mapping:
            EmptyProjectionMember -> 0
        SELECT COUNT(*)
        FROM Roles AS r), 
    null, 
    Func<QueryContext, DbDataReader, ResultContext, SingleQueryResultCoordinator, int>, 
    AuthServer.AuthServerContext, 
    False, 
    False, 
    True
)
    .Single()'
2024-11-06 10:28:02.589 -03:00 [DBG] Creating DbConnection.
2024-11-06 10:28:02.607 -03:00 [DBG] Created DbConnection. (16ms).
2024-11-06 10:28:02.610 -03:00 [DBG] Opening connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:28:02.798 -03:00 [DBG] Opened connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:28:02.802 -03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2024-11-06 10:28:02.810 -03:00 [DBG] Created DbCommand for 'ExecuteReader' (4ms).
2024-11-06 10:28:02.813 -03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (11ms).
2024-11-06 10:28:02.821 -03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*)
FROM [Roles] AS [r]
2024-11-06 10:28:02.849 -03:00 [INF] Executed DbCommand (26ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*)
FROM [Roles] AS [r]
2024-11-06 10:28:02.860 -03:00 [DBG] Closing data reader to 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:28:02.867 -03:00 [DBG] A data reader for 'AuthServer' on server 'localhost,1433' is being disposed after spending 11ms reading results.
2024-11-06 10:28:02.871 -03:00 [DBG] Closing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:28:02.877 -03:00 [DBG] Closed connection to database 'AuthServer' on server 'localhost,1433' (6ms).
2024-11-06 10:28:02.886 -03:00 [DBG] Compiling query expression: 
'DbSet<User>()
    .Include(user => user.Roles)'
2024-11-06 10:28:02.902 -03:00 [DBG] Including navigation: 'User.Roles'.
2024-11-06 10:28:03.008 -03:00 [DBG] Generated query execution expression: 
'queryContext => new SingleQueryingEnumerable<User>(
    (RelationalQueryContext)queryContext, 
    RelationalCommandCache.QueryExpression(
        Client Projections:
            0 -> Dictionary<IProperty, int> { [Property: User.ID (long) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: User.Email (string) Required Index, 1], [Property: User.Name (string) Required, 2], [Property: User.Password (string) Required, 3] }
            1 -> 0
            2 -> Dictionary<IProperty, int> { [Property: UserRole (Dictionary<string, object>).RoleId (no field, int) Indexer Required PK FK AfterSave:Throw, 4], [Property: UserRole (Dictionary<string, object>).UserId (no field, long) Indexer Required PK FK Index AfterSave:Throw, 5] }
            3 -> Dictionary<IProperty, int> { [Property: Role.Long (int) Required PK AfterSave:Throw ValueGenerated.OnAdd, 6], [Property: Role.Name (string) Required Index, 7] }
            4 -> 4
            5 -> 5
            6 -> 6
        SELECT u.ID, u.Email, u.Name, u.Password, t.RoleId, t.UserId, t.Long, t.Name
        FROM Users AS u
        LEFT JOIN 
        (
            SELECT u0.RoleId, u0.UserId, r.Long, r.Name
            FROM UserRole AS u0
            INNER JOIN Roles AS r ON u0.RoleId == r.Long
        ) AS t ON u.ID == t.UserId
        ORDER BY u.ID ASC, t.RoleId ASC, t.UserId ASC), 
    null, 
    Func<QueryContext, DbDataReader, ResultContext, SingleQueryResultCoordinator, User>, 
    AuthServer.AuthServerContext, 
    False, 
    False, 
    True
)'
2024-11-06 10:28:03.017 -03:00 [DBG] Opening connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:28:03.019 -03:00 [DBG] Opened connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:28:03.020 -03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2024-11-06 10:28:03.021 -03:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2024-11-06 10:28:03.022 -03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (2ms).
2024-11-06 10:28:03.025 -03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[ID], [u].[Email], [u].[Name], [u].[Password], [t].[RoleId], [t].[UserId], [t].[Long], [t].[Name]
FROM [Users] AS [u]
LEFT JOIN (
    SELECT [u0].[RoleId], [u0].[UserId], [r].[Long], [r].[Name]
    FROM [UserRole] AS [u0]
    INNER JOIN [Roles] AS [r] ON [u0].[RoleId] = [r].[Long]
) AS [t] ON [u].[ID] = [t].[UserId]
ORDER BY [u].[ID], [t].[RoleId], [t].[UserId]
2024-11-06 10:28:03.032 -03:00 [INF] Executed DbCommand (7ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[ID], [u].[Email], [u].[Name], [u].[Password], [t].[RoleId], [t].[UserId], [t].[Long], [t].[Name]
FROM [Users] AS [u]
LEFT JOIN (
    SELECT [u0].[RoleId], [u0].[UserId], [r].[Long], [r].[Name]
    FROM [UserRole] AS [u0]
    INNER JOIN [Roles] AS [r] ON [u0].[RoleId] = [r].[Long]
) AS [t] ON [u].[ID] = [t].[UserId]
ORDER BY [u].[ID], [t].[RoleId], [t].[UserId]
2024-11-06 10:28:03.066 -03:00 [DBG] Context 'AuthServerContext' started tracking 'User' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 10:28:03.104 -03:00 [DBG] Context 'AuthServerContext' started tracking 'UserRole' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 10:28:03.122 -03:00 [DBG] Context 'AuthServerContext' started tracking 'Role' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 10:28:03.126 -03:00 [DBG] Closing data reader to 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:28:03.127 -03:00 [DBG] A data reader for 'AuthServer' on server 'localhost,1433' is being disposed after spending 92ms reading results.
2024-11-06 10:28:03.129 -03:00 [DBG] Closing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:28:03.130 -03:00 [DBG] Closed connection to database 'AuthServer' on server 'localhost,1433' (1ms).
2024-11-06 10:28:03.134 -03:00 [DBG] 'AuthServerContext' disposed.
2024-11-06 10:28:03.138 -03:00 [DBG] Disposing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:28:03.140 -03:00 [DBG] Disposed connection to database '' on server '' (2ms).
2024-11-06 10:28:03.241 -03:00 [INF] Now listening on: https://localhost:7011
2024-11-06 10:28:03.245 -03:00 [INF] Now listening on: http://localhost:5091
2024-11-06 10:28:03.246 -03:00 [DBG] Loaded hosting startup assembly AuthServer
2024-11-06 10:28:03.249 -03:00 [DBG] Loaded hosting startup assembly Microsoft.AspNetCore.Watch.BrowserRefresh
2024-11-06 10:28:03.250 -03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.BrowserLink.Net
2024-11-06 10:28:03.251 -03:00 [INF] Application started. Press Ctrl+C to shut down.
2024-11-06 10:28:03.252 -03:00 [INF] Hosting environment: Development
2024-11-06 10:28:03.253 -03:00 [INF] Content root path: C:\Users\gusta\source\repos\AuthServer\AuthServer
2024-11-06 10:28:03.254 -03:00 [DBG] Hosting started
2024-11-06 10:28:03.551 -03:00 [DBG] Connection id "0HN7UCRBO41D5" received FIN.
2024-11-06 10:28:03.556 -03:00 [DBG] Connection id "0HN7UCRBO41D5" accepted.
2024-11-06 10:28:03.558 -03:00 [DBG] Connection id "0HN7UCRBO41D5" started.
2024-11-06 10:28:03.571 -03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2024-11-06 10:28:03.587 -03:00 [DBG] Connection id "0HN7UCRBO41D5" stopped.
2024-11-06 10:28:03.590 -03:00 [DBG] Connection id "0HN7UCRBO41D5" sending FIN because: "The Socket transport's send loop completed gracefully."
2024-11-06 10:28:10.167 -03:00 [DBG] Connection id "0HN7UCRBO41D6" accepted.
2024-11-06 10:28:10.169 -03:00 [DBG] Connection id "0HN7UCRBO41D6" received FIN.
2024-11-06 10:28:10.170 -03:00 [DBG] Connection id "0HN7UCRBO41D6" started.
2024-11-06 10:28:10.170 -03:00 [DBG] Connection id "0HN7UCRBO41D7" accepted.
2024-11-06 10:28:10.173 -03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2024-11-06 10:28:10.173 -03:00 [DBG] Connection id "0HN7UCRBO41D7" started.
2024-11-06 10:28:10.176 -03:00 [DBG] Connection id "0HN7UCRBO41D6" stopped.
2024-11-06 10:28:10.177 -03:00 [DBG] Connection id "0HN7UCRBO41D6" sending FIN because: "The Socket transport's send loop completed gracefully."
2024-11-06 10:28:10.202 -03:00 [DBG] Connection 0HN7UCRBO41D7 established using the following protocol: "Tls13"
2024-11-06 10:28:10.229 -03:00 [INF] Request starting HTTP/1.1 GET https://localhost:7011/api/users - application/json 67
2024-11-06 10:28:10.240 -03:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2024-11-06 10:28:10.267 -03:00 [DBG] 1 candidate(s) found for the request path '/api/users'
2024-11-06 10:28:10.269 -03:00 [DBG] Endpoint 'AuthServer.Users.UsersController.ListUsers (AuthServer)' with route pattern 'api/users' is valid for the request path '/api/users'
2024-11-06 10:28:10.271 -03:00 [DBG] Request matched endpoint 'AuthServer.Users.UsersController.ListUsers (AuthServer)'
2024-11-06 10:28:10.288 -03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2024-11-06 10:28:10.394 -03:00 [DBG] Successfully validated the token.
2024-11-06 10:28:10.397 -03:00 [DBG] AuthenticationScheme: Bearer was successfully authenticated.
2024-11-06 10:28:10.402 -03:00 [INF] Executing endpoint 'AuthServer.Users.UsersController.ListUsers (AuthServer)'
2024-11-06 10:28:10.426 -03:00 [INF] Route matched with {action = "ListUsers", controller = "Users"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.ActionResult`1[System.Collections.Generic.List`1[AuthServer.Users.responses.UserResponse]] ListUsers(System.String) on controller AuthServer.Users.UsersController (AuthServer).
2024-11-06 10:28:10.431 -03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2024-11-06 10:28:10.434 -03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2024-11-06 10:28:10.437 -03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)"]
2024-11-06 10:28:10.439 -03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2024-11-06 10:28:10.441 -03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)"]
2024-11-06 10:28:10.444 -03:00 [DBG] Executing controller factory for controller AuthServer.Users.UsersController (AuthServer)
2024-11-06 10:28:10.448 -03:00 [DBG] Executed controller factory for controller AuthServer.Users.UsersController (AuthServer)
2024-11-06 10:28:10.455 -03:00 [DBG] Attempting to bind parameter 'role' of type 'System.String' ...
2024-11-06 10:28:10.458 -03:00 [DBG] Attempting to bind parameter 'role' of type 'System.String' using the name '' in request data ...
2024-11-06 10:28:10.460 -03:00 [DBG] Could not find a value in the request with name '' for binding parameter 'role' of type 'System.String'.
2024-11-06 10:28:10.462 -03:00 [DBG] Done attempting to bind parameter 'role' of type 'System.String'.
2024-11-06 10:28:10.465 -03:00 [DBG] Done attempting to bind parameter 'role' of type 'System.String'.
2024-11-06 10:28:10.467 -03:00 [DBG] Attempting to validate the bound parameter 'role' of type 'System.String' ...
2024-11-06 10:28:10.469 -03:00 [DBG] Done attempting to validate the bound parameter 'role' of type 'System.String'.
2024-11-06 10:28:10.490 -03:00 [DBG] Entity Framework Core 8.0.10 initialized 'AuthServerContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:8.0.10' with options: None
2024-11-06 10:28:10.495 -03:00 [DBG] Creating DbConnection.
2024-11-06 10:28:10.497 -03:00 [DBG] Created DbConnection. (2ms).
2024-11-06 10:28:10.500 -03:00 [DBG] Opening connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:28:10.501 -03:00 [DBG] Opened connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:28:10.502 -03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2024-11-06 10:28:10.504 -03:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2024-11-06 10:28:10.505 -03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (3ms).
2024-11-06 10:28:10.507 -03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[ID], [u].[Email], [u].[Name], [u].[Password], [t].[RoleId], [t].[UserId], [t].[Long], [t].[Name]
FROM [Users] AS [u]
LEFT JOIN (
    SELECT [u0].[RoleId], [u0].[UserId], [r].[Long], [r].[Name]
    FROM [UserRole] AS [u0]
    INNER JOIN [Roles] AS [r] ON [u0].[RoleId] = [r].[Long]
) AS [t] ON [u].[ID] = [t].[UserId]
ORDER BY [u].[ID], [t].[RoleId], [t].[UserId]
2024-11-06 10:28:10.511 -03:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[ID], [u].[Email], [u].[Name], [u].[Password], [t].[RoleId], [t].[UserId], [t].[Long], [t].[Name]
FROM [Users] AS [u]
LEFT JOIN (
    SELECT [u0].[RoleId], [u0].[UserId], [r].[Long], [r].[Name]
    FROM [UserRole] AS [u0]
    INNER JOIN [Roles] AS [r] ON [u0].[RoleId] = [r].[Long]
) AS [t] ON [u].[ID] = [t].[UserId]
ORDER BY [u].[ID], [t].[RoleId], [t].[UserId]
2024-11-06 10:28:10.515 -03:00 [DBG] Context 'AuthServerContext' started tracking 'User' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 10:28:10.517 -03:00 [DBG] Context 'AuthServerContext' started tracking 'UserRole' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 10:28:10.519 -03:00 [DBG] Context 'AuthServerContext' started tracking 'Role' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 10:28:10.521 -03:00 [DBG] Closing data reader to 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:28:10.522 -03:00 [DBG] A data reader for 'AuthServer' on server 'localhost,1433' is being disposed after spending 7ms reading results.
2024-11-06 10:28:10.524 -03:00 [DBG] Closing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:28:10.525 -03:00 [DBG] Closed connection to database 'AuthServer' on server 'localhost,1433' (1ms).
2024-11-06 10:28:10.530 -03:00 [DBG] List of registered output formatters, in the following order: ["Microsoft.AspNetCore.Mvc.Formatters.HttpNoContentOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StringOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StreamOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter"]
2024-11-06 10:28:10.534 -03:00 [DBG] No information found on request to perform content negotiation.
2024-11-06 10:28:10.535 -03:00 [DBG] Attempting to select an output formatter without using a content type as no explicit content types were specified for the response.
2024-11-06 10:28:10.536 -03:00 [DBG] Attempting to select the first formatter in the output formatters list which can write the result.
2024-11-06 10:28:10.538 -03:00 [DBG] Selected output formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter' and content type 'application/json' to write the response.
2024-11-06 10:28:10.540 -03:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[AuthServer.Users.responses.UserResponse, AuthServer, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2024-11-06 10:28:10.612 -03:00 [INF] Executed action AuthServer.Users.UsersController.ListUsers (AuthServer) in 166.9217ms
2024-11-06 10:28:10.616 -03:00 [INF] Executed endpoint 'AuthServer.Users.UsersController.ListUsers (AuthServer)'
2024-11-06 10:28:10.618 -03:00 [DBG] Connection id "0HN7UCRBO41D7" completed keep alive response.
2024-11-06 10:28:10.622 -03:00 [DBG] 'AuthServerContext' disposed.
2024-11-06 10:28:10.626 -03:00 [DBG] Disposing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:28:10.628 -03:00 [DBG] Disposed connection to database '' on server '' (2ms).
2024-11-06 10:28:10.631 -03:00 [INF] Request finished HTTP/1.1 GET https://localhost:7011/api/users - 200 null application/json; charset=utf-8 402.9282ms
2024-11-06 10:28:10.636 -03:00 [DBG] Connection id "0HN7UCRBO41D7", Request id "0HN7UCRBO41D7:00000001": started reading request body.
2024-11-06 10:28:10.638 -03:00 [DBG] Connection id "0HN7UCRBO41D7", Request id "0HN7UCRBO41D7:00000001": done reading request body.
2024-11-06 10:28:38.525 -03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7011/api/users - application/json 95
2024-11-06 10:28:38.528 -03:00 [DBG] 1 candidate(s) found for the request path '/api/users'
2024-11-06 10:28:38.530 -03:00 [DBG] Endpoint 'AuthServer.Users.UsersController.CreateUser (AuthServer)' with route pattern 'api/users' is valid for the request path '/api/users'
2024-11-06 10:28:38.532 -03:00 [DBG] Request matched endpoint 'AuthServer.Users.UsersController.CreateUser (AuthServer)'
2024-11-06 10:28:38.535 -03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2024-11-06 10:28:38.538 -03:00 [DBG] Successfully validated the token.
2024-11-06 10:28:38.540 -03:00 [DBG] AuthenticationScheme: Bearer was successfully authenticated.
2024-11-06 10:28:38.541 -03:00 [INF] Executing endpoint 'AuthServer.Users.UsersController.CreateUser (AuthServer)'
2024-11-06 10:28:38.545 -03:00 [INF] Route matched with {action = "CreateUser", controller = "Users"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.ActionResult`1[AuthServer.Users.responses.UserResponse] CreateUser(AuthServer.Users.requests.UserRequest) on controller AuthServer.Users.UsersController (AuthServer).
2024-11-06 10:28:38.547 -03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2024-11-06 10:28:38.550 -03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2024-11-06 10:28:38.551 -03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)"]
2024-11-06 10:28:38.553 -03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2024-11-06 10:28:38.554 -03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)"]
2024-11-06 10:28:38.556 -03:00 [DBG] Executing controller factory for controller AuthServer.Users.UsersController (AuthServer)
2024-11-06 10:28:38.558 -03:00 [DBG] Executed controller factory for controller AuthServer.Users.UsersController (AuthServer)
2024-11-06 10:28:38.560 -03:00 [DBG] Attempting to bind parameter 'req' of type 'AuthServer.Users.requests.UserRequest' ...
2024-11-06 10:28:38.562 -03:00 [DBG] Attempting to bind parameter 'req' of type 'AuthServer.Users.requests.UserRequest' using the name '' in request data ...
2024-11-06 10:28:38.566 -03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2024-11-06 10:28:38.573 -03:00 [DBG] Connection id "0HN7UCRBO41D7", Request id "0HN7UCRBO41D7:00000002": started reading request body.
2024-11-06 10:28:38.584 -03:00 [DBG] Connection id "0HN7UCRBO41D7", Request id "0HN7UCRBO41D7:00000002": done reading request body.
2024-11-06 10:28:38.589 -03:00 [DBG] JSON input formatter succeeded, deserializing to type 'AuthServer.Users.requests.UserRequest'
2024-11-06 10:28:38.590 -03:00 [DBG] Done attempting to bind parameter 'req' of type 'AuthServer.Users.requests.UserRequest'.
2024-11-06 10:28:38.591 -03:00 [DBG] Done attempting to bind parameter 'req' of type 'AuthServer.Users.requests.UserRequest'.
2024-11-06 10:28:38.593 -03:00 [DBG] Attempting to validate the bound parameter 'req' of type 'AuthServer.Users.requests.UserRequest' ...
2024-11-06 10:28:38.605 -03:00 [DBG] Done attempting to validate the bound parameter 'req' of type 'AuthServer.Users.requests.UserRequest'.
2024-11-06 10:28:38.673 -03:00 [DBG] Entity Framework Core 8.0.10 initialized 'AuthServerContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:8.0.10' with options: None
2024-11-06 10:28:38.677 -03:00 [DBG] Creating DbConnection.
2024-11-06 10:28:38.682 -03:00 [DBG] Created DbConnection. (4ms).
2024-11-06 10:28:38.683 -03:00 [DBG] Opening connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:28:38.695 -03:00 [DBG] Opened connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:28:38.701 -03:00 [DBG] Enlisted in an ambient transaction with isolation level 'Serializable'.
2024-11-06 10:28:38.703 -03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2024-11-06 10:28:38.705 -03:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2024-11-06 10:28:38.706 -03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (2ms).
2024-11-06 10:28:38.707 -03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[ID], [u].[Email], [u].[Name], [u].[Password], [t].[RoleId], [t].[UserId], [t].[Long], [t].[Name]
FROM [Users] AS [u]
LEFT JOIN (
    SELECT [u0].[RoleId], [u0].[UserId], [r].[Long], [r].[Name]
    FROM [UserRole] AS [u0]
    INNER JOIN [Roles] AS [r] ON [u0].[RoleId] = [r].[Long]
) AS [t] ON [u].[ID] = [t].[UserId]
ORDER BY [u].[ID], [t].[RoleId], [t].[UserId]
2024-11-06 10:28:38.712 -03:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[ID], [u].[Email], [u].[Name], [u].[Password], [t].[RoleId], [t].[UserId], [t].[Long], [t].[Name]
FROM [Users] AS [u]
LEFT JOIN (
    SELECT [u0].[RoleId], [u0].[UserId], [r].[Long], [r].[Name]
    FROM [UserRole] AS [u0]
    INNER JOIN [Roles] AS [r] ON [u0].[RoleId] = [r].[Long]
) AS [t] ON [u].[ID] = [t].[UserId]
ORDER BY [u].[ID], [t].[RoleId], [t].[UserId]
2024-11-06 10:28:38.717 -03:00 [DBG] Context 'AuthServerContext' started tracking 'User' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 10:28:38.719 -03:00 [DBG] Context 'AuthServerContext' started tracking 'UserRole' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 10:28:38.720 -03:00 [DBG] Context 'AuthServerContext' started tracking 'Role' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 10:28:38.722 -03:00 [DBG] Closing data reader to 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:28:38.723 -03:00 [DBG] A data reader for 'AuthServer' on server 'localhost,1433' is being disposed after spending 6ms reading results.
2024-11-06 10:28:38.725 -03:00 [DBG] Closing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:28:38.727 -03:00 [DBG] Closed connection to database 'AuthServer' on server 'localhost,1433' (2ms).
2024-11-06 10:28:38.734 -03:00 [DBG] Compiling query expression: 
'DbSet<Role>()
    .FirstOrDefault(r => r.Name == __name_0)'
2024-11-06 10:28:38.744 -03:00 [DBG] Generated query execution expression: 
'queryContext => new SingleQueryingEnumerable<Role>(
    (RelationalQueryContext)queryContext, 
    RelationalCommandCache.QueryExpression(
        Projection Mapping:
            EmptyProjectionMember -> Dictionary<IProperty, int> { [Property: Role.Long (int) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: Role.Name (string) Required Index, 1] }
        SELECT TOP(1) r.Long, r.Name
        FROM Roles AS r
        WHERE r.Name == @__name_0), 
    null, 
    Func<QueryContext, DbDataReader, ResultContext, SingleQueryResultCoordinator, Role>, 
    AuthServer.AuthServerContext, 
    False, 
    False, 
    True
)
    .SingleOrDefault()'
2024-11-06 10:28:38.751 -03:00 [DBG] Opening connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:28:38.753 -03:00 [DBG] Opened connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:28:38.754 -03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2024-11-06 10:28:38.756 -03:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2024-11-06 10:28:38.760 -03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (5ms).
2024-11-06 10:28:38.766 -03:00 [DBG] Executing DbCommand [Parameters=[@__name_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [r].[Long], [r].[Name]
FROM [Roles] AS [r]
WHERE [r].[Name] = @__name_0
2024-11-06 10:28:38.790 -03:00 [INF] Executed DbCommand (28ms) [Parameters=[@__name_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [r].[Long], [r].[Name]
FROM [Roles] AS [r]
WHERE [r].[Name] = @__name_0
2024-11-06 10:28:38.793 -03:00 [DBG] Context 'AuthServerContext' started tracking 'Role' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 10:28:38.795 -03:00 [DBG] Closing data reader to 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:28:38.800 -03:00 [DBG] A data reader for 'AuthServer' on server 'localhost,1433' is being disposed after spending 7ms reading results.
2024-11-06 10:28:38.802 -03:00 [DBG] Closing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:28:38.803 -03:00 [DBG] Closed connection to database 'AuthServer' on server 'localhost,1433' (1ms).
2024-11-06 10:28:38.859 -03:00 [DBG] 'AuthServerContext' generated a temporary value for the property 'User.ID'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 10:28:38.875 -03:00 [DBG] Context 'AuthServerContext' started tracking 'User' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 10:28:38.889 -03:00 [DBG] Context 'AuthServerContext' started tracking 'UserRole' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 10:28:38.891 -03:00 [DBG] SaveChanges starting for 'AuthServerContext'.
2024-11-06 10:28:38.894 -03:00 [DBG] DetectChanges starting for 'AuthServerContext'.
2024-11-06 10:28:38.907 -03:00 [DBG] DetectChanges completed for 'AuthServerContext'.
2024-11-06 10:28:38.981 -03:00 [DBG] Opening connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:28:38.983 -03:00 [DBG] Opened connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:28:38.985 -03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2024-11-06 10:28:38.986 -03:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2024-11-06 10:28:38.988 -03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (2ms).
2024-11-06 10:28:38.989 -03:00 [DBG] Executing DbCommand [Parameters=[@p0='?' (Size = 450), @p1='?' (Size = 4000), @p2='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Users] ([Email], [Name], [Password])
OUTPUT INSERTED.[ID]
VALUES (@p0, @p1, @p2);
2024-11-06 10:28:38.998 -03:00 [INF] Executed DbCommand (9ms) [Parameters=[@p0='?' (Size = 450), @p1='?' (Size = 4000), @p2='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Users] ([Email], [Name], [Password])
OUTPUT INSERTED.[ID]
VALUES (@p0, @p1, @p2);
2024-11-06 10:28:39.009 -03:00 [DBG] The foreign key property 'User.ID' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2024-11-06 10:28:39.015 -03:00 [DBG] The foreign key property 'UserRole.UserId' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2024-11-06 10:28:39.021 -03:00 [DBG] Closing data reader to 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:28:39.022 -03:00 [DBG] A data reader for 'AuthServer' on server 'localhost,1433' is being disposed after spending 21ms reading results.
2024-11-06 10:28:39.025 -03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2024-11-06 10:28:39.026 -03:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2024-11-06 10:28:39.027 -03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (2ms).
2024-11-06 10:28:39.030 -03:00 [DBG] Executing DbCommand [Parameters=[@p3='?' (DbType = Int32), @p4='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [UserRole] ([RoleId], [UserId])
VALUES (@p3, @p4);
2024-11-06 10:28:39.038 -03:00 [INF] Executed DbCommand (9ms) [Parameters=[@p3='?' (DbType = Int32), @p4='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [UserRole] ([RoleId], [UserId])
VALUES (@p3, @p4);
2024-11-06 10:28:39.040 -03:00 [DBG] Closing data reader to 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:28:39.041 -03:00 [DBG] A data reader for 'AuthServer' on server 'localhost,1433' is being disposed after spending 1ms reading results.
2024-11-06 10:28:39.043 -03:00 [DBG] Closing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:28:39.044 -03:00 [DBG] Closed connection to database 'AuthServer' on server 'localhost,1433' (1ms).
2024-11-06 10:28:39.054 -03:00 [DBG] An entity of type 'User' tracked by 'AuthServerContext' changed state from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 10:28:39.057 -03:00 [DBG] An entity of type 'UserRole' tracked by 'AuthServerContext' changed state from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 10:28:39.060 -03:00 [DBG] SaveChanges completed for 'AuthServerContext' with 2 entities written to the database.
2024-11-06 10:28:39.072 -03:00 [DBG] List of registered output formatters, in the following order: ["Microsoft.AspNetCore.Mvc.Formatters.HttpNoContentOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StringOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StreamOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter"]
2024-11-06 10:28:39.074 -03:00 [DBG] No information found on request to perform content negotiation.
2024-11-06 10:28:39.075 -03:00 [DBG] Attempting to select an output formatter without using a content type as no explicit content types were specified for the response.
2024-11-06 10:28:39.076 -03:00 [DBG] Attempting to select the first formatter in the output formatters list which can write the result.
2024-11-06 10:28:39.077 -03:00 [DBG] Selected output formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter' and content type 'application/json' to write the response.
2024-11-06 10:28:39.078 -03:00 [INF] Executing CreatedAtActionResult, writing value of type 'AuthServer.Users.responses.UserResponse'.
2024-11-06 10:28:39.096 -03:00 [DBG] Found the endpoints ["AuthServer.Users.UsersController.GetUser (AuthServer)"] for address (id=[29],action=[GetUser],controller=[Users])
2024-11-06 10:28:39.100 -03:00 [DBG] Successfully processed template api/users/{id} for AuthServer.Users.UsersController.GetUser (AuthServer) resulting in /api/users/29 and 
2024-11-06 10:28:39.102 -03:00 [DBG] Link generation succeeded for endpoints ["AuthServer.Users.UsersController.GetUser (AuthServer)"] with result /api/users/29
2024-11-06 10:28:39.105 -03:00 [INF] Executed action AuthServer.Users.UsersController.CreateUser (AuthServer) in 549.1539ms
2024-11-06 10:28:39.106 -03:00 [INF] Executed endpoint 'AuthServer.Users.UsersController.CreateUser (AuthServer)'
2024-11-06 10:28:39.107 -03:00 [DBG] Connection id "0HN7UCRBO41D7" completed keep alive response.
2024-11-06 10:28:39.108 -03:00 [DBG] 'AuthServerContext' disposed.
2024-11-06 10:28:39.110 -03:00 [DBG] Disposing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:28:39.111 -03:00 [DBG] Disposed connection to database '' on server '' (1ms).
2024-11-06 10:28:39.115 -03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7011/api/users - 201 null application/json; charset=utf-8 590.0244ms
2024-11-06 10:28:45.119 -03:00 [INF] Request starting HTTP/1.1 GET https://localhost:7011/api/users - application/json 95
2024-11-06 10:28:45.122 -03:00 [DBG] 1 candidate(s) found for the request path '/api/users'
2024-11-06 10:28:45.123 -03:00 [DBG] Endpoint 'AuthServer.Users.UsersController.ListUsers (AuthServer)' with route pattern 'api/users' is valid for the request path '/api/users'
2024-11-06 10:28:45.125 -03:00 [DBG] Request matched endpoint 'AuthServer.Users.UsersController.ListUsers (AuthServer)'
2024-11-06 10:28:45.127 -03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2024-11-06 10:28:45.132 -03:00 [DBG] Successfully validated the token.
2024-11-06 10:28:45.133 -03:00 [DBG] AuthenticationScheme: Bearer was successfully authenticated.
2024-11-06 10:28:45.134 -03:00 [INF] Executing endpoint 'AuthServer.Users.UsersController.ListUsers (AuthServer)'
2024-11-06 10:28:45.135 -03:00 [INF] Route matched with {action = "ListUsers", controller = "Users"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.ActionResult`1[System.Collections.Generic.List`1[AuthServer.Users.responses.UserResponse]] ListUsers(System.String) on controller AuthServer.Users.UsersController (AuthServer).
2024-11-06 10:28:45.138 -03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2024-11-06 10:28:45.139 -03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2024-11-06 10:28:45.141 -03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)"]
2024-11-06 10:28:45.142 -03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2024-11-06 10:28:45.144 -03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)"]
2024-11-06 10:28:45.145 -03:00 [DBG] Executing controller factory for controller AuthServer.Users.UsersController (AuthServer)
2024-11-06 10:28:45.149 -03:00 [DBG] Executed controller factory for controller AuthServer.Users.UsersController (AuthServer)
2024-11-06 10:28:45.151 -03:00 [DBG] Attempting to bind parameter 'role' of type 'System.String' ...
2024-11-06 10:28:45.152 -03:00 [DBG] Attempting to bind parameter 'role' of type 'System.String' using the name '' in request data ...
2024-11-06 10:28:45.154 -03:00 [DBG] Could not find a value in the request with name '' for binding parameter 'role' of type 'System.String'.
2024-11-06 10:28:45.155 -03:00 [DBG] Done attempting to bind parameter 'role' of type 'System.String'.
2024-11-06 10:28:45.157 -03:00 [DBG] Done attempting to bind parameter 'role' of type 'System.String'.
2024-11-06 10:28:45.158 -03:00 [DBG] Attempting to validate the bound parameter 'role' of type 'System.String' ...
2024-11-06 10:28:45.159 -03:00 [DBG] Done attempting to validate the bound parameter 'role' of type 'System.String'.
2024-11-06 10:28:45.161 -03:00 [DBG] Entity Framework Core 8.0.10 initialized 'AuthServerContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:8.0.10' with options: None
2024-11-06 10:28:45.165 -03:00 [DBG] Creating DbConnection.
2024-11-06 10:28:45.166 -03:00 [DBG] Created DbConnection. (1ms).
2024-11-06 10:28:45.167 -03:00 [DBG] Opening connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:28:45.169 -03:00 [DBG] Opened connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:28:45.171 -03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2024-11-06 10:28:45.172 -03:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2024-11-06 10:28:45.173 -03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (2ms).
2024-11-06 10:28:45.175 -03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[ID], [u].[Email], [u].[Name], [u].[Password], [t].[RoleId], [t].[UserId], [t].[Long], [t].[Name]
FROM [Users] AS [u]
LEFT JOIN (
    SELECT [u0].[RoleId], [u0].[UserId], [r].[Long], [r].[Name]
    FROM [UserRole] AS [u0]
    INNER JOIN [Roles] AS [r] ON [u0].[RoleId] = [r].[Long]
) AS [t] ON [u].[ID] = [t].[UserId]
ORDER BY [u].[ID], [t].[RoleId], [t].[UserId]
2024-11-06 10:28:45.179 -03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[ID], [u].[Email], [u].[Name], [u].[Password], [t].[RoleId], [t].[UserId], [t].[Long], [t].[Name]
FROM [Users] AS [u]
LEFT JOIN (
    SELECT [u0].[RoleId], [u0].[UserId], [r].[Long], [r].[Name]
    FROM [UserRole] AS [u0]
    INNER JOIN [Roles] AS [r] ON [u0].[RoleId] = [r].[Long]
) AS [t] ON [u].[ID] = [t].[UserId]
ORDER BY [u].[ID], [t].[RoleId], [t].[UserId]
2024-11-06 10:28:45.182 -03:00 [DBG] Context 'AuthServerContext' started tracking 'User' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 10:28:45.184 -03:00 [DBG] Context 'AuthServerContext' started tracking 'UserRole' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 10:28:45.186 -03:00 [DBG] Context 'AuthServerContext' started tracking 'Role' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 10:28:45.187 -03:00 [DBG] Context 'AuthServerContext' started tracking 'User' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 10:28:45.189 -03:00 [DBG] Context 'AuthServerContext' started tracking 'UserRole' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 10:28:45.190 -03:00 [DBG] Context 'AuthServerContext' started tracking 'Role' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 10:28:45.191 -03:00 [DBG] Closing data reader to 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:28:45.192 -03:00 [DBG] A data reader for 'AuthServer' on server 'localhost,1433' is being disposed after spending 10ms reading results.
2024-11-06 10:28:45.194 -03:00 [DBG] Closing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:28:45.195 -03:00 [DBG] Closed connection to database 'AuthServer' on server 'localhost,1433' (1ms).
2024-11-06 10:28:45.198 -03:00 [DBG] List of registered output formatters, in the following order: ["Microsoft.AspNetCore.Mvc.Formatters.HttpNoContentOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StringOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StreamOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter"]
2024-11-06 10:28:45.200 -03:00 [DBG] No information found on request to perform content negotiation.
2024-11-06 10:28:45.201 -03:00 [DBG] Attempting to select an output formatter without using a content type as no explicit content types were specified for the response.
2024-11-06 10:28:45.202 -03:00 [DBG] Attempting to select the first formatter in the output formatters list which can write the result.
2024-11-06 10:28:45.203 -03:00 [DBG] Selected output formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter' and content type 'application/json' to write the response.
2024-11-06 10:28:45.204 -03:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[AuthServer.Users.responses.UserResponse, AuthServer, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2024-11-06 10:28:45.206 -03:00 [INF] Executed action AuthServer.Users.UsersController.ListUsers (AuthServer) in 60.3551ms
2024-11-06 10:28:45.207 -03:00 [INF] Executed endpoint 'AuthServer.Users.UsersController.ListUsers (AuthServer)'
2024-11-06 10:28:45.208 -03:00 [DBG] Connection id "0HN7UCRBO41D7" completed keep alive response.
2024-11-06 10:28:45.209 -03:00 [DBG] 'AuthServerContext' disposed.
2024-11-06 10:28:45.210 -03:00 [DBG] Disposing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:28:45.212 -03:00 [DBG] Disposed connection to database '' on server '' (1ms).
2024-11-06 10:28:45.214 -03:00 [INF] Request finished HTTP/1.1 GET https://localhost:7011/api/users - 200 null application/json; charset=utf-8 94.9531ms
2024-11-06 10:28:45.218 -03:00 [DBG] Connection id "0HN7UCRBO41D7", Request id "0HN7UCRBO41D7:00000003": started reading request body.
2024-11-06 10:28:45.219 -03:00 [DBG] Connection id "0HN7UCRBO41D7", Request id "0HN7UCRBO41D7:00000003": done reading request body.
2024-11-06 10:29:01.353 -03:00 [INF] Request starting HTTP/1.1 DELETE https://localhost:7011/api/users/16 - application/json 95
2024-11-06 10:29:01.359 -03:00 [DBG] 1 candidate(s) found for the request path '/api/users/16'
2024-11-06 10:29:01.360 -03:00 [DBG] Endpoint 'AuthServer.Users.UsersController.Delete (AuthServer)' with route pattern 'api/users/{id}' is valid for the request path '/api/users/16'
2024-11-06 10:29:01.363 -03:00 [DBG] Request matched endpoint 'AuthServer.Users.UsersController.Delete (AuthServer)'
2024-11-06 10:29:01.364 -03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2024-11-06 10:29:01.366 -03:00 [DBG] Successfully validated the token.
2024-11-06 10:29:01.366 -03:00 [DBG] AuthenticationScheme: Bearer was successfully authenticated.
2024-11-06 10:29:01.372 -03:00 [DBG] Authorization was successful.
2024-11-06 10:29:01.374 -03:00 [INF] Executing endpoint 'AuthServer.Users.UsersController.Delete (AuthServer)'
2024-11-06 10:29:01.377 -03:00 [INF] Route matched with {action = "Delete", controller = "Users"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult Delete(Int64) on controller AuthServer.Users.UsersController (AuthServer).
2024-11-06 10:29:01.379 -03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2024-11-06 10:29:01.381 -03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2024-11-06 10:29:01.383 -03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)"]
2024-11-06 10:29:01.385 -03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2024-11-06 10:29:01.386 -03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)"]
2024-11-06 10:29:01.388 -03:00 [DBG] Executing controller factory for controller AuthServer.Users.UsersController (AuthServer)
2024-11-06 10:29:01.390 -03:00 [DBG] Executed controller factory for controller AuthServer.Users.UsersController (AuthServer)
2024-11-06 10:29:01.391 -03:00 [DBG] Attempting to bind parameter 'id' of type 'System.Int64' ...
2024-11-06 10:29:01.393 -03:00 [DBG] Attempting to bind parameter 'id' of type 'System.Int64' using the name 'id' in request data ...
2024-11-06 10:29:01.395 -03:00 [DBG] Done attempting to bind parameter 'id' of type 'System.Int64'.
2024-11-06 10:29:01.397 -03:00 [DBG] Done attempting to bind parameter 'id' of type 'System.Int64'.
2024-11-06 10:29:01.398 -03:00 [DBG] Attempting to validate the bound parameter 'id' of type 'System.Int64' ...
2024-11-06 10:29:01.400 -03:00 [DBG] Done attempting to validate the bound parameter 'id' of type 'System.Int64'.
2024-11-06 10:29:01.404 -03:00 [DBG] Entity Framework Core 8.0.10 initialized 'AuthServerContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:8.0.10' with options: None
2024-11-06 10:29:01.408 -03:00 [DBG] Compiling query expression: 
'DbSet<User>()
    .Include(u => u.Roles)
    .FirstOrDefault(u => u.ID == __id_0)'
2024-11-06 10:29:01.411 -03:00 [DBG] Including navigation: 'User.Roles'.
2024-11-06 10:29:01.431 -03:00 [DBG] Generated query execution expression: 
'queryContext => new SingleQueryingEnumerable<User>(
    (RelationalQueryContext)queryContext, 
    RelationalCommandCache.QueryExpression(
        Client Projections:
            0 -> Dictionary<IProperty, int> { [Property: User.ID (long) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: User.Email (string) Required Index, 1], [Property: User.Name (string) Required, 2], [Property: User.Password (string) Required, 3] }
            1 -> 0
            2 -> Dictionary<IProperty, int> { [Property: UserRole (Dictionary<string, object>).RoleId (no field, int) Indexer Required PK FK AfterSave:Throw, 4], [Property: UserRole (Dictionary<string, object>).UserId (no field, long) Indexer Required PK FK Index AfterSave:Throw, 5] }
            3 -> Dictionary<IProperty, int> { [Property: Role.Long (int) Required PK AfterSave:Throw ValueGenerated.OnAdd, 6], [Property: Role.Name (string) Required Index, 7] }
            4 -> 4
            5 -> 5
            6 -> 6
        SELECT t.ID, t.Email, t.Name, t.Password, t0.RoleId, t0.UserId, t0.Long, t0.Name
        FROM 
        (
            SELECT TOP(1) u.ID, u.Email, u.Name, u.Password
            FROM Users AS u
            WHERE u.ID == @__id_0
        ) AS t
        LEFT JOIN 
        (
            SELECT u0.RoleId, u0.UserId, r.Long, r.Name
            FROM UserRole AS u0
            INNER JOIN Roles AS r ON u0.RoleId == r.Long
        ) AS t0 ON t.ID == t0.UserId
        ORDER BY t.ID ASC, t0.RoleId ASC, t0.UserId ASC), 
    null, 
    Func<QueryContext, DbDataReader, ResultContext, SingleQueryResultCoordinator, User>, 
    AuthServer.AuthServerContext, 
    False, 
    False, 
    True
)
    .SingleOrDefault()'
2024-11-06 10:29:01.434 -03:00 [DBG] Creating DbConnection.
2024-11-06 10:29:01.436 -03:00 [DBG] Created DbConnection. (1ms).
2024-11-06 10:29:01.437 -03:00 [DBG] Opening connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:29:01.439 -03:00 [DBG] Opened connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:29:01.440 -03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2024-11-06 10:29:01.442 -03:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2024-11-06 10:29:01.443 -03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (2ms).
2024-11-06 10:29:01.445 -03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[ID], [t].[Email], [t].[Name], [t].[Password], [t0].[RoleId], [t0].[UserId], [t0].[Long], [t0].[Name]
FROM (
    SELECT TOP(1) [u].[ID], [u].[Email], [u].[Name], [u].[Password]
    FROM [Users] AS [u]
    WHERE [u].[ID] = @__id_0
) AS [t]
LEFT JOIN (
    SELECT [u0].[RoleId], [u0].[UserId], [r].[Long], [r].[Name]
    FROM [UserRole] AS [u0]
    INNER JOIN [Roles] AS [r] ON [u0].[RoleId] = [r].[Long]
) AS [t0] ON [t].[ID] = [t0].[UserId]
ORDER BY [t].[ID], [t0].[RoleId], [t0].[UserId]
2024-11-06 10:29:01.459 -03:00 [INF] Executed DbCommand (13ms) [Parameters=[@__id_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[ID], [t].[Email], [t].[Name], [t].[Password], [t0].[RoleId], [t0].[UserId], [t0].[Long], [t0].[Name]
FROM (
    SELECT TOP(1) [u].[ID], [u].[Email], [u].[Name], [u].[Password]
    FROM [Users] AS [u]
    WHERE [u].[ID] = @__id_0
) AS [t]
LEFT JOIN (
    SELECT [u0].[RoleId], [u0].[UserId], [r].[Long], [r].[Name]
    FROM [UserRole] AS [u0]
    INNER JOIN [Roles] AS [r] ON [u0].[RoleId] = [r].[Long]
) AS [t0] ON [t].[ID] = [t0].[UserId]
ORDER BY [t].[ID], [t0].[RoleId], [t0].[UserId]
2024-11-06 10:29:01.462 -03:00 [DBG] Context 'AuthServerContext' started tracking 'User' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 10:29:01.465 -03:00 [DBG] Context 'AuthServerContext' started tracking 'UserRole' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 10:29:01.466 -03:00 [DBG] Context 'AuthServerContext' started tracking 'Role' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 10:29:01.468 -03:00 [DBG] Closing data reader to 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:29:01.469 -03:00 [DBG] A data reader for 'AuthServer' on server 'localhost,1433' is being disposed after spending 7ms reading results.
2024-11-06 10:29:01.471 -03:00 [DBG] Closing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:29:01.472 -03:00 [DBG] Closed connection to database 'AuthServer' on server 'localhost,1433' (1ms).
2024-11-06 10:29:01.475 -03:00 [DBG] Opening connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:29:01.476 -03:00 [DBG] Opened connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:29:01.477 -03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2024-11-06 10:29:01.479 -03:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2024-11-06 10:29:01.482 -03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (4ms).
2024-11-06 10:29:01.483 -03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[ID], [u].[Email], [u].[Name], [u].[Password], [t].[RoleId], [t].[UserId], [t].[Long], [t].[Name]
FROM [Users] AS [u]
LEFT JOIN (
    SELECT [u0].[RoleId], [u0].[UserId], [r].[Long], [r].[Name]
    FROM [UserRole] AS [u0]
    INNER JOIN [Roles] AS [r] ON [u0].[RoleId] = [r].[Long]
) AS [t] ON [u].[ID] = [t].[UserId]
ORDER BY [u].[ID], [t].[RoleId], [t].[UserId]
2024-11-06 10:29:01.488 -03:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[ID], [u].[Email], [u].[Name], [u].[Password], [t].[RoleId], [t].[UserId], [t].[Long], [t].[Name]
FROM [Users] AS [u]
LEFT JOIN (
    SELECT [u0].[RoleId], [u0].[UserId], [r].[Long], [r].[Name]
    FROM [UserRole] AS [u0]
    INNER JOIN [Roles] AS [r] ON [u0].[RoleId] = [r].[Long]
) AS [t] ON [u].[ID] = [t].[UserId]
ORDER BY [u].[ID], [t].[RoleId], [t].[UserId]
2024-11-06 10:29:01.492 -03:00 [DBG] Context 'AuthServerContext' started tracking 'User' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 10:29:01.493 -03:00 [DBG] Context 'AuthServerContext' started tracking 'UserRole' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 10:29:01.495 -03:00 [DBG] Context 'AuthServerContext' started tracking 'Role' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 10:29:01.496 -03:00 [DBG] Closing data reader to 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:29:01.498 -03:00 [DBG] A data reader for 'AuthServer' on server 'localhost,1433' is being disposed after spending 7ms reading results.
2024-11-06 10:29:01.500 -03:00 [DBG] Closing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:29:01.502 -03:00 [DBG] Closed connection to database 'AuthServer' on server 'localhost,1433' (1ms).
2024-11-06 10:29:01.504 -03:00 [WRN] Attempted to delete the last system admin. id=16
2024-11-06 10:29:01.507 -03:00 [INF] Executed action AuthServer.Users.UsersController.Delete (AuthServer) in 118.9685ms
2024-11-06 10:29:01.509 -03:00 [INF] Executed endpoint 'AuthServer.Users.UsersController.Delete (AuthServer)'
2024-11-06 10:29:01.511 -03:00 [DBG] Connection id "0HN7UCRBO41D7" completed keep alive response.
2024-11-06 10:29:01.512 -03:00 [DBG] 'AuthServerContext' disposed.
2024-11-06 10:29:01.514 -03:00 [DBG] Disposing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:29:01.515 -03:00 [DBG] Disposed connection to database '' on server '' (1ms).
2024-11-06 10:29:01.517 -03:00 [INF] Request finished HTTP/1.1 DELETE https://localhost:7011/api/users/16 - 400 null null 163.5766ms
2024-11-06 10:29:01.520 -03:00 [DBG] Connection id "0HN7UCRBO41D7", Request id "0HN7UCRBO41D7:00000004": started reading request body.
2024-11-06 10:29:01.521 -03:00 [DBG] Connection id "0HN7UCRBO41D7", Request id "0HN7UCRBO41D7:00000004": done reading request body.
2024-11-06 10:29:07.920 -03:00 [INF] Request starting HTTP/1.1 DELETE https://localhost:7011/api/users/26 - application/json 95
2024-11-06 10:29:07.923 -03:00 [DBG] 1 candidate(s) found for the request path '/api/users/26'
2024-11-06 10:29:07.925 -03:00 [DBG] Endpoint 'AuthServer.Users.UsersController.Delete (AuthServer)' with route pattern 'api/users/{id}' is valid for the request path '/api/users/26'
2024-11-06 10:29:07.926 -03:00 [DBG] Request matched endpoint 'AuthServer.Users.UsersController.Delete (AuthServer)'
2024-11-06 10:29:07.927 -03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2024-11-06 10:29:07.929 -03:00 [DBG] Successfully validated the token.
2024-11-06 10:29:07.931 -03:00 [DBG] AuthenticationScheme: Bearer was successfully authenticated.
2024-11-06 10:29:07.934 -03:00 [DBG] Authorization was successful.
2024-11-06 10:29:07.935 -03:00 [INF] Executing endpoint 'AuthServer.Users.UsersController.Delete (AuthServer)'
2024-11-06 10:29:07.936 -03:00 [INF] Route matched with {action = "Delete", controller = "Users"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult Delete(Int64) on controller AuthServer.Users.UsersController (AuthServer).
2024-11-06 10:29:07.938 -03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2024-11-06 10:29:07.940 -03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2024-11-06 10:29:07.941 -03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)"]
2024-11-06 10:29:07.943 -03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2024-11-06 10:29:07.945 -03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)"]
2024-11-06 10:29:07.947 -03:00 [DBG] Executing controller factory for controller AuthServer.Users.UsersController (AuthServer)
2024-11-06 10:29:07.949 -03:00 [DBG] Executed controller factory for controller AuthServer.Users.UsersController (AuthServer)
2024-11-06 10:29:07.950 -03:00 [DBG] Attempting to bind parameter 'id' of type 'System.Int64' ...
2024-11-06 10:29:07.951 -03:00 [DBG] Attempting to bind parameter 'id' of type 'System.Int64' using the name 'id' in request data ...
2024-11-06 10:29:07.953 -03:00 [DBG] Done attempting to bind parameter 'id' of type 'System.Int64'.
2024-11-06 10:29:07.954 -03:00 [DBG] Done attempting to bind parameter 'id' of type 'System.Int64'.
2024-11-06 10:29:07.955 -03:00 [DBG] Attempting to validate the bound parameter 'id' of type 'System.Int64' ...
2024-11-06 10:29:07.957 -03:00 [DBG] Done attempting to validate the bound parameter 'id' of type 'System.Int64'.
2024-11-06 10:29:07.959 -03:00 [DBG] Entity Framework Core 8.0.10 initialized 'AuthServerContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:8.0.10' with options: None
2024-11-06 10:29:07.962 -03:00 [DBG] Creating DbConnection.
2024-11-06 10:29:07.964 -03:00 [DBG] Created DbConnection. (1ms).
2024-11-06 10:29:07.965 -03:00 [DBG] Opening connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:29:07.966 -03:00 [DBG] Opened connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:29:07.967 -03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2024-11-06 10:29:07.968 -03:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2024-11-06 10:29:07.969 -03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (2ms).
2024-11-06 10:29:07.971 -03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[ID], [t].[Email], [t].[Name], [t].[Password], [t0].[RoleId], [t0].[UserId], [t0].[Long], [t0].[Name]
FROM (
    SELECT TOP(1) [u].[ID], [u].[Email], [u].[Name], [u].[Password]
    FROM [Users] AS [u]
    WHERE [u].[ID] = @__id_0
) AS [t]
LEFT JOIN (
    SELECT [u0].[RoleId], [u0].[UserId], [r].[Long], [r].[Name]
    FROM [UserRole] AS [u0]
    INNER JOIN [Roles] AS [r] ON [u0].[RoleId] = [r].[Long]
) AS [t0] ON [t].[ID] = [t0].[UserId]
ORDER BY [t].[ID], [t0].[RoleId], [t0].[UserId]
2024-11-06 10:29:07.975 -03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__id_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[ID], [t].[Email], [t].[Name], [t].[Password], [t0].[RoleId], [t0].[UserId], [t0].[Long], [t0].[Name]
FROM (
    SELECT TOP(1) [u].[ID], [u].[Email], [u].[Name], [u].[Password]
    FROM [Users] AS [u]
    WHERE [u].[ID] = @__id_0
) AS [t]
LEFT JOIN (
    SELECT [u0].[RoleId], [u0].[UserId], [r].[Long], [r].[Name]
    FROM [UserRole] AS [u0]
    INNER JOIN [Roles] AS [r] ON [u0].[RoleId] = [r].[Long]
) AS [t0] ON [t].[ID] = [t0].[UserId]
ORDER BY [t].[ID], [t0].[RoleId], [t0].[UserId]
2024-11-06 10:29:07.977 -03:00 [DBG] Closing data reader to 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:29:07.981 -03:00 [DBG] A data reader for 'AuthServer' on server 'localhost,1433' is being disposed after spending 3ms reading results.
2024-11-06 10:29:07.986 -03:00 [DBG] Closing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:29:07.987 -03:00 [DBG] Closed connection to database 'AuthServer' on server 'localhost,1433' (1ms).
2024-11-06 10:29:07.989 -03:00 [WRN] Attempted to delete non-existing user. id=26
2024-11-06 10:29:08.029 -03:00 [DBG] List of registered output formatters, in the following order: ["Microsoft.AspNetCore.Mvc.Formatters.HttpNoContentOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StringOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StreamOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter"]
2024-11-06 10:29:08.032 -03:00 [DBG] No information found on request to perform content negotiation.
2024-11-06 10:29:08.033 -03:00 [DBG] Attempting to select the first output formatter in the output formatters list which supports a content type from the explicitly specified content types '["application/problem+json","application/problem+xml","application/problem+json","application/problem+xml"]'.
2024-11-06 10:29:08.036 -03:00 [DBG] Selected output formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter' and content type 'application/problem+json' to write the response.
2024-11-06 10:29:08.037 -03:00 [INF] Executing ObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ProblemDetails'.
2024-11-06 10:29:08.060 -03:00 [INF] Executed action AuthServer.Users.UsersController.Delete (AuthServer) in 112.8005ms
2024-11-06 10:29:08.061 -03:00 [INF] Executed endpoint 'AuthServer.Users.UsersController.Delete (AuthServer)'
2024-11-06 10:29:08.064 -03:00 [DBG] Connection id "0HN7UCRBO41D7" completed keep alive response.
2024-11-06 10:29:08.066 -03:00 [DBG] 'AuthServerContext' disposed.
2024-11-06 10:29:08.067 -03:00 [DBG] Disposing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:29:08.069 -03:00 [DBG] Disposed connection to database '' on server '' (1ms).
2024-11-06 10:29:08.070 -03:00 [INF] Request finished HTTP/1.1 DELETE https://localhost:7011/api/users/26 - 404 null application/problem+json; charset=utf-8 150.46ms
2024-11-06 10:29:08.073 -03:00 [DBG] Connection id "0HN7UCRBO41D7", Request id "0HN7UCRBO41D7:00000005": started reading request body.
2024-11-06 10:29:08.075 -03:00 [DBG] Connection id "0HN7UCRBO41D7", Request id "0HN7UCRBO41D7:00000005": done reading request body.
2024-11-06 10:29:19.250 -03:00 [INF] Request starting HTTP/1.1 GET https://localhost:7011/api/users/ - application/json 95
2024-11-06 10:29:19.253 -03:00 [DBG] 1 candidate(s) found for the request path '/api/users/'
2024-11-06 10:29:19.254 -03:00 [DBG] Endpoint 'AuthServer.Users.UsersController.ListUsers (AuthServer)' with route pattern 'api/users' is valid for the request path '/api/users/'
2024-11-06 10:29:19.256 -03:00 [DBG] Request matched endpoint 'AuthServer.Users.UsersController.ListUsers (AuthServer)'
2024-11-06 10:29:19.257 -03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2024-11-06 10:29:19.258 -03:00 [DBG] Successfully validated the token.
2024-11-06 10:29:19.259 -03:00 [DBG] AuthenticationScheme: Bearer was successfully authenticated.
2024-11-06 10:29:19.261 -03:00 [INF] Executing endpoint 'AuthServer.Users.UsersController.ListUsers (AuthServer)'
2024-11-06 10:29:19.264 -03:00 [INF] Route matched with {action = "ListUsers", controller = "Users"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.ActionResult`1[System.Collections.Generic.List`1[AuthServer.Users.responses.UserResponse]] ListUsers(System.String) on controller AuthServer.Users.UsersController (AuthServer).
2024-11-06 10:29:19.266 -03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2024-11-06 10:29:19.267 -03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2024-11-06 10:29:19.268 -03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)"]
2024-11-06 10:29:19.270 -03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2024-11-06 10:29:19.271 -03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)"]
2024-11-06 10:29:19.273 -03:00 [DBG] Executing controller factory for controller AuthServer.Users.UsersController (AuthServer)
2024-11-06 10:29:19.274 -03:00 [DBG] Executed controller factory for controller AuthServer.Users.UsersController (AuthServer)
2024-11-06 10:29:19.276 -03:00 [DBG] Attempting to bind parameter 'role' of type 'System.String' ...
2024-11-06 10:29:19.277 -03:00 [DBG] Attempting to bind parameter 'role' of type 'System.String' using the name '' in request data ...
2024-11-06 10:29:19.280 -03:00 [DBG] Could not find a value in the request with name '' for binding parameter 'role' of type 'System.String'.
2024-11-06 10:29:19.281 -03:00 [DBG] Done attempting to bind parameter 'role' of type 'System.String'.
2024-11-06 10:29:19.283 -03:00 [DBG] Done attempting to bind parameter 'role' of type 'System.String'.
2024-11-06 10:29:19.284 -03:00 [DBG] Attempting to validate the bound parameter 'role' of type 'System.String' ...
2024-11-06 10:29:19.285 -03:00 [DBG] Done attempting to validate the bound parameter 'role' of type 'System.String'.
2024-11-06 10:29:19.287 -03:00 [DBG] Entity Framework Core 8.0.10 initialized 'AuthServerContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:8.0.10' with options: None
2024-11-06 10:29:19.290 -03:00 [DBG] Creating DbConnection.
2024-11-06 10:29:19.290 -03:00 [DBG] Created DbConnection. (0ms).
2024-11-06 10:29:19.291 -03:00 [DBG] Opening connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:29:19.293 -03:00 [DBG] Opened connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:29:19.294 -03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2024-11-06 10:29:19.296 -03:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2024-11-06 10:29:19.297 -03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (3ms).
2024-11-06 10:29:19.299 -03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[ID], [u].[Email], [u].[Name], [u].[Password], [t].[RoleId], [t].[UserId], [t].[Long], [t].[Name]
FROM [Users] AS [u]
LEFT JOIN (
    SELECT [u0].[RoleId], [u0].[UserId], [r].[Long], [r].[Name]
    FROM [UserRole] AS [u0]
    INNER JOIN [Roles] AS [r] ON [u0].[RoleId] = [r].[Long]
) AS [t] ON [u].[ID] = [t].[UserId]
ORDER BY [u].[ID], [t].[RoleId], [t].[UserId]
2024-11-06 10:29:19.304 -03:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[ID], [u].[Email], [u].[Name], [u].[Password], [t].[RoleId], [t].[UserId], [t].[Long], [t].[Name]
FROM [Users] AS [u]
LEFT JOIN (
    SELECT [u0].[RoleId], [u0].[UserId], [r].[Long], [r].[Name]
    FROM [UserRole] AS [u0]
    INNER JOIN [Roles] AS [r] ON [u0].[RoleId] = [r].[Long]
) AS [t] ON [u].[ID] = [t].[UserId]
ORDER BY [u].[ID], [t].[RoleId], [t].[UserId]
2024-11-06 10:29:19.306 -03:00 [DBG] Context 'AuthServerContext' started tracking 'User' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 10:29:19.308 -03:00 [DBG] Context 'AuthServerContext' started tracking 'UserRole' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 10:29:19.310 -03:00 [DBG] Context 'AuthServerContext' started tracking 'Role' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 10:29:19.312 -03:00 [DBG] Context 'AuthServerContext' started tracking 'User' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 10:29:19.314 -03:00 [DBG] Context 'AuthServerContext' started tracking 'UserRole' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 10:29:19.316 -03:00 [DBG] Context 'AuthServerContext' started tracking 'Role' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 10:29:19.317 -03:00 [DBG] Closing data reader to 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:29:19.318 -03:00 [DBG] A data reader for 'AuthServer' on server 'localhost,1433' is being disposed after spending 12ms reading results.
2024-11-06 10:29:19.320 -03:00 [DBG] Closing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:29:19.321 -03:00 [DBG] Closed connection to database 'AuthServer' on server 'localhost,1433' (1ms).
2024-11-06 10:29:19.323 -03:00 [DBG] List of registered output formatters, in the following order: ["Microsoft.AspNetCore.Mvc.Formatters.HttpNoContentOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StringOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StreamOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter"]
2024-11-06 10:29:19.325 -03:00 [DBG] No information found on request to perform content negotiation.
2024-11-06 10:29:19.326 -03:00 [DBG] Attempting to select an output formatter without using a content type as no explicit content types were specified for the response.
2024-11-06 10:29:19.327 -03:00 [DBG] Attempting to select the first formatter in the output formatters list which can write the result.
2024-11-06 10:29:19.328 -03:00 [DBG] Selected output formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter' and content type 'application/json' to write the response.
2024-11-06 10:29:19.329 -03:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[AuthServer.Users.responses.UserResponse, AuthServer, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2024-11-06 10:29:19.332 -03:00 [INF] Executed action AuthServer.Users.UsersController.ListUsers (AuthServer) in 59.0534ms
2024-11-06 10:29:19.333 -03:00 [INF] Executed endpoint 'AuthServer.Users.UsersController.ListUsers (AuthServer)'
2024-11-06 10:29:19.334 -03:00 [DBG] Connection id "0HN7UCRBO41D7" completed keep alive response.
2024-11-06 10:29:19.336 -03:00 [DBG] 'AuthServerContext' disposed.
2024-11-06 10:29:19.338 -03:00 [DBG] Disposing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:29:19.339 -03:00 [DBG] Disposed connection to database '' on server '' (1ms).
2024-11-06 10:29:19.340 -03:00 [INF] Request finished HTTP/1.1 GET https://localhost:7011/api/users/ - 200 null application/json; charset=utf-8 90.2211ms
2024-11-06 10:29:19.343 -03:00 [DBG] Connection id "0HN7UCRBO41D7", Request id "0HN7UCRBO41D7:00000006": started reading request body.
2024-11-06 10:29:19.345 -03:00 [DBG] Connection id "0HN7UCRBO41D7", Request id "0HN7UCRBO41D7:00000006": done reading request body.
2024-11-06 10:29:25.747 -03:00 [INF] Request starting HTTP/1.1 DELETE https://localhost:7011/api/users/29 - application/json 95
2024-11-06 10:29:25.750 -03:00 [DBG] 1 candidate(s) found for the request path '/api/users/29'
2024-11-06 10:29:25.751 -03:00 [DBG] Endpoint 'AuthServer.Users.UsersController.Delete (AuthServer)' with route pattern 'api/users/{id}' is valid for the request path '/api/users/29'
2024-11-06 10:29:25.752 -03:00 [DBG] Request matched endpoint 'AuthServer.Users.UsersController.Delete (AuthServer)'
2024-11-06 10:29:25.753 -03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2024-11-06 10:29:25.754 -03:00 [DBG] Successfully validated the token.
2024-11-06 10:29:25.755 -03:00 [DBG] AuthenticationScheme: Bearer was successfully authenticated.
2024-11-06 10:29:25.758 -03:00 [DBG] Authorization was successful.
2024-11-06 10:29:25.759 -03:00 [INF] Executing endpoint 'AuthServer.Users.UsersController.Delete (AuthServer)'
2024-11-06 10:29:25.760 -03:00 [INF] Route matched with {action = "Delete", controller = "Users"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult Delete(Int64) on controller AuthServer.Users.UsersController (AuthServer).
2024-11-06 10:29:25.762 -03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2024-11-06 10:29:25.763 -03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2024-11-06 10:29:25.765 -03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)"]
2024-11-06 10:29:25.767 -03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2024-11-06 10:29:25.768 -03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)"]
2024-11-06 10:29:25.770 -03:00 [DBG] Executing controller factory for controller AuthServer.Users.UsersController (AuthServer)
2024-11-06 10:29:25.771 -03:00 [DBG] Executed controller factory for controller AuthServer.Users.UsersController (AuthServer)
2024-11-06 10:29:25.772 -03:00 [DBG] Attempting to bind parameter 'id' of type 'System.Int64' ...
2024-11-06 10:29:25.774 -03:00 [DBG] Attempting to bind parameter 'id' of type 'System.Int64' using the name 'id' in request data ...
2024-11-06 10:29:25.775 -03:00 [DBG] Done attempting to bind parameter 'id' of type 'System.Int64'.
2024-11-06 10:29:25.776 -03:00 [DBG] Done attempting to bind parameter 'id' of type 'System.Int64'.
2024-11-06 10:29:25.778 -03:00 [DBG] Attempting to validate the bound parameter 'id' of type 'System.Int64' ...
2024-11-06 10:29:25.779 -03:00 [DBG] Done attempting to validate the bound parameter 'id' of type 'System.Int64'.
2024-11-06 10:29:25.782 -03:00 [DBG] Entity Framework Core 8.0.10 initialized 'AuthServerContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:8.0.10' with options: None
2024-11-06 10:29:25.784 -03:00 [DBG] Creating DbConnection.
2024-11-06 10:29:25.785 -03:00 [DBG] Created DbConnection. (0ms).
2024-11-06 10:29:25.786 -03:00 [DBG] Opening connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:29:25.788 -03:00 [DBG] Opened connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:29:25.789 -03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2024-11-06 10:29:25.790 -03:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2024-11-06 10:29:25.791 -03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (2ms).
2024-11-06 10:29:25.793 -03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[ID], [t].[Email], [t].[Name], [t].[Password], [t0].[RoleId], [t0].[UserId], [t0].[Long], [t0].[Name]
FROM (
    SELECT TOP(1) [u].[ID], [u].[Email], [u].[Name], [u].[Password]
    FROM [Users] AS [u]
    WHERE [u].[ID] = @__id_0
) AS [t]
LEFT JOIN (
    SELECT [u0].[RoleId], [u0].[UserId], [r].[Long], [r].[Name]
    FROM [UserRole] AS [u0]
    INNER JOIN [Roles] AS [r] ON [u0].[RoleId] = [r].[Long]
) AS [t0] ON [t].[ID] = [t0].[UserId]
ORDER BY [t].[ID], [t0].[RoleId], [t0].[UserId]
2024-11-06 10:29:25.798 -03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__id_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[ID], [t].[Email], [t].[Name], [t].[Password], [t0].[RoleId], [t0].[UserId], [t0].[Long], [t0].[Name]
FROM (
    SELECT TOP(1) [u].[ID], [u].[Email], [u].[Name], [u].[Password]
    FROM [Users] AS [u]
    WHERE [u].[ID] = @__id_0
) AS [t]
LEFT JOIN (
    SELECT [u0].[RoleId], [u0].[UserId], [r].[Long], [r].[Name]
    FROM [UserRole] AS [u0]
    INNER JOIN [Roles] AS [r] ON [u0].[RoleId] = [r].[Long]
) AS [t0] ON [t].[ID] = [t0].[UserId]
ORDER BY [t].[ID], [t0].[RoleId], [t0].[UserId]
2024-11-06 10:29:25.800 -03:00 [DBG] Context 'AuthServerContext' started tracking 'User' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 10:29:25.802 -03:00 [DBG] Context 'AuthServerContext' started tracking 'UserRole' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 10:29:25.803 -03:00 [DBG] Context 'AuthServerContext' started tracking 'Role' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 10:29:25.804 -03:00 [DBG] Closing data reader to 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:29:25.806 -03:00 [DBG] A data reader for 'AuthServer' on server 'localhost,1433' is being disposed after spending 5ms reading results.
2024-11-06 10:29:25.808 -03:00 [DBG] Closing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:29:25.809 -03:00 [DBG] Closed connection to database 'AuthServer' on server 'localhost,1433' (1ms).
2024-11-06 10:29:25.812 -03:00 [DBG] An entity of type 'User' tracked by 'AuthServerContext' changed state from '"Unchanged"' to '"Deleted"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 10:29:25.823 -03:00 [DBG] A cascade state change of an entity of type 'UserRole' to '"Deleted"' occurred due to deletion of its parent entity of type 'User'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 10:29:25.824 -03:00 [DBG] An entity of type 'UserRole' tracked by 'AuthServerContext' changed state from '"Unchanged"' to '"Deleted"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 10:29:25.826 -03:00 [DBG] SaveChanges starting for 'AuthServerContext'.
2024-11-06 10:29:25.827 -03:00 [DBG] DetectChanges starting for 'AuthServerContext'.
2024-11-06 10:29:25.829 -03:00 [DBG] DetectChanges completed for 'AuthServerContext'.
2024-11-06 10:29:25.842 -03:00 [DBG] Executing 2 update commands as a batch.
2024-11-06 10:29:25.843 -03:00 [DBG] Opening connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:29:25.845 -03:00 [DBG] Opened connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:29:25.849 -03:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2024-11-06 10:29:25.858 -03:00 [DBG] Began transaction with isolation level 'ReadCommitted'.
2024-11-06 10:29:25.860 -03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2024-11-06 10:29:25.861 -03:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2024-11-06 10:29:25.865 -03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (4ms).
2024-11-06 10:29:25.866 -03:00 [DBG] Executing DbCommand [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = Int64), @p2='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
DELETE FROM [UserRole]
OUTPUT 1
WHERE [RoleId] = @p0 AND [UserId] = @p1;
DELETE FROM [Users]
OUTPUT 1
WHERE [ID] = @p2;
2024-11-06 10:29:25.880 -03:00 [INF] Executed DbCommand (13ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = Int64), @p2='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
DELETE FROM [UserRole]
OUTPUT 1
WHERE [RoleId] = @p0 AND [UserId] = @p1;
DELETE FROM [Users]
OUTPUT 1
WHERE [ID] = @p2;
2024-11-06 10:29:25.884 -03:00 [DBG] Closing data reader to 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:29:25.885 -03:00 [DBG] A data reader for 'AuthServer' on server 'localhost,1433' is being disposed after spending 1ms reading results.
2024-11-06 10:29:25.888 -03:00 [DBG] Committing transaction.
2024-11-06 10:29:25.899 -03:00 [DBG] Committed transaction.
2024-11-06 10:29:25.900 -03:00 [DBG] Closing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:29:25.902 -03:00 [DBG] Closed connection to database 'AuthServer' on server 'localhost,1433' (1ms).
2024-11-06 10:29:25.904 -03:00 [DBG] Disposing transaction.
2024-11-06 10:29:25.909 -03:00 [DBG] An entity of type 'User' tracked by 'AuthServerContext' changed state from '"Deleted"' to '"Detached"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 10:29:25.912 -03:00 [DBG] An entity of type 'UserRole' tracked by 'AuthServerContext' changed state from '"Deleted"' to '"Detached"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 10:29:25.914 -03:00 [DBG] SaveChanges completed for 'AuthServerContext' with 2 entities written to the database.
2024-11-06 10:29:25.916 -03:00 [WRN] User deleted. id=29 name=gustavo
2024-11-06 10:29:25.918 -03:00 [INF] Executing StatusCodeResult, setting HTTP status code 200
2024-11-06 10:29:25.919 -03:00 [INF] Executed action AuthServer.Users.UsersController.Delete (AuthServer) in 148.9488ms
2024-11-06 10:29:25.920 -03:00 [INF] Executed endpoint 'AuthServer.Users.UsersController.Delete (AuthServer)'
2024-11-06 10:29:25.921 -03:00 [DBG] Connection id "0HN7UCRBO41D7" completed keep alive response.
2024-11-06 10:29:25.922 -03:00 [DBG] 'AuthServerContext' disposed.
2024-11-06 10:29:25.923 -03:00 [DBG] Disposing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:29:25.924 -03:00 [DBG] Disposed connection to database '' on server '' (1ms).
2024-11-06 10:29:25.926 -03:00 [INF] Request finished HTTP/1.1 DELETE https://localhost:7011/api/users/29 - 200 0 null 178.4569ms
2024-11-06 10:29:25.929 -03:00 [DBG] Connection id "0HN7UCRBO41D7", Request id "0HN7UCRBO41D7:00000007": started reading request body.
2024-11-06 10:29:25.931 -03:00 [DBG] Connection id "0HN7UCRBO41D7", Request id "0HN7UCRBO41D7:00000007": done reading request body.
2024-11-06 10:29:52.772 -03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7011/api/users/ - application/json 95
2024-11-06 10:29:52.775 -03:00 [DBG] 1 candidate(s) found for the request path '/api/users/'
2024-11-06 10:29:52.776 -03:00 [DBG] Endpoint 'AuthServer.Users.UsersController.CreateUser (AuthServer)' with route pattern 'api/users' is valid for the request path '/api/users/'
2024-11-06 10:29:52.779 -03:00 [DBG] Request matched endpoint 'AuthServer.Users.UsersController.CreateUser (AuthServer)'
2024-11-06 10:29:52.780 -03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2024-11-06 10:29:52.781 -03:00 [DBG] AuthenticationScheme: Bearer was not authenticated.
2024-11-06 10:29:52.782 -03:00 [INF] Executing endpoint 'AuthServer.Users.UsersController.CreateUser (AuthServer)'
2024-11-06 10:29:52.783 -03:00 [INF] Route matched with {action = "CreateUser", controller = "Users"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.ActionResult`1[AuthServer.Users.responses.UserResponse] CreateUser(AuthServer.Users.requests.UserRequest) on controller AuthServer.Users.UsersController (AuthServer).
2024-11-06 10:29:52.785 -03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2024-11-06 10:29:52.787 -03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2024-11-06 10:29:52.788 -03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)"]
2024-11-06 10:29:52.790 -03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2024-11-06 10:29:52.791 -03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)"]
2024-11-06 10:29:52.793 -03:00 [DBG] Executing controller factory for controller AuthServer.Users.UsersController (AuthServer)
2024-11-06 10:29:52.795 -03:00 [DBG] Executed controller factory for controller AuthServer.Users.UsersController (AuthServer)
2024-11-06 10:29:52.797 -03:00 [DBG] Attempting to bind parameter 'req' of type 'AuthServer.Users.requests.UserRequest' ...
2024-11-06 10:29:52.799 -03:00 [DBG] Attempting to bind parameter 'req' of type 'AuthServer.Users.requests.UserRequest' using the name '' in request data ...
2024-11-06 10:29:52.801 -03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2024-11-06 10:29:52.803 -03:00 [DBG] Connection id "0HN7UCRBO41D7", Request id "0HN7UCRBO41D7:00000008": started reading request body.
2024-11-06 10:29:52.804 -03:00 [DBG] Connection id "0HN7UCRBO41D7", Request id "0HN7UCRBO41D7:00000008": done reading request body.
2024-11-06 10:29:52.806 -03:00 [DBG] JSON input formatter succeeded, deserializing to type 'AuthServer.Users.requests.UserRequest'
2024-11-06 10:29:52.807 -03:00 [DBG] Done attempting to bind parameter 'req' of type 'AuthServer.Users.requests.UserRequest'.
2024-11-06 10:29:52.808 -03:00 [DBG] Done attempting to bind parameter 'req' of type 'AuthServer.Users.requests.UserRequest'.
2024-11-06 10:29:52.809 -03:00 [DBG] Attempting to validate the bound parameter 'req' of type 'AuthServer.Users.requests.UserRequest' ...
2024-11-06 10:29:52.811 -03:00 [DBG] Done attempting to validate the bound parameter 'req' of type 'AuthServer.Users.requests.UserRequest'.
2024-11-06 10:29:52.814 -03:00 [DBG] Entity Framework Core 8.0.10 initialized 'AuthServerContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:8.0.10' with options: None
2024-11-06 10:29:52.817 -03:00 [DBG] Creating DbConnection.
2024-11-06 10:29:52.818 -03:00 [DBG] Created DbConnection. (0ms).
2024-11-06 10:29:52.819 -03:00 [DBG] Opening connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:29:52.823 -03:00 [DBG] Opened connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:29:52.824 -03:00 [DBG] Enlisted in an ambient transaction with isolation level 'Serializable'.
2024-11-06 10:29:52.825 -03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2024-11-06 10:29:52.826 -03:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2024-11-06 10:29:52.828 -03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (2ms).
2024-11-06 10:29:52.830 -03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[ID], [u].[Email], [u].[Name], [u].[Password], [t].[RoleId], [t].[UserId], [t].[Long], [t].[Name]
FROM [Users] AS [u]
LEFT JOIN (
    SELECT [u0].[RoleId], [u0].[UserId], [r].[Long], [r].[Name]
    FROM [UserRole] AS [u0]
    INNER JOIN [Roles] AS [r] ON [u0].[RoleId] = [r].[Long]
) AS [t] ON [u].[ID] = [t].[UserId]
ORDER BY [u].[ID], [t].[RoleId], [t].[UserId]
2024-11-06 10:29:52.834 -03:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[ID], [u].[Email], [u].[Name], [u].[Password], [t].[RoleId], [t].[UserId], [t].[Long], [t].[Name]
FROM [Users] AS [u]
LEFT JOIN (
    SELECT [u0].[RoleId], [u0].[UserId], [r].[Long], [r].[Name]
    FROM [UserRole] AS [u0]
    INNER JOIN [Roles] AS [r] ON [u0].[RoleId] = [r].[Long]
) AS [t] ON [u].[ID] = [t].[UserId]
ORDER BY [u].[ID], [t].[RoleId], [t].[UserId]
2024-11-06 10:29:52.836 -03:00 [DBG] Context 'AuthServerContext' started tracking 'User' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 10:29:52.838 -03:00 [DBG] Context 'AuthServerContext' started tracking 'UserRole' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 10:29:52.840 -03:00 [DBG] Context 'AuthServerContext' started tracking 'Role' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 10:29:52.841 -03:00 [DBG] Closing data reader to 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:29:52.843 -03:00 [DBG] A data reader for 'AuthServer' on server 'localhost,1433' is being disposed after spending 6ms reading results.
2024-11-06 10:29:52.845 -03:00 [DBG] Closing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:29:52.846 -03:00 [DBG] Closed connection to database 'AuthServer' on server 'localhost,1433' (1ms).
2024-11-06 10:29:52.849 -03:00 [DBG] Opening connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:29:52.850 -03:00 [DBG] Opened connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:29:52.852 -03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2024-11-06 10:29:52.853 -03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2024-11-06 10:29:52.854 -03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (2ms).
2024-11-06 10:29:52.855 -03:00 [DBG] Executing DbCommand [Parameters=[@__name_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [r].[Long], [r].[Name]
FROM [Roles] AS [r]
WHERE [r].[Name] = @__name_0
2024-11-06 10:29:52.898 -03:00 [INF] Executed DbCommand (43ms) [Parameters=[@__name_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [r].[Long], [r].[Name]
FROM [Roles] AS [r]
WHERE [r].[Name] = @__name_0
2024-11-06 10:29:52.901 -03:00 [DBG] Context 'AuthServerContext' started tracking 'Role' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 10:29:52.902 -03:00 [DBG] Closing data reader to 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:29:52.904 -03:00 [DBG] A data reader for 'AuthServer' on server 'localhost,1433' is being disposed after spending 2ms reading results.
2024-11-06 10:29:52.905 -03:00 [DBG] Closing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:29:52.907 -03:00 [DBG] Closed connection to database 'AuthServer' on server 'localhost,1433' (1ms).
2024-11-06 10:29:52.909 -03:00 [DBG] 'AuthServerContext' generated a temporary value for the property 'User.ID'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 10:29:52.911 -03:00 [DBG] Context 'AuthServerContext' started tracking 'User' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 10:29:52.914 -03:00 [DBG] Context 'AuthServerContext' started tracking 'UserRole' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 10:29:52.915 -03:00 [DBG] SaveChanges starting for 'AuthServerContext'.
2024-11-06 10:29:52.916 -03:00 [DBG] DetectChanges starting for 'AuthServerContext'.
2024-11-06 10:29:52.917 -03:00 [DBG] DetectChanges completed for 'AuthServerContext'.
2024-11-06 10:29:52.919 -03:00 [DBG] Opening connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:29:52.920 -03:00 [DBG] Opened connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:29:52.922 -03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2024-11-06 10:29:52.923 -03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2024-11-06 10:29:52.924 -03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (2ms).
2024-11-06 10:29:52.925 -03:00 [DBG] Executing DbCommand [Parameters=[@p0='?' (Size = 450), @p1='?' (Size = 4000), @p2='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Users] ([Email], [Name], [Password])
OUTPUT INSERTED.[ID]
VALUES (@p0, @p1, @p2);
2024-11-06 10:29:52.930 -03:00 [INF] Executed DbCommand (5ms) [Parameters=[@p0='?' (Size = 450), @p1='?' (Size = 4000), @p2='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Users] ([Email], [Name], [Password])
OUTPUT INSERTED.[ID]
VALUES (@p0, @p1, @p2);
2024-11-06 10:29:52.933 -03:00 [DBG] The foreign key property 'User.ID' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2024-11-06 10:29:52.935 -03:00 [DBG] The foreign key property 'UserRole.UserId' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2024-11-06 10:29:52.937 -03:00 [DBG] Closing data reader to 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:29:52.939 -03:00 [DBG] A data reader for 'AuthServer' on server 'localhost,1433' is being disposed after spending 5ms reading results.
2024-11-06 10:29:52.941 -03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2024-11-06 10:29:52.942 -03:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2024-11-06 10:29:52.944 -03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (2ms).
2024-11-06 10:29:52.945 -03:00 [DBG] Executing DbCommand [Parameters=[@p3='?' (DbType = Int32), @p4='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [UserRole] ([RoleId], [UserId])
VALUES (@p3, @p4);
2024-11-06 10:29:52.950 -03:00 [INF] Executed DbCommand (5ms) [Parameters=[@p3='?' (DbType = Int32), @p4='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [UserRole] ([RoleId], [UserId])
VALUES (@p3, @p4);
2024-11-06 10:29:52.952 -03:00 [DBG] Closing data reader to 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:29:52.954 -03:00 [DBG] A data reader for 'AuthServer' on server 'localhost,1433' is being disposed after spending 1ms reading results.
2024-11-06 10:29:52.956 -03:00 [DBG] Closing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:29:52.957 -03:00 [DBG] Closed connection to database 'AuthServer' on server 'localhost,1433' (1ms).
2024-11-06 10:29:52.958 -03:00 [DBG] An entity of type 'User' tracked by 'AuthServerContext' changed state from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 10:29:52.960 -03:00 [DBG] An entity of type 'UserRole' tracked by 'AuthServerContext' changed state from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 10:29:52.962 -03:00 [DBG] SaveChanges completed for 'AuthServerContext' with 2 entities written to the database.
2024-11-06 10:29:52.971 -03:00 [DBG] List of registered output formatters, in the following order: ["Microsoft.AspNetCore.Mvc.Formatters.HttpNoContentOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StringOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StreamOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter"]
2024-11-06 10:29:52.974 -03:00 [DBG] No information found on request to perform content negotiation.
2024-11-06 10:29:52.974 -03:00 [DBG] Attempting to select an output formatter without using a content type as no explicit content types were specified for the response.
2024-11-06 10:29:52.975 -03:00 [DBG] Attempting to select the first formatter in the output formatters list which can write the result.
2024-11-06 10:29:52.976 -03:00 [DBG] Selected output formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter' and content type 'application/json' to write the response.
2024-11-06 10:29:52.978 -03:00 [INF] Executing CreatedAtActionResult, writing value of type 'AuthServer.Users.responses.UserResponse'.
2024-11-06 10:29:52.980 -03:00 [DBG] Found the endpoints ["AuthServer.Users.UsersController.GetUser (AuthServer)"] for address (id=[30],action=[GetUser],controller=[Users])
2024-11-06 10:29:52.982 -03:00 [DBG] Successfully processed template api/users/{id} for AuthServer.Users.UsersController.GetUser (AuthServer) resulting in /api/users/30 and 
2024-11-06 10:29:52.984 -03:00 [DBG] Link generation succeeded for endpoints ["AuthServer.Users.UsersController.GetUser (AuthServer)"] with result /api/users/30
2024-11-06 10:29:52.986 -03:00 [INF] Executed action AuthServer.Users.UsersController.CreateUser (AuthServer) in 192.6378ms
2024-11-06 10:29:52.987 -03:00 [INF] Executed endpoint 'AuthServer.Users.UsersController.CreateUser (AuthServer)'
2024-11-06 10:29:52.988 -03:00 [DBG] Connection id "0HN7UCRBO41D7" completed keep alive response.
2024-11-06 10:29:52.989 -03:00 [DBG] 'AuthServerContext' disposed.
2024-11-06 10:29:52.990 -03:00 [DBG] Disposing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:29:52.991 -03:00 [DBG] Disposed connection to database '' on server '' (1ms).
2024-11-06 10:29:52.993 -03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7011/api/users/ - 201 null application/json; charset=utf-8 220.2587ms
2024-11-06 10:30:06.803 -03:00 [INF] Request starting HTTP/1.1 DELETE https://localhost:7011/api/users/16 - application/json 95
2024-11-06 10:30:06.806 -03:00 [DBG] 1 candidate(s) found for the request path '/api/users/16'
2024-11-06 10:30:06.807 -03:00 [DBG] Endpoint 'AuthServer.Users.UsersController.Delete (AuthServer)' with route pattern 'api/users/{id}' is valid for the request path '/api/users/16'
2024-11-06 10:30:06.808 -03:00 [DBG] Request matched endpoint 'AuthServer.Users.UsersController.Delete (AuthServer)'
2024-11-06 10:30:06.809 -03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2024-11-06 10:30:06.811 -03:00 [DBG] AuthenticationScheme: Bearer was not authenticated.
2024-11-06 10:30:06.813 -03:00 [DBG] Policy authentication schemes  did not succeed
2024-11-06 10:30:06.814 -03:00 [INF] Authorization failed. These requirements were not met:
RolesAuthorizationRequirement:User.IsInRole must be true for one of the following roles: (ADMIN)
2024-11-06 10:30:06.818 -03:00 [INF] AuthenticationScheme: Bearer was challenged.
2024-11-06 10:30:06.820 -03:00 [DBG] Connection id "0HN7UCRBO41D7" completed keep alive response.
2024-11-06 10:30:06.821 -03:00 [INF] Request finished HTTP/1.1 DELETE https://localhost:7011/api/users/16 - 401 0 null 17.6534ms
2024-11-06 10:30:06.824 -03:00 [DBG] Connection id "0HN7UCRBO41D7", Request id "0HN7UCRBO41D7:00000009": started reading request body.
2024-11-06 10:30:06.825 -03:00 [DBG] Connection id "0HN7UCRBO41D7", Request id "0HN7UCRBO41D7:00000009": done reading request body.
2024-11-06 10:30:23.842 -03:00 [INF] Request starting HTTP/1.1 DELETE https://localhost:7011/api/users/30 - application/json 95
2024-11-06 10:30:23.845 -03:00 [DBG] 1 candidate(s) found for the request path '/api/users/30'
2024-11-06 10:30:23.847 -03:00 [DBG] Endpoint 'AuthServer.Users.UsersController.Delete (AuthServer)' with route pattern 'api/users/{id}' is valid for the request path '/api/users/30'
2024-11-06 10:30:23.848 -03:00 [DBG] Request matched endpoint 'AuthServer.Users.UsersController.Delete (AuthServer)'
2024-11-06 10:30:23.850 -03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2024-11-06 10:30:23.851 -03:00 [DBG] AuthenticationScheme: Bearer was not authenticated.
2024-11-06 10:30:23.852 -03:00 [DBG] Policy authentication schemes  did not succeed
2024-11-06 10:30:23.853 -03:00 [INF] Authorization failed. These requirements were not met:
RolesAuthorizationRequirement:User.IsInRole must be true for one of the following roles: (ADMIN)
2024-11-06 10:30:23.854 -03:00 [INF] AuthenticationScheme: Bearer was challenged.
2024-11-06 10:30:23.856 -03:00 [DBG] Connection id "0HN7UCRBO41D7" completed keep alive response.
2024-11-06 10:30:23.857 -03:00 [INF] Request finished HTTP/1.1 DELETE https://localhost:7011/api/users/30 - 401 0 null 15.1085ms
2024-11-06 10:30:23.863 -03:00 [DBG] Connection id "0HN7UCRBO41D7", Request id "0HN7UCRBO41D7:0000000A": started reading request body.
2024-11-06 10:30:23.864 -03:00 [DBG] Connection id "0HN7UCRBO41D7", Request id "0HN7UCRBO41D7:0000000A": done reading request body.
2024-11-06 10:30:55.080 -03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7011/api/users/login - application/json 76
2024-11-06 10:30:55.084 -03:00 [DBG] 1 candidate(s) found for the request path '/api/users/login'
2024-11-06 10:30:55.085 -03:00 [DBG] Endpoint 'AuthServer.Users.UsersController.Login (AuthServer)' with route pattern 'api/users/login' is valid for the request path '/api/users/login'
2024-11-06 10:30:55.087 -03:00 [DBG] Request matched endpoint 'AuthServer.Users.UsersController.Login (AuthServer)'
2024-11-06 10:30:55.088 -03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2024-11-06 10:30:55.089 -03:00 [DBG] AuthenticationScheme: Bearer was not authenticated.
2024-11-06 10:30:55.090 -03:00 [INF] Executing endpoint 'AuthServer.Users.UsersController.Login (AuthServer)'
2024-11-06 10:30:55.131 -03:00 [INF] Route matched with {action = "Login", controller = "Users"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult Login(AuthServer.Users.LoginRequest) on controller AuthServer.Users.UsersController (AuthServer).
2024-11-06 10:30:55.134 -03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2024-11-06 10:30:55.136 -03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2024-11-06 10:30:55.137 -03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)"]
2024-11-06 10:30:55.138 -03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2024-11-06 10:30:55.140 -03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)"]
2024-11-06 10:30:55.142 -03:00 [DBG] Executing controller factory for controller AuthServer.Users.UsersController (AuthServer)
2024-11-06 10:30:55.144 -03:00 [DBG] Executed controller factory for controller AuthServer.Users.UsersController (AuthServer)
2024-11-06 10:30:55.146 -03:00 [DBG] Attempting to bind parameter 'credentials' of type 'AuthServer.Users.LoginRequest' ...
2024-11-06 10:30:55.147 -03:00 [DBG] Attempting to bind parameter 'credentials' of type 'AuthServer.Users.LoginRequest' using the name '' in request data ...
2024-11-06 10:30:55.149 -03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2024-11-06 10:30:55.151 -03:00 [DBG] Connection id "0HN7UCRBO41D7", Request id "0HN7UCRBO41D7:0000000B": started reading request body.
2024-11-06 10:30:55.153 -03:00 [DBG] Connection id "0HN7UCRBO41D7", Request id "0HN7UCRBO41D7:0000000B": done reading request body.
2024-11-06 10:30:55.156 -03:00 [DBG] JSON input formatter succeeded, deserializing to type 'AuthServer.Users.LoginRequest'
2024-11-06 10:30:55.157 -03:00 [DBG] Done attempting to bind parameter 'credentials' of type 'AuthServer.Users.LoginRequest'.
2024-11-06 10:30:55.158 -03:00 [DBG] Done attempting to bind parameter 'credentials' of type 'AuthServer.Users.LoginRequest'.
2024-11-06 10:30:55.160 -03:00 [DBG] Attempting to validate the bound parameter 'credentials' of type 'AuthServer.Users.LoginRequest' ...
2024-11-06 10:30:55.163 -03:00 [DBG] Done attempting to validate the bound parameter 'credentials' of type 'AuthServer.Users.LoginRequest'.
2024-11-06 10:30:55.166 -03:00 [DBG] Entity Framework Core 8.0.10 initialized 'AuthServerContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:8.0.10' with options: None
2024-11-06 10:30:55.169 -03:00 [DBG] Compiling query expression: 
'DbSet<User>()
    .Include(u => u.Roles)
    .FirstOrDefault(u => u.Email == __email_0)'
2024-11-06 10:30:55.171 -03:00 [DBG] Including navigation: 'User.Roles'.
2024-11-06 10:30:55.187 -03:00 [DBG] Generated query execution expression: 
'queryContext => new SingleQueryingEnumerable<User>(
    (RelationalQueryContext)queryContext, 
    RelationalCommandCache.QueryExpression(
        Client Projections:
            0 -> Dictionary<IProperty, int> { [Property: User.ID (long) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: User.Email (string) Required Index, 1], [Property: User.Name (string) Required, 2], [Property: User.Password (string) Required, 3] }
            1 -> 0
            2 -> Dictionary<IProperty, int> { [Property: UserRole (Dictionary<string, object>).RoleId (no field, int) Indexer Required PK FK AfterSave:Throw, 4], [Property: UserRole (Dictionary<string, object>).UserId (no field, long) Indexer Required PK FK Index AfterSave:Throw, 5] }
            3 -> Dictionary<IProperty, int> { [Property: Role.Long (int) Required PK AfterSave:Throw ValueGenerated.OnAdd, 6], [Property: Role.Name (string) Required Index, 7] }
            4 -> 4
            5 -> 5
            6 -> 6
        SELECT t.ID, t.Email, t.Name, t.Password, t0.RoleId, t0.UserId, t0.Long, t0.Name
        FROM 
        (
            SELECT TOP(1) u.ID, u.Email, u.Name, u.Password
            FROM Users AS u
            WHERE u.Email == @__email_0
        ) AS t
        LEFT JOIN 
        (
            SELECT u0.RoleId, u0.UserId, r.Long, r.Name
            FROM UserRole AS u0
            INNER JOIN Roles AS r ON u0.RoleId == r.Long
        ) AS t0 ON t.ID == t0.UserId
        ORDER BY t.ID ASC, t0.RoleId ASC, t0.UserId ASC), 
    null, 
    Func<QueryContext, DbDataReader, ResultContext, SingleQueryResultCoordinator, User>, 
    AuthServer.AuthServerContext, 
    False, 
    False, 
    True
)
    .SingleOrDefault()'
2024-11-06 10:30:55.190 -03:00 [DBG] Creating DbConnection.
2024-11-06 10:30:55.191 -03:00 [DBG] Created DbConnection. (0ms).
2024-11-06 10:30:55.192 -03:00 [DBG] Opening connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:30:55.194 -03:00 [DBG] Opened connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:30:55.196 -03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2024-11-06 10:30:55.197 -03:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2024-11-06 10:30:55.198 -03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (2ms).
2024-11-06 10:30:55.200 -03:00 [DBG] Executing DbCommand [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[ID], [t].[Email], [t].[Name], [t].[Password], [t0].[RoleId], [t0].[UserId], [t0].[Long], [t0].[Name]
FROM (
    SELECT TOP(1) [u].[ID], [u].[Email], [u].[Name], [u].[Password]
    FROM [Users] AS [u]
    WHERE [u].[Email] = @__email_0
) AS [t]
LEFT JOIN (
    SELECT [u0].[RoleId], [u0].[UserId], [r].[Long], [r].[Name]
    FROM [UserRole] AS [u0]
    INNER JOIN [Roles] AS [r] ON [u0].[RoleId] = [r].[Long]
) AS [t0] ON [t].[ID] = [t0].[UserId]
ORDER BY [t].[ID], [t0].[RoleId], [t0].[UserId]
2024-11-06 10:30:55.205 -03:00 [INF] Executed DbCommand (6ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[ID], [t].[Email], [t].[Name], [t].[Password], [t0].[RoleId], [t0].[UserId], [t0].[Long], [t0].[Name]
FROM (
    SELECT TOP(1) [u].[ID], [u].[Email], [u].[Name], [u].[Password]
    FROM [Users] AS [u]
    WHERE [u].[Email] = @__email_0
) AS [t]
LEFT JOIN (
    SELECT [u0].[RoleId], [u0].[UserId], [r].[Long], [r].[Name]
    FROM [UserRole] AS [u0]
    INNER JOIN [Roles] AS [r] ON [u0].[RoleId] = [r].[Long]
) AS [t0] ON [t].[ID] = [t0].[UserId]
ORDER BY [t].[ID], [t0].[RoleId], [t0].[UserId]
2024-11-06 10:30:55.209 -03:00 [DBG] Context 'AuthServerContext' started tracking 'User' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 10:30:55.211 -03:00 [DBG] Context 'AuthServerContext' started tracking 'UserRole' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 10:30:55.213 -03:00 [DBG] Context 'AuthServerContext' started tracking 'Role' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 10:30:55.214 -03:00 [DBG] Closing data reader to 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:30:55.216 -03:00 [DBG] A data reader for 'AuthServer' on server 'localhost,1433' is being disposed after spending 6ms reading results.
2024-11-06 10:30:55.217 -03:00 [DBG] Closing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:30:55.219 -03:00 [DBG] Closed connection to database 'AuthServer' on server 'localhost,1433' (1ms).
2024-11-06 10:30:55.220 -03:00 [INF] User logged in. id=30 name=gustavo
2024-11-06 10:30:55.305 -03:00 [DBG] List of registered output formatters, in the following order: ["Microsoft.AspNetCore.Mvc.Formatters.HttpNoContentOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StringOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StreamOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter"]
2024-11-06 10:30:55.308 -03:00 [DBG] No information found on request to perform content negotiation.
2024-11-06 10:30:55.309 -03:00 [DBG] Attempting to select an output formatter without using a content type as no explicit content types were specified for the response.
2024-11-06 10:30:55.310 -03:00 [DBG] Attempting to select the first formatter in the output formatters list which can write the result.
2024-11-06 10:30:55.311 -03:00 [DBG] Selected output formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter' and content type 'application/json' to write the response.
2024-11-06 10:30:55.313 -03:00 [INF] Executing OkObjectResult, writing value of type 'LoginResponse'.
2024-11-06 10:30:55.316 -03:00 [INF] Executed action AuthServer.Users.UsersController.Login (AuthServer) in 174.9755ms
2024-11-06 10:30:55.318 -03:00 [INF] Executed endpoint 'AuthServer.Users.UsersController.Login (AuthServer)'
2024-11-06 10:30:55.319 -03:00 [DBG] Connection id "0HN7UCRBO41D7" completed keep alive response.
2024-11-06 10:30:55.320 -03:00 [DBG] 'AuthServerContext' disposed.
2024-11-06 10:30:55.321 -03:00 [DBG] Disposing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:30:55.323 -03:00 [DBG] Disposed connection to database '' on server '' (1ms).
2024-11-06 10:30:55.324 -03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7011/api/users/login - 200 null application/json; charset=utf-8 244.5412ms
2024-11-06 10:31:09.672 -03:00 [INF] Request starting HTTP/1.1 DELETE https://localhost:7011/api/users/16 - application/json 76
2024-11-06 10:31:09.675 -03:00 [DBG] 1 candidate(s) found for the request path '/api/users/16'
2024-11-06 10:31:09.677 -03:00 [DBG] Endpoint 'AuthServer.Users.UsersController.Delete (AuthServer)' with route pattern 'api/users/{id}' is valid for the request path '/api/users/16'
2024-11-06 10:31:09.678 -03:00 [DBG] Request matched endpoint 'AuthServer.Users.UsersController.Delete (AuthServer)'
2024-11-06 10:31:09.679 -03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2024-11-06 10:31:09.681 -03:00 [DBG] Successfully validated the token.
2024-11-06 10:31:09.682 -03:00 [DBG] AuthenticationScheme: Bearer was successfully authenticated.
2024-11-06 10:31:09.682 -03:00 [INF] Authorization failed. These requirements were not met:
RolesAuthorizationRequirement:User.IsInRole must be true for one of the following roles: (ADMIN)
2024-11-06 10:31:09.722 -03:00 [INF] AuthenticationScheme: Bearer was forbidden.
2024-11-06 10:31:09.723 -03:00 [DBG] Connection id "0HN7UCRBO41D7" completed keep alive response.
2024-11-06 10:31:09.724 -03:00 [INF] Request finished HTTP/1.1 DELETE https://localhost:7011/api/users/16 - 403 0 null 52.1944ms
2024-11-06 10:31:09.728 -03:00 [DBG] Connection id "0HN7UCRBO41D7", Request id "0HN7UCRBO41D7:0000000C": started reading request body.
2024-11-06 10:31:09.729 -03:00 [DBG] Connection id "0HN7UCRBO41D7", Request id "0HN7UCRBO41D7:0000000C": done reading request body.
2024-11-06 10:31:19.082 -03:00 [INF] Request starting HTTP/1.1 DELETE https://localhost:7011/api/users/30 - application/json 76
2024-11-06 10:31:19.085 -03:00 [DBG] 1 candidate(s) found for the request path '/api/users/30'
2024-11-06 10:31:19.086 -03:00 [DBG] Endpoint 'AuthServer.Users.UsersController.Delete (AuthServer)' with route pattern 'api/users/{id}' is valid for the request path '/api/users/30'
2024-11-06 10:31:19.087 -03:00 [DBG] Request matched endpoint 'AuthServer.Users.UsersController.Delete (AuthServer)'
2024-11-06 10:31:19.088 -03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2024-11-06 10:31:19.090 -03:00 [DBG] Successfully validated the token.
2024-11-06 10:31:19.091 -03:00 [DBG] AuthenticationScheme: Bearer was successfully authenticated.
2024-11-06 10:31:19.092 -03:00 [INF] Authorization failed. These requirements were not met:
RolesAuthorizationRequirement:User.IsInRole must be true for one of the following roles: (ADMIN)
2024-11-06 10:31:19.093 -03:00 [INF] AuthenticationScheme: Bearer was forbidden.
2024-11-06 10:31:19.094 -03:00 [DBG] Connection id "0HN7UCRBO41D7" completed keep alive response.
2024-11-06 10:31:19.095 -03:00 [INF] Request finished HTTP/1.1 DELETE https://localhost:7011/api/users/30 - 403 0 null 13.1498ms
2024-11-06 10:31:19.098 -03:00 [DBG] Connection id "0HN7UCRBO41D7", Request id "0HN7UCRBO41D7:0000000D": started reading request body.
2024-11-06 10:31:19.100 -03:00 [DBG] Connection id "0HN7UCRBO41D7", Request id "0HN7UCRBO41D7:0000000D": done reading request body.
2024-11-06 10:31:31.445 -03:00 [INF] Request starting HTTP/1.1 GET https://localhost:7011/api/users - application/json 76
2024-11-06 10:31:31.448 -03:00 [DBG] 1 candidate(s) found for the request path '/api/users'
2024-11-06 10:31:31.449 -03:00 [DBG] Endpoint 'AuthServer.Users.UsersController.ListUsers (AuthServer)' with route pattern 'api/users' is valid for the request path '/api/users'
2024-11-06 10:31:31.451 -03:00 [DBG] Request matched endpoint 'AuthServer.Users.UsersController.ListUsers (AuthServer)'
2024-11-06 10:31:31.452 -03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2024-11-06 10:31:31.453 -03:00 [DBG] Successfully validated the token.
2024-11-06 10:31:31.455 -03:00 [DBG] AuthenticationScheme: Bearer was successfully authenticated.
2024-11-06 10:31:31.456 -03:00 [INF] Executing endpoint 'AuthServer.Users.UsersController.ListUsers (AuthServer)'
2024-11-06 10:31:31.458 -03:00 [INF] Route matched with {action = "ListUsers", controller = "Users"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.ActionResult`1[System.Collections.Generic.List`1[AuthServer.Users.responses.UserResponse]] ListUsers(System.String) on controller AuthServer.Users.UsersController (AuthServer).
2024-11-06 10:31:31.460 -03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2024-11-06 10:31:31.462 -03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2024-11-06 10:31:31.464 -03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)"]
2024-11-06 10:31:31.467 -03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2024-11-06 10:31:31.469 -03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)"]
2024-11-06 10:31:31.470 -03:00 [DBG] Executing controller factory for controller AuthServer.Users.UsersController (AuthServer)
2024-11-06 10:31:31.472 -03:00 [DBG] Executed controller factory for controller AuthServer.Users.UsersController (AuthServer)
2024-11-06 10:31:31.473 -03:00 [DBG] Attempting to bind parameter 'role' of type 'System.String' ...
2024-11-06 10:31:31.475 -03:00 [DBG] Attempting to bind parameter 'role' of type 'System.String' using the name '' in request data ...
2024-11-06 10:31:31.477 -03:00 [DBG] Could not find a value in the request with name '' for binding parameter 'role' of type 'System.String'.
2024-11-06 10:31:31.479 -03:00 [DBG] Done attempting to bind parameter 'role' of type 'System.String'.
2024-11-06 10:31:31.480 -03:00 [DBG] Done attempting to bind parameter 'role' of type 'System.String'.
2024-11-06 10:31:31.482 -03:00 [DBG] Attempting to validate the bound parameter 'role' of type 'System.String' ...
2024-11-06 10:31:31.484 -03:00 [DBG] Done attempting to validate the bound parameter 'role' of type 'System.String'.
2024-11-06 10:31:31.486 -03:00 [DBG] Entity Framework Core 8.0.10 initialized 'AuthServerContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:8.0.10' with options: None
2024-11-06 10:31:31.489 -03:00 [DBG] Creating DbConnection.
2024-11-06 10:31:31.490 -03:00 [DBG] Created DbConnection. (1ms).
2024-11-06 10:31:31.491 -03:00 [DBG] Opening connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:31:31.493 -03:00 [DBG] Opened connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:31:31.495 -03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2024-11-06 10:31:31.496 -03:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2024-11-06 10:31:31.498 -03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (2ms).
2024-11-06 10:31:31.499 -03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[ID], [u].[Email], [u].[Name], [u].[Password], [t].[RoleId], [t].[UserId], [t].[Long], [t].[Name]
FROM [Users] AS [u]
LEFT JOIN (
    SELECT [u0].[RoleId], [u0].[UserId], [r].[Long], [r].[Name]
    FROM [UserRole] AS [u0]
    INNER JOIN [Roles] AS [r] ON [u0].[RoleId] = [r].[Long]
) AS [t] ON [u].[ID] = [t].[UserId]
ORDER BY [u].[ID], [t].[RoleId], [t].[UserId]
2024-11-06 10:31:31.505 -03:00 [INF] Executed DbCommand (6ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[ID], [u].[Email], [u].[Name], [u].[Password], [t].[RoleId], [t].[UserId], [t].[Long], [t].[Name]
FROM [Users] AS [u]
LEFT JOIN (
    SELECT [u0].[RoleId], [u0].[UserId], [r].[Long], [r].[Name]
    FROM [UserRole] AS [u0]
    INNER JOIN [Roles] AS [r] ON [u0].[RoleId] = [r].[Long]
) AS [t] ON [u].[ID] = [t].[UserId]
ORDER BY [u].[ID], [t].[RoleId], [t].[UserId]
2024-11-06 10:31:31.508 -03:00 [DBG] Context 'AuthServerContext' started tracking 'User' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 10:31:31.510 -03:00 [DBG] Context 'AuthServerContext' started tracking 'UserRole' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 10:31:31.512 -03:00 [DBG] Context 'AuthServerContext' started tracking 'Role' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 10:31:31.514 -03:00 [DBG] Context 'AuthServerContext' started tracking 'User' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 10:31:31.516 -03:00 [DBG] Context 'AuthServerContext' started tracking 'UserRole' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 10:31:31.517 -03:00 [DBG] Context 'AuthServerContext' started tracking 'Role' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 10:31:31.519 -03:00 [DBG] Closing data reader to 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:31:31.521 -03:00 [DBG] A data reader for 'AuthServer' on server 'localhost,1433' is being disposed after spending 13ms reading results.
2024-11-06 10:31:31.523 -03:00 [DBG] Closing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:31:31.525 -03:00 [DBG] Closed connection to database 'AuthServer' on server 'localhost,1433' (1ms).
2024-11-06 10:31:31.527 -03:00 [DBG] List of registered output formatters, in the following order: ["Microsoft.AspNetCore.Mvc.Formatters.HttpNoContentOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StringOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StreamOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter"]
2024-11-06 10:31:31.529 -03:00 [DBG] No information found on request to perform content negotiation.
2024-11-06 10:31:31.530 -03:00 [DBG] Attempting to select an output formatter without using a content type as no explicit content types were specified for the response.
2024-11-06 10:31:31.531 -03:00 [DBG] Attempting to select the first formatter in the output formatters list which can write the result.
2024-11-06 10:31:31.532 -03:00 [DBG] Selected output formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter' and content type 'application/json' to write the response.
2024-11-06 10:31:31.534 -03:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[AuthServer.Users.responses.UserResponse, AuthServer, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2024-11-06 10:31:31.536 -03:00 [INF] Executed action AuthServer.Users.UsersController.ListUsers (AuthServer) in 65.1982ms
2024-11-06 10:31:31.537 -03:00 [INF] Executed endpoint 'AuthServer.Users.UsersController.ListUsers (AuthServer)'
2024-11-06 10:31:31.538 -03:00 [DBG] Connection id "0HN7UCRBO41D7" completed keep alive response.
2024-11-06 10:31:31.540 -03:00 [DBG] 'AuthServerContext' disposed.
2024-11-06 10:31:31.541 -03:00 [DBG] Disposing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:31:31.543 -03:00 [DBG] Disposed connection to database '' on server '' (1ms).
2024-11-06 10:31:31.545 -03:00 [INF] Request finished HTTP/1.1 GET https://localhost:7011/api/users - 200 null application/json; charset=utf-8 100.9567ms
2024-11-06 10:31:31.548 -03:00 [DBG] Connection id "0HN7UCRBO41D7", Request id "0HN7UCRBO41D7:0000000E": started reading request body.
2024-11-06 10:31:31.550 -03:00 [DBG] Connection id "0HN7UCRBO41D7", Request id "0HN7UCRBO41D7:0000000E": done reading request body.
2024-11-06 10:31:38.807 -03:00 [INF] Request starting HTTP/1.1 GET https://localhost:7011/api/users - application/json 76
2024-11-06 10:31:38.810 -03:00 [DBG] 1 candidate(s) found for the request path '/api/users'
2024-11-06 10:31:38.811 -03:00 [DBG] Endpoint 'AuthServer.Users.UsersController.ListUsers (AuthServer)' with route pattern 'api/users' is valid for the request path '/api/users'
2024-11-06 10:31:38.813 -03:00 [DBG] Request matched endpoint 'AuthServer.Users.UsersController.ListUsers (AuthServer)'
2024-11-06 10:31:38.814 -03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2024-11-06 10:31:38.815 -03:00 [DBG] AuthenticationScheme: Bearer was not authenticated.
2024-11-06 10:31:38.817 -03:00 [INF] Executing endpoint 'AuthServer.Users.UsersController.ListUsers (AuthServer)'
2024-11-06 10:31:38.818 -03:00 [INF] Route matched with {action = "ListUsers", controller = "Users"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.ActionResult`1[System.Collections.Generic.List`1[AuthServer.Users.responses.UserResponse]] ListUsers(System.String) on controller AuthServer.Users.UsersController (AuthServer).
2024-11-06 10:31:38.820 -03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2024-11-06 10:31:38.822 -03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2024-11-06 10:31:38.824 -03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)"]
2024-11-06 10:31:38.826 -03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2024-11-06 10:31:38.828 -03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)"]
2024-11-06 10:31:38.830 -03:00 [DBG] Executing controller factory for controller AuthServer.Users.UsersController (AuthServer)
2024-11-06 10:31:38.832 -03:00 [DBG] Executed controller factory for controller AuthServer.Users.UsersController (AuthServer)
2024-11-06 10:31:38.834 -03:00 [DBG] Attempting to bind parameter 'role' of type 'System.String' ...
2024-11-06 10:31:38.836 -03:00 [DBG] Attempting to bind parameter 'role' of type 'System.String' using the name '' in request data ...
2024-11-06 10:31:38.837 -03:00 [DBG] Could not find a value in the request with name '' for binding parameter 'role' of type 'System.String'.
2024-11-06 10:31:38.839 -03:00 [DBG] Done attempting to bind parameter 'role' of type 'System.String'.
2024-11-06 10:31:38.841 -03:00 [DBG] Done attempting to bind parameter 'role' of type 'System.String'.
2024-11-06 10:31:38.844 -03:00 [DBG] Attempting to validate the bound parameter 'role' of type 'System.String' ...
2024-11-06 10:31:38.845 -03:00 [DBG] Done attempting to validate the bound parameter 'role' of type 'System.String'.
2024-11-06 10:31:38.847 -03:00 [DBG] Entity Framework Core 8.0.10 initialized 'AuthServerContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:8.0.10' with options: None
2024-11-06 10:31:38.850 -03:00 [DBG] Creating DbConnection.
2024-11-06 10:31:38.851 -03:00 [DBG] Created DbConnection. (1ms).
2024-11-06 10:31:38.852 -03:00 [DBG] Opening connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:31:38.853 -03:00 [DBG] Opened connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:31:38.855 -03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2024-11-06 10:31:38.856 -03:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2024-11-06 10:31:38.858 -03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (2ms).
2024-11-06 10:31:38.859 -03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[ID], [u].[Email], [u].[Name], [u].[Password], [t].[RoleId], [t].[UserId], [t].[Long], [t].[Name]
FROM [Users] AS [u]
LEFT JOIN (
    SELECT [u0].[RoleId], [u0].[UserId], [r].[Long], [r].[Name]
    FROM [UserRole] AS [u0]
    INNER JOIN [Roles] AS [r] ON [u0].[RoleId] = [r].[Long]
) AS [t] ON [u].[ID] = [t].[UserId]
ORDER BY [u].[ID], [t].[RoleId], [t].[UserId]
2024-11-06 10:31:38.864 -03:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[ID], [u].[Email], [u].[Name], [u].[Password], [t].[RoleId], [t].[UserId], [t].[Long], [t].[Name]
FROM [Users] AS [u]
LEFT JOIN (
    SELECT [u0].[RoleId], [u0].[UserId], [r].[Long], [r].[Name]
    FROM [UserRole] AS [u0]
    INNER JOIN [Roles] AS [r] ON [u0].[RoleId] = [r].[Long]
) AS [t] ON [u].[ID] = [t].[UserId]
ORDER BY [u].[ID], [t].[RoleId], [t].[UserId]
2024-11-06 10:31:38.867 -03:00 [DBG] Context 'AuthServerContext' started tracking 'User' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 10:31:38.869 -03:00 [DBG] Context 'AuthServerContext' started tracking 'UserRole' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 10:31:38.870 -03:00 [DBG] Context 'AuthServerContext' started tracking 'Role' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 10:31:38.871 -03:00 [DBG] Context 'AuthServerContext' started tracking 'User' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 10:31:38.873 -03:00 [DBG] Context 'AuthServerContext' started tracking 'UserRole' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 10:31:38.875 -03:00 [DBG] Context 'AuthServerContext' started tracking 'Role' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 10:31:38.876 -03:00 [DBG] Closing data reader to 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:31:38.877 -03:00 [DBG] A data reader for 'AuthServer' on server 'localhost,1433' is being disposed after spending 10ms reading results.
2024-11-06 10:31:38.879 -03:00 [DBG] Closing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:31:38.880 -03:00 [DBG] Closed connection to database 'AuthServer' on server 'localhost,1433' (1ms).
2024-11-06 10:31:38.882 -03:00 [DBG] List of registered output formatters, in the following order: ["Microsoft.AspNetCore.Mvc.Formatters.HttpNoContentOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StringOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StreamOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter"]
2024-11-06 10:31:38.885 -03:00 [DBG] No information found on request to perform content negotiation.
2024-11-06 10:31:38.886 -03:00 [DBG] Attempting to select an output formatter without using a content type as no explicit content types were specified for the response.
2024-11-06 10:31:38.887 -03:00 [DBG] Attempting to select the first formatter in the output formatters list which can write the result.
2024-11-06 10:31:38.888 -03:00 [DBG] Selected output formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter' and content type 'application/json' to write the response.
2024-11-06 10:31:38.889 -03:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[AuthServer.Users.responses.UserResponse, AuthServer, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2024-11-06 10:31:38.891 -03:00 [INF] Executed action AuthServer.Users.UsersController.ListUsers (AuthServer) in 60.7827ms
2024-11-06 10:31:38.893 -03:00 [INF] Executed endpoint 'AuthServer.Users.UsersController.ListUsers (AuthServer)'
2024-11-06 10:31:38.894 -03:00 [DBG] Connection id "0HN7UCRBO41D7" completed keep alive response.
2024-11-06 10:31:38.896 -03:00 [DBG] 'AuthServerContext' disposed.
2024-11-06 10:31:38.897 -03:00 [DBG] Disposing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 10:31:38.898 -03:00 [DBG] Disposed connection to database '' on server '' (1ms).
2024-11-06 10:31:38.899 -03:00 [INF] Request finished HTTP/1.1 GET https://localhost:7011/api/users - 200 null application/json; charset=utf-8 92.2702ms
2024-11-06 10:31:38.902 -03:00 [DBG] Connection id "0HN7UCRBO41D7", Request id "0HN7UCRBO41D7:0000000F": started reading request body.
2024-11-06 10:31:38.903 -03:00 [DBG] Connection id "0HN7UCRBO41D7", Request id "0HN7UCRBO41D7:0000000F": done reading request body.
2024-11-06 10:33:50.040 -03:00 [DBG] Connection id "0HN7UCRBO41D7" disconnecting.
2024-11-06 10:33:50.043 -03:00 [DBG] Connection id "0HN7UCRBO41D7" stopped.
2024-11-06 10:33:50.044 -03:00 [DBG] Connection id "0HN7UCRBO41D7" sending FIN because: "The Socket transport's send loop completed gracefully."
2024-11-06 11:34:29.190 -03:00 [DBG] Config reload token fired. Checking for changes...
2024-11-06 11:34:29.453 -03:00 [DBG] Config reload token fired. Checking for changes...
2024-11-06 11:51:08.965 -03:00 [INF] Aplicação iniciada - configuração de logs inicializada.
2024-11-06 11:51:09.111 -03:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2024-11-06 11:51:09.140 -03:00 [DBG] Hosting starting
2024-11-06 11:51:09.151 -03:00 [INF] User profile is available. Using 'C:\Users\gusta\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2024-11-06 11:51:09.155 -03:00 [DBG] Reading data from file 'C:\Users\gusta\AppData\Local\ASP.NET\DataProtection-Keys\key-bf4636f6-ef08-4ac9-8613-5c8299c406a4.xml'.
2024-11-06 11:51:09.160 -03:00 [DBG] Found key {bf4636f6-ef08-4ac9-8613-5c8299c406a4}.
2024-11-06 11:51:09.165 -03:00 [DBG] Considering key {bf4636f6-ef08-4ac9-8613-5c8299c406a4} with expiration date 2025-02-02 14:46:39Z as default key.
2024-11-06 11:51:09.167 -03:00 [DBG] Forwarded activator type request from Microsoft.AspNetCore.DataProtection.XmlEncryption.DpapiXmlDecryptor, Microsoft.AspNetCore.DataProtection, Version=8.0.0.0, Culture=neutral, PublicKeyToken=adb9793829ddae60 to Microsoft.AspNetCore.DataProtection.XmlEncryption.DpapiXmlDecryptor, Microsoft.AspNetCore.DataProtection, Culture=neutral, PublicKeyToken=adb9793829ddae60
2024-11-06 11:51:09.169 -03:00 [DBG] Decrypting secret element using Windows DPAPI.
2024-11-06 11:51:09.171 -03:00 [DBG] Forwarded activator type request from Microsoft.AspNetCore.DataProtection.AuthenticatedEncryption.ConfigurationModel.AuthenticatedEncryptorDescriptorDeserializer, Microsoft.AspNetCore.DataProtection, Version=8.0.0.0, Culture=neutral, PublicKeyToken=adb9793829ddae60 to Microsoft.AspNetCore.DataProtection.AuthenticatedEncryption.ConfigurationModel.AuthenticatedEncryptorDescriptorDeserializer, Microsoft.AspNetCore.DataProtection, Culture=neutral, PublicKeyToken=adb9793829ddae60
2024-11-06 11:51:09.174 -03:00 [DBG] Opening CNG algorithm 'AES' from provider 'null' with chaining mode CBC.
2024-11-06 11:51:09.175 -03:00 [DBG] Opening CNG algorithm 'SHA256' from provider 'null' with HMAC.
2024-11-06 11:51:09.177 -03:00 [DBG] Using key {bf4636f6-ef08-4ac9-8613-5c8299c406a4} as the default key.
2024-11-06 11:51:09.177 -03:00 [DBG] Key ring with default key {bf4636f6-ef08-4ac9-8613-5c8299c406a4} was loaded during application startup.
2024-11-06 11:51:09.226 -03:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2024-11-06 11:51:09.460 -03:00 [DBG] The index {'RoleId'} was not created on entity type 'UserRole (Dictionary<string, object>)' as the properties are already covered by the index {'RoleId', 'UserId'}.
2024-11-06 11:51:09.585 -03:00 [DBG] Entity Framework Core 8.0.10 initialized 'AuthServerContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:8.0.10' with options: None
2024-11-06 11:51:09.610 -03:00 [DBG] Compiling query expression: 
'DbSet<Role>()
    .Count()'
2024-11-06 11:51:09.726 -03:00 [DBG] Generated query execution expression: 
'queryContext => new SingleQueryingEnumerable<int>(
    (RelationalQueryContext)queryContext, 
    RelationalCommandCache.QueryExpression(
        Projection Mapping:
            EmptyProjectionMember -> 0
        SELECT COUNT(*)
        FROM Roles AS r), 
    null, 
    Func<QueryContext, DbDataReader, ResultContext, SingleQueryResultCoordinator, int>, 
    AuthServer.AuthServerContext, 
    False, 
    False, 
    True
)
    .Single()'
2024-11-06 11:51:09.742 -03:00 [DBG] Creating DbConnection.
2024-11-06 11:51:09.756 -03:00 [DBG] Created DbConnection. (12ms).
2024-11-06 11:51:09.758 -03:00 [DBG] Opening connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 11:51:09.896 -03:00 [DBG] Opened connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 11:51:09.899 -03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2024-11-06 11:51:09.904 -03:00 [DBG] Created DbCommand for 'ExecuteReader' (3ms).
2024-11-06 11:51:09.905 -03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (6ms).
2024-11-06 11:51:09.909 -03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*)
FROM [Roles] AS [r]
2024-11-06 11:51:09.937 -03:00 [INF] Executed DbCommand (26ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*)
FROM [Roles] AS [r]
2024-11-06 11:51:09.944 -03:00 [DBG] Closing data reader to 'AuthServer' on server 'localhost,1433'.
2024-11-06 11:51:09.948 -03:00 [DBG] A data reader for 'AuthServer' on server 'localhost,1433' is being disposed after spending 6ms reading results.
2024-11-06 11:51:09.950 -03:00 [DBG] Closing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 11:51:09.953 -03:00 [DBG] Closed connection to database 'AuthServer' on server 'localhost,1433' (3ms).
2024-11-06 11:51:09.959 -03:00 [DBG] Compiling query expression: 
'DbSet<User>()
    .Include(user => user.Roles)'
2024-11-06 11:51:09.967 -03:00 [DBG] Including navigation: 'User.Roles'.
2024-11-06 11:51:10.030 -03:00 [DBG] Generated query execution expression: 
'queryContext => new SingleQueryingEnumerable<User>(
    (RelationalQueryContext)queryContext, 
    RelationalCommandCache.QueryExpression(
        Client Projections:
            0 -> Dictionary<IProperty, int> { [Property: User.ID (long) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: User.Email (string) Required Index, 1], [Property: User.Name (string) Required, 2], [Property: User.Password (string) Required, 3] }
            1 -> 0
            2 -> Dictionary<IProperty, int> { [Property: UserRole (Dictionary<string, object>).RoleId (no field, int) Indexer Required PK FK AfterSave:Throw, 4], [Property: UserRole (Dictionary<string, object>).UserId (no field, long) Indexer Required PK FK Index AfterSave:Throw, 5] }
            3 -> Dictionary<IProperty, int> { [Property: Role.Long (int) Required PK AfterSave:Throw ValueGenerated.OnAdd, 6], [Property: Role.Name (string) Required Index, 7] }
            4 -> 4
            5 -> 5
            6 -> 6
        SELECT u.ID, u.Email, u.Name, u.Password, t.RoleId, t.UserId, t.Long, t.Name
        FROM Users AS u
        LEFT JOIN 
        (
            SELECT u0.RoleId, u0.UserId, r.Long, r.Name
            FROM UserRole AS u0
            INNER JOIN Roles AS r ON u0.RoleId == r.Long
        ) AS t ON u.ID == t.UserId
        ORDER BY u.ID ASC, t.RoleId ASC, t.UserId ASC), 
    null, 
    Func<QueryContext, DbDataReader, ResultContext, SingleQueryResultCoordinator, User>, 
    AuthServer.AuthServerContext, 
    False, 
    False, 
    True
)'
2024-11-06 11:51:10.035 -03:00 [DBG] Opening connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 11:51:10.036 -03:00 [DBG] Opened connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 11:51:10.037 -03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2024-11-06 11:51:10.038 -03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2024-11-06 11:51:10.039 -03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2024-11-06 11:51:10.040 -03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[ID], [u].[Email], [u].[Name], [u].[Password], [t].[RoleId], [t].[UserId], [t].[Long], [t].[Name]
FROM [Users] AS [u]
LEFT JOIN (
    SELECT [u0].[RoleId], [u0].[UserId], [r].[Long], [r].[Name]
    FROM [UserRole] AS [u0]
    INNER JOIN [Roles] AS [r] ON [u0].[RoleId] = [r].[Long]
) AS [t] ON [u].[ID] = [t].[UserId]
ORDER BY [u].[ID], [t].[RoleId], [t].[UserId]
2024-11-06 11:51:10.046 -03:00 [INF] Executed DbCommand (6ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[ID], [u].[Email], [u].[Name], [u].[Password], [t].[RoleId], [t].[UserId], [t].[Long], [t].[Name]
FROM [Users] AS [u]
LEFT JOIN (
    SELECT [u0].[RoleId], [u0].[UserId], [r].[Long], [r].[Name]
    FROM [UserRole] AS [u0]
    INNER JOIN [Roles] AS [r] ON [u0].[RoleId] = [r].[Long]
) AS [t] ON [u].[ID] = [t].[UserId]
ORDER BY [u].[ID], [t].[RoleId], [t].[UserId]
2024-11-06 11:51:10.064 -03:00 [DBG] Context 'AuthServerContext' started tracking 'User' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 11:51:10.083 -03:00 [DBG] Context 'AuthServerContext' started tracking 'UserRole' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 11:51:10.093 -03:00 [DBG] Context 'AuthServerContext' started tracking 'Role' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 11:51:10.096 -03:00 [DBG] Context 'AuthServerContext' started tracking 'User' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 11:51:10.097 -03:00 [DBG] Context 'AuthServerContext' started tracking 'UserRole' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 11:51:10.098 -03:00 [DBG] Context 'AuthServerContext' started tracking 'Role' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 11:51:10.099 -03:00 [DBG] Closing data reader to 'AuthServer' on server 'localhost,1433'.
2024-11-06 11:51:10.100 -03:00 [DBG] A data reader for 'AuthServer' on server 'localhost,1433' is being disposed after spending 52ms reading results.
2024-11-06 11:51:10.101 -03:00 [DBG] Closing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 11:51:10.102 -03:00 [DBG] Closed connection to database 'AuthServer' on server 'localhost,1433' (0ms).
2024-11-06 11:51:10.103 -03:00 [DBG] 'AuthServerContext' disposed.
2024-11-06 11:51:10.105 -03:00 [DBG] Disposing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 11:51:10.106 -03:00 [DBG] Disposed connection to database '' on server '' (1ms).
2024-11-06 11:51:10.193 -03:00 [INF] Now listening on: https://localhost:7011
2024-11-06 11:51:10.193 -03:00 [INF] Now listening on: http://localhost:5091
2024-11-06 11:51:10.194 -03:00 [DBG] Loaded hosting startup assembly AuthServer
2024-11-06 11:51:10.195 -03:00 [DBG] Loaded hosting startup assembly Microsoft.AspNetCore.Watch.BrowserRefresh
2024-11-06 11:51:10.195 -03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.BrowserLink.Net
2024-11-06 11:51:10.196 -03:00 [INF] Application started. Press Ctrl+C to shut down.
2024-11-06 11:51:10.196 -03:00 [INF] Hosting environment: Development
2024-11-06 11:51:10.197 -03:00 [INF] Content root path: C:\Users\gusta\source\repos\AuthServer\AuthServer
2024-11-06 11:51:10.197 -03:00 [DBG] Hosting started
2024-11-06 11:51:10.225 -03:00 [DBG] Connection id "0HN7UE9PSO94Q" accepted.
2024-11-06 11:51:10.226 -03:00 [DBG] Connection id "0HN7UE9PSO94Q" started.
2024-11-06 11:51:10.235 -03:00 [DBG] Connection id "0HN7UE9PSO94R" accepted.
2024-11-06 11:51:10.236 -03:00 [DBG] Connection id "0HN7UE9PSO94R" started.
2024-11-06 11:51:10.268 -03:00 [DBG] Connection id "0HN7UE9PSO94R" received FIN.
2024-11-06 11:51:10.268 -03:00 [DBG] Connection id "0HN7UE9PSO94Q" received FIN.
2024-11-06 11:51:10.273 -03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2024-11-06 11:51:10.273 -03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2024-11-06 11:51:10.291 -03:00 [DBG] Connection id "0HN7UE9PSO94R" stopped.
2024-11-06 11:51:10.291 -03:00 [DBG] Connection id "0HN7UE9PSO94Q" stopped.
2024-11-06 11:51:10.293 -03:00 [DBG] Connection id "0HN7UE9PSO94R" sending FIN because: "The Socket transport's send loop completed gracefully."
2024-11-06 11:51:10.293 -03:00 [DBG] Connection id "0HN7UE9PSO94Q" sending FIN because: "The Socket transport's send loop completed gracefully."
2024-11-06 11:51:10.343 -03:00 [DBG] Connection id "0HN7UE9PSO94S" accepted.
2024-11-06 11:51:10.344 -03:00 [DBG] Connection id "0HN7UE9PSO94S" started.
2024-11-06 11:51:10.370 -03:00 [DBG] Connection 0HN7UE9PSO94S established using the following protocol: "Tls13"
2024-11-06 11:51:10.398 -03:00 [INF] Request starting HTTP/2 GET https://localhost:7011/swagger/index.html - null null
2024-11-06 11:51:10.458 -03:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2024-11-06 11:51:10.470 -03:00 [DBG] No candidates found for the request path '/swagger/index.html'
2024-11-06 11:51:10.471 -03:00 [DBG] Request did not match any endpoints
2024-11-06 11:51:10.525 -03:00 [DBG] Response markup is scheduled to include Browser Link script injection.
2024-11-06 11:51:10.526 -03:00 [DBG] Response markup is scheduled to include browser refresh script injection.
2024-11-06 11:51:10.531 -03:00 [DBG] Response markup was updated to include Browser Link script injection.
2024-11-06 11:51:10.532 -03:00 [DBG] Response markup was updated to include browser refresh script injection.
2024-11-06 11:51:10.535 -03:00 [INF] Request finished HTTP/2 GET https://localhost:7011/swagger/index.html - 200 null text/html;charset=utf-8 138.3928ms
2024-11-06 11:51:10.556 -03:00 [INF] Request starting HTTP/2 GET https://localhost:7011/_framework/aspnetcore-browser-refresh.js - null null
2024-11-06 11:51:10.556 -03:00 [INF] Request starting HTTP/2 GET https://localhost:7011/swagger/index.js - null null
2024-11-06 11:51:10.563 -03:00 [DBG] No candidates found for the request path '/swagger/index.js'
2024-11-06 11:51:10.564 -03:00 [DBG] Request did not match any endpoints
2024-11-06 11:51:10.568 -03:00 [INF] Request finished HTTP/2 GET https://localhost:7011/swagger/index.js - 200 null application/javascript;charset=utf-8 11.9441ms
2024-11-06 11:51:10.568 -03:00 [INF] Request finished HTTP/2 GET https://localhost:7011/_framework/aspnetcore-browser-refresh.js - 200 13756 application/javascript; charset=utf-8 12.1076ms
2024-11-06 11:51:10.621 -03:00 [INF] Request starting HTTP/2 GET https://localhost:7011/_vs/browserLink - null null
2024-11-06 11:51:10.645 -03:00 [INF] Request finished HTTP/2 GET https://localhost:7011/_vs/browserLink - 200 null text/javascript; charset=UTF-8 23.9631ms
2024-11-06 11:51:10.700 -03:00 [INF] Request starting HTTP/2 GET https://localhost:7011/swagger/v1/swagger.json - null null
2024-11-06 11:51:10.702 -03:00 [DBG] No candidates found for the request path '/swagger/v1/swagger.json'
2024-11-06 11:51:10.702 -03:00 [DBG] Request did not match any endpoints
2024-11-06 11:51:10.784 -03:00 [INF] Request finished HTTP/2 GET https://localhost:7011/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 84.0406ms
2024-11-06 11:51:21.907 -03:00 [INF] Request starting HTTP/2 POST https://localhost:7011/api/users/login - application/json 60
2024-11-06 11:51:21.912 -03:00 [DBG] 1 candidate(s) found for the request path '/api/users/login'
2024-11-06 11:51:21.913 -03:00 [DBG] Endpoint 'AuthServer.Users.UsersController.Login (AuthServer)' with route pattern 'api/users/login' is valid for the request path '/api/users/login'
2024-11-06 11:51:21.916 -03:00 [DBG] Request matched endpoint 'AuthServer.Users.UsersController.Login (AuthServer)'
2024-11-06 11:51:21.918 -03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2024-11-06 11:51:21.922 -03:00 [DBG] The request has an origin header: 'https://localhost:7011'.
2024-11-06 11:51:21.923 -03:00 [INF] CORS policy execution successful.
2024-11-06 11:51:21.942 -03:00 [DBG] AuthenticationScheme: Bearer was not authenticated.
2024-11-06 11:51:21.944 -03:00 [INF] Executing endpoint 'AuthServer.Users.UsersController.Login (AuthServer)'
2024-11-06 11:51:21.958 -03:00 [INF] Route matched with {action = "Login", controller = "Users"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult Login(AuthServer.Users.LoginRequest) on controller AuthServer.Users.UsersController (AuthServer).
2024-11-06 11:51:21.960 -03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2024-11-06 11:51:21.961 -03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2024-11-06 11:51:21.963 -03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)"]
2024-11-06 11:51:21.964 -03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2024-11-06 11:51:21.965 -03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)"]
2024-11-06 11:51:21.967 -03:00 [DBG] Executing controller factory for controller AuthServer.Users.UsersController (AuthServer)
2024-11-06 11:51:21.969 -03:00 [DBG] Executed controller factory for controller AuthServer.Users.UsersController (AuthServer)
2024-11-06 11:51:21.973 -03:00 [DBG] Attempting to bind parameter 'credentials' of type 'AuthServer.Users.LoginRequest' ...
2024-11-06 11:51:21.975 -03:00 [DBG] Attempting to bind parameter 'credentials' of type 'AuthServer.Users.LoginRequest' using the name '' in request data ...
2024-11-06 11:51:21.977 -03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2024-11-06 11:51:21.984 -03:00 [DBG] Connection id "0HN7UE9PSO94S", Request id "0HN7UE9PSO94S:0000000B": started reading request body.
2024-11-06 11:51:21.985 -03:00 [DBG] Connection id "0HN7UE9PSO94S", Request id "0HN7UE9PSO94S:0000000B": done reading request body.
2024-11-06 11:51:21.988 -03:00 [DBG] JSON input formatter succeeded, deserializing to type 'AuthServer.Users.LoginRequest'
2024-11-06 11:51:21.988 -03:00 [DBG] Done attempting to bind parameter 'credentials' of type 'AuthServer.Users.LoginRequest'.
2024-11-06 11:51:21.989 -03:00 [DBG] Done attempting to bind parameter 'credentials' of type 'AuthServer.Users.LoginRequest'.
2024-11-06 11:51:21.990 -03:00 [DBG] Attempting to validate the bound parameter 'credentials' of type 'AuthServer.Users.LoginRequest' ...
2024-11-06 11:51:21.994 -03:00 [DBG] Done attempting to validate the bound parameter 'credentials' of type 'AuthServer.Users.LoginRequest'.
2024-11-06 11:51:22.005 -03:00 [DBG] Entity Framework Core 8.0.10 initialized 'AuthServerContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:8.0.10' with options: None
2024-11-06 11:51:22.009 -03:00 [DBG] Compiling query expression: 
'DbSet<User>()
    .Include(u => u.Roles)
    .FirstOrDefault(u => u.Email == __email_0)'
2024-11-06 11:51:22.011 -03:00 [DBG] Including navigation: 'User.Roles'.
2024-11-06 11:51:22.021 -03:00 [DBG] Generated query execution expression: 
'queryContext => new SingleQueryingEnumerable<User>(
    (RelationalQueryContext)queryContext, 
    RelationalCommandCache.QueryExpression(
        Client Projections:
            0 -> Dictionary<IProperty, int> { [Property: User.ID (long) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: User.Email (string) Required Index, 1], [Property: User.Name (string) Required, 2], [Property: User.Password (string) Required, 3] }
            1 -> 0
            2 -> Dictionary<IProperty, int> { [Property: UserRole (Dictionary<string, object>).RoleId (no field, int) Indexer Required PK FK AfterSave:Throw, 4], [Property: UserRole (Dictionary<string, object>).UserId (no field, long) Indexer Required PK FK Index AfterSave:Throw, 5] }
            3 -> Dictionary<IProperty, int> { [Property: Role.Long (int) Required PK AfterSave:Throw ValueGenerated.OnAdd, 6], [Property: Role.Name (string) Required Index, 7] }
            4 -> 4
            5 -> 5
            6 -> 6
        SELECT t.ID, t.Email, t.Name, t.Password, t0.RoleId, t0.UserId, t0.Long, t0.Name
        FROM 
        (
            SELECT TOP(1) u.ID, u.Email, u.Name, u.Password
            FROM Users AS u
            WHERE u.Email == @__email_0
        ) AS t
        LEFT JOIN 
        (
            SELECT u0.RoleId, u0.UserId, r.Long, r.Name
            FROM UserRole AS u0
            INNER JOIN Roles AS r ON u0.RoleId == r.Long
        ) AS t0 ON t.ID == t0.UserId
        ORDER BY t.ID ASC, t0.RoleId ASC, t0.UserId ASC), 
    null, 
    Func<QueryContext, DbDataReader, ResultContext, SingleQueryResultCoordinator, User>, 
    AuthServer.AuthServerContext, 
    False, 
    False, 
    True
)
    .SingleOrDefault()'
2024-11-06 11:51:22.025 -03:00 [DBG] Creating DbConnection.
2024-11-06 11:51:22.025 -03:00 [DBG] Created DbConnection. (0ms).
2024-11-06 11:51:22.026 -03:00 [DBG] Opening connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 11:51:22.027 -03:00 [DBG] Opened connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 11:51:22.028 -03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2024-11-06 11:51:22.028 -03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2024-11-06 11:51:22.030 -03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (2ms).
2024-11-06 11:51:22.033 -03:00 [DBG] Executing DbCommand [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[ID], [t].[Email], [t].[Name], [t].[Password], [t0].[RoleId], [t0].[UserId], [t0].[Long], [t0].[Name]
FROM (
    SELECT TOP(1) [u].[ID], [u].[Email], [u].[Name], [u].[Password]
    FROM [Users] AS [u]
    WHERE [u].[Email] = @__email_0
) AS [t]
LEFT JOIN (
    SELECT [u0].[RoleId], [u0].[UserId], [r].[Long], [r].[Name]
    FROM [UserRole] AS [u0]
    INNER JOIN [Roles] AS [r] ON [u0].[RoleId] = [r].[Long]
) AS [t0] ON [t].[ID] = [t0].[UserId]
ORDER BY [t].[ID], [t0].[RoleId], [t0].[UserId]
2024-11-06 11:51:22.045 -03:00 [INF] Executed DbCommand (13ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[ID], [t].[Email], [t].[Name], [t].[Password], [t0].[RoleId], [t0].[UserId], [t0].[Long], [t0].[Name]
FROM (
    SELECT TOP(1) [u].[ID], [u].[Email], [u].[Name], [u].[Password]
    FROM [Users] AS [u]
    WHERE [u].[Email] = @__email_0
) AS [t]
LEFT JOIN (
    SELECT [u0].[RoleId], [u0].[UserId], [r].[Long], [r].[Name]
    FROM [UserRole] AS [u0]
    INNER JOIN [Roles] AS [r] ON [u0].[RoleId] = [r].[Long]
) AS [t0] ON [t].[ID] = [t0].[UserId]
ORDER BY [t].[ID], [t0].[RoleId], [t0].[UserId]
2024-11-06 11:51:22.047 -03:00 [DBG] Context 'AuthServerContext' started tracking 'User' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 11:51:22.048 -03:00 [DBG] Context 'AuthServerContext' started tracking 'UserRole' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 11:51:22.050 -03:00 [DBG] Context 'AuthServerContext' started tracking 'Role' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 11:51:22.051 -03:00 [DBG] Closing data reader to 'AuthServer' on server 'localhost,1433'.
2024-11-06 11:51:22.052 -03:00 [DBG] A data reader for 'AuthServer' on server 'localhost,1433' is being disposed after spending 5ms reading results.
2024-11-06 11:51:22.053 -03:00 [DBG] Closing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 11:51:22.054 -03:00 [DBG] Closed connection to database 'AuthServer' on server 'localhost,1433' (0ms).
2024-11-06 11:51:22.055 -03:00 [INF] User logged in. id=16 name=Auth Server Administrator
2024-11-06 11:51:22.109 -03:00 [DBG] List of registered output formatters, in the following order: ["Microsoft.AspNetCore.Mvc.Formatters.HttpNoContentOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StringOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StreamOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter"]
2024-11-06 11:51:22.112 -03:00 [DBG] No information found on request to perform content negotiation.
2024-11-06 11:51:22.112 -03:00 [DBG] Attempting to select an output formatter without using a content type as no explicit content types were specified for the response.
2024-11-06 11:51:22.113 -03:00 [DBG] Attempting to select the first formatter in the output formatters list which can write the result.
2024-11-06 11:51:22.114 -03:00 [DBG] Selected output formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter' and content type 'application/json' to write the response.
2024-11-06 11:51:22.115 -03:00 [INF] Executing OkObjectResult, writing value of type 'LoginResponse'.
2024-11-06 11:51:22.124 -03:00 [INF] Executed action AuthServer.Users.UsersController.Login (AuthServer) in 155.9393ms
2024-11-06 11:51:22.124 -03:00 [INF] Executed endpoint 'AuthServer.Users.UsersController.Login (AuthServer)'
2024-11-06 11:51:22.125 -03:00 [DBG] 'AuthServerContext' disposed.
2024-11-06 11:51:22.127 -03:00 [DBG] Disposing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 11:51:22.129 -03:00 [DBG] Disposed connection to database '' on server '' (1ms).
2024-11-06 11:51:22.130 -03:00 [INF] Request finished HTTP/2 POST https://localhost:7011/api/users/login - 200 null application/json; charset=utf-8 223.1208ms
2024-11-06 11:53:33.291 -03:00 [DBG] Connection id "0HN7UE9PSO94S" is closing.
2024-11-06 11:53:33.292 -03:00 [DBG] Connection id "0HN7UE9PSO94S" is closed. The last processed stream ID was 11.
2024-11-06 11:53:33.294 -03:00 [DBG] Connection id "0HN7UE9PSO94S" received FIN.
2024-11-06 11:53:33.295 -03:00 [DBG] Connection id "0HN7UE9PSO94S" sending FIN because: "The Socket transport's send loop completed gracefully."
2024-11-06 11:53:33.295 -03:00 [DBG] The connection queue processing loop for 0HN7UE9PSO94S completed.
2024-11-06 11:53:33.297 -03:00 [DBG] Connection id "0HN7UE9PSO94S" stopped.
2024-11-06 11:55:56.285 -03:00 [DBG] Connection id "0HN7UE9PSO94T" accepted.
2024-11-06 11:55:56.286 -03:00 [DBG] Connection id "0HN7UE9PSO94T" received FIN.
2024-11-06 11:55:56.286 -03:00 [DBG] Connection id "0HN7UE9PSO94U" accepted.
2024-11-06 11:55:56.286 -03:00 [DBG] Connection id "0HN7UE9PSO94T" started.
2024-11-06 11:55:56.288 -03:00 [DBG] Connection id "0HN7UE9PSO94U" started.
2024-11-06 11:55:56.289 -03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2024-11-06 11:55:56.291 -03:00 [DBG] Connection id "0HN7UE9PSO94T" stopped.
2024-11-06 11:55:56.292 -03:00 [DBG] Connection id "0HN7UE9PSO94T" sending FIN because: "The Socket transport's send loop completed gracefully."
2024-11-06 11:55:56.293 -03:00 [DBG] Connection 0HN7UE9PSO94U established using the following protocol: "Tls13"
2024-11-06 11:55:56.296 -03:00 [INF] Request starting HTTP/1.1 GET https://localhost:7011/api/users/me - application/json 76
2024-11-06 11:55:56.298 -03:00 [DBG] 2 candidate(s) found for the request path '/api/users/me'
2024-11-06 11:55:56.299 -03:00 [DBG] Endpoint 'AuthServer.Users.UsersController.GetSelf (AuthServer)' with route pattern 'api/users/me' is valid for the request path '/api/users/me'
2024-11-06 11:55:56.300 -03:00 [DBG] Endpoint 'AuthServer.Users.UsersController.GetUser (AuthServer)' with route pattern 'api/users/{id}' is valid for the request path '/api/users/me'
2024-11-06 11:55:56.301 -03:00 [DBG] Request matched endpoint 'AuthServer.Users.UsersController.GetSelf (AuthServer)'
2024-11-06 11:55:56.302 -03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2024-11-06 11:55:56.304 -03:00 [DBG] AuthenticationScheme: Bearer was not authenticated.
2024-11-06 11:55:56.307 -03:00 [DBG] Policy authentication schemes  did not succeed
2024-11-06 11:55:56.309 -03:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2024-11-06 11:55:56.313 -03:00 [INF] AuthenticationScheme: Bearer was challenged.
2024-11-06 11:55:56.314 -03:00 [DBG] Connection id "0HN7UE9PSO94U" completed keep alive response.
2024-11-06 11:55:56.315 -03:00 [INF] Request finished HTTP/1.1 GET https://localhost:7011/api/users/me - 401 0 null 18.8588ms
2024-11-06 11:55:56.317 -03:00 [DBG] Connection id "0HN7UE9PSO94U", Request id "0HN7UE9PSO94U:00000001": started reading request body.
2024-11-06 11:55:56.318 -03:00 [DBG] Connection id "0HN7UE9PSO94U", Request id "0HN7UE9PSO94U:00000001": done reading request body.
2024-11-06 11:56:09.123 -03:00 [INF] Request starting HTTP/1.1 GET https://localhost:7011/api/users - application/json 76
2024-11-06 11:56:09.125 -03:00 [DBG] 1 candidate(s) found for the request path '/api/users'
2024-11-06 11:56:09.126 -03:00 [DBG] Endpoint 'AuthServer.Users.UsersController.ListUsers (AuthServer)' with route pattern 'api/users' is valid for the request path '/api/users'
2024-11-06 11:56:09.127 -03:00 [DBG] Request matched endpoint 'AuthServer.Users.UsersController.ListUsers (AuthServer)'
2024-11-06 11:56:09.128 -03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2024-11-06 11:56:09.131 -03:00 [DBG] AuthenticationScheme: Bearer was not authenticated.
2024-11-06 11:56:09.132 -03:00 [INF] Executing endpoint 'AuthServer.Users.UsersController.ListUsers (AuthServer)'
2024-11-06 11:56:09.135 -03:00 [INF] Route matched with {action = "ListUsers", controller = "Users"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.ActionResult`1[System.Collections.Generic.List`1[AuthServer.Users.responses.UserResponse]] ListUsers(System.String) on controller AuthServer.Users.UsersController (AuthServer).
2024-11-06 11:56:09.137 -03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2024-11-06 11:56:09.138 -03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2024-11-06 11:56:09.139 -03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)"]
2024-11-06 11:56:09.140 -03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2024-11-06 11:56:09.141 -03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)"]
2024-11-06 11:56:09.143 -03:00 [DBG] Executing controller factory for controller AuthServer.Users.UsersController (AuthServer)
2024-11-06 11:56:09.144 -03:00 [DBG] Executed controller factory for controller AuthServer.Users.UsersController (AuthServer)
2024-11-06 11:56:09.145 -03:00 [DBG] Attempting to bind parameter 'role' of type 'System.String' ...
2024-11-06 11:56:09.147 -03:00 [DBG] Attempting to bind parameter 'role' of type 'System.String' using the name '' in request data ...
2024-11-06 11:56:09.148 -03:00 [DBG] Could not find a value in the request with name '' for binding parameter 'role' of type 'System.String'.
2024-11-06 11:56:09.149 -03:00 [DBG] Done attempting to bind parameter 'role' of type 'System.String'.
2024-11-06 11:56:09.150 -03:00 [DBG] Done attempting to bind parameter 'role' of type 'System.String'.
2024-11-06 11:56:09.151 -03:00 [DBG] Attempting to validate the bound parameter 'role' of type 'System.String' ...
2024-11-06 11:56:09.152 -03:00 [DBG] Done attempting to validate the bound parameter 'role' of type 'System.String'.
2024-11-06 11:56:09.190 -03:00 [DBG] Entity Framework Core 8.0.10 initialized 'AuthServerContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:8.0.10' with options: None
2024-11-06 11:56:09.194 -03:00 [DBG] Creating DbConnection.
2024-11-06 11:56:09.195 -03:00 [DBG] Created DbConnection. (0ms).
2024-11-06 11:56:09.195 -03:00 [DBG] Opening connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 11:56:09.196 -03:00 [DBG] Opened connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 11:56:09.197 -03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2024-11-06 11:56:09.198 -03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2024-11-06 11:56:09.199 -03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2024-11-06 11:56:09.200 -03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[ID], [u].[Email], [u].[Name], [u].[Password], [t].[RoleId], [t].[UserId], [t].[Long], [t].[Name]
FROM [Users] AS [u]
LEFT JOIN (
    SELECT [u0].[RoleId], [u0].[UserId], [r].[Long], [r].[Name]
    FROM [UserRole] AS [u0]
    INNER JOIN [Roles] AS [r] ON [u0].[RoleId] = [r].[Long]
) AS [t] ON [u].[ID] = [t].[UserId]
ORDER BY [u].[ID], [t].[RoleId], [t].[UserId]
2024-11-06 11:56:09.204 -03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[ID], [u].[Email], [u].[Name], [u].[Password], [t].[RoleId], [t].[UserId], [t].[Long], [t].[Name]
FROM [Users] AS [u]
LEFT JOIN (
    SELECT [u0].[RoleId], [u0].[UserId], [r].[Long], [r].[Name]
    FROM [UserRole] AS [u0]
    INNER JOIN [Roles] AS [r] ON [u0].[RoleId] = [r].[Long]
) AS [t] ON [u].[ID] = [t].[UserId]
ORDER BY [u].[ID], [t].[RoleId], [t].[UserId]
2024-11-06 11:56:09.206 -03:00 [DBG] Context 'AuthServerContext' started tracking 'User' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 11:56:09.207 -03:00 [DBG] Context 'AuthServerContext' started tracking 'UserRole' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 11:56:09.208 -03:00 [DBG] Context 'AuthServerContext' started tracking 'Role' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 11:56:09.209 -03:00 [DBG] Context 'AuthServerContext' started tracking 'User' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 11:56:09.210 -03:00 [DBG] Context 'AuthServerContext' started tracking 'UserRole' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 11:56:09.211 -03:00 [DBG] Context 'AuthServerContext' started tracking 'Role' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 11:56:09.212 -03:00 [DBG] Closing data reader to 'AuthServer' on server 'localhost,1433'.
2024-11-06 11:56:09.213 -03:00 [DBG] A data reader for 'AuthServer' on server 'localhost,1433' is being disposed after spending 7ms reading results.
2024-11-06 11:56:09.214 -03:00 [DBG] Closing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 11:56:09.215 -03:00 [DBG] Closed connection to database 'AuthServer' on server 'localhost,1433' (0ms).
2024-11-06 11:56:09.216 -03:00 [DBG] List of registered output formatters, in the following order: ["Microsoft.AspNetCore.Mvc.Formatters.HttpNoContentOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StringOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StreamOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter"]
2024-11-06 11:56:09.218 -03:00 [DBG] No information found on request to perform content negotiation.
2024-11-06 11:56:09.218 -03:00 [DBG] Attempting to select an output formatter without using a content type as no explicit content types were specified for the response.
2024-11-06 11:56:09.219 -03:00 [DBG] Attempting to select the first formatter in the output formatters list which can write the result.
2024-11-06 11:56:09.219 -03:00 [DBG] Selected output formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter' and content type 'application/json' to write the response.
2024-11-06 11:56:09.220 -03:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[AuthServer.Users.responses.UserResponse, AuthServer, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2024-11-06 11:56:09.226 -03:00 [INF] Executed action AuthServer.Users.UsersController.ListUsers (AuthServer) in 83.1518ms
2024-11-06 11:56:09.227 -03:00 [INF] Executed endpoint 'AuthServer.Users.UsersController.ListUsers (AuthServer)'
2024-11-06 11:56:09.227 -03:00 [DBG] Connection id "0HN7UE9PSO94U" completed keep alive response.
2024-11-06 11:56:09.228 -03:00 [DBG] 'AuthServerContext' disposed.
2024-11-06 11:56:09.229 -03:00 [DBG] Disposing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 11:56:09.230 -03:00 [DBG] Disposed connection to database '' on server '' (0ms).
2024-11-06 11:56:09.231 -03:00 [INF] Request finished HTTP/1.1 GET https://localhost:7011/api/users - 200 null application/json; charset=utf-8 108.1614ms
2024-11-06 11:56:09.233 -03:00 [DBG] Connection id "0HN7UE9PSO94U", Request id "0HN7UE9PSO94U:00000002": started reading request body.
2024-11-06 11:56:09.234 -03:00 [DBG] Connection id "0HN7UE9PSO94U", Request id "0HN7UE9PSO94U:00000002": done reading request body.
2024-11-06 11:56:17.472 -03:00 [INF] Request starting HTTP/1.1 DELETE https://localhost:7011/api/users/30 - application/json 76
2024-11-06 11:56:17.474 -03:00 [DBG] 1 candidate(s) found for the request path '/api/users/30'
2024-11-06 11:56:17.475 -03:00 [DBG] Endpoint 'AuthServer.Users.UsersController.Delete (AuthServer)' with route pattern 'api/users/{id}' is valid for the request path '/api/users/30'
2024-11-06 11:56:17.476 -03:00 [DBG] Request matched endpoint 'AuthServer.Users.UsersController.Delete (AuthServer)'
2024-11-06 11:56:17.477 -03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2024-11-06 11:56:17.477 -03:00 [DBG] AuthenticationScheme: Bearer was not authenticated.
2024-11-06 11:56:17.479 -03:00 [DBG] Policy authentication schemes  did not succeed
2024-11-06 11:56:17.481 -03:00 [INF] Authorization failed. These requirements were not met:
RolesAuthorizationRequirement:User.IsInRole must be true for one of the following roles: (ADMIN)
2024-11-06 11:56:17.482 -03:00 [INF] AuthenticationScheme: Bearer was challenged.
2024-11-06 11:56:17.483 -03:00 [DBG] Connection id "0HN7UE9PSO94U" completed keep alive response.
2024-11-06 11:56:17.484 -03:00 [INF] Request finished HTTP/1.1 DELETE https://localhost:7011/api/users/30 - 401 0 null 11.9763ms
2024-11-06 11:56:17.486 -03:00 [DBG] Connection id "0HN7UE9PSO94U", Request id "0HN7UE9PSO94U:00000003": started reading request body.
2024-11-06 11:56:17.487 -03:00 [DBG] Connection id "0HN7UE9PSO94U", Request id "0HN7UE9PSO94U:00000003": done reading request body.
2024-11-06 11:56:35.796 -03:00 [INF] Request starting HTTP/1.1 GET https://localhost:7011/api/users/30 - application/json 76
2024-11-06 11:56:35.797 -03:00 [DBG] 1 candidate(s) found for the request path '/api/users/30'
2024-11-06 11:56:35.798 -03:00 [DBG] Endpoint 'AuthServer.Users.UsersController.GetUser (AuthServer)' with route pattern 'api/users/{id}' is valid for the request path '/api/users/30'
2024-11-06 11:56:35.799 -03:00 [DBG] Request matched endpoint 'AuthServer.Users.UsersController.GetUser (AuthServer)'
2024-11-06 11:56:35.800 -03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2024-11-06 11:56:35.800 -03:00 [DBG] AuthenticationScheme: Bearer was not authenticated.
2024-11-06 11:56:35.801 -03:00 [INF] Executing endpoint 'AuthServer.Users.UsersController.GetUser (AuthServer)'
2024-11-06 11:56:35.803 -03:00 [INF] Route matched with {action = "GetUser", controller = "Users"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.ActionResult`1[AuthServer.Users.responses.UserResponse] GetUser(Int64) on controller AuthServer.Users.UsersController (AuthServer).
2024-11-06 11:56:35.804 -03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2024-11-06 11:56:35.805 -03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2024-11-06 11:56:35.806 -03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)"]
2024-11-06 11:56:35.808 -03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2024-11-06 11:56:35.809 -03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)"]
2024-11-06 11:56:35.810 -03:00 [DBG] Executing controller factory for controller AuthServer.Users.UsersController (AuthServer)
2024-11-06 11:56:35.812 -03:00 [DBG] Executed controller factory for controller AuthServer.Users.UsersController (AuthServer)
2024-11-06 11:56:35.813 -03:00 [DBG] Attempting to bind parameter 'id' of type 'System.Int64' ...
2024-11-06 11:56:35.814 -03:00 [DBG] Attempting to bind parameter 'id' of type 'System.Int64' using the name 'id' in request data ...
2024-11-06 11:56:35.815 -03:00 [DBG] Done attempting to bind parameter 'id' of type 'System.Int64'.
2024-11-06 11:56:35.816 -03:00 [DBG] Done attempting to bind parameter 'id' of type 'System.Int64'.
2024-11-06 11:56:35.817 -03:00 [DBG] Attempting to validate the bound parameter 'id' of type 'System.Int64' ...
2024-11-06 11:56:35.818 -03:00 [DBG] Done attempting to validate the bound parameter 'id' of type 'System.Int64'.
2024-11-06 11:56:35.820 -03:00 [DBG] Entity Framework Core 8.0.10 initialized 'AuthServerContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:8.0.10' with options: None
2024-11-06 11:56:35.822 -03:00 [DBG] Compiling query expression: 
'DbSet<User>()
    .Include(u => u.Roles)
    .FirstOrDefault(u => u.ID == __id_0)'
2024-11-06 11:56:35.823 -03:00 [DBG] Including navigation: 'User.Roles'.
2024-11-06 11:56:35.833 -03:00 [DBG] Generated query execution expression: 
'queryContext => new SingleQueryingEnumerable<User>(
    (RelationalQueryContext)queryContext, 
    RelationalCommandCache.QueryExpression(
        Client Projections:
            0 -> Dictionary<IProperty, int> { [Property: User.ID (long) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: User.Email (string) Required Index, 1], [Property: User.Name (string) Required, 2], [Property: User.Password (string) Required, 3] }
            1 -> 0
            2 -> Dictionary<IProperty, int> { [Property: UserRole (Dictionary<string, object>).RoleId (no field, int) Indexer Required PK FK AfterSave:Throw, 4], [Property: UserRole (Dictionary<string, object>).UserId (no field, long) Indexer Required PK FK Index AfterSave:Throw, 5] }
            3 -> Dictionary<IProperty, int> { [Property: Role.Long (int) Required PK AfterSave:Throw ValueGenerated.OnAdd, 6], [Property: Role.Name (string) Required Index, 7] }
            4 -> 4
            5 -> 5
            6 -> 6
        SELECT t.ID, t.Email, t.Name, t.Password, t0.RoleId, t0.UserId, t0.Long, t0.Name
        FROM 
        (
            SELECT TOP(1) u.ID, u.Email, u.Name, u.Password
            FROM Users AS u
            WHERE u.ID == @__id_0
        ) AS t
        LEFT JOIN 
        (
            SELECT u0.RoleId, u0.UserId, r.Long, r.Name
            FROM UserRole AS u0
            INNER JOIN Roles AS r ON u0.RoleId == r.Long
        ) AS t0 ON t.ID == t0.UserId
        ORDER BY t.ID ASC, t0.RoleId ASC, t0.UserId ASC), 
    null, 
    Func<QueryContext, DbDataReader, ResultContext, SingleQueryResultCoordinator, User>, 
    AuthServer.AuthServerContext, 
    False, 
    False, 
    True
)
    .SingleOrDefault()'
2024-11-06 11:56:35.835 -03:00 [DBG] Creating DbConnection.
2024-11-06 11:56:35.836 -03:00 [DBG] Created DbConnection. (0ms).
2024-11-06 11:56:35.836 -03:00 [DBG] Opening connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 11:56:35.837 -03:00 [DBG] Opened connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 11:56:35.838 -03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2024-11-06 11:56:35.839 -03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2024-11-06 11:56:35.840 -03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2024-11-06 11:56:35.841 -03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[ID], [t].[Email], [t].[Name], [t].[Password], [t0].[RoleId], [t0].[UserId], [t0].[Long], [t0].[Name]
FROM (
    SELECT TOP(1) [u].[ID], [u].[Email], [u].[Name], [u].[Password]
    FROM [Users] AS [u]
    WHERE [u].[ID] = @__id_0
) AS [t]
LEFT JOIN (
    SELECT [u0].[RoleId], [u0].[UserId], [r].[Long], [r].[Name]
    FROM [UserRole] AS [u0]
    INNER JOIN [Roles] AS [r] ON [u0].[RoleId] = [r].[Long]
) AS [t0] ON [t].[ID] = [t0].[UserId]
ORDER BY [t].[ID], [t0].[RoleId], [t0].[UserId]
2024-11-06 11:56:35.846 -03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__id_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[ID], [t].[Email], [t].[Name], [t].[Password], [t0].[RoleId], [t0].[UserId], [t0].[Long], [t0].[Name]
FROM (
    SELECT TOP(1) [u].[ID], [u].[Email], [u].[Name], [u].[Password]
    FROM [Users] AS [u]
    WHERE [u].[ID] = @__id_0
) AS [t]
LEFT JOIN (
    SELECT [u0].[RoleId], [u0].[UserId], [r].[Long], [r].[Name]
    FROM [UserRole] AS [u0]
    INNER JOIN [Roles] AS [r] ON [u0].[RoleId] = [r].[Long]
) AS [t0] ON [t].[ID] = [t0].[UserId]
ORDER BY [t].[ID], [t0].[RoleId], [t0].[UserId]
2024-11-06 11:56:35.847 -03:00 [DBG] Context 'AuthServerContext' started tracking 'User' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 11:56:35.848 -03:00 [DBG] Context 'AuthServerContext' started tracking 'UserRole' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 11:56:35.849 -03:00 [DBG] Context 'AuthServerContext' started tracking 'Role' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 11:56:35.850 -03:00 [DBG] Closing data reader to 'AuthServer' on server 'localhost,1433'.
2024-11-06 11:56:35.851 -03:00 [DBG] A data reader for 'AuthServer' on server 'localhost,1433' is being disposed after spending 3ms reading results.
2024-11-06 11:56:35.852 -03:00 [DBG] Closing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 11:56:35.853 -03:00 [DBG] Closed connection to database 'AuthServer' on server 'localhost,1433' (0ms).
2024-11-06 11:56:35.854 -03:00 [DBG] List of registered output formatters, in the following order: ["Microsoft.AspNetCore.Mvc.Formatters.HttpNoContentOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StringOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StreamOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter"]
2024-11-06 11:56:35.856 -03:00 [DBG] No information found on request to perform content negotiation.
2024-11-06 11:56:35.856 -03:00 [DBG] Attempting to select an output formatter without using a content type as no explicit content types were specified for the response.
2024-11-06 11:56:35.857 -03:00 [DBG] Attempting to select the first formatter in the output formatters list which can write the result.
2024-11-06 11:56:35.857 -03:00 [DBG] Selected output formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter' and content type 'application/json' to write the response.
2024-11-06 11:56:35.858 -03:00 [INF] Executing OkObjectResult, writing value of type 'AuthServer.Users.responses.UserResponse'.
2024-11-06 11:56:35.860 -03:00 [INF] Executed action AuthServer.Users.UsersController.GetUser (AuthServer) in 49.5414ms
2024-11-06 11:56:35.861 -03:00 [INF] Executed endpoint 'AuthServer.Users.UsersController.GetUser (AuthServer)'
2024-11-06 11:56:35.861 -03:00 [DBG] Connection id "0HN7UE9PSO94U" completed keep alive response.
2024-11-06 11:56:35.862 -03:00 [DBG] 'AuthServerContext' disposed.
2024-11-06 11:56:35.863 -03:00 [DBG] Disposing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 11:56:35.864 -03:00 [DBG] Disposed connection to database '' on server '' (0ms).
2024-11-06 11:56:35.865 -03:00 [INF] Request finished HTTP/1.1 GET https://localhost:7011/api/users/30 - 200 null application/json; charset=utf-8 68.9463ms
2024-11-06 11:56:35.867 -03:00 [DBG] Connection id "0HN7UE9PSO94U", Request id "0HN7UE9PSO94U:00000004": started reading request body.
2024-11-06 11:56:35.867 -03:00 [DBG] Connection id "0HN7UE9PSO94U", Request id "0HN7UE9PSO94U:00000004": done reading request body.
2024-11-06 11:56:39.561 -03:00 [INF] Request starting HTTP/1.1 GET https://localhost:7011/api/users/31 - application/json 76
2024-11-06 11:56:39.563 -03:00 [DBG] 1 candidate(s) found for the request path '/api/users/31'
2024-11-06 11:56:39.564 -03:00 [DBG] Endpoint 'AuthServer.Users.UsersController.GetUser (AuthServer)' with route pattern 'api/users/{id}' is valid for the request path '/api/users/31'
2024-11-06 11:56:39.565 -03:00 [DBG] Request matched endpoint 'AuthServer.Users.UsersController.GetUser (AuthServer)'
2024-11-06 11:56:39.566 -03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2024-11-06 11:56:39.567 -03:00 [DBG] AuthenticationScheme: Bearer was not authenticated.
2024-11-06 11:56:39.568 -03:00 [INF] Executing endpoint 'AuthServer.Users.UsersController.GetUser (AuthServer)'
2024-11-06 11:56:39.568 -03:00 [INF] Route matched with {action = "GetUser", controller = "Users"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.ActionResult`1[AuthServer.Users.responses.UserResponse] GetUser(Int64) on controller AuthServer.Users.UsersController (AuthServer).
2024-11-06 11:56:39.570 -03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2024-11-06 11:56:39.571 -03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2024-11-06 11:56:39.572 -03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)"]
2024-11-06 11:56:39.573 -03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2024-11-06 11:56:39.574 -03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)"]
2024-11-06 11:56:39.575 -03:00 [DBG] Executing controller factory for controller AuthServer.Users.UsersController (AuthServer)
2024-11-06 11:56:39.576 -03:00 [DBG] Executed controller factory for controller AuthServer.Users.UsersController (AuthServer)
2024-11-06 11:56:39.577 -03:00 [DBG] Attempting to bind parameter 'id' of type 'System.Int64' ...
2024-11-06 11:56:39.578 -03:00 [DBG] Attempting to bind parameter 'id' of type 'System.Int64' using the name 'id' in request data ...
2024-11-06 11:56:39.579 -03:00 [DBG] Done attempting to bind parameter 'id' of type 'System.Int64'.
2024-11-06 11:56:39.580 -03:00 [DBG] Done attempting to bind parameter 'id' of type 'System.Int64'.
2024-11-06 11:56:39.581 -03:00 [DBG] Attempting to validate the bound parameter 'id' of type 'System.Int64' ...
2024-11-06 11:56:39.581 -03:00 [DBG] Done attempting to validate the bound parameter 'id' of type 'System.Int64'.
2024-11-06 11:56:39.583 -03:00 [DBG] Entity Framework Core 8.0.10 initialized 'AuthServerContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:8.0.10' with options: None
2024-11-06 11:56:39.584 -03:00 [DBG] Creating DbConnection.
2024-11-06 11:56:39.585 -03:00 [DBG] Created DbConnection. (0ms).
2024-11-06 11:56:39.586 -03:00 [DBG] Opening connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 11:56:39.587 -03:00 [DBG] Opened connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 11:56:39.587 -03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2024-11-06 11:56:39.588 -03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2024-11-06 11:56:39.589 -03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2024-11-06 11:56:39.590 -03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[ID], [t].[Email], [t].[Name], [t].[Password], [t0].[RoleId], [t0].[UserId], [t0].[Long], [t0].[Name]
FROM (
    SELECT TOP(1) [u].[ID], [u].[Email], [u].[Name], [u].[Password]
    FROM [Users] AS [u]
    WHERE [u].[ID] = @__id_0
) AS [t]
LEFT JOIN (
    SELECT [u0].[RoleId], [u0].[UserId], [r].[Long], [r].[Name]
    FROM [UserRole] AS [u0]
    INNER JOIN [Roles] AS [r] ON [u0].[RoleId] = [r].[Long]
) AS [t0] ON [t].[ID] = [t0].[UserId]
ORDER BY [t].[ID], [t0].[RoleId], [t0].[UserId]
2024-11-06 11:56:39.593 -03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__id_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[ID], [t].[Email], [t].[Name], [t].[Password], [t0].[RoleId], [t0].[UserId], [t0].[Long], [t0].[Name]
FROM (
    SELECT TOP(1) [u].[ID], [u].[Email], [u].[Name], [u].[Password]
    FROM [Users] AS [u]
    WHERE [u].[ID] = @__id_0
) AS [t]
LEFT JOIN (
    SELECT [u0].[RoleId], [u0].[UserId], [r].[Long], [r].[Name]
    FROM [UserRole] AS [u0]
    INNER JOIN [Roles] AS [r] ON [u0].[RoleId] = [r].[Long]
) AS [t0] ON [t].[ID] = [t0].[UserId]
ORDER BY [t].[ID], [t0].[RoleId], [t0].[UserId]
2024-11-06 11:56:39.595 -03:00 [DBG] Closing data reader to 'AuthServer' on server 'localhost,1433'.
2024-11-06 11:56:39.595 -03:00 [DBG] A data reader for 'AuthServer' on server 'localhost,1433' is being disposed after spending 0ms reading results.
2024-11-06 11:56:39.597 -03:00 [DBG] Closing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 11:56:39.597 -03:00 [DBG] Closed connection to database 'AuthServer' on server 'localhost,1433' (0ms).
2024-11-06 11:56:39.599 -03:00 [DBG] List of registered output formatters, in the following order: ["Microsoft.AspNetCore.Mvc.Formatters.HttpNoContentOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StringOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StreamOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter"]
2024-11-06 11:56:39.601 -03:00 [DBG] No information found on request to perform content negotiation.
2024-11-06 11:56:39.602 -03:00 [DBG] Attempting to select the first output formatter in the output formatters list which supports a content type from the explicitly specified content types '["application/problem+json","application/problem+xml","application/problem+json","application/problem+xml"]'.
2024-11-06 11:56:39.603 -03:00 [DBG] Selected output formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter' and content type 'application/problem+json' to write the response.
2024-11-06 11:56:39.604 -03:00 [INF] Executing ObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ProblemDetails'.
2024-11-06 11:56:39.615 -03:00 [INF] Executed action AuthServer.Users.UsersController.GetUser (AuthServer) in 40.1615ms
2024-11-06 11:56:39.616 -03:00 [INF] Executed endpoint 'AuthServer.Users.UsersController.GetUser (AuthServer)'
2024-11-06 11:56:39.617 -03:00 [DBG] Connection id "0HN7UE9PSO94U" completed keep alive response.
2024-11-06 11:56:39.618 -03:00 [DBG] 'AuthServerContext' disposed.
2024-11-06 11:56:39.618 -03:00 [DBG] Disposing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 11:56:39.619 -03:00 [DBG] Disposed connection to database '' on server '' (0ms).
2024-11-06 11:56:39.620 -03:00 [INF] Request finished HTTP/1.1 GET https://localhost:7011/api/users/31 - 404 null application/problem+json; charset=utf-8 59.3777ms
2024-11-06 11:56:39.623 -03:00 [DBG] Connection id "0HN7UE9PSO94U", Request id "0HN7UE9PSO94U:00000005": started reading request body.
2024-11-06 11:56:39.623 -03:00 [DBG] Connection id "0HN7UE9PSO94U", Request id "0HN7UE9PSO94U:00000005": done reading request body.
2024-11-06 11:57:11.186 -03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7011/api/users - application/json 95
2024-11-06 11:57:11.188 -03:00 [DBG] 1 candidate(s) found for the request path '/api/users'
2024-11-06 11:57:11.189 -03:00 [DBG] Endpoint 'AuthServer.Users.UsersController.CreateUser (AuthServer)' with route pattern 'api/users' is valid for the request path '/api/users'
2024-11-06 11:57:11.190 -03:00 [DBG] Request matched endpoint 'AuthServer.Users.UsersController.CreateUser (AuthServer)'
2024-11-06 11:57:11.191 -03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2024-11-06 11:57:11.192 -03:00 [DBG] AuthenticationScheme: Bearer was not authenticated.
2024-11-06 11:57:11.193 -03:00 [INF] Executing endpoint 'AuthServer.Users.UsersController.CreateUser (AuthServer)'
2024-11-06 11:57:11.195 -03:00 [INF] Route matched with {action = "CreateUser", controller = "Users"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.ActionResult`1[AuthServer.Users.responses.UserResponse] CreateUser(AuthServer.Users.requests.UserRequest) on controller AuthServer.Users.UsersController (AuthServer).
2024-11-06 11:57:11.196 -03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2024-11-06 11:57:11.197 -03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2024-11-06 11:57:11.199 -03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)"]
2024-11-06 11:57:11.200 -03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2024-11-06 11:57:11.201 -03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)"]
2024-11-06 11:57:11.202 -03:00 [DBG] Executing controller factory for controller AuthServer.Users.UsersController (AuthServer)
2024-11-06 11:57:11.203 -03:00 [DBG] Executed controller factory for controller AuthServer.Users.UsersController (AuthServer)
2024-11-06 11:57:11.204 -03:00 [DBG] Attempting to bind parameter 'req' of type 'AuthServer.Users.requests.UserRequest' ...
2024-11-06 11:57:11.205 -03:00 [DBG] Attempting to bind parameter 'req' of type 'AuthServer.Users.requests.UserRequest' using the name '' in request data ...
2024-11-06 11:57:11.206 -03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2024-11-06 11:57:11.208 -03:00 [DBG] Connection id "0HN7UE9PSO94U", Request id "0HN7UE9PSO94U:00000006": started reading request body.
2024-11-06 11:57:11.209 -03:00 [DBG] Connection id "0HN7UE9PSO94U", Request id "0HN7UE9PSO94U:00000006": done reading request body.
2024-11-06 11:57:11.211 -03:00 [DBG] JSON input formatter succeeded, deserializing to type 'AuthServer.Users.requests.UserRequest'
2024-11-06 11:57:11.211 -03:00 [DBG] Done attempting to bind parameter 'req' of type 'AuthServer.Users.requests.UserRequest'.
2024-11-06 11:57:11.212 -03:00 [DBG] Done attempting to bind parameter 'req' of type 'AuthServer.Users.requests.UserRequest'.
2024-11-06 11:57:11.213 -03:00 [DBG] Attempting to validate the bound parameter 'req' of type 'AuthServer.Users.requests.UserRequest' ...
2024-11-06 11:57:11.216 -03:00 [DBG] Done attempting to validate the bound parameter 'req' of type 'AuthServer.Users.requests.UserRequest'.
2024-11-06 11:57:11.222 -03:00 [DBG] Entity Framework Core 8.0.10 initialized 'AuthServerContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:8.0.10' with options: None
2024-11-06 11:57:11.224 -03:00 [DBG] Creating DbConnection.
2024-11-06 11:57:11.225 -03:00 [DBG] Created DbConnection. (0ms).
2024-11-06 11:57:11.226 -03:00 [DBG] Opening connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 11:57:11.233 -03:00 [DBG] Opened connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 11:57:11.236 -03:00 [DBG] Enlisted in an ambient transaction with isolation level 'Serializable'.
2024-11-06 11:57:11.237 -03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2024-11-06 11:57:11.237 -03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2024-11-06 11:57:11.238 -03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2024-11-06 11:57:11.239 -03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[ID], [u].[Email], [u].[Name], [u].[Password], [t].[RoleId], [t].[UserId], [t].[Long], [t].[Name]
FROM [Users] AS [u]
LEFT JOIN (
    SELECT [u0].[RoleId], [u0].[UserId], [r].[Long], [r].[Name]
    FROM [UserRole] AS [u0]
    INNER JOIN [Roles] AS [r] ON [u0].[RoleId] = [r].[Long]
) AS [t] ON [u].[ID] = [t].[UserId]
ORDER BY [u].[ID], [t].[RoleId], [t].[UserId]
2024-11-06 11:57:11.242 -03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[ID], [u].[Email], [u].[Name], [u].[Password], [t].[RoleId], [t].[UserId], [t].[Long], [t].[Name]
FROM [Users] AS [u]
LEFT JOIN (
    SELECT [u0].[RoleId], [u0].[UserId], [r].[Long], [r].[Name]
    FROM [UserRole] AS [u0]
    INNER JOIN [Roles] AS [r] ON [u0].[RoleId] = [r].[Long]
) AS [t] ON [u].[ID] = [t].[UserId]
ORDER BY [u].[ID], [t].[RoleId], [t].[UserId]
2024-11-06 11:57:11.244 -03:00 [DBG] Context 'AuthServerContext' started tracking 'User' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 11:57:11.245 -03:00 [DBG] Context 'AuthServerContext' started tracking 'UserRole' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 11:57:11.246 -03:00 [DBG] Context 'AuthServerContext' started tracking 'Role' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 11:57:11.247 -03:00 [DBG] Context 'AuthServerContext' started tracking 'User' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 11:57:11.248 -03:00 [DBG] Context 'AuthServerContext' started tracking 'UserRole' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 11:57:11.249 -03:00 [DBG] Context 'AuthServerContext' started tracking 'Role' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 11:57:11.250 -03:00 [DBG] Closing data reader to 'AuthServer' on server 'localhost,1433'.
2024-11-06 11:57:11.250 -03:00 [DBG] A data reader for 'AuthServer' on server 'localhost,1433' is being disposed after spending 6ms reading results.
2024-11-06 11:57:11.252 -03:00 [DBG] Closing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 11:57:11.253 -03:00 [DBG] Closed connection to database 'AuthServer' on server 'localhost,1433' (1ms).
2024-11-06 11:57:11.255 -03:00 [DBG] Compiling query expression: 
'DbSet<Role>()
    .FirstOrDefault(r => r.Name == __name_0)'
2024-11-06 11:57:11.259 -03:00 [DBG] Generated query execution expression: 
'queryContext => new SingleQueryingEnumerable<Role>(
    (RelationalQueryContext)queryContext, 
    RelationalCommandCache.QueryExpression(
        Projection Mapping:
            EmptyProjectionMember -> Dictionary<IProperty, int> { [Property: Role.Long (int) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: Role.Name (string) Required Index, 1] }
        SELECT TOP(1) r.Long, r.Name
        FROM Roles AS r
        WHERE r.Name == @__name_0), 
    null, 
    Func<QueryContext, DbDataReader, ResultContext, SingleQueryResultCoordinator, Role>, 
    AuthServer.AuthServerContext, 
    False, 
    False, 
    True
)
    .SingleOrDefault()'
2024-11-06 11:57:11.260 -03:00 [DBG] Opening connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 11:57:11.261 -03:00 [DBG] Opened connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 11:57:11.262 -03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2024-11-06 11:57:11.263 -03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2024-11-06 11:57:11.264 -03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2024-11-06 11:57:11.265 -03:00 [DBG] Executing DbCommand [Parameters=[@__name_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [r].[Long], [r].[Name]
FROM [Roles] AS [r]
WHERE [r].[Name] = @__name_0
2024-11-06 11:57:11.268 -03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__name_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [r].[Long], [r].[Name]
FROM [Roles] AS [r]
WHERE [r].[Name] = @__name_0
2024-11-06 11:57:11.270 -03:00 [DBG] Closing data reader to 'AuthServer' on server 'localhost,1433'.
2024-11-06 11:57:11.271 -03:00 [DBG] A data reader for 'AuthServer' on server 'localhost,1433' is being disposed after spending 1ms reading results.
2024-11-06 11:57:11.272 -03:00 [DBG] Closing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 11:57:11.273 -03:00 [DBG] Closed connection to database 'AuthServer' on server 'localhost,1433' (0ms).
2024-11-06 11:57:11.283 -03:00 [DBG] 'AuthServerContext' generated a temporary value for the property 'User.ID'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 11:57:11.291 -03:00 [DBG] Context 'AuthServerContext' started tracking 'User' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 11:57:11.298 -03:00 [DBG] Context 'AuthServerContext' started tracking 'UserRole' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 11:57:11.299 -03:00 [DBG] SaveChanges starting for 'AuthServerContext'.
2024-11-06 11:57:11.301 -03:00 [DBG] DetectChanges starting for 'AuthServerContext'.
2024-11-06 11:57:11.309 -03:00 [DBG] DetectChanges completed for 'AuthServerContext'.
2024-11-06 11:57:11.352 -03:00 [DBG] Opening connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 11:57:11.353 -03:00 [DBG] Opened connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 11:57:11.355 -03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2024-11-06 11:57:11.355 -03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2024-11-06 11:57:11.356 -03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2024-11-06 11:57:11.357 -03:00 [DBG] Executing DbCommand [Parameters=[@p0='?' (Size = 450), @p1='?' (Size = 4000), @p2='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Users] ([Email], [Name], [Password])
OUTPUT INSERTED.[ID]
VALUES (@p0, @p1, @p2);
2024-11-06 11:57:11.362 -03:00 [INF] Executed DbCommand (5ms) [Parameters=[@p0='?' (Size = 450), @p1='?' (Size = 4000), @p2='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Users] ([Email], [Name], [Password])
OUTPUT INSERTED.[ID]
VALUES (@p0, @p1, @p2);
2024-11-06 11:57:11.369 -03:00 [DBG] The foreign key property 'User.ID' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2024-11-06 11:57:11.371 -03:00 [DBG] The foreign key property 'UserRole.UserId' was detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2024-11-06 11:57:11.375 -03:00 [DBG] Closing data reader to 'AuthServer' on server 'localhost,1433'.
2024-11-06 11:57:11.376 -03:00 [DBG] A data reader for 'AuthServer' on server 'localhost,1433' is being disposed after spending 12ms reading results.
2024-11-06 11:57:11.377 -03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2024-11-06 11:57:11.378 -03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2024-11-06 11:57:11.379 -03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2024-11-06 11:57:11.380 -03:00 [DBG] Executing DbCommand [Parameters=[@p3='?' (DbType = Int32), @p4='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [UserRole] ([RoleId], [UserId])
VALUES (@p3, @p4);
2024-11-06 11:57:11.384 -03:00 [INF] Executed DbCommand (4ms) [Parameters=[@p3='?' (DbType = Int32), @p4='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [UserRole] ([RoleId], [UserId])
VALUES (@p3, @p4);
2024-11-06 11:57:11.385 -03:00 [DBG] Closing data reader to 'AuthServer' on server 'localhost,1433'.
2024-11-06 11:57:11.386 -03:00 [DBG] A data reader for 'AuthServer' on server 'localhost,1433' is being disposed after spending 0ms reading results.
2024-11-06 11:57:11.387 -03:00 [DBG] Closing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 11:57:11.388 -03:00 [DBG] Closed connection to database 'AuthServer' on server 'localhost,1433' (0ms).
2024-11-06 11:57:11.394 -03:00 [DBG] An entity of type 'User' tracked by 'AuthServerContext' changed state from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 11:57:11.396 -03:00 [DBG] An entity of type 'UserRole' tracked by 'AuthServerContext' changed state from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 11:57:11.398 -03:00 [DBG] SaveChanges completed for 'AuthServerContext' with 2 entities written to the database.
2024-11-06 11:57:11.404 -03:00 [DBG] List of registered output formatters, in the following order: ["Microsoft.AspNetCore.Mvc.Formatters.HttpNoContentOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StringOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StreamOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter"]
2024-11-06 11:57:11.406 -03:00 [DBG] No information found on request to perform content negotiation.
2024-11-06 11:57:11.406 -03:00 [DBG] Attempting to select an output formatter without using a content type as no explicit content types were specified for the response.
2024-11-06 11:57:11.407 -03:00 [DBG] Attempting to select the first formatter in the output formatters list which can write the result.
2024-11-06 11:57:11.408 -03:00 [DBG] Selected output formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter' and content type 'application/json' to write the response.
2024-11-06 11:57:11.409 -03:00 [INF] Executing CreatedAtActionResult, writing value of type 'AuthServer.Users.responses.UserResponse'.
2024-11-06 11:57:11.419 -03:00 [DBG] Found the endpoints ["AuthServer.Users.UsersController.GetUser (AuthServer)"] for address (id=[31],action=[GetUser],controller=[Users])
2024-11-06 11:57:11.421 -03:00 [DBG] Successfully processed template api/users/{id} for AuthServer.Users.UsersController.GetUser (AuthServer) resulting in /api/users/31 and 
2024-11-06 11:57:11.423 -03:00 [DBG] Link generation succeeded for endpoints ["AuthServer.Users.UsersController.GetUser (AuthServer)"] with result /api/users/31
2024-11-06 11:57:11.424 -03:00 [INF] Executed action AuthServer.Users.UsersController.CreateUser (AuthServer) in 222.7784ms
2024-11-06 11:57:11.425 -03:00 [INF] Executed endpoint 'AuthServer.Users.UsersController.CreateUser (AuthServer)'
2024-11-06 11:57:11.426 -03:00 [DBG] Connection id "0HN7UE9PSO94U" completed keep alive response.
2024-11-06 11:57:11.426 -03:00 [DBG] 'AuthServerContext' disposed.
2024-11-06 11:57:11.427 -03:00 [DBG] Disposing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 11:57:11.428 -03:00 [DBG] Disposed connection to database '' on server '' (0ms).
2024-11-06 11:57:11.429 -03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7011/api/users - 201 null application/json; charset=utf-8 243.0342ms
2024-11-06 11:57:19.446 -03:00 [INF] Request starting HTTP/1.1 GET https://localhost:7011/api/users - application/json 95
2024-11-06 11:57:19.448 -03:00 [DBG] 1 candidate(s) found for the request path '/api/users'
2024-11-06 11:57:19.449 -03:00 [DBG] Endpoint 'AuthServer.Users.UsersController.ListUsers (AuthServer)' with route pattern 'api/users' is valid for the request path '/api/users'
2024-11-06 11:57:19.450 -03:00 [DBG] Request matched endpoint 'AuthServer.Users.UsersController.ListUsers (AuthServer)'
2024-11-06 11:57:19.450 -03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2024-11-06 11:57:19.451 -03:00 [DBG] AuthenticationScheme: Bearer was not authenticated.
2024-11-06 11:57:19.452 -03:00 [INF] Executing endpoint 'AuthServer.Users.UsersController.ListUsers (AuthServer)'
2024-11-06 11:57:19.453 -03:00 [INF] Route matched with {action = "ListUsers", controller = "Users"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.ActionResult`1[System.Collections.Generic.List`1[AuthServer.Users.responses.UserResponse]] ListUsers(System.String) on controller AuthServer.Users.UsersController (AuthServer).
2024-11-06 11:57:19.454 -03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2024-11-06 11:57:19.455 -03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2024-11-06 11:57:19.456 -03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)"]
2024-11-06 11:57:19.457 -03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2024-11-06 11:57:19.458 -03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)"]
2024-11-06 11:57:19.459 -03:00 [DBG] Executing controller factory for controller AuthServer.Users.UsersController (AuthServer)
2024-11-06 11:57:19.460 -03:00 [DBG] Executed controller factory for controller AuthServer.Users.UsersController (AuthServer)
2024-11-06 11:57:19.461 -03:00 [DBG] Attempting to bind parameter 'role' of type 'System.String' ...
2024-11-06 11:57:19.462 -03:00 [DBG] Attempting to bind parameter 'role' of type 'System.String' using the name '' in request data ...
2024-11-06 11:57:19.463 -03:00 [DBG] Could not find a value in the request with name '' for binding parameter 'role' of type 'System.String'.
2024-11-06 11:57:19.464 -03:00 [DBG] Done attempting to bind parameter 'role' of type 'System.String'.
2024-11-06 11:57:19.465 -03:00 [DBG] Done attempting to bind parameter 'role' of type 'System.String'.
2024-11-06 11:57:19.466 -03:00 [DBG] Attempting to validate the bound parameter 'role' of type 'System.String' ...
2024-11-06 11:57:19.467 -03:00 [DBG] Done attempting to validate the bound parameter 'role' of type 'System.String'.
2024-11-06 11:57:19.468 -03:00 [DBG] Entity Framework Core 8.0.10 initialized 'AuthServerContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:8.0.10' with options: None
2024-11-06 11:57:19.469 -03:00 [DBG] Creating DbConnection.
2024-11-06 11:57:19.470 -03:00 [DBG] Created DbConnection. (0ms).
2024-11-06 11:57:19.471 -03:00 [DBG] Opening connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 11:57:19.472 -03:00 [DBG] Opened connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 11:57:19.473 -03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2024-11-06 11:57:19.473 -03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2024-11-06 11:57:19.474 -03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2024-11-06 11:57:19.477 -03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[ID], [u].[Email], [u].[Name], [u].[Password], [t].[RoleId], [t].[UserId], [t].[Long], [t].[Name]
FROM [Users] AS [u]
LEFT JOIN (
    SELECT [u0].[RoleId], [u0].[UserId], [r].[Long], [r].[Name]
    FROM [UserRole] AS [u0]
    INNER JOIN [Roles] AS [r] ON [u0].[RoleId] = [r].[Long]
) AS [t] ON [u].[ID] = [t].[UserId]
ORDER BY [u].[ID], [t].[RoleId], [t].[UserId]
2024-11-06 11:57:19.481 -03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[ID], [u].[Email], [u].[Name], [u].[Password], [t].[RoleId], [t].[UserId], [t].[Long], [t].[Name]
FROM [Users] AS [u]
LEFT JOIN (
    SELECT [u0].[RoleId], [u0].[UserId], [r].[Long], [r].[Name]
    FROM [UserRole] AS [u0]
    INNER JOIN [Roles] AS [r] ON [u0].[RoleId] = [r].[Long]
) AS [t] ON [u].[ID] = [t].[UserId]
ORDER BY [u].[ID], [t].[RoleId], [t].[UserId]
2024-11-06 11:57:19.483 -03:00 [DBG] Context 'AuthServerContext' started tracking 'User' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 11:57:19.484 -03:00 [DBG] Context 'AuthServerContext' started tracking 'UserRole' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 11:57:19.485 -03:00 [DBG] Context 'AuthServerContext' started tracking 'Role' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 11:57:19.485 -03:00 [DBG] Context 'AuthServerContext' started tracking 'User' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 11:57:19.486 -03:00 [DBG] Context 'AuthServerContext' started tracking 'UserRole' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 11:57:19.487 -03:00 [DBG] Context 'AuthServerContext' started tracking 'Role' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 11:57:19.488 -03:00 [DBG] Context 'AuthServerContext' started tracking 'User' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 11:57:19.489 -03:00 [DBG] Context 'AuthServerContext' started tracking 'UserRole' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 11:57:19.491 -03:00 [DBG] Closing data reader to 'AuthServer' on server 'localhost,1433'.
2024-11-06 11:57:19.491 -03:00 [DBG] A data reader for 'AuthServer' on server 'localhost,1433' is being disposed after spending 8ms reading results.
2024-11-06 11:57:19.493 -03:00 [DBG] Closing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 11:57:19.494 -03:00 [DBG] Closed connection to database 'AuthServer' on server 'localhost,1433' (1ms).
2024-11-06 11:57:19.495 -03:00 [DBG] List of registered output formatters, in the following order: ["Microsoft.AspNetCore.Mvc.Formatters.HttpNoContentOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StringOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StreamOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter"]
2024-11-06 11:57:19.496 -03:00 [DBG] No information found on request to perform content negotiation.
2024-11-06 11:57:19.497 -03:00 [DBG] Attempting to select an output formatter without using a content type as no explicit content types were specified for the response.
2024-11-06 11:57:19.497 -03:00 [DBG] Attempting to select the first formatter in the output formatters list which can write the result.
2024-11-06 11:57:19.498 -03:00 [DBG] Selected output formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter' and content type 'application/json' to write the response.
2024-11-06 11:57:19.499 -03:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[AuthServer.Users.responses.UserResponse, AuthServer, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2024-11-06 11:57:19.500 -03:00 [INF] Executed action AuthServer.Users.UsersController.ListUsers (AuthServer) in 40.3558ms
2024-11-06 11:57:19.501 -03:00 [INF] Executed endpoint 'AuthServer.Users.UsersController.ListUsers (AuthServer)'
2024-11-06 11:57:19.501 -03:00 [DBG] Connection id "0HN7UE9PSO94U" completed keep alive response.
2024-11-06 11:57:19.502 -03:00 [DBG] 'AuthServerContext' disposed.
2024-11-06 11:57:19.503 -03:00 [DBG] Disposing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 11:57:19.504 -03:00 [DBG] Disposed connection to database '' on server '' (1ms).
2024-11-06 11:57:19.506 -03:00 [INF] Request finished HTTP/1.1 GET https://localhost:7011/api/users - 200 null application/json; charset=utf-8 60.0005ms
2024-11-06 11:57:19.508 -03:00 [DBG] Connection id "0HN7UE9PSO94U", Request id "0HN7UE9PSO94U:00000007": started reading request body.
2024-11-06 11:57:19.508 -03:00 [DBG] Connection id "0HN7UE9PSO94U", Request id "0HN7UE9PSO94U:00000007": done reading request body.
2024-11-06 11:57:28.992 -03:00 [INF] Request starting HTTP/1.1 DELETE https://localhost:7011/api/users/31 - application/json 95
2024-11-06 11:57:28.994 -03:00 [DBG] 1 candidate(s) found for the request path '/api/users/31'
2024-11-06 11:57:28.994 -03:00 [DBG] Endpoint 'AuthServer.Users.UsersController.Delete (AuthServer)' with route pattern 'api/users/{id}' is valid for the request path '/api/users/31'
2024-11-06 11:57:28.996 -03:00 [DBG] Request matched endpoint 'AuthServer.Users.UsersController.Delete (AuthServer)'
2024-11-06 11:57:28.996 -03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2024-11-06 11:57:28.997 -03:00 [DBG] AuthenticationScheme: Bearer was not authenticated.
2024-11-06 11:57:28.999 -03:00 [DBG] Policy authentication schemes  did not succeed
2024-11-06 11:57:29.000 -03:00 [INF] Authorization failed. These requirements were not met:
RolesAuthorizationRequirement:User.IsInRole must be true for one of the following roles: (ADMIN)
2024-11-06 11:57:29.000 -03:00 [INF] AuthenticationScheme: Bearer was challenged.
2024-11-06 11:57:29.001 -03:00 [DBG] Connection id "0HN7UE9PSO94U" completed keep alive response.
2024-11-06 11:57:29.002 -03:00 [INF] Request finished HTTP/1.1 DELETE https://localhost:7011/api/users/31 - 401 0 null 10.6535ms
2024-11-06 11:57:29.004 -03:00 [DBG] Connection id "0HN7UE9PSO94U", Request id "0HN7UE9PSO94U:00000008": started reading request body.
2024-11-06 11:57:29.005 -03:00 [DBG] Connection id "0HN7UE9PSO94U", Request id "0HN7UE9PSO94U:00000008": done reading request body.
2024-11-06 11:57:33.175 -03:00 [INF] Request starting HTTP/1.1 DELETE https://localhost:7011/api/users/16 - application/json 95
2024-11-06 11:57:33.177 -03:00 [DBG] 1 candidate(s) found for the request path '/api/users/16'
2024-11-06 11:57:33.178 -03:00 [DBG] Endpoint 'AuthServer.Users.UsersController.Delete (AuthServer)' with route pattern 'api/users/{id}' is valid for the request path '/api/users/16'
2024-11-06 11:57:33.179 -03:00 [DBG] Request matched endpoint 'AuthServer.Users.UsersController.Delete (AuthServer)'
2024-11-06 11:57:33.180 -03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2024-11-06 11:57:33.181 -03:00 [DBG] AuthenticationScheme: Bearer was not authenticated.
2024-11-06 11:57:33.181 -03:00 [DBG] Policy authentication schemes  did not succeed
2024-11-06 11:57:33.182 -03:00 [INF] Authorization failed. These requirements were not met:
RolesAuthorizationRequirement:User.IsInRole must be true for one of the following roles: (ADMIN)
2024-11-06 11:57:33.183 -03:00 [INF] AuthenticationScheme: Bearer was challenged.
2024-11-06 11:57:33.184 -03:00 [DBG] Connection id "0HN7UE9PSO94U" completed keep alive response.
2024-11-06 11:57:33.185 -03:00 [INF] Request finished HTTP/1.1 DELETE https://localhost:7011/api/users/16 - 401 0 null 10.5245ms
2024-11-06 11:57:33.187 -03:00 [DBG] Connection id "0HN7UE9PSO94U", Request id "0HN7UE9PSO94U:00000009": started reading request body.
2024-11-06 11:57:33.188 -03:00 [DBG] Connection id "0HN7UE9PSO94U", Request id "0HN7UE9PSO94U:00000009": done reading request body.
2024-11-06 11:57:37.783 -03:00 [INF] Request starting HTTP/1.1 DELETE https://localhost:7011/api/users/15 - application/json 95
2024-11-06 11:57:37.784 -03:00 [DBG] 1 candidate(s) found for the request path '/api/users/15'
2024-11-06 11:57:37.785 -03:00 [DBG] Endpoint 'AuthServer.Users.UsersController.Delete (AuthServer)' with route pattern 'api/users/{id}' is valid for the request path '/api/users/15'
2024-11-06 11:57:37.786 -03:00 [DBG] Request matched endpoint 'AuthServer.Users.UsersController.Delete (AuthServer)'
2024-11-06 11:57:37.786 -03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2024-11-06 11:57:37.787 -03:00 [DBG] AuthenticationScheme: Bearer was not authenticated.
2024-11-06 11:57:37.788 -03:00 [DBG] Policy authentication schemes  did not succeed
2024-11-06 11:57:37.789 -03:00 [INF] Authorization failed. These requirements were not met:
RolesAuthorizationRequirement:User.IsInRole must be true for one of the following roles: (ADMIN)
2024-11-06 11:57:37.789 -03:00 [INF] AuthenticationScheme: Bearer was challenged.
2024-11-06 11:57:37.790 -03:00 [DBG] Connection id "0HN7UE9PSO94U" completed keep alive response.
2024-11-06 11:57:37.791 -03:00 [INF] Request finished HTTP/1.1 DELETE https://localhost:7011/api/users/15 - 401 0 null 8.1809ms
2024-11-06 11:57:37.793 -03:00 [DBG] Connection id "0HN7UE9PSO94U", Request id "0HN7UE9PSO94U:0000000A": started reading request body.
2024-11-06 11:57:37.794 -03:00 [DBG] Connection id "0HN7UE9PSO94U", Request id "0HN7UE9PSO94U:0000000A": done reading request body.
2024-11-06 11:57:45.004 -03:00 [INF] Request starting HTTP/1.1 GET https://localhost:7011/api/users - application/json 95
2024-11-06 11:57:45.007 -03:00 [DBG] 1 candidate(s) found for the request path '/api/users'
2024-11-06 11:57:45.007 -03:00 [DBG] Endpoint 'AuthServer.Users.UsersController.ListUsers (AuthServer)' with route pattern 'api/users' is valid for the request path '/api/users'
2024-11-06 11:57:45.009 -03:00 [DBG] Request matched endpoint 'AuthServer.Users.UsersController.ListUsers (AuthServer)'
2024-11-06 11:57:45.010 -03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2024-11-06 11:57:45.010 -03:00 [DBG] AuthenticationScheme: Bearer was not authenticated.
2024-11-06 11:57:45.011 -03:00 [INF] Executing endpoint 'AuthServer.Users.UsersController.ListUsers (AuthServer)'
2024-11-06 11:57:45.012 -03:00 [INF] Route matched with {action = "ListUsers", controller = "Users"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.ActionResult`1[System.Collections.Generic.List`1[AuthServer.Users.responses.UserResponse]] ListUsers(System.String) on controller AuthServer.Users.UsersController (AuthServer).
2024-11-06 11:57:45.013 -03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2024-11-06 11:57:45.015 -03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2024-11-06 11:57:45.016 -03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)"]
2024-11-06 11:57:45.017 -03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2024-11-06 11:57:45.018 -03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)"]
2024-11-06 11:57:45.019 -03:00 [DBG] Executing controller factory for controller AuthServer.Users.UsersController (AuthServer)
2024-11-06 11:57:45.020 -03:00 [DBG] Executed controller factory for controller AuthServer.Users.UsersController (AuthServer)
2024-11-06 11:57:45.022 -03:00 [DBG] Attempting to bind parameter 'role' of type 'System.String' ...
2024-11-06 11:57:45.023 -03:00 [DBG] Attempting to bind parameter 'role' of type 'System.String' using the name '' in request data ...
2024-11-06 11:57:45.024 -03:00 [DBG] Could not find a value in the request with name '' for binding parameter 'role' of type 'System.String'.
2024-11-06 11:57:45.024 -03:00 [DBG] Done attempting to bind parameter 'role' of type 'System.String'.
2024-11-06 11:57:45.025 -03:00 [DBG] Done attempting to bind parameter 'role' of type 'System.String'.
2024-11-06 11:57:45.026 -03:00 [DBG] Attempting to validate the bound parameter 'role' of type 'System.String' ...
2024-11-06 11:57:45.027 -03:00 [DBG] Done attempting to validate the bound parameter 'role' of type 'System.String'.
2024-11-06 11:57:45.028 -03:00 [DBG] Entity Framework Core 8.0.10 initialized 'AuthServerContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:8.0.10' with options: None
2024-11-06 11:57:45.030 -03:00 [DBG] Creating DbConnection.
2024-11-06 11:57:45.030 -03:00 [DBG] Created DbConnection. (0ms).
2024-11-06 11:57:45.031 -03:00 [DBG] Opening connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 11:57:45.032 -03:00 [DBG] Opened connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 11:57:45.032 -03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2024-11-06 11:57:45.033 -03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2024-11-06 11:57:45.034 -03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2024-11-06 11:57:45.035 -03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[ID], [u].[Email], [u].[Name], [u].[Password], [t].[RoleId], [t].[UserId], [t].[Long], [t].[Name]
FROM [Users] AS [u]
LEFT JOIN (
    SELECT [u0].[RoleId], [u0].[UserId], [r].[Long], [r].[Name]
    FROM [UserRole] AS [u0]
    INNER JOIN [Roles] AS [r] ON [u0].[RoleId] = [r].[Long]
) AS [t] ON [u].[ID] = [t].[UserId]
ORDER BY [u].[ID], [t].[RoleId], [t].[UserId]
2024-11-06 11:57:45.037 -03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[ID], [u].[Email], [u].[Name], [u].[Password], [t].[RoleId], [t].[UserId], [t].[Long], [t].[Name]
FROM [Users] AS [u]
LEFT JOIN (
    SELECT [u0].[RoleId], [u0].[UserId], [r].[Long], [r].[Name]
    FROM [UserRole] AS [u0]
    INNER JOIN [Roles] AS [r] ON [u0].[RoleId] = [r].[Long]
) AS [t] ON [u].[ID] = [t].[UserId]
ORDER BY [u].[ID], [t].[RoleId], [t].[UserId]
2024-11-06 11:57:45.039 -03:00 [DBG] Context 'AuthServerContext' started tracking 'User' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 11:57:45.040 -03:00 [DBG] Context 'AuthServerContext' started tracking 'UserRole' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 11:57:45.041 -03:00 [DBG] Context 'AuthServerContext' started tracking 'Role' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 11:57:45.042 -03:00 [DBG] Context 'AuthServerContext' started tracking 'User' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 11:57:45.043 -03:00 [DBG] Context 'AuthServerContext' started tracking 'UserRole' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 11:57:45.044 -03:00 [DBG] Context 'AuthServerContext' started tracking 'Role' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 11:57:45.045 -03:00 [DBG] Context 'AuthServerContext' started tracking 'User' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 11:57:45.046 -03:00 [DBG] Context 'AuthServerContext' started tracking 'UserRole' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 11:57:45.047 -03:00 [DBG] Closing data reader to 'AuthServer' on server 'localhost,1433'.
2024-11-06 11:57:45.048 -03:00 [DBG] A data reader for 'AuthServer' on server 'localhost,1433' is being disposed after spending 8ms reading results.
2024-11-06 11:57:45.049 -03:00 [DBG] Closing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 11:57:45.050 -03:00 [DBG] Closed connection to database 'AuthServer' on server 'localhost,1433' (0ms).
2024-11-06 11:57:45.051 -03:00 [DBG] List of registered output formatters, in the following order: ["Microsoft.AspNetCore.Mvc.Formatters.HttpNoContentOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StringOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StreamOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter"]
2024-11-06 11:57:45.052 -03:00 [DBG] No information found on request to perform content negotiation.
2024-11-06 11:57:45.053 -03:00 [DBG] Attempting to select an output formatter without using a content type as no explicit content types were specified for the response.
2024-11-06 11:57:45.054 -03:00 [DBG] Attempting to select the first formatter in the output formatters list which can write the result.
2024-11-06 11:57:45.054 -03:00 [DBG] Selected output formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter' and content type 'application/json' to write the response.
2024-11-06 11:57:45.055 -03:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[AuthServer.Users.responses.UserResponse, AuthServer, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2024-11-06 11:57:45.056 -03:00 [INF] Executed action AuthServer.Users.UsersController.ListUsers (AuthServer) in 36.801ms
2024-11-06 11:57:45.057 -03:00 [INF] Executed endpoint 'AuthServer.Users.UsersController.ListUsers (AuthServer)'
2024-11-06 11:57:45.058 -03:00 [DBG] Connection id "0HN7UE9PSO94U" completed keep alive response.
2024-11-06 11:57:45.058 -03:00 [DBG] 'AuthServerContext' disposed.
2024-11-06 11:57:45.059 -03:00 [DBG] Disposing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 11:57:45.060 -03:00 [DBG] Disposed connection to database '' on server '' (0ms).
2024-11-06 11:57:45.061 -03:00 [INF] Request finished HTTP/1.1 GET https://localhost:7011/api/users - 200 null application/json; charset=utf-8 56.3499ms
2024-11-06 11:57:45.063 -03:00 [DBG] Connection id "0HN7UE9PSO94U", Request id "0HN7UE9PSO94U:0000000B": started reading request body.
2024-11-06 11:57:45.064 -03:00 [DBG] Connection id "0HN7UE9PSO94U", Request id "0HN7UE9PSO94U:0000000B": done reading request body.
2024-11-06 11:58:09.187 -03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7011/api/users/login - application/json 72
2024-11-06 11:58:09.189 -03:00 [DBG] 1 candidate(s) found for the request path '/api/users/login'
2024-11-06 11:58:09.190 -03:00 [DBG] Endpoint 'AuthServer.Users.UsersController.Login (AuthServer)' with route pattern 'api/users/login' is valid for the request path '/api/users/login'
2024-11-06 11:58:09.191 -03:00 [DBG] Request matched endpoint 'AuthServer.Users.UsersController.Login (AuthServer)'
2024-11-06 11:58:09.192 -03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2024-11-06 11:58:09.192 -03:00 [DBG] AuthenticationScheme: Bearer was not authenticated.
2024-11-06 11:58:09.193 -03:00 [INF] Executing endpoint 'AuthServer.Users.UsersController.Login (AuthServer)'
2024-11-06 11:58:09.194 -03:00 [INF] Route matched with {action = "Login", controller = "Users"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult Login(AuthServer.Users.LoginRequest) on controller AuthServer.Users.UsersController (AuthServer).
2024-11-06 11:58:09.195 -03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2024-11-06 11:58:09.196 -03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2024-11-06 11:58:09.197 -03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)"]
2024-11-06 11:58:09.199 -03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2024-11-06 11:58:09.200 -03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)"]
2024-11-06 11:58:09.201 -03:00 [DBG] Executing controller factory for controller AuthServer.Users.UsersController (AuthServer)
2024-11-06 11:58:09.202 -03:00 [DBG] Executed controller factory for controller AuthServer.Users.UsersController (AuthServer)
2024-11-06 11:58:09.203 -03:00 [DBG] Attempting to bind parameter 'credentials' of type 'AuthServer.Users.LoginRequest' ...
2024-11-06 11:58:09.204 -03:00 [DBG] Attempting to bind parameter 'credentials' of type 'AuthServer.Users.LoginRequest' using the name '' in request data ...
2024-11-06 11:58:09.205 -03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2024-11-06 11:58:09.206 -03:00 [DBG] Connection id "0HN7UE9PSO94U", Request id "0HN7UE9PSO94U:0000000C": started reading request body.
2024-11-06 11:58:09.207 -03:00 [DBG] Connection id "0HN7UE9PSO94U", Request id "0HN7UE9PSO94U:0000000C": done reading request body.
2024-11-06 11:58:09.208 -03:00 [DBG] JSON input formatter succeeded, deserializing to type 'AuthServer.Users.LoginRequest'
2024-11-06 11:58:09.209 -03:00 [DBG] Done attempting to bind parameter 'credentials' of type 'AuthServer.Users.LoginRequest'.
2024-11-06 11:58:09.210 -03:00 [DBG] Done attempting to bind parameter 'credentials' of type 'AuthServer.Users.LoginRequest'.
2024-11-06 11:58:09.210 -03:00 [DBG] Attempting to validate the bound parameter 'credentials' of type 'AuthServer.Users.LoginRequest' ...
2024-11-06 11:58:09.212 -03:00 [DBG] Done attempting to validate the bound parameter 'credentials' of type 'AuthServer.Users.LoginRequest'.
2024-11-06 11:58:09.213 -03:00 [DBG] Entity Framework Core 8.0.10 initialized 'AuthServerContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:8.0.10' with options: None
2024-11-06 11:58:09.214 -03:00 [DBG] Creating DbConnection.
2024-11-06 11:58:09.215 -03:00 [DBG] Created DbConnection. (0ms).
2024-11-06 11:58:09.216 -03:00 [DBG] Opening connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 11:58:09.216 -03:00 [DBG] Opened connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 11:58:09.217 -03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2024-11-06 11:58:09.218 -03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2024-11-06 11:58:09.219 -03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2024-11-06 11:58:09.220 -03:00 [DBG] Executing DbCommand [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[ID], [t].[Email], [t].[Name], [t].[Password], [t0].[RoleId], [t0].[UserId], [t0].[Long], [t0].[Name]
FROM (
    SELECT TOP(1) [u].[ID], [u].[Email], [u].[Name], [u].[Password]
    FROM [Users] AS [u]
    WHERE [u].[Email] = @__email_0
) AS [t]
LEFT JOIN (
    SELECT [u0].[RoleId], [u0].[UserId], [r].[Long], [r].[Name]
    FROM [UserRole] AS [u0]
    INNER JOIN [Roles] AS [r] ON [u0].[RoleId] = [r].[Long]
) AS [t0] ON [t].[ID] = [t0].[UserId]
ORDER BY [t].[ID], [t0].[RoleId], [t0].[UserId]
2024-11-06 11:58:09.223 -03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[ID], [t].[Email], [t].[Name], [t].[Password], [t0].[RoleId], [t0].[UserId], [t0].[Long], [t0].[Name]
FROM (
    SELECT TOP(1) [u].[ID], [u].[Email], [u].[Name], [u].[Password]
    FROM [Users] AS [u]
    WHERE [u].[Email] = @__email_0
) AS [t]
LEFT JOIN (
    SELECT [u0].[RoleId], [u0].[UserId], [r].[Long], [r].[Name]
    FROM [UserRole] AS [u0]
    INNER JOIN [Roles] AS [r] ON [u0].[RoleId] = [r].[Long]
) AS [t0] ON [t].[ID] = [t0].[UserId]
ORDER BY [t].[ID], [t0].[RoleId], [t0].[UserId]
2024-11-06 11:58:09.225 -03:00 [DBG] Context 'AuthServerContext' started tracking 'User' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 11:58:09.226 -03:00 [DBG] Context 'AuthServerContext' started tracking 'UserRole' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 11:58:09.227 -03:00 [DBG] Context 'AuthServerContext' started tracking 'Role' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 11:58:09.228 -03:00 [DBG] Closing data reader to 'AuthServer' on server 'localhost,1433'.
2024-11-06 11:58:09.228 -03:00 [DBG] A data reader for 'AuthServer' on server 'localhost,1433' is being disposed after spending 3ms reading results.
2024-11-06 11:58:09.229 -03:00 [DBG] Closing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 11:58:09.230 -03:00 [DBG] Closed connection to database 'AuthServer' on server 'localhost,1433' (0ms).
2024-11-06 11:58:09.231 -03:00 [INF] User logged in. id=31 name=Luiza Silva
2024-11-06 11:58:09.233 -03:00 [DBG] List of registered output formatters, in the following order: ["Microsoft.AspNetCore.Mvc.Formatters.HttpNoContentOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StringOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StreamOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter"]
2024-11-06 11:58:09.234 -03:00 [DBG] No information found on request to perform content negotiation.
2024-11-06 11:58:09.235 -03:00 [DBG] Attempting to select an output formatter without using a content type as no explicit content types were specified for the response.
2024-11-06 11:58:09.235 -03:00 [DBG] Attempting to select the first formatter in the output formatters list which can write the result.
2024-11-06 11:58:09.236 -03:00 [DBG] Selected output formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter' and content type 'application/json' to write the response.
2024-11-06 11:58:09.236 -03:00 [INF] Executing OkObjectResult, writing value of type 'LoginResponse'.
2024-11-06 11:58:09.238 -03:00 [INF] Executed action AuthServer.Users.UsersController.Login (AuthServer) in 36.8681ms
2024-11-06 11:58:09.239 -03:00 [INF] Executed endpoint 'AuthServer.Users.UsersController.Login (AuthServer)'
2024-11-06 11:58:09.239 -03:00 [DBG] Connection id "0HN7UE9PSO94U" completed keep alive response.
2024-11-06 11:58:09.240 -03:00 [DBG] 'AuthServerContext' disposed.
2024-11-06 11:58:09.241 -03:00 [DBG] Disposing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 11:58:09.241 -03:00 [DBG] Disposed connection to database '' on server '' (0ms).
2024-11-06 11:58:09.242 -03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7011/api/users/login - 200 null application/json; charset=utf-8 55.8855ms
2024-11-06 11:58:22.556 -03:00 [INF] Request starting HTTP/1.1 DELETE https://localhost:7011/api/users/16 - application/json 72
2024-11-06 11:58:22.558 -03:00 [DBG] 1 candidate(s) found for the request path '/api/users/16'
2024-11-06 11:58:22.559 -03:00 [DBG] Endpoint 'AuthServer.Users.UsersController.Delete (AuthServer)' with route pattern 'api/users/{id}' is valid for the request path '/api/users/16'
2024-11-06 11:58:22.560 -03:00 [DBG] Request matched endpoint 'AuthServer.Users.UsersController.Delete (AuthServer)'
2024-11-06 11:58:22.561 -03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2024-11-06 11:58:22.603 -03:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenSignatureKeyNotFoundException: IDX10517: Signature validation failed. The token's kid is missing. Keys tried: 'Microsoft.IdentityModel.Tokens.SymmetricSecurityKey, KeyId: '', InternalId: 'usxXQ1xbApZ07H2YlOD06P6caSPwoiLGyCgT6MUX9k8'. , KeyId: 
'. Number of keys in TokenValidationParameters: '1'. 
Number of keys in Configuration: '0'. 
Exceptions caught:
 '[PII of type 'System.String' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'.
token: '[PII of type 'Microsoft.IdentityModel.JsonWebTokens.JsonWebToken' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'. See https://aka.ms/IDX10503 for details.
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateSignature(JsonWebToken jwtToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateSignatureAndIssuerSecurityKey(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2024-11-06 11:58:22.606 -03:00 [INF] Bearer was not authenticated. Failure message: IDX10517: Signature validation failed. The token's kid is missing. Keys tried: 'Microsoft.IdentityModel.Tokens.SymmetricSecurityKey, KeyId: '', InternalId: 'usxXQ1xbApZ07H2YlOD06P6caSPwoiLGyCgT6MUX9k8'. , KeyId: 
'. Number of keys in TokenValidationParameters: '1'. 
Number of keys in Configuration: '0'. 
Exceptions caught:
 '[PII of type 'System.String' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'.
token: '[PII of type 'Microsoft.IdentityModel.JsonWebTokens.JsonWebToken' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'. See https://aka.ms/IDX10503 for details.
2024-11-06 11:58:22.607 -03:00 [INF] Authorization failed. These requirements were not met:
RolesAuthorizationRequirement:User.IsInRole must be true for one of the following roles: (ADMIN)
2024-11-06 11:58:22.609 -03:00 [INF] AuthenticationScheme: Bearer was forbidden.
2024-11-06 11:58:22.610 -03:00 [DBG] Connection id "0HN7UE9PSO94U" completed keep alive response.
2024-11-06 11:58:22.610 -03:00 [INF] Request finished HTTP/1.1 DELETE https://localhost:7011/api/users/16 - 403 0 null 54.4762ms
2024-11-06 11:58:22.612 -03:00 [DBG] Connection id "0HN7UE9PSO94U", Request id "0HN7UE9PSO94U:0000000D": started reading request body.
2024-11-06 11:58:22.613 -03:00 [DBG] Connection id "0HN7UE9PSO94U", Request id "0HN7UE9PSO94U:0000000D": done reading request body.
2024-11-06 11:58:47.635 -03:00 [INF] Request starting HTTP/1.1 DELETE https://localhost:7011/api/users/30 - application/json 72
2024-11-06 11:58:47.637 -03:00 [DBG] 1 candidate(s) found for the request path '/api/users/30'
2024-11-06 11:58:47.639 -03:00 [DBG] Endpoint 'AuthServer.Users.UsersController.Delete (AuthServer)' with route pattern 'api/users/{id}' is valid for the request path '/api/users/30'
2024-11-06 11:58:47.640 -03:00 [DBG] Request matched endpoint 'AuthServer.Users.UsersController.Delete (AuthServer)'
2024-11-06 11:58:47.641 -03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2024-11-06 11:58:47.642 -03:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenSignatureKeyNotFoundException: IDX10517: Signature validation failed. The token's kid is missing. Keys tried: 'Microsoft.IdentityModel.Tokens.SymmetricSecurityKey, KeyId: '', InternalId: 'usxXQ1xbApZ07H2YlOD06P6caSPwoiLGyCgT6MUX9k8'. , KeyId: 
'. Number of keys in TokenValidationParameters: '1'. 
Number of keys in Configuration: '0'. 
Exceptions caught:
 '[PII of type 'System.String' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'.
token: '[PII of type 'Microsoft.IdentityModel.JsonWebTokens.JsonWebToken' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'. See https://aka.ms/IDX10503 for details.
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateSignature(JsonWebToken jwtToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateSignatureAndIssuerSecurityKey(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2024-11-06 11:58:47.644 -03:00 [INF] Bearer was not authenticated. Failure message: IDX10517: Signature validation failed. The token's kid is missing. Keys tried: 'Microsoft.IdentityModel.Tokens.SymmetricSecurityKey, KeyId: '', InternalId: 'usxXQ1xbApZ07H2YlOD06P6caSPwoiLGyCgT6MUX9k8'. , KeyId: 
'. Number of keys in TokenValidationParameters: '1'. 
Number of keys in Configuration: '0'. 
Exceptions caught:
 '[PII of type 'System.String' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'.
token: '[PII of type 'Microsoft.IdentityModel.JsonWebTokens.JsonWebToken' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'. See https://aka.ms/IDX10503 for details.
2024-11-06 11:58:47.645 -03:00 [INF] Authorization failed. These requirements were not met:
RolesAuthorizationRequirement:User.IsInRole must be true for one of the following roles: (ADMIN)
2024-11-06 11:58:47.646 -03:00 [INF] AuthenticationScheme: Bearer was forbidden.
2024-11-06 11:58:47.647 -03:00 [DBG] Connection id "0HN7UE9PSO94U" completed keep alive response.
2024-11-06 11:58:47.648 -03:00 [INF] Request finished HTTP/1.1 DELETE https://localhost:7011/api/users/30 - 403 0 null 12.4135ms
2024-11-06 11:58:47.650 -03:00 [DBG] Connection id "0HN7UE9PSO94U", Request id "0HN7UE9PSO94U:0000000E": started reading request body.
2024-11-06 11:58:47.651 -03:00 [DBG] Connection id "0HN7UE9PSO94U", Request id "0HN7UE9PSO94U:0000000E": done reading request body.
2024-11-06 11:58:50.300 -03:00 [INF] Request starting HTTP/1.1 DELETE https://localhost:7011/api/users/31 - application/json 72
2024-11-06 11:58:50.301 -03:00 [DBG] 1 candidate(s) found for the request path '/api/users/31'
2024-11-06 11:58:50.302 -03:00 [DBG] Endpoint 'AuthServer.Users.UsersController.Delete (AuthServer)' with route pattern 'api/users/{id}' is valid for the request path '/api/users/31'
2024-11-06 11:58:50.304 -03:00 [DBG] Request matched endpoint 'AuthServer.Users.UsersController.Delete (AuthServer)'
2024-11-06 11:58:50.305 -03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2024-11-06 11:58:50.306 -03:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenSignatureKeyNotFoundException: IDX10517: Signature validation failed. The token's kid is missing. Keys tried: 'Microsoft.IdentityModel.Tokens.SymmetricSecurityKey, KeyId: '', InternalId: 'usxXQ1xbApZ07H2YlOD06P6caSPwoiLGyCgT6MUX9k8'. , KeyId: 
'. Number of keys in TokenValidationParameters: '1'. 
Number of keys in Configuration: '0'. 
Exceptions caught:
 '[PII of type 'System.String' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'.
token: '[PII of type 'Microsoft.IdentityModel.JsonWebTokens.JsonWebToken' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'. See https://aka.ms/IDX10503 for details.
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateSignature(JsonWebToken jwtToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateSignatureAndIssuerSecurityKey(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2024-11-06 11:58:50.308 -03:00 [INF] Bearer was not authenticated. Failure message: IDX10517: Signature validation failed. The token's kid is missing. Keys tried: 'Microsoft.IdentityModel.Tokens.SymmetricSecurityKey, KeyId: '', InternalId: 'usxXQ1xbApZ07H2YlOD06P6caSPwoiLGyCgT6MUX9k8'. , KeyId: 
'. Number of keys in TokenValidationParameters: '1'. 
Number of keys in Configuration: '0'. 
Exceptions caught:
 '[PII of type 'System.String' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'.
token: '[PII of type 'Microsoft.IdentityModel.JsonWebTokens.JsonWebToken' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'. See https://aka.ms/IDX10503 for details.
2024-11-06 11:58:50.309 -03:00 [INF] Authorization failed. These requirements were not met:
RolesAuthorizationRequirement:User.IsInRole must be true for one of the following roles: (ADMIN)
2024-11-06 11:58:50.310 -03:00 [INF] AuthenticationScheme: Bearer was forbidden.
2024-11-06 11:58:50.311 -03:00 [DBG] Connection id "0HN7UE9PSO94U" completed keep alive response.
2024-11-06 11:58:50.312 -03:00 [INF] Request finished HTTP/1.1 DELETE https://localhost:7011/api/users/31 - 403 0 null 12.252ms
2024-11-06 11:58:50.314 -03:00 [DBG] Connection id "0HN7UE9PSO94U", Request id "0HN7UE9PSO94U:0000000F": started reading request body.
2024-11-06 11:58:50.315 -03:00 [DBG] Connection id "0HN7UE9PSO94U", Request id "0HN7UE9PSO94U:0000000F": done reading request body.
2024-11-06 11:59:06.345 -03:00 [INF] Request starting HTTP/1.1 DELETE https://localhost:7011/api/users/login - application/json 72
2024-11-06 11:59:06.347 -03:00 [DBG] 1 candidate(s) found for the request path '/api/users/login'
2024-11-06 11:59:06.348 -03:00 [DBG] Endpoint 'AuthServer.Users.UsersController.Delete (AuthServer)' with route pattern 'api/users/{id}' is valid for the request path '/api/users/login'
2024-11-06 11:59:06.349 -03:00 [DBG] Request matched endpoint 'AuthServer.Users.UsersController.Delete (AuthServer)'
2024-11-06 11:59:06.350 -03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2024-11-06 11:59:06.351 -03:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenSignatureKeyNotFoundException: IDX10517: Signature validation failed. The token's kid is missing. Keys tried: 'Microsoft.IdentityModel.Tokens.SymmetricSecurityKey, KeyId: '', InternalId: 'usxXQ1xbApZ07H2YlOD06P6caSPwoiLGyCgT6MUX9k8'. , KeyId: 
'. Number of keys in TokenValidationParameters: '1'. 
Number of keys in Configuration: '0'. 
Exceptions caught:
 '[PII of type 'System.String' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'.
token: '[PII of type 'Microsoft.IdentityModel.JsonWebTokens.JsonWebToken' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'. See https://aka.ms/IDX10503 for details.
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateSignature(JsonWebToken jwtToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateSignatureAndIssuerSecurityKey(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2024-11-06 11:59:06.354 -03:00 [INF] Bearer was not authenticated. Failure message: IDX10517: Signature validation failed. The token's kid is missing. Keys tried: 'Microsoft.IdentityModel.Tokens.SymmetricSecurityKey, KeyId: '', InternalId: 'usxXQ1xbApZ07H2YlOD06P6caSPwoiLGyCgT6MUX9k8'. , KeyId: 
'. Number of keys in TokenValidationParameters: '1'. 
Number of keys in Configuration: '0'. 
Exceptions caught:
 '[PII of type 'System.String' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'.
token: '[PII of type 'Microsoft.IdentityModel.JsonWebTokens.JsonWebToken' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'. See https://aka.ms/IDX10503 for details.
2024-11-06 11:59:06.355 -03:00 [INF] Authorization failed. These requirements were not met:
RolesAuthorizationRequirement:User.IsInRole must be true for one of the following roles: (ADMIN)
2024-11-06 11:59:06.356 -03:00 [INF] AuthenticationScheme: Bearer was forbidden.
2024-11-06 11:59:06.357 -03:00 [DBG] Connection id "0HN7UE9PSO94U" completed keep alive response.
2024-11-06 11:59:06.358 -03:00 [INF] Request finished HTTP/1.1 DELETE https://localhost:7011/api/users/login - 403 0 null 12.193ms
2024-11-06 11:59:06.359 -03:00 [DBG] Connection id "0HN7UE9PSO94U", Request id "0HN7UE9PSO94U:00000010": started reading request body.
2024-11-06 11:59:06.360 -03:00 [DBG] Connection id "0HN7UE9PSO94U", Request id "0HN7UE9PSO94U:00000010": done reading request body.
2024-11-06 12:01:17.160 -03:00 [DBG] Connection id "0HN7UE9PSO94U" disconnecting.
2024-11-06 12:01:17.162 -03:00 [DBG] Connection id "0HN7UE9PSO94U" stopped.
2024-11-06 12:01:17.163 -03:00 [DBG] Connection id "0HN7UE9PSO94U" sending FIN because: "The Socket transport's send loop completed gracefully."
2024-11-06 12:10:13.881 -03:00 [DBG] Connection id "0HN7UE9PSO94V" accepted.
2024-11-06 12:10:13.882 -03:00 [DBG] Connection id "0HN7UE9PSO94V" received FIN.
2024-11-06 12:10:13.883 -03:00 [DBG] Connection id "0HN7UE9PSO94V" started.
2024-11-06 12:10:13.883 -03:00 [DBG] Connection id "0HN7UE9PSO950" accepted.
2024-11-06 12:10:13.884 -03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2024-11-06 12:10:13.885 -03:00 [DBG] Connection id "0HN7UE9PSO950" started.
2024-11-06 12:10:13.898 -03:00 [DBG] Connection id "0HN7UE9PSO94V" stopped.
2024-11-06 12:10:13.899 -03:00 [DBG] Connection id "0HN7UE9PSO94V" sending FIN because: "The Socket transport's send loop completed gracefully."
2024-11-06 12:10:13.901 -03:00 [DBG] Connection 0HN7UE9PSO950 established using the following protocol: "Tls13"
2024-11-06 12:10:13.902 -03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7011/api/users/login - application/json 72
2024-11-06 12:10:13.904 -03:00 [DBG] 1 candidate(s) found for the request path '/api/users/login'
2024-11-06 12:10:13.905 -03:00 [DBG] Endpoint 'AuthServer.Users.UsersController.Login (AuthServer)' with route pattern 'api/users/login' is valid for the request path '/api/users/login'
2024-11-06 12:10:13.906 -03:00 [DBG] Request matched endpoint 'AuthServer.Users.UsersController.Login (AuthServer)'
2024-11-06 12:10:13.906 -03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2024-11-06 12:10:13.907 -03:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenSignatureKeyNotFoundException: IDX10517: Signature validation failed. The token's kid is missing. Keys tried: 'Microsoft.IdentityModel.Tokens.SymmetricSecurityKey, KeyId: '', InternalId: 'usxXQ1xbApZ07H2YlOD06P6caSPwoiLGyCgT6MUX9k8'. , KeyId: 
'. Number of keys in TokenValidationParameters: '1'. 
Number of keys in Configuration: '0'. 
Exceptions caught:
 '[PII of type 'System.String' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'.
token: '[PII of type 'Microsoft.IdentityModel.JsonWebTokens.JsonWebToken' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'. See https://aka.ms/IDX10503 for details.
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateSignature(JsonWebToken jwtToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateSignatureAndIssuerSecurityKey(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2024-11-06 12:10:13.909 -03:00 [INF] Bearer was not authenticated. Failure message: IDX10517: Signature validation failed. The token's kid is missing. Keys tried: 'Microsoft.IdentityModel.Tokens.SymmetricSecurityKey, KeyId: '', InternalId: 'usxXQ1xbApZ07H2YlOD06P6caSPwoiLGyCgT6MUX9k8'. , KeyId: 
'. Number of keys in TokenValidationParameters: '1'. 
Number of keys in Configuration: '0'. 
Exceptions caught:
 '[PII of type 'System.String' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'.
token: '[PII of type 'Microsoft.IdentityModel.JsonWebTokens.JsonWebToken' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'. See https://aka.ms/IDX10503 for details.
2024-11-06 12:10:13.910 -03:00 [INF] Executing endpoint 'AuthServer.Users.UsersController.Login (AuthServer)'
2024-11-06 12:10:13.911 -03:00 [INF] Route matched with {action = "Login", controller = "Users"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult Login(AuthServer.Users.LoginRequest) on controller AuthServer.Users.UsersController (AuthServer).
2024-11-06 12:10:13.912 -03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2024-11-06 12:10:13.913 -03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2024-11-06 12:10:13.914 -03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)"]
2024-11-06 12:10:13.915 -03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2024-11-06 12:10:13.916 -03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)"]
2024-11-06 12:10:13.917 -03:00 [DBG] Executing controller factory for controller AuthServer.Users.UsersController (AuthServer)
2024-11-06 12:10:13.918 -03:00 [DBG] Executed controller factory for controller AuthServer.Users.UsersController (AuthServer)
2024-11-06 12:10:13.919 -03:00 [DBG] Attempting to bind parameter 'credentials' of type 'AuthServer.Users.LoginRequest' ...
2024-11-06 12:10:13.920 -03:00 [DBG] Attempting to bind parameter 'credentials' of type 'AuthServer.Users.LoginRequest' using the name '' in request data ...
2024-11-06 12:10:13.921 -03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2024-11-06 12:10:13.922 -03:00 [DBG] Connection id "0HN7UE9PSO950", Request id "0HN7UE9PSO950:00000001": started reading request body.
2024-11-06 12:10:13.923 -03:00 [DBG] Connection id "0HN7UE9PSO950", Request id "0HN7UE9PSO950:00000001": done reading request body.
2024-11-06 12:10:13.924 -03:00 [DBG] JSON input formatter succeeded, deserializing to type 'AuthServer.Users.LoginRequest'
2024-11-06 12:10:13.925 -03:00 [DBG] Done attempting to bind parameter 'credentials' of type 'AuthServer.Users.LoginRequest'.
2024-11-06 12:10:13.925 -03:00 [DBG] Done attempting to bind parameter 'credentials' of type 'AuthServer.Users.LoginRequest'.
2024-11-06 12:10:13.926 -03:00 [DBG] Attempting to validate the bound parameter 'credentials' of type 'AuthServer.Users.LoginRequest' ...
2024-11-06 12:10:13.927 -03:00 [DBG] Done attempting to validate the bound parameter 'credentials' of type 'AuthServer.Users.LoginRequest'.
2024-11-06 12:10:13.928 -03:00 [DBG] Entity Framework Core 8.0.10 initialized 'AuthServerContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:8.0.10' with options: None
2024-11-06 12:10:13.930 -03:00 [DBG] Creating DbConnection.
2024-11-06 12:10:13.931 -03:00 [DBG] Created DbConnection. (0ms).
2024-11-06 12:10:13.931 -03:00 [DBG] Opening connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 12:10:13.947 -03:00 [DBG] Opened connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 12:10:13.948 -03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2024-11-06 12:10:13.949 -03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2024-11-06 12:10:13.949 -03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2024-11-06 12:10:13.950 -03:00 [DBG] Executing DbCommand [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[ID], [t].[Email], [t].[Name], [t].[Password], [t0].[RoleId], [t0].[UserId], [t0].[Long], [t0].[Name]
FROM (
    SELECT TOP(1) [u].[ID], [u].[Email], [u].[Name], [u].[Password]
    FROM [Users] AS [u]
    WHERE [u].[Email] = @__email_0
) AS [t]
LEFT JOIN (
    SELECT [u0].[RoleId], [u0].[UserId], [r].[Long], [r].[Name]
    FROM [UserRole] AS [u0]
    INNER JOIN [Roles] AS [r] ON [u0].[RoleId] = [r].[Long]
) AS [t0] ON [t].[ID] = [t0].[UserId]
ORDER BY [t].[ID], [t0].[RoleId], [t0].[UserId]
2024-11-06 12:10:13.958 -03:00 [INF] Executed DbCommand (8ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[ID], [t].[Email], [t].[Name], [t].[Password], [t0].[RoleId], [t0].[UserId], [t0].[Long], [t0].[Name]
FROM (
    SELECT TOP(1) [u].[ID], [u].[Email], [u].[Name], [u].[Password]
    FROM [Users] AS [u]
    WHERE [u].[Email] = @__email_0
) AS [t]
LEFT JOIN (
    SELECT [u0].[RoleId], [u0].[UserId], [r].[Long], [r].[Name]
    FROM [UserRole] AS [u0]
    INNER JOIN [Roles] AS [r] ON [u0].[RoleId] = [r].[Long]
) AS [t0] ON [t].[ID] = [t0].[UserId]
ORDER BY [t].[ID], [t0].[RoleId], [t0].[UserId]
2024-11-06 12:10:13.960 -03:00 [DBG] Context 'AuthServerContext' started tracking 'User' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 12:10:13.961 -03:00 [DBG] Context 'AuthServerContext' started tracking 'UserRole' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 12:10:13.962 -03:00 [DBG] Context 'AuthServerContext' started tracking 'Role' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 12:10:13.963 -03:00 [DBG] Closing data reader to 'AuthServer' on server 'localhost,1433'.
2024-11-06 12:10:13.964 -03:00 [DBG] A data reader for 'AuthServer' on server 'localhost,1433' is being disposed after spending 3ms reading results.
2024-11-06 12:10:13.965 -03:00 [DBG] Closing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 12:10:13.966 -03:00 [DBG] Closed connection to database 'AuthServer' on server 'localhost,1433' (0ms).
2024-11-06 12:10:13.967 -03:00 [INF] User logged in. id=16 name=Auth Server Administrator
2024-11-06 12:10:13.968 -03:00 [DBG] List of registered output formatters, in the following order: ["Microsoft.AspNetCore.Mvc.Formatters.HttpNoContentOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StringOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StreamOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter"]
2024-11-06 12:10:13.969 -03:00 [DBG] No information found on request to perform content negotiation.
2024-11-06 12:10:13.970 -03:00 [DBG] Attempting to select an output formatter without using a content type as no explicit content types were specified for the response.
2024-11-06 12:10:13.970 -03:00 [DBG] Attempting to select the first formatter in the output formatters list which can write the result.
2024-11-06 12:10:13.971 -03:00 [DBG] Selected output formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter' and content type 'application/json' to write the response.
2024-11-06 12:10:13.972 -03:00 [INF] Executing OkObjectResult, writing value of type 'LoginResponse'.
2024-11-06 12:10:13.973 -03:00 [INF] Executed action AuthServer.Users.UsersController.Login (AuthServer) in 55.8893ms
2024-11-06 12:10:13.974 -03:00 [INF] Executed endpoint 'AuthServer.Users.UsersController.Login (AuthServer)'
2024-11-06 12:10:13.974 -03:00 [DBG] Connection id "0HN7UE9PSO950" completed keep alive response.
2024-11-06 12:10:13.975 -03:00 [DBG] 'AuthServerContext' disposed.
2024-11-06 12:10:13.976 -03:00 [DBG] Disposing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 12:10:13.977 -03:00 [DBG] Disposed connection to database '' on server '' (0ms).
2024-11-06 12:10:13.978 -03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7011/api/users/login - 200 null application/json; charset=utf-8 75.798ms
2024-11-06 12:10:29.815 -03:00 [INF] Request starting HTTP/1.1 GET https://localhost:7011/api/users - application/json 72
2024-11-06 12:10:29.817 -03:00 [DBG] 1 candidate(s) found for the request path '/api/users'
2024-11-06 12:10:29.818 -03:00 [DBG] Endpoint 'AuthServer.Users.UsersController.ListUsers (AuthServer)' with route pattern 'api/users' is valid for the request path '/api/users'
2024-11-06 12:10:29.819 -03:00 [DBG] Request matched endpoint 'AuthServer.Users.UsersController.ListUsers (AuthServer)'
2024-11-06 12:10:29.820 -03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2024-11-06 12:10:29.821 -03:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenSignatureKeyNotFoundException: IDX10517: Signature validation failed. The token's kid is missing. Keys tried: 'Microsoft.IdentityModel.Tokens.SymmetricSecurityKey, KeyId: '', InternalId: 'usxXQ1xbApZ07H2YlOD06P6caSPwoiLGyCgT6MUX9k8'. , KeyId: 
'. Number of keys in TokenValidationParameters: '1'. 
Number of keys in Configuration: '0'. 
Exceptions caught:
 '[PII of type 'System.String' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'.
token: '[PII of type 'Microsoft.IdentityModel.JsonWebTokens.JsonWebToken' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'. See https://aka.ms/IDX10503 for details.
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateSignature(JsonWebToken jwtToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateSignatureAndIssuerSecurityKey(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2024-11-06 12:10:29.824 -03:00 [INF] Bearer was not authenticated. Failure message: IDX10517: Signature validation failed. The token's kid is missing. Keys tried: 'Microsoft.IdentityModel.Tokens.SymmetricSecurityKey, KeyId: '', InternalId: 'usxXQ1xbApZ07H2YlOD06P6caSPwoiLGyCgT6MUX9k8'. , KeyId: 
'. Number of keys in TokenValidationParameters: '1'. 
Number of keys in Configuration: '0'. 
Exceptions caught:
 '[PII of type 'System.String' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'.
token: '[PII of type 'Microsoft.IdentityModel.JsonWebTokens.JsonWebToken' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'. See https://aka.ms/IDX10503 for details.
2024-11-06 12:10:29.825 -03:00 [INF] Executing endpoint 'AuthServer.Users.UsersController.ListUsers (AuthServer)'
2024-11-06 12:10:29.825 -03:00 [INF] Route matched with {action = "ListUsers", controller = "Users"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.ActionResult`1[System.Collections.Generic.List`1[AuthServer.Users.responses.UserResponse]] ListUsers(System.String) on controller AuthServer.Users.UsersController (AuthServer).
2024-11-06 12:10:29.827 -03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2024-11-06 12:10:29.828 -03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2024-11-06 12:10:29.829 -03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)"]
2024-11-06 12:10:29.830 -03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2024-11-06 12:10:29.831 -03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)"]
2024-11-06 12:10:29.832 -03:00 [DBG] Executing controller factory for controller AuthServer.Users.UsersController (AuthServer)
2024-11-06 12:10:29.833 -03:00 [DBG] Executed controller factory for controller AuthServer.Users.UsersController (AuthServer)
2024-11-06 12:10:29.834 -03:00 [DBG] Attempting to bind parameter 'role' of type 'System.String' ...
2024-11-06 12:10:29.835 -03:00 [DBG] Attempting to bind parameter 'role' of type 'System.String' using the name '' in request data ...
2024-11-06 12:10:29.837 -03:00 [DBG] Could not find a value in the request with name '' for binding parameter 'role' of type 'System.String'.
2024-11-06 12:10:29.837 -03:00 [DBG] Done attempting to bind parameter 'role' of type 'System.String'.
2024-11-06 12:10:29.838 -03:00 [DBG] Done attempting to bind parameter 'role' of type 'System.String'.
2024-11-06 12:10:29.839 -03:00 [DBG] Attempting to validate the bound parameter 'role' of type 'System.String' ...
2024-11-06 12:10:29.840 -03:00 [DBG] Done attempting to validate the bound parameter 'role' of type 'System.String'.
2024-11-06 12:10:29.841 -03:00 [DBG] Entity Framework Core 8.0.10 initialized 'AuthServerContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:8.0.10' with options: None
2024-11-06 12:10:29.843 -03:00 [DBG] Creating DbConnection.
2024-11-06 12:10:29.843 -03:00 [DBG] Created DbConnection. (0ms).
2024-11-06 12:10:29.844 -03:00 [DBG] Opening connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 12:10:29.845 -03:00 [DBG] Opened connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 12:10:29.846 -03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2024-11-06 12:10:29.846 -03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2024-11-06 12:10:29.847 -03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2024-11-06 12:10:29.848 -03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[ID], [u].[Email], [u].[Name], [u].[Password], [t].[RoleId], [t].[UserId], [t].[Long], [t].[Name]
FROM [Users] AS [u]
LEFT JOIN (
    SELECT [u0].[RoleId], [u0].[UserId], [r].[Long], [r].[Name]
    FROM [UserRole] AS [u0]
    INNER JOIN [Roles] AS [r] ON [u0].[RoleId] = [r].[Long]
) AS [t] ON [u].[ID] = [t].[UserId]
ORDER BY [u].[ID], [t].[RoleId], [t].[UserId]
2024-11-06 12:10:29.851 -03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[ID], [u].[Email], [u].[Name], [u].[Password], [t].[RoleId], [t].[UserId], [t].[Long], [t].[Name]
FROM [Users] AS [u]
LEFT JOIN (
    SELECT [u0].[RoleId], [u0].[UserId], [r].[Long], [r].[Name]
    FROM [UserRole] AS [u0]
    INNER JOIN [Roles] AS [r] ON [u0].[RoleId] = [r].[Long]
) AS [t] ON [u].[ID] = [t].[UserId]
ORDER BY [u].[ID], [t].[RoleId], [t].[UserId]
2024-11-06 12:10:29.853 -03:00 [DBG] Context 'AuthServerContext' started tracking 'User' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 12:10:29.854 -03:00 [DBG] Context 'AuthServerContext' started tracking 'UserRole' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 12:10:29.855 -03:00 [DBG] Context 'AuthServerContext' started tracking 'Role' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 12:10:29.856 -03:00 [DBG] Context 'AuthServerContext' started tracking 'User' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 12:10:29.857 -03:00 [DBG] Context 'AuthServerContext' started tracking 'UserRole' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 12:10:29.858 -03:00 [DBG] Context 'AuthServerContext' started tracking 'Role' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 12:10:29.859 -03:00 [DBG] Context 'AuthServerContext' started tracking 'User' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 12:10:29.859 -03:00 [DBG] Context 'AuthServerContext' started tracking 'UserRole' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 12:10:29.860 -03:00 [DBG] Closing data reader to 'AuthServer' on server 'localhost,1433'.
2024-11-06 12:10:29.861 -03:00 [DBG] A data reader for 'AuthServer' on server 'localhost,1433' is being disposed after spending 8ms reading results.
2024-11-06 12:10:29.862 -03:00 [DBG] Closing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 12:10:29.863 -03:00 [DBG] Closed connection to database 'AuthServer' on server 'localhost,1433' (0ms).
2024-11-06 12:10:29.864 -03:00 [DBG] List of registered output formatters, in the following order: ["Microsoft.AspNetCore.Mvc.Formatters.HttpNoContentOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StringOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StreamOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter"]
2024-11-06 12:10:29.865 -03:00 [DBG] No information found on request to perform content negotiation.
2024-11-06 12:10:29.866 -03:00 [DBG] Attempting to select an output formatter without using a content type as no explicit content types were specified for the response.
2024-11-06 12:10:29.866 -03:00 [DBG] Attempting to select the first formatter in the output formatters list which can write the result.
2024-11-06 12:10:29.867 -03:00 [DBG] Selected output formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter' and content type 'application/json' to write the response.
2024-11-06 12:10:29.868 -03:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[AuthServer.Users.responses.UserResponse, AuthServer, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2024-11-06 12:10:29.869 -03:00 [INF] Executed action AuthServer.Users.UsersController.ListUsers (AuthServer) in 36.8587ms
2024-11-06 12:10:29.870 -03:00 [INF] Executed endpoint 'AuthServer.Users.UsersController.ListUsers (AuthServer)'
2024-11-06 12:10:29.871 -03:00 [DBG] Connection id "0HN7UE9PSO950" completed keep alive response.
2024-11-06 12:10:29.872 -03:00 [DBG] 'AuthServerContext' disposed.
2024-11-06 12:10:29.872 -03:00 [DBG] Disposing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 12:10:29.873 -03:00 [DBG] Disposed connection to database '' on server '' (0ms).
2024-11-06 12:10:29.874 -03:00 [INF] Request finished HTTP/1.1 GET https://localhost:7011/api/users - 200 null application/json; charset=utf-8 59.4716ms
2024-11-06 12:10:29.876 -03:00 [DBG] Connection id "0HN7UE9PSO950", Request id "0HN7UE9PSO950:00000002": started reading request body.
2024-11-06 12:10:29.877 -03:00 [DBG] Connection id "0HN7UE9PSO950", Request id "0HN7UE9PSO950:00000002": done reading request body.
2024-11-06 12:10:37.154 -03:00 [INF] Request starting HTTP/1.1 DELETE https://localhost:7011/api/users/16 - application/json 72
2024-11-06 12:10:37.156 -03:00 [DBG] 1 candidate(s) found for the request path '/api/users/16'
2024-11-06 12:10:37.157 -03:00 [DBG] Endpoint 'AuthServer.Users.UsersController.Delete (AuthServer)' with route pattern 'api/users/{id}' is valid for the request path '/api/users/16'
2024-11-06 12:10:37.158 -03:00 [DBG] Request matched endpoint 'AuthServer.Users.UsersController.Delete (AuthServer)'
2024-11-06 12:10:37.159 -03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2024-11-06 12:10:37.160 -03:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenSignatureKeyNotFoundException: IDX10517: Signature validation failed. The token's kid is missing. Keys tried: 'Microsoft.IdentityModel.Tokens.SymmetricSecurityKey, KeyId: '', InternalId: 'usxXQ1xbApZ07H2YlOD06P6caSPwoiLGyCgT6MUX9k8'. , KeyId: 
'. Number of keys in TokenValidationParameters: '1'. 
Number of keys in Configuration: '0'. 
Exceptions caught:
 '[PII of type 'System.String' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'.
token: '[PII of type 'Microsoft.IdentityModel.JsonWebTokens.JsonWebToken' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'. See https://aka.ms/IDX10503 for details.
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateSignature(JsonWebToken jwtToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateSignatureAndIssuerSecurityKey(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2024-11-06 12:10:37.162 -03:00 [INF] Bearer was not authenticated. Failure message: IDX10517: Signature validation failed. The token's kid is missing. Keys tried: 'Microsoft.IdentityModel.Tokens.SymmetricSecurityKey, KeyId: '', InternalId: 'usxXQ1xbApZ07H2YlOD06P6caSPwoiLGyCgT6MUX9k8'. , KeyId: 
'. Number of keys in TokenValidationParameters: '1'. 
Number of keys in Configuration: '0'. 
Exceptions caught:
 '[PII of type 'System.String' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'.
token: '[PII of type 'Microsoft.IdentityModel.JsonWebTokens.JsonWebToken' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'. See https://aka.ms/IDX10503 for details.
2024-11-06 12:10:37.164 -03:00 [DBG] Authorization was successful.
2024-11-06 12:10:37.164 -03:00 [INF] Executing endpoint 'AuthServer.Users.UsersController.Delete (AuthServer)'
2024-11-06 12:10:37.166 -03:00 [INF] Route matched with {action = "Delete", controller = "Users"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult Delete(Int64) on controller AuthServer.Users.UsersController (AuthServer).
2024-11-06 12:10:37.168 -03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2024-11-06 12:10:37.169 -03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2024-11-06 12:10:37.170 -03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)"]
2024-11-06 12:10:37.171 -03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2024-11-06 12:10:37.172 -03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)"]
2024-11-06 12:10:37.173 -03:00 [DBG] Executing controller factory for controller AuthServer.Users.UsersController (AuthServer)
2024-11-06 12:10:37.174 -03:00 [DBG] Executed controller factory for controller AuthServer.Users.UsersController (AuthServer)
2024-11-06 12:10:37.175 -03:00 [DBG] Attempting to bind parameter 'id' of type 'System.Int64' ...
2024-11-06 12:10:37.176 -03:00 [DBG] Attempting to bind parameter 'id' of type 'System.Int64' using the name 'id' in request data ...
2024-11-06 12:10:37.177 -03:00 [DBG] Done attempting to bind parameter 'id' of type 'System.Int64'.
2024-11-06 12:10:37.178 -03:00 [DBG] Done attempting to bind parameter 'id' of type 'System.Int64'.
2024-11-06 12:10:37.179 -03:00 [DBG] Attempting to validate the bound parameter 'id' of type 'System.Int64' ...
2024-11-06 12:10:37.179 -03:00 [DBG] Done attempting to validate the bound parameter 'id' of type 'System.Int64'.
2024-11-06 12:10:37.181 -03:00 [DBG] Entity Framework Core 8.0.10 initialized 'AuthServerContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:8.0.10' with options: None
2024-11-06 12:10:37.182 -03:00 [DBG] Creating DbConnection.
2024-11-06 12:10:37.183 -03:00 [DBG] Created DbConnection. (0ms).
2024-11-06 12:10:37.184 -03:00 [DBG] Opening connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 12:10:37.185 -03:00 [DBG] Opened connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 12:10:37.185 -03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2024-11-06 12:10:37.186 -03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2024-11-06 12:10:37.187 -03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2024-11-06 12:10:37.188 -03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[ID], [t].[Email], [t].[Name], [t].[Password], [t0].[RoleId], [t0].[UserId], [t0].[Long], [t0].[Name]
FROM (
    SELECT TOP(1) [u].[ID], [u].[Email], [u].[Name], [u].[Password]
    FROM [Users] AS [u]
    WHERE [u].[ID] = @__id_0
) AS [t]
LEFT JOIN (
    SELECT [u0].[RoleId], [u0].[UserId], [r].[Long], [r].[Name]
    FROM [UserRole] AS [u0]
    INNER JOIN [Roles] AS [r] ON [u0].[RoleId] = [r].[Long]
) AS [t0] ON [t].[ID] = [t0].[UserId]
ORDER BY [t].[ID], [t0].[RoleId], [t0].[UserId]
2024-11-06 12:10:37.191 -03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__id_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[ID], [t].[Email], [t].[Name], [t].[Password], [t0].[RoleId], [t0].[UserId], [t0].[Long], [t0].[Name]
FROM (
    SELECT TOP(1) [u].[ID], [u].[Email], [u].[Name], [u].[Password]
    FROM [Users] AS [u]
    WHERE [u].[ID] = @__id_0
) AS [t]
LEFT JOIN (
    SELECT [u0].[RoleId], [u0].[UserId], [r].[Long], [r].[Name]
    FROM [UserRole] AS [u0]
    INNER JOIN [Roles] AS [r] ON [u0].[RoleId] = [r].[Long]
) AS [t0] ON [t].[ID] = [t0].[UserId]
ORDER BY [t].[ID], [t0].[RoleId], [t0].[UserId]
2024-11-06 12:10:37.192 -03:00 [DBG] Context 'AuthServerContext' started tracking 'User' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 12:10:37.193 -03:00 [DBG] Context 'AuthServerContext' started tracking 'UserRole' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 12:10:37.194 -03:00 [DBG] Context 'AuthServerContext' started tracking 'Role' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 12:10:37.195 -03:00 [DBG] Closing data reader to 'AuthServer' on server 'localhost,1433'.
2024-11-06 12:10:37.196 -03:00 [DBG] A data reader for 'AuthServer' on server 'localhost,1433' is being disposed after spending 3ms reading results.
2024-11-06 12:10:37.197 -03:00 [DBG] Closing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 12:10:37.198 -03:00 [DBG] Closed connection to database 'AuthServer' on server 'localhost,1433' (0ms).
2024-11-06 12:10:37.199 -03:00 [DBG] Opening connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 12:10:37.200 -03:00 [DBG] Opened connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 12:10:37.201 -03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2024-11-06 12:10:37.201 -03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2024-11-06 12:10:37.202 -03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2024-11-06 12:10:37.203 -03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[ID], [u].[Email], [u].[Name], [u].[Password], [t].[RoleId], [t].[UserId], [t].[Long], [t].[Name]
FROM [Users] AS [u]
LEFT JOIN (
    SELECT [u0].[RoleId], [u0].[UserId], [r].[Long], [r].[Name]
    FROM [UserRole] AS [u0]
    INNER JOIN [Roles] AS [r] ON [u0].[RoleId] = [r].[Long]
) AS [t] ON [u].[ID] = [t].[UserId]
ORDER BY [u].[ID], [t].[RoleId], [t].[UserId]
2024-11-06 12:10:37.206 -03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[ID], [u].[Email], [u].[Name], [u].[Password], [t].[RoleId], [t].[UserId], [t].[Long], [t].[Name]
FROM [Users] AS [u]
LEFT JOIN (
    SELECT [u0].[RoleId], [u0].[UserId], [r].[Long], [r].[Name]
    FROM [UserRole] AS [u0]
    INNER JOIN [Roles] AS [r] ON [u0].[RoleId] = [r].[Long]
) AS [t] ON [u].[ID] = [t].[UserId]
ORDER BY [u].[ID], [t].[RoleId], [t].[UserId]
2024-11-06 12:10:37.207 -03:00 [DBG] Context 'AuthServerContext' started tracking 'User' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 12:10:37.208 -03:00 [DBG] Context 'AuthServerContext' started tracking 'UserRole' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 12:10:37.209 -03:00 [DBG] Context 'AuthServerContext' started tracking 'Role' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 12:10:37.210 -03:00 [DBG] Context 'AuthServerContext' started tracking 'User' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 12:10:37.211 -03:00 [DBG] Context 'AuthServerContext' started tracking 'UserRole' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 12:10:37.212 -03:00 [DBG] Closing data reader to 'AuthServer' on server 'localhost,1433'.
2024-11-06 12:10:37.213 -03:00 [DBG] A data reader for 'AuthServer' on server 'localhost,1433' is being disposed after spending 5ms reading results.
2024-11-06 12:10:37.213 -03:00 [DBG] Closing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 12:10:37.214 -03:00 [DBG] Closed connection to database 'AuthServer' on server 'localhost,1433' (0ms).
2024-11-06 12:10:37.215 -03:00 [WRN] Attempted to delete the last system admin. id=16
2024-11-06 12:10:37.218 -03:00 [INF] Executed action AuthServer.Users.UsersController.Delete (AuthServer) in 45.2585ms
2024-11-06 12:10:37.220 -03:00 [INF] Executed endpoint 'AuthServer.Users.UsersController.Delete (AuthServer)'
2024-11-06 12:10:37.221 -03:00 [DBG] Connection id "0HN7UE9PSO950" completed keep alive response.
2024-11-06 12:10:37.221 -03:00 [DBG] 'AuthServerContext' disposed.
2024-11-06 12:10:37.222 -03:00 [DBG] Disposing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 12:10:37.223 -03:00 [DBG] Disposed connection to database '' on server '' (0ms).
2024-11-06 12:10:37.224 -03:00 [INF] Request finished HTTP/1.1 DELETE https://localhost:7011/api/users/16 - 400 null null 70.042ms
2024-11-06 12:10:37.226 -03:00 [DBG] Connection id "0HN7UE9PSO950", Request id "0HN7UE9PSO950:00000003": started reading request body.
2024-11-06 12:10:37.227 -03:00 [DBG] Connection id "0HN7UE9PSO950", Request id "0HN7UE9PSO950:00000003": done reading request body.
2024-11-06 12:10:54.906 -03:00 [INF] Request starting HTTP/1.1 DELETE https://localhost:7011/api/users/31 - application/json 72
2024-11-06 12:10:54.908 -03:00 [DBG] 1 candidate(s) found for the request path '/api/users/31'
2024-11-06 12:10:54.909 -03:00 [DBG] Endpoint 'AuthServer.Users.UsersController.Delete (AuthServer)' with route pattern 'api/users/{id}' is valid for the request path '/api/users/31'
2024-11-06 12:10:54.910 -03:00 [DBG] Request matched endpoint 'AuthServer.Users.UsersController.Delete (AuthServer)'
2024-11-06 12:10:54.911 -03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2024-11-06 12:10:54.912 -03:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenSignatureKeyNotFoundException: IDX10517: Signature validation failed. The token's kid is missing. Keys tried: 'Microsoft.IdentityModel.Tokens.SymmetricSecurityKey, KeyId: '', InternalId: 'usxXQ1xbApZ07H2YlOD06P6caSPwoiLGyCgT6MUX9k8'. , KeyId: 
'. Number of keys in TokenValidationParameters: '1'. 
Number of keys in Configuration: '0'. 
Exceptions caught:
 '[PII of type 'System.String' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'.
token: '[PII of type 'Microsoft.IdentityModel.JsonWebTokens.JsonWebToken' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'. See https://aka.ms/IDX10503 for details.
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateSignature(JsonWebToken jwtToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateSignatureAndIssuerSecurityKey(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2024-11-06 12:10:54.914 -03:00 [INF] Bearer was not authenticated. Failure message: IDX10517: Signature validation failed. The token's kid is missing. Keys tried: 'Microsoft.IdentityModel.Tokens.SymmetricSecurityKey, KeyId: '', InternalId: 'usxXQ1xbApZ07H2YlOD06P6caSPwoiLGyCgT6MUX9k8'. , KeyId: 
'. Number of keys in TokenValidationParameters: '1'. 
Number of keys in Configuration: '0'. 
Exceptions caught:
 '[PII of type 'System.String' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'.
token: '[PII of type 'Microsoft.IdentityModel.JsonWebTokens.JsonWebToken' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'. See https://aka.ms/IDX10503 for details.
2024-11-06 12:10:54.915 -03:00 [DBG] Authorization was successful.
2024-11-06 12:10:54.916 -03:00 [INF] Executing endpoint 'AuthServer.Users.UsersController.Delete (AuthServer)'
2024-11-06 12:10:54.916 -03:00 [INF] Route matched with {action = "Delete", controller = "Users"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult Delete(Int64) on controller AuthServer.Users.UsersController (AuthServer).
2024-11-06 12:10:54.918 -03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2024-11-06 12:10:54.919 -03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2024-11-06 12:10:54.920 -03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)"]
2024-11-06 12:10:54.921 -03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2024-11-06 12:10:54.922 -03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)"]
2024-11-06 12:10:54.923 -03:00 [DBG] Executing controller factory for controller AuthServer.Users.UsersController (AuthServer)
2024-11-06 12:10:54.924 -03:00 [DBG] Executed controller factory for controller AuthServer.Users.UsersController (AuthServer)
2024-11-06 12:10:54.925 -03:00 [DBG] Attempting to bind parameter 'id' of type 'System.Int64' ...
2024-11-06 12:10:54.926 -03:00 [DBG] Attempting to bind parameter 'id' of type 'System.Int64' using the name 'id' in request data ...
2024-11-06 12:10:54.927 -03:00 [DBG] Done attempting to bind parameter 'id' of type 'System.Int64'.
2024-11-06 12:10:54.928 -03:00 [DBG] Done attempting to bind parameter 'id' of type 'System.Int64'.
2024-11-06 12:10:54.929 -03:00 [DBG] Attempting to validate the bound parameter 'id' of type 'System.Int64' ...
2024-11-06 12:10:54.930 -03:00 [DBG] Done attempting to validate the bound parameter 'id' of type 'System.Int64'.
2024-11-06 12:10:54.931 -03:00 [DBG] Entity Framework Core 8.0.10 initialized 'AuthServerContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:8.0.10' with options: None
2024-11-06 12:10:54.932 -03:00 [DBG] Creating DbConnection.
2024-11-06 12:10:54.933 -03:00 [DBG] Created DbConnection. (0ms).
2024-11-06 12:10:54.934 -03:00 [DBG] Opening connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 12:10:54.935 -03:00 [DBG] Opened connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 12:10:54.936 -03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2024-11-06 12:10:54.937 -03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2024-11-06 12:10:54.937 -03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2024-11-06 12:10:54.938 -03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[ID], [t].[Email], [t].[Name], [t].[Password], [t0].[RoleId], [t0].[UserId], [t0].[Long], [t0].[Name]
FROM (
    SELECT TOP(1) [u].[ID], [u].[Email], [u].[Name], [u].[Password]
    FROM [Users] AS [u]
    WHERE [u].[ID] = @__id_0
) AS [t]
LEFT JOIN (
    SELECT [u0].[RoleId], [u0].[UserId], [r].[Long], [r].[Name]
    FROM [UserRole] AS [u0]
    INNER JOIN [Roles] AS [r] ON [u0].[RoleId] = [r].[Long]
) AS [t0] ON [t].[ID] = [t0].[UserId]
ORDER BY [t].[ID], [t0].[RoleId], [t0].[UserId]
2024-11-06 12:10:54.941 -03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__id_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[ID], [t].[Email], [t].[Name], [t].[Password], [t0].[RoleId], [t0].[UserId], [t0].[Long], [t0].[Name]
FROM (
    SELECT TOP(1) [u].[ID], [u].[Email], [u].[Name], [u].[Password]
    FROM [Users] AS [u]
    WHERE [u].[ID] = @__id_0
) AS [t]
LEFT JOIN (
    SELECT [u0].[RoleId], [u0].[UserId], [r].[Long], [r].[Name]
    FROM [UserRole] AS [u0]
    INNER JOIN [Roles] AS [r] ON [u0].[RoleId] = [r].[Long]
) AS [t0] ON [t].[ID] = [t0].[UserId]
ORDER BY [t].[ID], [t0].[RoleId], [t0].[UserId]
2024-11-06 12:10:54.943 -03:00 [DBG] Context 'AuthServerContext' started tracking 'User' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 12:10:54.944 -03:00 [DBG] Context 'AuthServerContext' started tracking 'UserRole' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 12:10:54.945 -03:00 [DBG] Context 'AuthServerContext' started tracking 'Role' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 12:10:54.946 -03:00 [DBG] Closing data reader to 'AuthServer' on server 'localhost,1433'.
2024-11-06 12:10:54.947 -03:00 [DBG] A data reader for 'AuthServer' on server 'localhost,1433' is being disposed after spending 3ms reading results.
2024-11-06 12:10:54.948 -03:00 [DBG] Closing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 12:10:54.949 -03:00 [DBG] Closed connection to database 'AuthServer' on server 'localhost,1433' (0ms).
2024-11-06 12:10:54.950 -03:00 [DBG] An entity of type 'User' tracked by 'AuthServerContext' changed state from '"Unchanged"' to '"Deleted"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 12:10:54.957 -03:00 [DBG] A cascade state change of an entity of type 'UserRole' to '"Deleted"' occurred due to deletion of its parent entity of type 'User'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 12:10:54.958 -03:00 [DBG] An entity of type 'UserRole' tracked by 'AuthServerContext' changed state from '"Unchanged"' to '"Deleted"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 12:10:54.959 -03:00 [DBG] SaveChanges starting for 'AuthServerContext'.
2024-11-06 12:10:54.959 -03:00 [DBG] DetectChanges starting for 'AuthServerContext'.
2024-11-06 12:10:54.960 -03:00 [DBG] DetectChanges completed for 'AuthServerContext'.
2024-11-06 12:10:54.967 -03:00 [DBG] Executing 2 update commands as a batch.
2024-11-06 12:10:54.969 -03:00 [DBG] Opening connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 12:10:54.970 -03:00 [DBG] Opened connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 12:10:54.972 -03:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2024-11-06 12:10:54.977 -03:00 [DBG] Began transaction with isolation level 'ReadCommitted'.
2024-11-06 12:10:54.978 -03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2024-11-06 12:10:54.979 -03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2024-11-06 12:10:54.981 -03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (2ms).
2024-11-06 12:10:54.982 -03:00 [DBG] Executing DbCommand [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = Int64), @p2='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
DELETE FROM [UserRole]
OUTPUT 1
WHERE [RoleId] = @p0 AND [UserId] = @p1;
DELETE FROM [Users]
OUTPUT 1
WHERE [ID] = @p2;
2024-11-06 12:10:54.991 -03:00 [INF] Executed DbCommand (9ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = Int64), @p2='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
DELETE FROM [UserRole]
OUTPUT 1
WHERE [RoleId] = @p0 AND [UserId] = @p1;
DELETE FROM [Users]
OUTPUT 1
WHERE [ID] = @p2;
2024-11-06 12:10:54.993 -03:00 [DBG] Closing data reader to 'AuthServer' on server 'localhost,1433'.
2024-11-06 12:10:54.993 -03:00 [DBG] A data reader for 'AuthServer' on server 'localhost,1433' is being disposed after spending 1ms reading results.
2024-11-06 12:10:54.995 -03:00 [DBG] Committing transaction.
2024-11-06 12:10:55.001 -03:00 [DBG] Committed transaction.
2024-11-06 12:10:55.002 -03:00 [DBG] Closing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 12:10:55.003 -03:00 [DBG] Closed connection to database 'AuthServer' on server 'localhost,1433' (1ms).
2024-11-06 12:10:55.004 -03:00 [DBG] Disposing transaction.
2024-11-06 12:10:55.007 -03:00 [DBG] An entity of type 'User' tracked by 'AuthServerContext' changed state from '"Deleted"' to '"Detached"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 12:10:55.009 -03:00 [DBG] An entity of type 'UserRole' tracked by 'AuthServerContext' changed state from '"Deleted"' to '"Detached"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 12:10:55.010 -03:00 [DBG] SaveChanges completed for 'AuthServerContext' with 2 entities written to the database.
2024-11-06 12:10:55.011 -03:00 [WRN] User deleted. id=31 name=Luiza Silva
2024-11-06 12:10:55.012 -03:00 [INF] Executing StatusCodeResult, setting HTTP status code 200
2024-11-06 12:10:55.012 -03:00 [INF] Executed action AuthServer.Users.UsersController.Delete (AuthServer) in 89.0216ms
2024-11-06 12:10:55.013 -03:00 [INF] Executed endpoint 'AuthServer.Users.UsersController.Delete (AuthServer)'
2024-11-06 12:10:55.014 -03:00 [DBG] Connection id "0HN7UE9PSO950" completed keep alive response.
2024-11-06 12:10:55.015 -03:00 [DBG] 'AuthServerContext' disposed.
2024-11-06 12:10:55.016 -03:00 [DBG] Disposing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 12:10:55.016 -03:00 [DBG] Disposed connection to database '' on server '' (0ms).
2024-11-06 12:10:55.018 -03:00 [INF] Request finished HTTP/1.1 DELETE https://localhost:7011/api/users/31 - 200 0 null 111.4506ms
2024-11-06 12:10:55.020 -03:00 [DBG] Connection id "0HN7UE9PSO950", Request id "0HN7UE9PSO950:00000004": started reading request body.
2024-11-06 12:10:55.020 -03:00 [DBG] Connection id "0HN7UE9PSO950", Request id "0HN7UE9PSO950:00000004": done reading request body.
2024-11-06 12:11:15.179 -03:00 [INF] Request starting HTTP/1.1 GET https://localhost:7011/api/users/me - application/json 72
2024-11-06 12:11:15.181 -03:00 [DBG] 2 candidate(s) found for the request path '/api/users/me'
2024-11-06 12:11:15.182 -03:00 [DBG] Endpoint 'AuthServer.Users.UsersController.GetSelf (AuthServer)' with route pattern 'api/users/me' is valid for the request path '/api/users/me'
2024-11-06 12:11:15.183 -03:00 [DBG] Endpoint 'AuthServer.Users.UsersController.GetUser (AuthServer)' with route pattern 'api/users/{id}' is valid for the request path '/api/users/me'
2024-11-06 12:11:15.185 -03:00 [DBG] Request matched endpoint 'AuthServer.Users.UsersController.GetSelf (AuthServer)'
2024-11-06 12:11:15.186 -03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2024-11-06 12:11:15.187 -03:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenSignatureKeyNotFoundException: IDX10517: Signature validation failed. The token's kid is missing. Keys tried: 'Microsoft.IdentityModel.Tokens.SymmetricSecurityKey, KeyId: '', InternalId: 'usxXQ1xbApZ07H2YlOD06P6caSPwoiLGyCgT6MUX9k8'. , KeyId: 
'. Number of keys in TokenValidationParameters: '1'. 
Number of keys in Configuration: '0'. 
Exceptions caught:
 '[PII of type 'System.String' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'.
token: '[PII of type 'Microsoft.IdentityModel.JsonWebTokens.JsonWebToken' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'. See https://aka.ms/IDX10503 for details.
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateSignature(JsonWebToken jwtToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateSignatureAndIssuerSecurityKey(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2024-11-06 12:11:15.189 -03:00 [INF] Bearer was not authenticated. Failure message: IDX10517: Signature validation failed. The token's kid is missing. Keys tried: 'Microsoft.IdentityModel.Tokens.SymmetricSecurityKey, KeyId: '', InternalId: 'usxXQ1xbApZ07H2YlOD06P6caSPwoiLGyCgT6MUX9k8'. , KeyId: 
'. Number of keys in TokenValidationParameters: '1'. 
Number of keys in Configuration: '0'. 
Exceptions caught:
 '[PII of type 'System.String' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'.
token: '[PII of type 'Microsoft.IdentityModel.JsonWebTokens.JsonWebToken' is hidden. For more details, see https://aka.ms/IdentityModel/PII.]'. See https://aka.ms/IDX10503 for details.
2024-11-06 12:11:15.190 -03:00 [DBG] Authorization was successful.
2024-11-06 12:11:15.191 -03:00 [INF] Executing endpoint 'AuthServer.Users.UsersController.GetSelf (AuthServer)'
2024-11-06 12:11:15.192 -03:00 [INF] Route matched with {action = "GetSelf", controller = "Users"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult GetSelf() on controller AuthServer.Users.UsersController (AuthServer).
2024-11-06 12:11:15.194 -03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2024-11-06 12:11:15.195 -03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2024-11-06 12:11:15.196 -03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)"]
2024-11-06 12:11:15.197 -03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2024-11-06 12:11:15.198 -03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)"]
2024-11-06 12:11:15.199 -03:00 [DBG] Executing controller factory for controller AuthServer.Users.UsersController (AuthServer)
2024-11-06 12:11:15.200 -03:00 [DBG] Executed controller factory for controller AuthServer.Users.UsersController (AuthServer)
2024-11-06 12:11:15.202 -03:00 [DBG] Entity Framework Core 8.0.10 initialized 'AuthServerContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:8.0.10' with options: None
2024-11-06 12:11:15.203 -03:00 [DBG] Creating DbConnection.
2024-11-06 12:11:15.204 -03:00 [DBG] Created DbConnection. (0ms).
2024-11-06 12:11:15.205 -03:00 [DBG] Opening connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 12:11:15.206 -03:00 [DBG] Opened connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 12:11:15.207 -03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2024-11-06 12:11:15.208 -03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2024-11-06 12:11:15.209 -03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2024-11-06 12:11:15.209 -03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[ID], [t].[Email], [t].[Name], [t].[Password], [t0].[RoleId], [t0].[UserId], [t0].[Long], [t0].[Name]
FROM (
    SELECT TOP(1) [u].[ID], [u].[Email], [u].[Name], [u].[Password]
    FROM [Users] AS [u]
    WHERE [u].[ID] = @__id_0
) AS [t]
LEFT JOIN (
    SELECT [u0].[RoleId], [u0].[UserId], [r].[Long], [r].[Name]
    FROM [UserRole] AS [u0]
    INNER JOIN [Roles] AS [r] ON [u0].[RoleId] = [r].[Long]
) AS [t0] ON [t].[ID] = [t0].[UserId]
ORDER BY [t].[ID], [t0].[RoleId], [t0].[UserId]
2024-11-06 12:11:15.212 -03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__id_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[ID], [t].[Email], [t].[Name], [t].[Password], [t0].[RoleId], [t0].[UserId], [t0].[Long], [t0].[Name]
FROM (
    SELECT TOP(1) [u].[ID], [u].[Email], [u].[Name], [u].[Password]
    FROM [Users] AS [u]
    WHERE [u].[ID] = @__id_0
) AS [t]
LEFT JOIN (
    SELECT [u0].[RoleId], [u0].[UserId], [r].[Long], [r].[Name]
    FROM [UserRole] AS [u0]
    INNER JOIN [Roles] AS [r] ON [u0].[RoleId] = [r].[Long]
) AS [t0] ON [t].[ID] = [t0].[UserId]
ORDER BY [t].[ID], [t0].[RoleId], [t0].[UserId]
2024-11-06 12:11:15.214 -03:00 [DBG] Context 'AuthServerContext' started tracking 'User' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 12:11:15.215 -03:00 [DBG] Context 'AuthServerContext' started tracking 'UserRole' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 12:11:15.216 -03:00 [DBG] Context 'AuthServerContext' started tracking 'Role' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 12:11:15.217 -03:00 [DBG] Closing data reader to 'AuthServer' on server 'localhost,1433'.
2024-11-06 12:11:15.218 -03:00 [DBG] A data reader for 'AuthServer' on server 'localhost,1433' is being disposed after spending 4ms reading results.
2024-11-06 12:11:15.219 -03:00 [DBG] Closing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 12:11:15.220 -03:00 [DBG] Closed connection to database 'AuthServer' on server 'localhost,1433' (0ms).
2024-11-06 12:11:15.222 -03:00 [DBG] List of registered output formatters, in the following order: ["Microsoft.AspNetCore.Mvc.Formatters.HttpNoContentOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StringOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StreamOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter"]
2024-11-06 12:11:15.223 -03:00 [DBG] No information found on request to perform content negotiation.
2024-11-06 12:11:15.224 -03:00 [DBG] Attempting to select an output formatter without using a content type as no explicit content types were specified for the response.
2024-11-06 12:11:15.224 -03:00 [DBG] Attempting to select the first formatter in the output formatters list which can write the result.
2024-11-06 12:11:15.225 -03:00 [DBG] Selected output formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter' and content type 'application/json' to write the response.
2024-11-06 12:11:15.226 -03:00 [INF] Executing OkObjectResult, writing value of type 'AuthServer.Users.responses.UserResponse'.
2024-11-06 12:11:15.227 -03:00 [INF] Executed action AuthServer.Users.UsersController.GetSelf (AuthServer) in 28.0647ms
2024-11-06 12:11:15.228 -03:00 [INF] Executed endpoint 'AuthServer.Users.UsersController.GetSelf (AuthServer)'
2024-11-06 12:11:15.229 -03:00 [DBG] Connection id "0HN7UE9PSO950" completed keep alive response.
2024-11-06 12:11:15.229 -03:00 [DBG] 'AuthServerContext' disposed.
2024-11-06 12:11:15.230 -03:00 [DBG] Disposing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 12:11:15.231 -03:00 [DBG] Disposed connection to database '' on server '' (0ms).
2024-11-06 12:11:15.232 -03:00 [INF] Request finished HTTP/1.1 GET https://localhost:7011/api/users/me - 200 null application/json; charset=utf-8 52.906ms
2024-11-06 12:11:15.234 -03:00 [DBG] Connection id "0HN7UE9PSO950", Request id "0HN7UE9PSO950:00000005": started reading request body.
2024-11-06 12:11:15.235 -03:00 [DBG] Connection id "0HN7UE9PSO950", Request id "0HN7UE9PSO950:00000005": done reading request body.
2024-11-06 12:11:23.620 -03:00 [INF] Request starting HTTP/1.1 GET https://localhost:7011/api/users/me - application/json 72
2024-11-06 12:11:23.622 -03:00 [DBG] 2 candidate(s) found for the request path '/api/users/me'
2024-11-06 12:11:23.623 -03:00 [DBG] Endpoint 'AuthServer.Users.UsersController.GetSelf (AuthServer)' with route pattern 'api/users/me' is valid for the request path '/api/users/me'
2024-11-06 12:11:23.624 -03:00 [DBG] Endpoint 'AuthServer.Users.UsersController.GetUser (AuthServer)' with route pattern 'api/users/{id}' is valid for the request path '/api/users/me'
2024-11-06 12:11:23.626 -03:00 [DBG] Request matched endpoint 'AuthServer.Users.UsersController.GetSelf (AuthServer)'
2024-11-06 12:11:23.626 -03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2024-11-06 12:11:23.627 -03:00 [DBG] AuthenticationScheme: Bearer was not authenticated.
2024-11-06 12:11:23.628 -03:00 [DBG] Policy authentication schemes  did not succeed
2024-11-06 12:11:23.628 -03:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2024-11-06 12:11:23.629 -03:00 [INF] AuthenticationScheme: Bearer was challenged.
2024-11-06 12:11:23.630 -03:00 [DBG] Connection id "0HN7UE9PSO950" completed keep alive response.
2024-11-06 12:11:23.631 -03:00 [INF] Request finished HTTP/1.1 GET https://localhost:7011/api/users/me - 401 0 null 10.4736ms
2024-11-06 12:11:23.633 -03:00 [DBG] Connection id "0HN7UE9PSO950", Request id "0HN7UE9PSO950:00000006": started reading request body.
2024-11-06 12:11:23.634 -03:00 [DBG] Connection id "0HN7UE9PSO950", Request id "0HN7UE9PSO950:00000006": done reading request body.
2024-11-06 12:13:34.367 -03:00 [DBG] Connection id "0HN7UE9PSO950" disconnecting.
2024-11-06 12:13:34.369 -03:00 [DBG] Connection id "0HN7UE9PSO950" stopped.
2024-11-06 12:13:34.369 -03:00 [DBG] Connection id "0HN7UE9PSO950" sending FIN because: "The Socket transport's send loop completed gracefully."
2024-11-06 12:21:27.147 -03:00 [DBG] Config reload token fired. Checking for changes...
2024-11-06 12:21:27.414 -03:00 [DBG] Config reload token fired. Checking for changes...
2024-11-06 23:11:58.979 -03:00 [INF] Aplicação iniciada - configuração de logs inicializada.
2024-11-06 23:11:59.133 -03:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2024-11-06 23:11:59.166 -03:00 [DBG] Hosting starting
2024-11-06 23:11:59.176 -03:00 [INF] User profile is available. Using 'C:\Users\gusta\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2024-11-06 23:11:59.181 -03:00 [DBG] Reading data from file 'C:\Users\gusta\AppData\Local\ASP.NET\DataProtection-Keys\key-bf4636f6-ef08-4ac9-8613-5c8299c406a4.xml'.
2024-11-06 23:11:59.186 -03:00 [DBG] Found key {bf4636f6-ef08-4ac9-8613-5c8299c406a4}.
2024-11-06 23:11:59.191 -03:00 [DBG] Considering key {bf4636f6-ef08-4ac9-8613-5c8299c406a4} with expiration date 2025-02-02 14:46:39Z as default key.
2024-11-06 23:11:59.193 -03:00 [DBG] Forwarded activator type request from Microsoft.AspNetCore.DataProtection.XmlEncryption.DpapiXmlDecryptor, Microsoft.AspNetCore.DataProtection, Version=8.0.0.0, Culture=neutral, PublicKeyToken=adb9793829ddae60 to Microsoft.AspNetCore.DataProtection.XmlEncryption.DpapiXmlDecryptor, Microsoft.AspNetCore.DataProtection, Culture=neutral, PublicKeyToken=adb9793829ddae60
2024-11-06 23:11:59.194 -03:00 [DBG] Decrypting secret element using Windows DPAPI.
2024-11-06 23:11:59.196 -03:00 [DBG] Forwarded activator type request from Microsoft.AspNetCore.DataProtection.AuthenticatedEncryption.ConfigurationModel.AuthenticatedEncryptorDescriptorDeserializer, Microsoft.AspNetCore.DataProtection, Version=8.0.0.0, Culture=neutral, PublicKeyToken=adb9793829ddae60 to Microsoft.AspNetCore.DataProtection.AuthenticatedEncryption.ConfigurationModel.AuthenticatedEncryptorDescriptorDeserializer, Microsoft.AspNetCore.DataProtection, Culture=neutral, PublicKeyToken=adb9793829ddae60
2024-11-06 23:11:59.199 -03:00 [DBG] Opening CNG algorithm 'AES' from provider 'null' with chaining mode CBC.
2024-11-06 23:11:59.200 -03:00 [DBG] Opening CNG algorithm 'SHA256' from provider 'null' with HMAC.
2024-11-06 23:11:59.202 -03:00 [DBG] Using key {bf4636f6-ef08-4ac9-8613-5c8299c406a4} as the default key.
2024-11-06 23:11:59.203 -03:00 [DBG] Key ring with default key {bf4636f6-ef08-4ac9-8613-5c8299c406a4} was loaded during application startup.
2024-11-06 23:11:59.256 -03:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2024-11-06 23:11:59.490 -03:00 [DBG] The index {'RoleId'} was not created on entity type 'UserRole (Dictionary<string, object>)' as the properties are already covered by the index {'RoleId', 'UserId'}.
2024-11-06 23:11:59.615 -03:00 [DBG] Entity Framework Core 8.0.10 initialized 'AuthServerContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:8.0.10' with options: None
2024-11-06 23:11:59.644 -03:00 [DBG] Compiling query expression: 
'DbSet<Role>()
    .Count()'
2024-11-06 23:11:59.744 -03:00 [DBG] Generated query execution expression: 
'queryContext => new SingleQueryingEnumerable<int>(
    (RelationalQueryContext)queryContext, 
    RelationalCommandCache.QueryExpression(
        Projection Mapping:
            EmptyProjectionMember -> 0
        SELECT COUNT(*)
        FROM Roles AS r), 
    null, 
    Func<QueryContext, DbDataReader, ResultContext, SingleQueryResultCoordinator, int>, 
    AuthServer.AuthServerContext, 
    False, 
    False, 
    True
)
    .Single()'
2024-11-06 23:11:59.759 -03:00 [DBG] Creating DbConnection.
2024-11-06 23:11:59.770 -03:00 [DBG] Created DbConnection. (10ms).
2024-11-06 23:11:59.772 -03:00 [DBG] Opening connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 23:12:16.846 -03:00 [ERR] An error occurred using the connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 23:12:16.856 -03:00 [ERR] An exception occurred while iterating over the results of a query for context type 'AuthServer.AuthServerContext'.
Microsoft.Data.SqlClient.SqlException (0x80131904): A network-related or instance-specific error occurred while establishing a connection to SQL Server. The server was not found or was not accessible. Verify that the instance name is correct and that SQL Server is configured to allow remote connections. (provider: TCP Provider, error: 0 - Nenhuma conexão pôde ser feita porque a máquina de destino as recusou ativamente.)
 ---> System.ComponentModel.Win32Exception (10061): Nenhuma conexão pôde ser feita porque a máquina de destino as recusou ativamente.
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.Connect(ServerInfo serverInfo, SqlInternalConnectionTds connHandler, Boolean ignoreSniOpenTimeout, Int64 timerExpire, SqlConnectionString connectionOptions, Boolean withFailover)
   at Microsoft.Data.SqlClient.SqlInternalConnectionTds.AttemptOneLogin(ServerInfo serverInfo, String newPassword, SecureString newSecurePassword, Boolean ignoreSniOpenTimeout, TimeoutTimer timeout, Boolean withFailover)
   at Microsoft.Data.SqlClient.SqlInternalConnectionTds.LoginNoFailover(ServerInfo serverInfo, String newPassword, SecureString newSecurePassword, Boolean redirectedUserInstance, SqlConnectionString connectionOptions, SqlCredential credential, TimeoutTimer timeout)
   at Microsoft.Data.SqlClient.SqlInternalConnectionTds.OpenLoginEnlist(TimeoutTimer timeout, SqlConnectionString connectionOptions, SqlCredential credential, String newPassword, SecureString newSecurePassword, Boolean redirectedUserInstance)
   at Microsoft.Data.SqlClient.SqlInternalConnectionTds..ctor(DbConnectionPoolIdentity identity, SqlConnectionString connectionOptions, SqlCredential credential, Object providerInfo, String newPassword, SecureString newSecurePassword, Boolean redirectedUserInstance, SqlConnectionString userConnectionOptions, SessionData reconnectSessionData, Boolean applyTransientFaultHandling, String accessToken, DbConnectionPool pool)
   at Microsoft.Data.SqlClient.SqlConnectionFactory.CreateConnection(DbConnectionOptions options, DbConnectionPoolKey poolKey, Object poolGroupProviderInfo, DbConnectionPool pool, DbConnection owningConnection, DbConnectionOptions userOptions)
   at Microsoft.Data.ProviderBase.DbConnectionFactory.CreatePooledConnection(DbConnectionPool pool, DbConnection owningObject, DbConnectionOptions options, DbConnectionPoolKey poolKey, DbConnectionOptions userOptions)
   at Microsoft.Data.ProviderBase.DbConnectionPool.CreateObject(DbConnection owningObject, DbConnectionOptions userOptions, DbConnectionInternal oldConnection)
   at Microsoft.Data.ProviderBase.DbConnectionPool.UserCreateRequest(DbConnection owningObject, DbConnectionOptions userOptions, DbConnectionInternal oldConnection)
   at Microsoft.Data.ProviderBase.DbConnectionPool.TryGetConnection(DbConnection owningObject, UInt32 waitForMultipleObjectsTimeout, Boolean allowCreate, Boolean onlyOneCheckConnection, DbConnectionOptions userOptions, DbConnectionInternal& connection)
   at Microsoft.Data.ProviderBase.DbConnectionPool.TryGetConnection(DbConnection owningObject, TaskCompletionSource`1 retry, DbConnectionOptions userOptions, DbConnectionInternal& connection)
   at Microsoft.Data.ProviderBase.DbConnectionFactory.TryGetConnection(DbConnection owningConnection, TaskCompletionSource`1 retry, DbConnectionOptions userOptions, DbConnectionInternal oldConnection, DbConnectionInternal& connection)
   at Microsoft.Data.ProviderBase.DbConnectionInternal.TryOpenConnectionInternal(DbConnection outerConnection, DbConnectionFactory connectionFactory, TaskCompletionSource`1 retry, DbConnectionOptions userOptions)
   at Microsoft.Data.ProviderBase.DbConnectionClosed.TryOpenConnection(DbConnection outerConnection, DbConnectionFactory connectionFactory, TaskCompletionSource`1 retry, DbConnectionOptions userOptions)
   at Microsoft.Data.SqlClient.SqlConnection.TryOpen(TaskCompletionSource`1 retry, SqlConnectionOverrides overrides)
   at Microsoft.Data.SqlClient.SqlConnection.Open(SqlConnectionOverrides overrides)
   at Microsoft.Data.SqlClient.SqlConnection.Open()
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerConnection.OpenDbConnection(Boolean errorsExpected)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternal(Boolean errorsExpected)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.Open(Boolean errorsExpected)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReader(RelationalCommandParameterObject parameterObject)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.Enumerator.InitializeReader(Enumerator enumerator)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.Enumerator.<>c.<MoveNext>b__21_0(DbContext _, Enumerator enumerator)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.Execute[TState,TResult](TState state, Func`3 operation, Func`3 verifySucceeded)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.Enumerator.MoveNext()
ClientConnectionId:00000000-0000-0000-0000-000000000000
Error Number:10061,State:0,Class:20
Microsoft.Data.SqlClient.SqlException (0x80131904): A network-related or instance-specific error occurred while establishing a connection to SQL Server. The server was not found or was not accessible. Verify that the instance name is correct and that SQL Server is configured to allow remote connections. (provider: TCP Provider, error: 0 - Nenhuma conexão pôde ser feita porque a máquina de destino as recusou ativamente.)
 ---> System.ComponentModel.Win32Exception (10061): Nenhuma conexão pôde ser feita porque a máquina de destino as recusou ativamente.
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.Connect(ServerInfo serverInfo, SqlInternalConnectionTds connHandler, Boolean ignoreSniOpenTimeout, Int64 timerExpire, SqlConnectionString connectionOptions, Boolean withFailover)
   at Microsoft.Data.SqlClient.SqlInternalConnectionTds.AttemptOneLogin(ServerInfo serverInfo, String newPassword, SecureString newSecurePassword, Boolean ignoreSniOpenTimeout, TimeoutTimer timeout, Boolean withFailover)
   at Microsoft.Data.SqlClient.SqlInternalConnectionTds.LoginNoFailover(ServerInfo serverInfo, String newPassword, SecureString newSecurePassword, Boolean redirectedUserInstance, SqlConnectionString connectionOptions, SqlCredential credential, TimeoutTimer timeout)
   at Microsoft.Data.SqlClient.SqlInternalConnectionTds.OpenLoginEnlist(TimeoutTimer timeout, SqlConnectionString connectionOptions, SqlCredential credential, String newPassword, SecureString newSecurePassword, Boolean redirectedUserInstance)
   at Microsoft.Data.SqlClient.SqlInternalConnectionTds..ctor(DbConnectionPoolIdentity identity, SqlConnectionString connectionOptions, SqlCredential credential, Object providerInfo, String newPassword, SecureString newSecurePassword, Boolean redirectedUserInstance, SqlConnectionString userConnectionOptions, SessionData reconnectSessionData, Boolean applyTransientFaultHandling, String accessToken, DbConnectionPool pool)
   at Microsoft.Data.SqlClient.SqlConnectionFactory.CreateConnection(DbConnectionOptions options, DbConnectionPoolKey poolKey, Object poolGroupProviderInfo, DbConnectionPool pool, DbConnection owningConnection, DbConnectionOptions userOptions)
   at Microsoft.Data.ProviderBase.DbConnectionFactory.CreatePooledConnection(DbConnectionPool pool, DbConnection owningObject, DbConnectionOptions options, DbConnectionPoolKey poolKey, DbConnectionOptions userOptions)
   at Microsoft.Data.ProviderBase.DbConnectionPool.CreateObject(DbConnection owningObject, DbConnectionOptions userOptions, DbConnectionInternal oldConnection)
   at Microsoft.Data.ProviderBase.DbConnectionPool.UserCreateRequest(DbConnection owningObject, DbConnectionOptions userOptions, DbConnectionInternal oldConnection)
   at Microsoft.Data.ProviderBase.DbConnectionPool.TryGetConnection(DbConnection owningObject, UInt32 waitForMultipleObjectsTimeout, Boolean allowCreate, Boolean onlyOneCheckConnection, DbConnectionOptions userOptions, DbConnectionInternal& connection)
   at Microsoft.Data.ProviderBase.DbConnectionPool.TryGetConnection(DbConnection owningObject, TaskCompletionSource`1 retry, DbConnectionOptions userOptions, DbConnectionInternal& connection)
   at Microsoft.Data.ProviderBase.DbConnectionFactory.TryGetConnection(DbConnection owningConnection, TaskCompletionSource`1 retry, DbConnectionOptions userOptions, DbConnectionInternal oldConnection, DbConnectionInternal& connection)
   at Microsoft.Data.ProviderBase.DbConnectionInternal.TryOpenConnectionInternal(DbConnection outerConnection, DbConnectionFactory connectionFactory, TaskCompletionSource`1 retry, DbConnectionOptions userOptions)
   at Microsoft.Data.ProviderBase.DbConnectionClosed.TryOpenConnection(DbConnection outerConnection, DbConnectionFactory connectionFactory, TaskCompletionSource`1 retry, DbConnectionOptions userOptions)
   at Microsoft.Data.SqlClient.SqlConnection.TryOpen(TaskCompletionSource`1 retry, SqlConnectionOverrides overrides)
   at Microsoft.Data.SqlClient.SqlConnection.Open(SqlConnectionOverrides overrides)
   at Microsoft.Data.SqlClient.SqlConnection.Open()
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerConnection.OpenDbConnection(Boolean errorsExpected)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternal(Boolean errorsExpected)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.Open(Boolean errorsExpected)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReader(RelationalCommandParameterObject parameterObject)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.Enumerator.InitializeReader(Enumerator enumerator)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.Enumerator.<>c.<MoveNext>b__21_0(DbContext _, Enumerator enumerator)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.Execute[TState,TResult](TState state, Func`3 operation, Func`3 verifySucceeded)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.Enumerator.MoveNext()
ClientConnectionId:00000000-0000-0000-0000-000000000000
Error Number:10061,State:0,Class:20
2024-11-06 23:12:16.865 -03:00 [DBG] 'AuthServerContext' disposed.
2024-11-06 23:12:16.867 -03:00 [DBG] Disposing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 23:12:16.871 -03:00 [DBG] Disposed connection to database '' on server '' (1ms).
2024-11-06 23:12:16.872 -03:00 [ERR] Hosting failed to start
Microsoft.Data.SqlClient.SqlException (0x80131904): A network-related or instance-specific error occurred while establishing a connection to SQL Server. The server was not found or was not accessible. Verify that the instance name is correct and that SQL Server is configured to allow remote connections. (provider: TCP Provider, error: 0 - Nenhuma conexão pôde ser feita porque a máquina de destino as recusou ativamente.)
 ---> System.ComponentModel.Win32Exception (10061): Nenhuma conexão pôde ser feita porque a máquina de destino as recusou ativamente.
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.Connect(ServerInfo serverInfo, SqlInternalConnectionTds connHandler, Boolean ignoreSniOpenTimeout, Int64 timerExpire, SqlConnectionString connectionOptions, Boolean withFailover)
   at Microsoft.Data.SqlClient.SqlInternalConnectionTds.AttemptOneLogin(ServerInfo serverInfo, String newPassword, SecureString newSecurePassword, Boolean ignoreSniOpenTimeout, TimeoutTimer timeout, Boolean withFailover)
   at Microsoft.Data.SqlClient.SqlInternalConnectionTds.LoginNoFailover(ServerInfo serverInfo, String newPassword, SecureString newSecurePassword, Boolean redirectedUserInstance, SqlConnectionString connectionOptions, SqlCredential credential, TimeoutTimer timeout)
   at Microsoft.Data.SqlClient.SqlInternalConnectionTds.OpenLoginEnlist(TimeoutTimer timeout, SqlConnectionString connectionOptions, SqlCredential credential, String newPassword, SecureString newSecurePassword, Boolean redirectedUserInstance)
   at Microsoft.Data.SqlClient.SqlInternalConnectionTds..ctor(DbConnectionPoolIdentity identity, SqlConnectionString connectionOptions, SqlCredential credential, Object providerInfo, String newPassword, SecureString newSecurePassword, Boolean redirectedUserInstance, SqlConnectionString userConnectionOptions, SessionData reconnectSessionData, Boolean applyTransientFaultHandling, String accessToken, DbConnectionPool pool)
   at Microsoft.Data.SqlClient.SqlConnectionFactory.CreateConnection(DbConnectionOptions options, DbConnectionPoolKey poolKey, Object poolGroupProviderInfo, DbConnectionPool pool, DbConnection owningConnection, DbConnectionOptions userOptions)
   at Microsoft.Data.ProviderBase.DbConnectionFactory.CreatePooledConnection(DbConnectionPool pool, DbConnection owningObject, DbConnectionOptions options, DbConnectionPoolKey poolKey, DbConnectionOptions userOptions)
   at Microsoft.Data.ProviderBase.DbConnectionPool.CreateObject(DbConnection owningObject, DbConnectionOptions userOptions, DbConnectionInternal oldConnection)
   at Microsoft.Data.ProviderBase.DbConnectionPool.UserCreateRequest(DbConnection owningObject, DbConnectionOptions userOptions, DbConnectionInternal oldConnection)
   at Microsoft.Data.ProviderBase.DbConnectionPool.TryGetConnection(DbConnection owningObject, UInt32 waitForMultipleObjectsTimeout, Boolean allowCreate, Boolean onlyOneCheckConnection, DbConnectionOptions userOptions, DbConnectionInternal& connection)
   at Microsoft.Data.ProviderBase.DbConnectionPool.TryGetConnection(DbConnection owningObject, TaskCompletionSource`1 retry, DbConnectionOptions userOptions, DbConnectionInternal& connection)
   at Microsoft.Data.ProviderBase.DbConnectionFactory.TryGetConnection(DbConnection owningConnection, TaskCompletionSource`1 retry, DbConnectionOptions userOptions, DbConnectionInternal oldConnection, DbConnectionInternal& connection)
   at Microsoft.Data.ProviderBase.DbConnectionInternal.TryOpenConnectionInternal(DbConnection outerConnection, DbConnectionFactory connectionFactory, TaskCompletionSource`1 retry, DbConnectionOptions userOptions)
   at Microsoft.Data.ProviderBase.DbConnectionClosed.TryOpenConnection(DbConnection outerConnection, DbConnectionFactory connectionFactory, TaskCompletionSource`1 retry, DbConnectionOptions userOptions)
   at Microsoft.Data.SqlClient.SqlConnection.TryOpen(TaskCompletionSource`1 retry, SqlConnectionOverrides overrides)
   at Microsoft.Data.SqlClient.SqlConnection.Open(SqlConnectionOverrides overrides)
   at Microsoft.Data.SqlClient.SqlConnection.Open()
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerConnection.OpenDbConnection(Boolean errorsExpected)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternal(Boolean errorsExpected)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.Open(Boolean errorsExpected)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReader(RelationalCommandParameterObject parameterObject)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.Enumerator.InitializeReader(Enumerator enumerator)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.Enumerator.<>c.<MoveNext>b__21_0(DbContext _, Enumerator enumerator)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.Execute[TState,TResult](TState state, Func`3 operation, Func`3 verifySucceeded)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.Enumerator.MoveNext()
   at System.Linq.Enumerable.TryGetSingle[TSource](IEnumerable`1 source, Boolean& found)
   at lambda_method4(Closure, QueryContext)
   at Microsoft.EntityFrameworkCore.Query.Internal.QueryCompiler.Execute[TResult](Expression query)
   at Microsoft.EntityFrameworkCore.Query.Internal.EntityQueryProvider.Execute[TResult](Expression expression)
   at AuthServer.Users.RoleRepository.Count() in C:\Users\gusta\source\repos\AuthServer\AuthServer\Users\RoleRepository.cs:line 21
   at AuthServer.Users.UsersBootstrap.StartAsync(CancellationToken cancellationToken) in C:\Users\gusta\source\repos\AuthServer\AuthServer\Users\UserBootstrap.cs:line 22
   at Microsoft.Extensions.Hosting.Internal.Host.<StartAsync>b__15_1(IHostedService service, CancellationToken token)
   at Microsoft.Extensions.Hosting.Internal.Host.ForeachService[T](IEnumerable`1 services, CancellationToken token, Boolean concurrent, Boolean abortOnFirstException, List`1 exceptions, Func`3 operation)
ClientConnectionId:00000000-0000-0000-0000-000000000000
Error Number:10061,State:0,Class:20
2024-11-06 23:12:16.890 -03:00 [FTL] A aplicação falhou ao iniciar.
Microsoft.Data.SqlClient.SqlException (0x80131904): A network-related or instance-specific error occurred while establishing a connection to SQL Server. The server was not found or was not accessible. Verify that the instance name is correct and that SQL Server is configured to allow remote connections. (provider: TCP Provider, error: 0 - Nenhuma conexão pôde ser feita porque a máquina de destino as recusou ativamente.)
 ---> System.ComponentModel.Win32Exception (10061): Nenhuma conexão pôde ser feita porque a máquina de destino as recusou ativamente.
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.Connect(ServerInfo serverInfo, SqlInternalConnectionTds connHandler, Boolean ignoreSniOpenTimeout, Int64 timerExpire, SqlConnectionString connectionOptions, Boolean withFailover)
   at Microsoft.Data.SqlClient.SqlInternalConnectionTds.AttemptOneLogin(ServerInfo serverInfo, String newPassword, SecureString newSecurePassword, Boolean ignoreSniOpenTimeout, TimeoutTimer timeout, Boolean withFailover)
   at Microsoft.Data.SqlClient.SqlInternalConnectionTds.LoginNoFailover(ServerInfo serverInfo, String newPassword, SecureString newSecurePassword, Boolean redirectedUserInstance, SqlConnectionString connectionOptions, SqlCredential credential, TimeoutTimer timeout)
   at Microsoft.Data.SqlClient.SqlInternalConnectionTds.OpenLoginEnlist(TimeoutTimer timeout, SqlConnectionString connectionOptions, SqlCredential credential, String newPassword, SecureString newSecurePassword, Boolean redirectedUserInstance)
   at Microsoft.Data.SqlClient.SqlInternalConnectionTds..ctor(DbConnectionPoolIdentity identity, SqlConnectionString connectionOptions, SqlCredential credential, Object providerInfo, String newPassword, SecureString newSecurePassword, Boolean redirectedUserInstance, SqlConnectionString userConnectionOptions, SessionData reconnectSessionData, Boolean applyTransientFaultHandling, String accessToken, DbConnectionPool pool)
   at Microsoft.Data.SqlClient.SqlConnectionFactory.CreateConnection(DbConnectionOptions options, DbConnectionPoolKey poolKey, Object poolGroupProviderInfo, DbConnectionPool pool, DbConnection owningConnection, DbConnectionOptions userOptions)
   at Microsoft.Data.ProviderBase.DbConnectionFactory.CreatePooledConnection(DbConnectionPool pool, DbConnection owningObject, DbConnectionOptions options, DbConnectionPoolKey poolKey, DbConnectionOptions userOptions)
   at Microsoft.Data.ProviderBase.DbConnectionPool.CreateObject(DbConnection owningObject, DbConnectionOptions userOptions, DbConnectionInternal oldConnection)
   at Microsoft.Data.ProviderBase.DbConnectionPool.UserCreateRequest(DbConnection owningObject, DbConnectionOptions userOptions, DbConnectionInternal oldConnection)
   at Microsoft.Data.ProviderBase.DbConnectionPool.TryGetConnection(DbConnection owningObject, UInt32 waitForMultipleObjectsTimeout, Boolean allowCreate, Boolean onlyOneCheckConnection, DbConnectionOptions userOptions, DbConnectionInternal& connection)
   at Microsoft.Data.ProviderBase.DbConnectionPool.TryGetConnection(DbConnection owningObject, TaskCompletionSource`1 retry, DbConnectionOptions userOptions, DbConnectionInternal& connection)
   at Microsoft.Data.ProviderBase.DbConnectionFactory.TryGetConnection(DbConnection owningConnection, TaskCompletionSource`1 retry, DbConnectionOptions userOptions, DbConnectionInternal oldConnection, DbConnectionInternal& connection)
   at Microsoft.Data.ProviderBase.DbConnectionInternal.TryOpenConnectionInternal(DbConnection outerConnection, DbConnectionFactory connectionFactory, TaskCompletionSource`1 retry, DbConnectionOptions userOptions)
   at Microsoft.Data.ProviderBase.DbConnectionClosed.TryOpenConnection(DbConnection outerConnection, DbConnectionFactory connectionFactory, TaskCompletionSource`1 retry, DbConnectionOptions userOptions)
   at Microsoft.Data.SqlClient.SqlConnection.TryOpen(TaskCompletionSource`1 retry, SqlConnectionOverrides overrides)
   at Microsoft.Data.SqlClient.SqlConnection.Open(SqlConnectionOverrides overrides)
   at Microsoft.Data.SqlClient.SqlConnection.Open()
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerConnection.OpenDbConnection(Boolean errorsExpected)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternal(Boolean errorsExpected)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.Open(Boolean errorsExpected)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReader(RelationalCommandParameterObject parameterObject)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.Enumerator.InitializeReader(Enumerator enumerator)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.Enumerator.<>c.<MoveNext>b__21_0(DbContext _, Enumerator enumerator)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.Execute[TState,TResult](TState state, Func`3 operation, Func`3 verifySucceeded)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.Enumerator.MoveNext()
   at System.Linq.Enumerable.TryGetSingle[TSource](IEnumerable`1 source, Boolean& found)
   at lambda_method4(Closure, QueryContext)
   at Microsoft.EntityFrameworkCore.Query.Internal.QueryCompiler.Execute[TResult](Expression query)
   at Microsoft.EntityFrameworkCore.Query.Internal.EntityQueryProvider.Execute[TResult](Expression expression)
   at AuthServer.Users.RoleRepository.Count() in C:\Users\gusta\source\repos\AuthServer\AuthServer\Users\RoleRepository.cs:line 21
   at AuthServer.Users.UsersBootstrap.StartAsync(CancellationToken cancellationToken) in C:\Users\gusta\source\repos\AuthServer\AuthServer\Users\UserBootstrap.cs:line 22
   at Microsoft.Extensions.Hosting.Internal.Host.<StartAsync>b__15_1(IHostedService service, CancellationToken token)
   at Microsoft.Extensions.Hosting.Internal.Host.ForeachService[T](IEnumerable`1 services, CancellationToken token, Boolean concurrent, Boolean abortOnFirstException, List`1 exceptions, Func`3 operation)
   at Microsoft.Extensions.Hosting.Internal.Host.StartAsync(CancellationToken cancellationToken)
   at Microsoft.Extensions.Hosting.HostingAbstractionsHostExtensions.RunAsync(IHost host, CancellationToken token)
   at Microsoft.Extensions.Hosting.HostingAbstractionsHostExtensions.RunAsync(IHost host, CancellationToken token)
   at Microsoft.Extensions.Hosting.HostingAbstractionsHostExtensions.Run(IHost host)
   at AuthServer.Program.Main(String[] args) in C:\Users\gusta\source\repos\AuthServer\AuthServer\Program.cs:line 115
ClientConnectionId:00000000-0000-0000-0000-000000000000
Error Number:10061,State:0,Class:20
2024-11-06 23:15:19.258 -03:00 [INF] Aplicação iniciada - configuração de logs inicializada.
2024-11-06 23:15:19.410 -03:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2024-11-06 23:15:19.446 -03:00 [DBG] Hosting starting
2024-11-06 23:15:19.457 -03:00 [INF] User profile is available. Using 'C:\Users\gusta\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2024-11-06 23:15:19.462 -03:00 [DBG] Reading data from file 'C:\Users\gusta\AppData\Local\ASP.NET\DataProtection-Keys\key-bf4636f6-ef08-4ac9-8613-5c8299c406a4.xml'.
2024-11-06 23:15:19.467 -03:00 [DBG] Found key {bf4636f6-ef08-4ac9-8613-5c8299c406a4}.
2024-11-06 23:15:19.472 -03:00 [DBG] Considering key {bf4636f6-ef08-4ac9-8613-5c8299c406a4} with expiration date 2025-02-02 14:46:39Z as default key.
2024-11-06 23:15:19.475 -03:00 [DBG] Forwarded activator type request from Microsoft.AspNetCore.DataProtection.XmlEncryption.DpapiXmlDecryptor, Microsoft.AspNetCore.DataProtection, Version=8.0.0.0, Culture=neutral, PublicKeyToken=adb9793829ddae60 to Microsoft.AspNetCore.DataProtection.XmlEncryption.DpapiXmlDecryptor, Microsoft.AspNetCore.DataProtection, Culture=neutral, PublicKeyToken=adb9793829ddae60
2024-11-06 23:15:19.476 -03:00 [DBG] Decrypting secret element using Windows DPAPI.
2024-11-06 23:15:19.478 -03:00 [DBG] Forwarded activator type request from Microsoft.AspNetCore.DataProtection.AuthenticatedEncryption.ConfigurationModel.AuthenticatedEncryptorDescriptorDeserializer, Microsoft.AspNetCore.DataProtection, Version=8.0.0.0, Culture=neutral, PublicKeyToken=adb9793829ddae60 to Microsoft.AspNetCore.DataProtection.AuthenticatedEncryption.ConfigurationModel.AuthenticatedEncryptorDescriptorDeserializer, Microsoft.AspNetCore.DataProtection, Culture=neutral, PublicKeyToken=adb9793829ddae60
2024-11-06 23:15:19.482 -03:00 [DBG] Opening CNG algorithm 'AES' from provider 'null' with chaining mode CBC.
2024-11-06 23:15:19.483 -03:00 [DBG] Opening CNG algorithm 'SHA256' from provider 'null' with HMAC.
2024-11-06 23:15:19.484 -03:00 [DBG] Using key {bf4636f6-ef08-4ac9-8613-5c8299c406a4} as the default key.
2024-11-06 23:15:19.485 -03:00 [DBG] Key ring with default key {bf4636f6-ef08-4ac9-8613-5c8299c406a4} was loaded during application startup.
2024-11-06 23:15:19.541 -03:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2024-11-06 23:15:19.804 -03:00 [DBG] The index {'RoleId'} was not created on entity type 'UserRole (Dictionary<string, object>)' as the properties are already covered by the index {'RoleId', 'UserId'}.
2024-11-06 23:15:19.928 -03:00 [DBG] Entity Framework Core 8.0.10 initialized 'AuthServerContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:8.0.10' with options: None
2024-11-06 23:15:19.966 -03:00 [DBG] Compiling query expression: 
'DbSet<Role>()
    .Count()'
2024-11-06 23:15:20.070 -03:00 [DBG] Generated query execution expression: 
'queryContext => new SingleQueryingEnumerable<int>(
    (RelationalQueryContext)queryContext, 
    RelationalCommandCache.QueryExpression(
        Projection Mapping:
            EmptyProjectionMember -> 0
        SELECT COUNT(*)
        FROM Roles AS r), 
    null, 
    Func<QueryContext, DbDataReader, ResultContext, SingleQueryResultCoordinator, int>, 
    AuthServer.AuthServerContext, 
    False, 
    False, 
    True
)
    .Single()'
2024-11-06 23:15:20.086 -03:00 [DBG] Creating DbConnection.
2024-11-06 23:15:20.104 -03:00 [DBG] Created DbConnection. (17ms).
2024-11-06 23:15:20.106 -03:00 [DBG] Opening connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 23:16:21.337 -03:00 [INF] Aplicação iniciada - configuração de logs inicializada.
2024-11-06 23:16:21.977 -03:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2024-11-06 23:16:22.032 -03:00 [DBG] Hosting starting
2024-11-06 23:16:22.067 -03:00 [INF] User profile is available. Using 'C:\Users\gusta\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2024-11-06 23:16:22.080 -03:00 [DBG] Reading data from file 'C:\Users\gusta\AppData\Local\ASP.NET\DataProtection-Keys\key-bf4636f6-ef08-4ac9-8613-5c8299c406a4.xml'.
2024-11-06 23:16:22.118 -03:00 [DBG] Found key {bf4636f6-ef08-4ac9-8613-5c8299c406a4}.
2024-11-06 23:16:22.132 -03:00 [DBG] Considering key {bf4636f6-ef08-4ac9-8613-5c8299c406a4} with expiration date 2025-02-02 14:46:39Z as default key.
2024-11-06 23:16:22.137 -03:00 [DBG] Forwarded activator type request from Microsoft.AspNetCore.DataProtection.XmlEncryption.DpapiXmlDecryptor, Microsoft.AspNetCore.DataProtection, Version=8.0.0.0, Culture=neutral, PublicKeyToken=adb9793829ddae60 to Microsoft.AspNetCore.DataProtection.XmlEncryption.DpapiXmlDecryptor, Microsoft.AspNetCore.DataProtection, Culture=neutral, PublicKeyToken=adb9793829ddae60
2024-11-06 23:16:22.141 -03:00 [DBG] Decrypting secret element using Windows DPAPI.
2024-11-06 23:16:22.143 -03:00 [DBG] Forwarded activator type request from Microsoft.AspNetCore.DataProtection.AuthenticatedEncryption.ConfigurationModel.AuthenticatedEncryptorDescriptorDeserializer, Microsoft.AspNetCore.DataProtection, Version=8.0.0.0, Culture=neutral, PublicKeyToken=adb9793829ddae60 to Microsoft.AspNetCore.DataProtection.AuthenticatedEncryption.ConfigurationModel.AuthenticatedEncryptorDescriptorDeserializer, Microsoft.AspNetCore.DataProtection, Culture=neutral, PublicKeyToken=adb9793829ddae60
2024-11-06 23:16:22.150 -03:00 [DBG] Opening CNG algorithm 'AES' from provider 'null' with chaining mode CBC.
2024-11-06 23:16:22.152 -03:00 [DBG] Opening CNG algorithm 'SHA256' from provider 'null' with HMAC.
2024-11-06 23:16:22.154 -03:00 [DBG] Using key {bf4636f6-ef08-4ac9-8613-5c8299c406a4} as the default key.
2024-11-06 23:16:22.155 -03:00 [DBG] Key ring with default key {bf4636f6-ef08-4ac9-8613-5c8299c406a4} was loaded during application startup.
2024-11-06 23:16:22.289 -03:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2024-11-06 23:16:22.634 -03:00 [DBG] The index {'RoleId'} was not created on entity type 'UserRole (Dictionary<string, object>)' as the properties are already covered by the index {'RoleId', 'UserId'}.
2024-11-06 23:16:22.787 -03:00 [DBG] Entity Framework Core 8.0.10 initialized 'AuthServerContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:8.0.10' with options: None
2024-11-06 23:16:22.823 -03:00 [DBG] Compiling query expression: 
'DbSet<Role>()
    .Count()'
2024-11-06 23:16:22.936 -03:00 [DBG] Generated query execution expression: 
'queryContext => new SingleQueryingEnumerable<int>(
    (RelationalQueryContext)queryContext, 
    RelationalCommandCache.QueryExpression(
        Projection Mapping:
            EmptyProjectionMember -> 0
        SELECT COUNT(*)
        FROM Roles AS r), 
    null, 
    Func<QueryContext, DbDataReader, ResultContext, SingleQueryResultCoordinator, int>, 
    AuthServer.AuthServerContext, 
    False, 
    False, 
    True
)
    .Single()'
2024-11-06 23:16:22.952 -03:00 [DBG] Creating DbConnection.
2024-11-06 23:16:22.968 -03:00 [DBG] Created DbConnection. (14ms).
2024-11-06 23:16:22.970 -03:00 [DBG] Opening connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 23:16:40.052 -03:00 [ERR] An error occurred using the connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 23:16:40.073 -03:00 [ERR] An exception occurred while iterating over the results of a query for context type 'AuthServer.AuthServerContext'.
Microsoft.Data.SqlClient.SqlException (0x80131904): A network-related or instance-specific error occurred while establishing a connection to SQL Server. The server was not found or was not accessible. Verify that the instance name is correct and that SQL Server is configured to allow remote connections. (provider: TCP Provider, error: 0 - Nenhuma conexão pôde ser feita porque a máquina de destino as recusou ativamente.)
 ---> System.ComponentModel.Win32Exception (10061): Nenhuma conexão pôde ser feita porque a máquina de destino as recusou ativamente.
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.Connect(ServerInfo serverInfo, SqlInternalConnectionTds connHandler, Boolean ignoreSniOpenTimeout, Int64 timerExpire, SqlConnectionString connectionOptions, Boolean withFailover)
   at Microsoft.Data.SqlClient.SqlInternalConnectionTds.AttemptOneLogin(ServerInfo serverInfo, String newPassword, SecureString newSecurePassword, Boolean ignoreSniOpenTimeout, TimeoutTimer timeout, Boolean withFailover)
   at Microsoft.Data.SqlClient.SqlInternalConnectionTds.LoginNoFailover(ServerInfo serverInfo, String newPassword, SecureString newSecurePassword, Boolean redirectedUserInstance, SqlConnectionString connectionOptions, SqlCredential credential, TimeoutTimer timeout)
   at Microsoft.Data.SqlClient.SqlInternalConnectionTds.OpenLoginEnlist(TimeoutTimer timeout, SqlConnectionString connectionOptions, SqlCredential credential, String newPassword, SecureString newSecurePassword, Boolean redirectedUserInstance)
   at Microsoft.Data.SqlClient.SqlInternalConnectionTds..ctor(DbConnectionPoolIdentity identity, SqlConnectionString connectionOptions, SqlCredential credential, Object providerInfo, String newPassword, SecureString newSecurePassword, Boolean redirectedUserInstance, SqlConnectionString userConnectionOptions, SessionData reconnectSessionData, Boolean applyTransientFaultHandling, String accessToken, DbConnectionPool pool)
   at Microsoft.Data.SqlClient.SqlConnectionFactory.CreateConnection(DbConnectionOptions options, DbConnectionPoolKey poolKey, Object poolGroupProviderInfo, DbConnectionPool pool, DbConnection owningConnection, DbConnectionOptions userOptions)
   at Microsoft.Data.ProviderBase.DbConnectionFactory.CreatePooledConnection(DbConnectionPool pool, DbConnection owningObject, DbConnectionOptions options, DbConnectionPoolKey poolKey, DbConnectionOptions userOptions)
   at Microsoft.Data.ProviderBase.DbConnectionPool.CreateObject(DbConnection owningObject, DbConnectionOptions userOptions, DbConnectionInternal oldConnection)
   at Microsoft.Data.ProviderBase.DbConnectionPool.UserCreateRequest(DbConnection owningObject, DbConnectionOptions userOptions, DbConnectionInternal oldConnection)
   at Microsoft.Data.ProviderBase.DbConnectionPool.TryGetConnection(DbConnection owningObject, UInt32 waitForMultipleObjectsTimeout, Boolean allowCreate, Boolean onlyOneCheckConnection, DbConnectionOptions userOptions, DbConnectionInternal& connection)
   at Microsoft.Data.ProviderBase.DbConnectionPool.TryGetConnection(DbConnection owningObject, TaskCompletionSource`1 retry, DbConnectionOptions userOptions, DbConnectionInternal& connection)
   at Microsoft.Data.ProviderBase.DbConnectionFactory.TryGetConnection(DbConnection owningConnection, TaskCompletionSource`1 retry, DbConnectionOptions userOptions, DbConnectionInternal oldConnection, DbConnectionInternal& connection)
   at Microsoft.Data.ProviderBase.DbConnectionInternal.TryOpenConnectionInternal(DbConnection outerConnection, DbConnectionFactory connectionFactory, TaskCompletionSource`1 retry, DbConnectionOptions userOptions)
   at Microsoft.Data.ProviderBase.DbConnectionClosed.TryOpenConnection(DbConnection outerConnection, DbConnectionFactory connectionFactory, TaskCompletionSource`1 retry, DbConnectionOptions userOptions)
   at Microsoft.Data.SqlClient.SqlConnection.TryOpen(TaskCompletionSource`1 retry, SqlConnectionOverrides overrides)
   at Microsoft.Data.SqlClient.SqlConnection.Open(SqlConnectionOverrides overrides)
   at Microsoft.Data.SqlClient.SqlConnection.Open()
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerConnection.OpenDbConnection(Boolean errorsExpected)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternal(Boolean errorsExpected)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.Open(Boolean errorsExpected)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReader(RelationalCommandParameterObject parameterObject)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.Enumerator.InitializeReader(Enumerator enumerator)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.Enumerator.<>c.<MoveNext>b__21_0(DbContext _, Enumerator enumerator)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.Execute[TState,TResult](TState state, Func`3 operation, Func`3 verifySucceeded)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.Enumerator.MoveNext()
ClientConnectionId:00000000-0000-0000-0000-000000000000
Error Number:10061,State:0,Class:20
Microsoft.Data.SqlClient.SqlException (0x80131904): A network-related or instance-specific error occurred while establishing a connection to SQL Server. The server was not found or was not accessible. Verify that the instance name is correct and that SQL Server is configured to allow remote connections. (provider: TCP Provider, error: 0 - Nenhuma conexão pôde ser feita porque a máquina de destino as recusou ativamente.)
 ---> System.ComponentModel.Win32Exception (10061): Nenhuma conexão pôde ser feita porque a máquina de destino as recusou ativamente.
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.Connect(ServerInfo serverInfo, SqlInternalConnectionTds connHandler, Boolean ignoreSniOpenTimeout, Int64 timerExpire, SqlConnectionString connectionOptions, Boolean withFailover)
   at Microsoft.Data.SqlClient.SqlInternalConnectionTds.AttemptOneLogin(ServerInfo serverInfo, String newPassword, SecureString newSecurePassword, Boolean ignoreSniOpenTimeout, TimeoutTimer timeout, Boolean withFailover)
   at Microsoft.Data.SqlClient.SqlInternalConnectionTds.LoginNoFailover(ServerInfo serverInfo, String newPassword, SecureString newSecurePassword, Boolean redirectedUserInstance, SqlConnectionString connectionOptions, SqlCredential credential, TimeoutTimer timeout)
   at Microsoft.Data.SqlClient.SqlInternalConnectionTds.OpenLoginEnlist(TimeoutTimer timeout, SqlConnectionString connectionOptions, SqlCredential credential, String newPassword, SecureString newSecurePassword, Boolean redirectedUserInstance)
   at Microsoft.Data.SqlClient.SqlInternalConnectionTds..ctor(DbConnectionPoolIdentity identity, SqlConnectionString connectionOptions, SqlCredential credential, Object providerInfo, String newPassword, SecureString newSecurePassword, Boolean redirectedUserInstance, SqlConnectionString userConnectionOptions, SessionData reconnectSessionData, Boolean applyTransientFaultHandling, String accessToken, DbConnectionPool pool)
   at Microsoft.Data.SqlClient.SqlConnectionFactory.CreateConnection(DbConnectionOptions options, DbConnectionPoolKey poolKey, Object poolGroupProviderInfo, DbConnectionPool pool, DbConnection owningConnection, DbConnectionOptions userOptions)
   at Microsoft.Data.ProviderBase.DbConnectionFactory.CreatePooledConnection(DbConnectionPool pool, DbConnection owningObject, DbConnectionOptions options, DbConnectionPoolKey poolKey, DbConnectionOptions userOptions)
   at Microsoft.Data.ProviderBase.DbConnectionPool.CreateObject(DbConnection owningObject, DbConnectionOptions userOptions, DbConnectionInternal oldConnection)
   at Microsoft.Data.ProviderBase.DbConnectionPool.UserCreateRequest(DbConnection owningObject, DbConnectionOptions userOptions, DbConnectionInternal oldConnection)
   at Microsoft.Data.ProviderBase.DbConnectionPool.TryGetConnection(DbConnection owningObject, UInt32 waitForMultipleObjectsTimeout, Boolean allowCreate, Boolean onlyOneCheckConnection, DbConnectionOptions userOptions, DbConnectionInternal& connection)
   at Microsoft.Data.ProviderBase.DbConnectionPool.TryGetConnection(DbConnection owningObject, TaskCompletionSource`1 retry, DbConnectionOptions userOptions, DbConnectionInternal& connection)
   at Microsoft.Data.ProviderBase.DbConnectionFactory.TryGetConnection(DbConnection owningConnection, TaskCompletionSource`1 retry, DbConnectionOptions userOptions, DbConnectionInternal oldConnection, DbConnectionInternal& connection)
   at Microsoft.Data.ProviderBase.DbConnectionInternal.TryOpenConnectionInternal(DbConnection outerConnection, DbConnectionFactory connectionFactory, TaskCompletionSource`1 retry, DbConnectionOptions userOptions)
   at Microsoft.Data.ProviderBase.DbConnectionClosed.TryOpenConnection(DbConnection outerConnection, DbConnectionFactory connectionFactory, TaskCompletionSource`1 retry, DbConnectionOptions userOptions)
   at Microsoft.Data.SqlClient.SqlConnection.TryOpen(TaskCompletionSource`1 retry, SqlConnectionOverrides overrides)
   at Microsoft.Data.SqlClient.SqlConnection.Open(SqlConnectionOverrides overrides)
   at Microsoft.Data.SqlClient.SqlConnection.Open()
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerConnection.OpenDbConnection(Boolean errorsExpected)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternal(Boolean errorsExpected)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.Open(Boolean errorsExpected)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReader(RelationalCommandParameterObject parameterObject)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.Enumerator.InitializeReader(Enumerator enumerator)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.Enumerator.<>c.<MoveNext>b__21_0(DbContext _, Enumerator enumerator)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.Execute[TState,TResult](TState state, Func`3 operation, Func`3 verifySucceeded)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.Enumerator.MoveNext()
ClientConnectionId:00000000-0000-0000-0000-000000000000
Error Number:10061,State:0,Class:20
2024-11-06 23:16:40.122 -03:00 [DBG] 'AuthServerContext' disposed.
2024-11-06 23:16:40.126 -03:00 [DBG] Disposing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 23:16:40.131 -03:00 [DBG] Disposed connection to database '' on server '' (2ms).
2024-11-06 23:16:40.134 -03:00 [ERR] Hosting failed to start
Microsoft.Data.SqlClient.SqlException (0x80131904): A network-related or instance-specific error occurred while establishing a connection to SQL Server. The server was not found or was not accessible. Verify that the instance name is correct and that SQL Server is configured to allow remote connections. (provider: TCP Provider, error: 0 - Nenhuma conexão pôde ser feita porque a máquina de destino as recusou ativamente.)
 ---> System.ComponentModel.Win32Exception (10061): Nenhuma conexão pôde ser feita porque a máquina de destino as recusou ativamente.
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.Connect(ServerInfo serverInfo, SqlInternalConnectionTds connHandler, Boolean ignoreSniOpenTimeout, Int64 timerExpire, SqlConnectionString connectionOptions, Boolean withFailover)
   at Microsoft.Data.SqlClient.SqlInternalConnectionTds.AttemptOneLogin(ServerInfo serverInfo, String newPassword, SecureString newSecurePassword, Boolean ignoreSniOpenTimeout, TimeoutTimer timeout, Boolean withFailover)
   at Microsoft.Data.SqlClient.SqlInternalConnectionTds.LoginNoFailover(ServerInfo serverInfo, String newPassword, SecureString newSecurePassword, Boolean redirectedUserInstance, SqlConnectionString connectionOptions, SqlCredential credential, TimeoutTimer timeout)
   at Microsoft.Data.SqlClient.SqlInternalConnectionTds.OpenLoginEnlist(TimeoutTimer timeout, SqlConnectionString connectionOptions, SqlCredential credential, String newPassword, SecureString newSecurePassword, Boolean redirectedUserInstance)
   at Microsoft.Data.SqlClient.SqlInternalConnectionTds..ctor(DbConnectionPoolIdentity identity, SqlConnectionString connectionOptions, SqlCredential credential, Object providerInfo, String newPassword, SecureString newSecurePassword, Boolean redirectedUserInstance, SqlConnectionString userConnectionOptions, SessionData reconnectSessionData, Boolean applyTransientFaultHandling, String accessToken, DbConnectionPool pool)
   at Microsoft.Data.SqlClient.SqlConnectionFactory.CreateConnection(DbConnectionOptions options, DbConnectionPoolKey poolKey, Object poolGroupProviderInfo, DbConnectionPool pool, DbConnection owningConnection, DbConnectionOptions userOptions)
   at Microsoft.Data.ProviderBase.DbConnectionFactory.CreatePooledConnection(DbConnectionPool pool, DbConnection owningObject, DbConnectionOptions options, DbConnectionPoolKey poolKey, DbConnectionOptions userOptions)
   at Microsoft.Data.ProviderBase.DbConnectionPool.CreateObject(DbConnection owningObject, DbConnectionOptions userOptions, DbConnectionInternal oldConnection)
   at Microsoft.Data.ProviderBase.DbConnectionPool.UserCreateRequest(DbConnection owningObject, DbConnectionOptions userOptions, DbConnectionInternal oldConnection)
   at Microsoft.Data.ProviderBase.DbConnectionPool.TryGetConnection(DbConnection owningObject, UInt32 waitForMultipleObjectsTimeout, Boolean allowCreate, Boolean onlyOneCheckConnection, DbConnectionOptions userOptions, DbConnectionInternal& connection)
   at Microsoft.Data.ProviderBase.DbConnectionPool.TryGetConnection(DbConnection owningObject, TaskCompletionSource`1 retry, DbConnectionOptions userOptions, DbConnectionInternal& connection)
   at Microsoft.Data.ProviderBase.DbConnectionFactory.TryGetConnection(DbConnection owningConnection, TaskCompletionSource`1 retry, DbConnectionOptions userOptions, DbConnectionInternal oldConnection, DbConnectionInternal& connection)
   at Microsoft.Data.ProviderBase.DbConnectionInternal.TryOpenConnectionInternal(DbConnection outerConnection, DbConnectionFactory connectionFactory, TaskCompletionSource`1 retry, DbConnectionOptions userOptions)
   at Microsoft.Data.ProviderBase.DbConnectionClosed.TryOpenConnection(DbConnection outerConnection, DbConnectionFactory connectionFactory, TaskCompletionSource`1 retry, DbConnectionOptions userOptions)
   at Microsoft.Data.SqlClient.SqlConnection.TryOpen(TaskCompletionSource`1 retry, SqlConnectionOverrides overrides)
   at Microsoft.Data.SqlClient.SqlConnection.Open(SqlConnectionOverrides overrides)
   at Microsoft.Data.SqlClient.SqlConnection.Open()
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerConnection.OpenDbConnection(Boolean errorsExpected)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternal(Boolean errorsExpected)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.Open(Boolean errorsExpected)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReader(RelationalCommandParameterObject parameterObject)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.Enumerator.InitializeReader(Enumerator enumerator)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.Enumerator.<>c.<MoveNext>b__21_0(DbContext _, Enumerator enumerator)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.Execute[TState,TResult](TState state, Func`3 operation, Func`3 verifySucceeded)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.Enumerator.MoveNext()
   at System.Linq.Enumerable.TryGetSingle[TSource](IEnumerable`1 source, Boolean& found)
   at lambda_method4(Closure, QueryContext)
   at Microsoft.EntityFrameworkCore.Query.Internal.QueryCompiler.Execute[TResult](Expression query)
   at Microsoft.EntityFrameworkCore.Query.Internal.EntityQueryProvider.Execute[TResult](Expression expression)
   at AuthServer.Users.RoleRepository.Count() in C:\Users\gusta\source\repos\AuthServer\AuthServer\Users\RoleRepository.cs:line 21
   at AuthServer.Users.UsersBootstrap.StartAsync(CancellationToken cancellationToken) in C:\Users\gusta\source\repos\AuthServer\AuthServer\Users\UserBootstrap.cs:line 22
   at Microsoft.Extensions.Hosting.Internal.Host.<StartAsync>b__15_1(IHostedService service, CancellationToken token)
   at Microsoft.Extensions.Hosting.Internal.Host.ForeachService[T](IEnumerable`1 services, CancellationToken token, Boolean concurrent, Boolean abortOnFirstException, List`1 exceptions, Func`3 operation)
ClientConnectionId:00000000-0000-0000-0000-000000000000
Error Number:10061,State:0,Class:20
2024-11-06 23:16:40.177 -03:00 [FTL] A aplicação falhou ao iniciar.
Microsoft.Data.SqlClient.SqlException (0x80131904): A network-related or instance-specific error occurred while establishing a connection to SQL Server. The server was not found or was not accessible. Verify that the instance name is correct and that SQL Server is configured to allow remote connections. (provider: TCP Provider, error: 0 - Nenhuma conexão pôde ser feita porque a máquina de destino as recusou ativamente.)
 ---> System.ComponentModel.Win32Exception (10061): Nenhuma conexão pôde ser feita porque a máquina de destino as recusou ativamente.
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.Connect(ServerInfo serverInfo, SqlInternalConnectionTds connHandler, Boolean ignoreSniOpenTimeout, Int64 timerExpire, SqlConnectionString connectionOptions, Boolean withFailover)
   at Microsoft.Data.SqlClient.SqlInternalConnectionTds.AttemptOneLogin(ServerInfo serverInfo, String newPassword, SecureString newSecurePassword, Boolean ignoreSniOpenTimeout, TimeoutTimer timeout, Boolean withFailover)
   at Microsoft.Data.SqlClient.SqlInternalConnectionTds.LoginNoFailover(ServerInfo serverInfo, String newPassword, SecureString newSecurePassword, Boolean redirectedUserInstance, SqlConnectionString connectionOptions, SqlCredential credential, TimeoutTimer timeout)
   at Microsoft.Data.SqlClient.SqlInternalConnectionTds.OpenLoginEnlist(TimeoutTimer timeout, SqlConnectionString connectionOptions, SqlCredential credential, String newPassword, SecureString newSecurePassword, Boolean redirectedUserInstance)
   at Microsoft.Data.SqlClient.SqlInternalConnectionTds..ctor(DbConnectionPoolIdentity identity, SqlConnectionString connectionOptions, SqlCredential credential, Object providerInfo, String newPassword, SecureString newSecurePassword, Boolean redirectedUserInstance, SqlConnectionString userConnectionOptions, SessionData reconnectSessionData, Boolean applyTransientFaultHandling, String accessToken, DbConnectionPool pool)
   at Microsoft.Data.SqlClient.SqlConnectionFactory.CreateConnection(DbConnectionOptions options, DbConnectionPoolKey poolKey, Object poolGroupProviderInfo, DbConnectionPool pool, DbConnection owningConnection, DbConnectionOptions userOptions)
   at Microsoft.Data.ProviderBase.DbConnectionFactory.CreatePooledConnection(DbConnectionPool pool, DbConnection owningObject, DbConnectionOptions options, DbConnectionPoolKey poolKey, DbConnectionOptions userOptions)
   at Microsoft.Data.ProviderBase.DbConnectionPool.CreateObject(DbConnection owningObject, DbConnectionOptions userOptions, DbConnectionInternal oldConnection)
   at Microsoft.Data.ProviderBase.DbConnectionPool.UserCreateRequest(DbConnection owningObject, DbConnectionOptions userOptions, DbConnectionInternal oldConnection)
   at Microsoft.Data.ProviderBase.DbConnectionPool.TryGetConnection(DbConnection owningObject, UInt32 waitForMultipleObjectsTimeout, Boolean allowCreate, Boolean onlyOneCheckConnection, DbConnectionOptions userOptions, DbConnectionInternal& connection)
   at Microsoft.Data.ProviderBase.DbConnectionPool.TryGetConnection(DbConnection owningObject, TaskCompletionSource`1 retry, DbConnectionOptions userOptions, DbConnectionInternal& connection)
   at Microsoft.Data.ProviderBase.DbConnectionFactory.TryGetConnection(DbConnection owningConnection, TaskCompletionSource`1 retry, DbConnectionOptions userOptions, DbConnectionInternal oldConnection, DbConnectionInternal& connection)
   at Microsoft.Data.ProviderBase.DbConnectionInternal.TryOpenConnectionInternal(DbConnection outerConnection, DbConnectionFactory connectionFactory, TaskCompletionSource`1 retry, DbConnectionOptions userOptions)
   at Microsoft.Data.ProviderBase.DbConnectionClosed.TryOpenConnection(DbConnection outerConnection, DbConnectionFactory connectionFactory, TaskCompletionSource`1 retry, DbConnectionOptions userOptions)
   at Microsoft.Data.SqlClient.SqlConnection.TryOpen(TaskCompletionSource`1 retry, SqlConnectionOverrides overrides)
   at Microsoft.Data.SqlClient.SqlConnection.Open(SqlConnectionOverrides overrides)
   at Microsoft.Data.SqlClient.SqlConnection.Open()
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerConnection.OpenDbConnection(Boolean errorsExpected)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternal(Boolean errorsExpected)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.Open(Boolean errorsExpected)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReader(RelationalCommandParameterObject parameterObject)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.Enumerator.InitializeReader(Enumerator enumerator)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.Enumerator.<>c.<MoveNext>b__21_0(DbContext _, Enumerator enumerator)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.Execute[TState,TResult](TState state, Func`3 operation, Func`3 verifySucceeded)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.Enumerator.MoveNext()
   at System.Linq.Enumerable.TryGetSingle[TSource](IEnumerable`1 source, Boolean& found)
   at lambda_method4(Closure, QueryContext)
   at Microsoft.EntityFrameworkCore.Query.Internal.QueryCompiler.Execute[TResult](Expression query)
   at Microsoft.EntityFrameworkCore.Query.Internal.EntityQueryProvider.Execute[TResult](Expression expression)
   at AuthServer.Users.RoleRepository.Count() in C:\Users\gusta\source\repos\AuthServer\AuthServer\Users\RoleRepository.cs:line 21
   at AuthServer.Users.UsersBootstrap.StartAsync(CancellationToken cancellationToken) in C:\Users\gusta\source\repos\AuthServer\AuthServer\Users\UserBootstrap.cs:line 22
   at Microsoft.Extensions.Hosting.Internal.Host.<StartAsync>b__15_1(IHostedService service, CancellationToken token)
   at Microsoft.Extensions.Hosting.Internal.Host.ForeachService[T](IEnumerable`1 services, CancellationToken token, Boolean concurrent, Boolean abortOnFirstException, List`1 exceptions, Func`3 operation)
   at Microsoft.Extensions.Hosting.Internal.Host.StartAsync(CancellationToken cancellationToken)
   at Microsoft.Extensions.Hosting.HostingAbstractionsHostExtensions.RunAsync(IHost host, CancellationToken token)
   at Microsoft.Extensions.Hosting.HostingAbstractionsHostExtensions.RunAsync(IHost host, CancellationToken token)
   at Microsoft.Extensions.Hosting.HostingAbstractionsHostExtensions.Run(IHost host)
   at AuthServer.Program.Main(String[] args) in C:\Users\gusta\source\repos\AuthServer\AuthServer\Program.cs:line 115
ClientConnectionId:00000000-0000-0000-0000-000000000000
Error Number:10061,State:0,Class:20
2024-11-06 23:17:21.472 -03:00 [INF] Aplicação iniciada - configuração de logs inicializada.
2024-11-06 23:17:21.625 -03:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2024-11-06 23:17:21.655 -03:00 [DBG] Hosting starting
2024-11-06 23:17:21.665 -03:00 [INF] User profile is available. Using 'C:\Users\gusta\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2024-11-06 23:17:21.670 -03:00 [DBG] Reading data from file 'C:\Users\gusta\AppData\Local\ASP.NET\DataProtection-Keys\key-bf4636f6-ef08-4ac9-8613-5c8299c406a4.xml'.
2024-11-06 23:17:21.675 -03:00 [DBG] Found key {bf4636f6-ef08-4ac9-8613-5c8299c406a4}.
2024-11-06 23:17:21.680 -03:00 [DBG] Considering key {bf4636f6-ef08-4ac9-8613-5c8299c406a4} with expiration date 2025-02-02 14:46:39Z as default key.
2024-11-06 23:17:21.682 -03:00 [DBG] Forwarded activator type request from Microsoft.AspNetCore.DataProtection.XmlEncryption.DpapiXmlDecryptor, Microsoft.AspNetCore.DataProtection, Version=8.0.0.0, Culture=neutral, PublicKeyToken=adb9793829ddae60 to Microsoft.AspNetCore.DataProtection.XmlEncryption.DpapiXmlDecryptor, Microsoft.AspNetCore.DataProtection, Culture=neutral, PublicKeyToken=adb9793829ddae60
2024-11-06 23:17:21.683 -03:00 [DBG] Decrypting secret element using Windows DPAPI.
2024-11-06 23:17:21.685 -03:00 [DBG] Forwarded activator type request from Microsoft.AspNetCore.DataProtection.AuthenticatedEncryption.ConfigurationModel.AuthenticatedEncryptorDescriptorDeserializer, Microsoft.AspNetCore.DataProtection, Version=8.0.0.0, Culture=neutral, PublicKeyToken=adb9793829ddae60 to Microsoft.AspNetCore.DataProtection.AuthenticatedEncryption.ConfigurationModel.AuthenticatedEncryptorDescriptorDeserializer, Microsoft.AspNetCore.DataProtection, Culture=neutral, PublicKeyToken=adb9793829ddae60
2024-11-06 23:17:21.688 -03:00 [DBG] Opening CNG algorithm 'AES' from provider 'null' with chaining mode CBC.
2024-11-06 23:17:21.689 -03:00 [DBG] Opening CNG algorithm 'SHA256' from provider 'null' with HMAC.
2024-11-06 23:17:21.690 -03:00 [DBG] Using key {bf4636f6-ef08-4ac9-8613-5c8299c406a4} as the default key.
2024-11-06 23:17:21.691 -03:00 [DBG] Key ring with default key {bf4636f6-ef08-4ac9-8613-5c8299c406a4} was loaded during application startup.
2024-11-06 23:17:21.764 -03:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2024-11-06 23:17:22.041 -03:00 [DBG] The index {'RoleId'} was not created on entity type 'UserRole (Dictionary<string, object>)' as the properties are already covered by the index {'RoleId', 'UserId'}.
2024-11-06 23:17:22.175 -03:00 [DBG] Entity Framework Core 8.0.10 initialized 'AuthServerContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:8.0.10' with options: None
2024-11-06 23:17:22.213 -03:00 [DBG] Compiling query expression: 
'DbSet<Role>()
    .Count()'
2024-11-06 23:17:22.321 -03:00 [DBG] Generated query execution expression: 
'queryContext => new SingleQueryingEnumerable<int>(
    (RelationalQueryContext)queryContext, 
    RelationalCommandCache.QueryExpression(
        Projection Mapping:
            EmptyProjectionMember -> 0
        SELECT COUNT(*)
        FROM Roles AS r), 
    null, 
    Func<QueryContext, DbDataReader, ResultContext, SingleQueryResultCoordinator, int>, 
    AuthServer.AuthServerContext, 
    False, 
    False, 
    True
)
    .Single()'
2024-11-06 23:17:22.337 -03:00 [DBG] Creating DbConnection.
2024-11-06 23:17:22.356 -03:00 [DBG] Created DbConnection. (19ms).
2024-11-06 23:17:22.359 -03:00 [DBG] Opening connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 23:17:22.504 -03:00 [DBG] Opened connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 23:17:22.506 -03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2024-11-06 23:17:22.511 -03:00 [DBG] Created DbCommand for 'ExecuteReader' (2ms).
2024-11-06 23:17:22.513 -03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (6ms).
2024-11-06 23:17:22.517 -03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*)
FROM [Roles] AS [r]
2024-11-06 23:17:22.543 -03:00 [INF] Executed DbCommand (25ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*)
FROM [Roles] AS [r]
2024-11-06 23:17:22.551 -03:00 [DBG] Closing data reader to 'AuthServer' on server 'localhost,1433'.
2024-11-06 23:17:22.555 -03:00 [DBG] A data reader for 'AuthServer' on server 'localhost,1433' is being disposed after spending 7ms reading results.
2024-11-06 23:17:22.556 -03:00 [DBG] Closing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 23:17:22.560 -03:00 [DBG] Closed connection to database 'AuthServer' on server 'localhost,1433' (3ms).
2024-11-06 23:17:22.565 -03:00 [DBG] Compiling query expression: 
'DbSet<User>()
    .Include(user => user.Roles)'
2024-11-06 23:17:22.573 -03:00 [DBG] Including navigation: 'User.Roles'.
2024-11-06 23:17:22.640 -03:00 [DBG] Generated query execution expression: 
'queryContext => new SingleQueryingEnumerable<User>(
    (RelationalQueryContext)queryContext, 
    RelationalCommandCache.QueryExpression(
        Client Projections:
            0 -> Dictionary<IProperty, int> { [Property: User.ID (long) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: User.Email (string) Required Index, 1], [Property: User.Name (string) Required, 2], [Property: User.Password (string) Required, 3] }
            1 -> 0
            2 -> Dictionary<IProperty, int> { [Property: UserRole (Dictionary<string, object>).RoleId (no field, int) Indexer Required PK FK AfterSave:Throw, 4], [Property: UserRole (Dictionary<string, object>).UserId (no field, long) Indexer Required PK FK Index AfterSave:Throw, 5] }
            3 -> Dictionary<IProperty, int> { [Property: Role.Long (int) Required PK AfterSave:Throw ValueGenerated.OnAdd, 6], [Property: Role.Name (string) Required Index, 7] }
            4 -> 4
            5 -> 5
            6 -> 6
        SELECT u.ID, u.Email, u.Name, u.Password, t.RoleId, t.UserId, t.Long, t.Name
        FROM Users AS u
        LEFT JOIN 
        (
            SELECT u0.RoleId, u0.UserId, r.Long, r.Name
            FROM UserRole AS u0
            INNER JOIN Roles AS r ON u0.RoleId == r.Long
        ) AS t ON u.ID == t.UserId
        ORDER BY u.ID ASC, t.RoleId ASC, t.UserId ASC), 
    null, 
    Func<QueryContext, DbDataReader, ResultContext, SingleQueryResultCoordinator, User>, 
    AuthServer.AuthServerContext, 
    False, 
    False, 
    True
)'
2024-11-06 23:17:22.646 -03:00 [DBG] Opening connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 23:17:22.648 -03:00 [DBG] Opened connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 23:17:22.648 -03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2024-11-06 23:17:22.649 -03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2024-11-06 23:17:22.650 -03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2024-11-06 23:17:22.650 -03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[ID], [u].[Email], [u].[Name], [u].[Password], [t].[RoleId], [t].[UserId], [t].[Long], [t].[Name]
FROM [Users] AS [u]
LEFT JOIN (
    SELECT [u0].[RoleId], [u0].[UserId], [r].[Long], [r].[Name]
    FROM [UserRole] AS [u0]
    INNER JOIN [Roles] AS [r] ON [u0].[RoleId] = [r].[Long]
) AS [t] ON [u].[ID] = [t].[UserId]
ORDER BY [u].[ID], [t].[RoleId], [t].[UserId]
2024-11-06 23:17:22.664 -03:00 [INF] Executed DbCommand (13ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[ID], [u].[Email], [u].[Name], [u].[Password], [t].[RoleId], [t].[UserId], [t].[Long], [t].[Name]
FROM [Users] AS [u]
LEFT JOIN (
    SELECT [u0].[RoleId], [u0].[UserId], [r].[Long], [r].[Name]
    FROM [UserRole] AS [u0]
    INNER JOIN [Roles] AS [r] ON [u0].[RoleId] = [r].[Long]
) AS [t] ON [u].[ID] = [t].[UserId]
ORDER BY [u].[ID], [t].[RoleId], [t].[UserId]
2024-11-06 23:17:22.682 -03:00 [DBG] Context 'AuthServerContext' started tracking 'User' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 23:17:22.702 -03:00 [DBG] Context 'AuthServerContext' started tracking 'UserRole' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 23:17:22.712 -03:00 [DBG] Context 'AuthServerContext' started tracking 'Role' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 23:17:22.715 -03:00 [DBG] Context 'AuthServerContext' started tracking 'User' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 23:17:22.716 -03:00 [DBG] Context 'AuthServerContext' started tracking 'UserRole' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 23:17:22.717 -03:00 [DBG] Context 'AuthServerContext' started tracking 'Role' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 23:17:22.718 -03:00 [DBG] Closing data reader to 'AuthServer' on server 'localhost,1433'.
2024-11-06 23:17:22.719 -03:00 [DBG] A data reader for 'AuthServer' on server 'localhost,1433' is being disposed after spending 53ms reading results.
2024-11-06 23:17:22.719 -03:00 [DBG] Closing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 23:17:22.720 -03:00 [DBG] Closed connection to database 'AuthServer' on server 'localhost,1433' (0ms).
2024-11-06 23:17:22.722 -03:00 [DBG] 'AuthServerContext' disposed.
2024-11-06 23:17:22.723 -03:00 [DBG] Disposing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 23:17:22.725 -03:00 [DBG] Disposed connection to database '' on server '' (1ms).
2024-11-06 23:17:22.855 -03:00 [INF] Now listening on: https://localhost:7011
2024-11-06 23:17:22.855 -03:00 [INF] Now listening on: http://localhost:5091
2024-11-06 23:17:22.856 -03:00 [DBG] Loaded hosting startup assembly AuthServer
2024-11-06 23:17:22.857 -03:00 [DBG] Loaded hosting startup assembly Microsoft.AspNetCore.Watch.BrowserRefresh
2024-11-06 23:17:22.858 -03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.BrowserLink.Net
2024-11-06 23:17:22.859 -03:00 [INF] Application started. Press Ctrl+C to shut down.
2024-11-06 23:17:22.860 -03:00 [INF] Hosting environment: Development
2024-11-06 23:17:22.861 -03:00 [INF] Content root path: C:\Users\gusta\source\repos\AuthServer\AuthServer
2024-11-06 23:17:22.861 -03:00 [DBG] Hosting started
2024-11-06 23:17:22.936 -03:00 [DBG] Connection id "0HN7UQ98AADL6" accepted.
2024-11-06 23:17:22.936 -03:00 [DBG] Connection id "0HN7UQ98AADL5" accepted.
2024-11-06 23:17:22.942 -03:00 [DBG] Connection id "0HN7UQ98AADL5" started.
2024-11-06 23:17:22.943 -03:00 [DBG] Connection id "0HN7UQ98AADL6" started.
2024-11-06 23:17:22.951 -03:00 [DBG] Connection id "0HN7UQ98AADL6" received FIN.
2024-11-06 23:17:22.951 -03:00 [DBG] Connection id "0HN7UQ98AADL5" received FIN.
2024-11-06 23:17:22.957 -03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2024-11-06 23:17:22.959 -03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2024-11-06 23:17:22.974 -03:00 [DBG] Connection id "0HN7UQ98AADL6" stopped.
2024-11-06 23:17:22.974 -03:00 [DBG] Connection id "0HN7UQ98AADL5" stopped.
2024-11-06 23:17:22.976 -03:00 [DBG] Connection id "0HN7UQ98AADL6" sending FIN because: "The Socket transport's send loop completed gracefully."
2024-11-06 23:17:22.976 -03:00 [DBG] Connection id "0HN7UQ98AADL5" sending FIN because: "The Socket transport's send loop completed gracefully."
2024-11-06 23:17:23.216 -03:00 [DBG] Connection id "0HN7UQ98AADL7" accepted.
2024-11-06 23:17:23.219 -03:00 [DBG] Connection id "0HN7UQ98AADL7" started.
2024-11-06 23:17:23.382 -03:00 [DBG] Connection 0HN7UQ98AADL7 established using the following protocol: "Tls13"
2024-11-06 23:17:23.425 -03:00 [INF] Request starting HTTP/2 GET https://localhost:7011/swagger/index.html - null null
2024-11-06 23:17:23.722 -03:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2024-11-06 23:17:23.737 -03:00 [DBG] No candidates found for the request path '/swagger/index.html'
2024-11-06 23:17:23.739 -03:00 [DBG] Request did not match any endpoints
2024-11-06 23:17:23.802 -03:00 [DBG] Response markup is scheduled to include Browser Link script injection.
2024-11-06 23:17:23.804 -03:00 [DBG] Response markup is scheduled to include browser refresh script injection.
2024-11-06 23:17:23.810 -03:00 [DBG] Response markup was updated to include Browser Link script injection.
2024-11-06 23:17:23.811 -03:00 [DBG] Response markup was updated to include browser refresh script injection.
2024-11-06 23:17:23.814 -03:00 [INF] Request finished HTTP/2 GET https://localhost:7011/swagger/index.html - 200 null text/html;charset=utf-8 389.7529ms
2024-11-06 23:17:23.836 -03:00 [INF] Request starting HTTP/2 GET https://localhost:7011/swagger/index.js - null null
2024-11-06 23:17:23.836 -03:00 [INF] Request starting HTTP/2 GET https://localhost:7011/_framework/aspnetcore-browser-refresh.js - null null
2024-11-06 23:17:23.839 -03:00 [DBG] No candidates found for the request path '/swagger/index.js'
2024-11-06 23:17:23.843 -03:00 [DBG] Request did not match any endpoints
2024-11-06 23:17:23.846 -03:00 [INF] Request finished HTTP/2 GET https://localhost:7011/swagger/index.js - 200 null application/javascript;charset=utf-8 9.6191ms
2024-11-06 23:17:23.850 -03:00 [INF] Request finished HTTP/2 GET https://localhost:7011/_framework/aspnetcore-browser-refresh.js - 200 13756 application/javascript; charset=utf-8 14.1113ms
2024-11-06 23:17:23.924 -03:00 [INF] Request starting HTTP/2 GET https://localhost:7011/_vs/browserLink - null null
2024-11-06 23:17:23.964 -03:00 [INF] Request finished HTTP/2 GET https://localhost:7011/_vs/browserLink - 200 null text/javascript; charset=UTF-8 40.1714ms
2024-11-06 23:17:24.024 -03:00 [INF] Request starting HTTP/2 GET https://localhost:7011/swagger/v1/swagger.json - null null
2024-11-06 23:17:24.026 -03:00 [DBG] No candidates found for the request path '/swagger/v1/swagger.json'
2024-11-06 23:17:24.027 -03:00 [DBG] Request did not match any endpoints
2024-11-06 23:17:24.122 -03:00 [INF] Request finished HTTP/2 GET https://localhost:7011/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 97.8826ms
2024-11-06 23:17:32.016 -03:00 [DBG] Connection id "0HN7UQ98AADL7" received FIN.
2024-11-06 23:17:32.018 -03:00 [DBG] Connection id "0HN7UQ98AADL7" is closed. The last processed stream ID was 9.
2024-11-06 23:17:32.019 -03:00 [DBG] The connection queue processing loop for 0HN7UQ98AADL7 completed.
2024-11-06 23:17:32.020 -03:00 [DBG] Connection id "0HN7UQ98AADL7" sending FIN because: "The Socket transport's send loop completed gracefully."
2024-11-06 23:17:32.032 -03:00 [DBG] Connection id "0HN7UQ98AADL7" stopped.
2024-11-06 23:26:47.882 -03:00 [INF] Aplicação iniciada - configuração de logs inicializada.
2024-11-06 23:26:48.056 -03:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2024-11-06 23:26:48.086 -03:00 [DBG] Hosting starting
2024-11-06 23:26:48.098 -03:00 [INF] User profile is available. Using 'C:\Users\gusta\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2024-11-06 23:26:48.104 -03:00 [DBG] Reading data from file 'C:\Users\gusta\AppData\Local\ASP.NET\DataProtection-Keys\key-bf4636f6-ef08-4ac9-8613-5c8299c406a4.xml'.
2024-11-06 23:26:48.109 -03:00 [DBG] Found key {bf4636f6-ef08-4ac9-8613-5c8299c406a4}.
2024-11-06 23:26:48.115 -03:00 [DBG] Considering key {bf4636f6-ef08-4ac9-8613-5c8299c406a4} with expiration date 2025-02-02 14:46:39Z as default key.
2024-11-06 23:26:48.117 -03:00 [DBG] Forwarded activator type request from Microsoft.AspNetCore.DataProtection.XmlEncryption.DpapiXmlDecryptor, Microsoft.AspNetCore.DataProtection, Version=8.0.0.0, Culture=neutral, PublicKeyToken=adb9793829ddae60 to Microsoft.AspNetCore.DataProtection.XmlEncryption.DpapiXmlDecryptor, Microsoft.AspNetCore.DataProtection, Culture=neutral, PublicKeyToken=adb9793829ddae60
2024-11-06 23:26:48.119 -03:00 [DBG] Decrypting secret element using Windows DPAPI.
2024-11-06 23:26:48.120 -03:00 [DBG] Forwarded activator type request from Microsoft.AspNetCore.DataProtection.AuthenticatedEncryption.ConfigurationModel.AuthenticatedEncryptorDescriptorDeserializer, Microsoft.AspNetCore.DataProtection, Version=8.0.0.0, Culture=neutral, PublicKeyToken=adb9793829ddae60 to Microsoft.AspNetCore.DataProtection.AuthenticatedEncryption.ConfigurationModel.AuthenticatedEncryptorDescriptorDeserializer, Microsoft.AspNetCore.DataProtection, Culture=neutral, PublicKeyToken=adb9793829ddae60
2024-11-06 23:26:48.124 -03:00 [DBG] Opening CNG algorithm 'AES' from provider 'null' with chaining mode CBC.
2024-11-06 23:26:48.126 -03:00 [DBG] Opening CNG algorithm 'SHA256' from provider 'null' with HMAC.
2024-11-06 23:26:48.127 -03:00 [DBG] Using key {bf4636f6-ef08-4ac9-8613-5c8299c406a4} as the default key.
2024-11-06 23:26:48.128 -03:00 [DBG] Key ring with default key {bf4636f6-ef08-4ac9-8613-5c8299c406a4} was loaded during application startup.
2024-11-06 23:26:48.200 -03:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2024-11-06 23:26:48.475 -03:00 [DBG] The index {'RoleId'} was not created on entity type 'UserRole (Dictionary<string, object>)' as the properties are already covered by the index {'RoleId', 'UserId'}.
2024-11-06 23:26:48.607 -03:00 [DBG] Entity Framework Core 8.0.10 initialized 'AuthServerContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:8.0.10' with options: None
2024-11-06 23:26:48.643 -03:00 [DBG] Compiling query expression: 
'DbSet<Role>()
    .Count()'
2024-11-06 23:26:48.754 -03:00 [DBG] Generated query execution expression: 
'queryContext => new SingleQueryingEnumerable<int>(
    (RelationalQueryContext)queryContext, 
    RelationalCommandCache.QueryExpression(
        Projection Mapping:
            EmptyProjectionMember -> 0
        SELECT COUNT(*)
        FROM Roles AS r), 
    null, 
    Func<QueryContext, DbDataReader, ResultContext, SingleQueryResultCoordinator, int>, 
    AuthServer.AuthServerContext, 
    False, 
    False, 
    True
)
    .Single()'
2024-11-06 23:26:48.772 -03:00 [DBG] Creating DbConnection.
2024-11-06 23:26:48.786 -03:00 [DBG] Created DbConnection. (14ms).
2024-11-06 23:26:48.789 -03:00 [DBG] Opening connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 23:26:48.912 -03:00 [DBG] Opened connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 23:26:48.915 -03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2024-11-06 23:26:48.919 -03:00 [DBG] Created DbCommand for 'ExecuteReader' (2ms).
2024-11-06 23:26:48.921 -03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (6ms).
2024-11-06 23:26:48.925 -03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*)
FROM [Roles] AS [r]
2024-11-06 23:26:48.944 -03:00 [INF] Executed DbCommand (18ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*)
FROM [Roles] AS [r]
2024-11-06 23:26:48.950 -03:00 [DBG] Closing data reader to 'AuthServer' on server 'localhost,1433'.
2024-11-06 23:26:48.954 -03:00 [DBG] A data reader for 'AuthServer' on server 'localhost,1433' is being disposed after spending 6ms reading results.
2024-11-06 23:26:48.957 -03:00 [DBG] Closing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 23:26:48.960 -03:00 [DBG] Closed connection to database 'AuthServer' on server 'localhost,1433' (3ms).
2024-11-06 23:26:48.965 -03:00 [DBG] Compiling query expression: 
'DbSet<User>()
    .Include(user => user.Roles)'
2024-11-06 23:26:48.977 -03:00 [DBG] Including navigation: 'User.Roles'.
2024-11-06 23:26:49.040 -03:00 [DBG] Generated query execution expression: 
'queryContext => new SingleQueryingEnumerable<User>(
    (RelationalQueryContext)queryContext, 
    RelationalCommandCache.QueryExpression(
        Client Projections:
            0 -> Dictionary<IProperty, int> { [Property: User.ID (long) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: User.Email (string) Required Index, 1], [Property: User.Name (string) Required, 2], [Property: User.Password (string) Required, 3] }
            1 -> 0
            2 -> Dictionary<IProperty, int> { [Property: UserRole (Dictionary<string, object>).RoleId (no field, int) Indexer Required PK FK AfterSave:Throw, 4], [Property: UserRole (Dictionary<string, object>).UserId (no field, long) Indexer Required PK FK Index AfterSave:Throw, 5] }
            3 -> Dictionary<IProperty, int> { [Property: Role.Long (int) Required PK AfterSave:Throw ValueGenerated.OnAdd, 6], [Property: Role.Name (string) Required Index, 7] }
            4 -> 4
            5 -> 5
            6 -> 6
        SELECT u.ID, u.Email, u.Name, u.Password, t.RoleId, t.UserId, t.Long, t.Name
        FROM Users AS u
        LEFT JOIN 
        (
            SELECT u0.RoleId, u0.UserId, r.Long, r.Name
            FROM UserRole AS u0
            INNER JOIN Roles AS r ON u0.RoleId == r.Long
        ) AS t ON u.ID == t.UserId
        ORDER BY u.ID ASC, t.RoleId ASC, t.UserId ASC), 
    null, 
    Func<QueryContext, DbDataReader, ResultContext, SingleQueryResultCoordinator, User>, 
    AuthServer.AuthServerContext, 
    False, 
    False, 
    True
)'
2024-11-06 23:26:49.045 -03:00 [DBG] Opening connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 23:26:49.046 -03:00 [DBG] Opened connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 23:26:49.047 -03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2024-11-06 23:26:49.048 -03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2024-11-06 23:26:49.048 -03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2024-11-06 23:26:49.049 -03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[ID], [u].[Email], [u].[Name], [u].[Password], [t].[RoleId], [t].[UserId], [t].[Long], [t].[Name]
FROM [Users] AS [u]
LEFT JOIN (
    SELECT [u0].[RoleId], [u0].[UserId], [r].[Long], [r].[Name]
    FROM [UserRole] AS [u0]
    INNER JOIN [Roles] AS [r] ON [u0].[RoleId] = [r].[Long]
) AS [t] ON [u].[ID] = [t].[UserId]
ORDER BY [u].[ID], [t].[RoleId], [t].[UserId]
2024-11-06 23:26:49.053 -03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[ID], [u].[Email], [u].[Name], [u].[Password], [t].[RoleId], [t].[UserId], [t].[Long], [t].[Name]
FROM [Users] AS [u]
LEFT JOIN (
    SELECT [u0].[RoleId], [u0].[UserId], [r].[Long], [r].[Name]
    FROM [UserRole] AS [u0]
    INNER JOIN [Roles] AS [r] ON [u0].[RoleId] = [r].[Long]
) AS [t] ON [u].[ID] = [t].[UserId]
ORDER BY [u].[ID], [t].[RoleId], [t].[UserId]
2024-11-06 23:26:49.071 -03:00 [DBG] Context 'AuthServerContext' started tracking 'User' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 23:26:49.091 -03:00 [DBG] Context 'AuthServerContext' started tracking 'UserRole' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 23:26:49.102 -03:00 [DBG] Context 'AuthServerContext' started tracking 'Role' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 23:26:49.105 -03:00 [DBG] Context 'AuthServerContext' started tracking 'User' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 23:26:49.106 -03:00 [DBG] Context 'AuthServerContext' started tracking 'UserRole' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 23:26:49.107 -03:00 [DBG] Context 'AuthServerContext' started tracking 'Role' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 23:26:49.108 -03:00 [DBG] Closing data reader to 'AuthServer' on server 'localhost,1433'.
2024-11-06 23:26:49.109 -03:00 [DBG] A data reader for 'AuthServer' on server 'localhost,1433' is being disposed after spending 54ms reading results.
2024-11-06 23:26:49.110 -03:00 [DBG] Closing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 23:26:49.111 -03:00 [DBG] Closed connection to database 'AuthServer' on server 'localhost,1433' (0ms).
2024-11-06 23:26:49.112 -03:00 [DBG] 'AuthServerContext' disposed.
2024-11-06 23:26:49.114 -03:00 [DBG] Disposing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 23:26:49.115 -03:00 [DBG] Disposed connection to database '' on server '' (1ms).
2024-11-06 23:26:49.198 -03:00 [INF] Now listening on: https://localhost:7011
2024-11-06 23:26:49.199 -03:00 [INF] Now listening on: http://localhost:5091
2024-11-06 23:26:49.200 -03:00 [DBG] Loaded hosting startup assembly AuthServer
2024-11-06 23:26:49.200 -03:00 [DBG] Loaded hosting startup assembly Microsoft.AspNetCore.Watch.BrowserRefresh
2024-11-06 23:26:49.200 -03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.BrowserLink.Net
2024-11-06 23:26:49.201 -03:00 [INF] Application started. Press Ctrl+C to shut down.
2024-11-06 23:26:49.202 -03:00 [INF] Hosting environment: Development
2024-11-06 23:26:49.202 -03:00 [INF] Content root path: C:\Users\gusta\source\repos\AuthServer\AuthServer
2024-11-06 23:26:49.203 -03:00 [DBG] Hosting started
2024-11-06 23:26:49.435 -03:00 [DBG] Connection id "0HN7UQEH4SCNL" accepted.
2024-11-06 23:26:49.435 -03:00 [DBG] Connection id "0HN7UQEH4SCNM" accepted.
2024-11-06 23:26:49.437 -03:00 [DBG] Connection id "0HN7UQEH4SCNL" started.
2024-11-06 23:26:49.437 -03:00 [DBG] Connection id "0HN7UQEH4SCNM" started.
2024-11-06 23:26:49.536 -03:00 [DBG] Connection id "0HN7UQEH4SCNL" received FIN.
2024-11-06 23:26:49.536 -03:00 [DBG] Connection id "0HN7UQEH4SCNM" received FIN.
2024-11-06 23:26:49.542 -03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2024-11-06 23:26:49.542 -03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2024-11-06 23:26:49.556 -03:00 [DBG] Connection id "0HN7UQEH4SCNL" stopped.
2024-11-06 23:26:49.556 -03:00 [DBG] Connection id "0HN7UQEH4SCNM" stopped.
2024-11-06 23:26:49.558 -03:00 [DBG] Connection id "0HN7UQEH4SCNL" sending FIN because: "The Socket transport's send loop completed gracefully."
2024-11-06 23:26:49.558 -03:00 [DBG] Connection id "0HN7UQEH4SCNM" sending FIN because: "The Socket transport's send loop completed gracefully."
2024-11-06 23:26:49.648 -03:00 [DBG] Connection id "0HN7UQEH4SCNN" accepted.
2024-11-06 23:26:49.650 -03:00 [DBG] Connection id "0HN7UQEH4SCNN" started.
2024-11-06 23:26:49.678 -03:00 [DBG] Connection 0HN7UQEH4SCNN established using the following protocol: "Tls13"
2024-11-06 23:26:49.711 -03:00 [INF] Request starting HTTP/2 GET https://localhost:7011/swagger/index.html - null null
2024-11-06 23:26:49.794 -03:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2024-11-06 23:26:49.805 -03:00 [DBG] No candidates found for the request path '/swagger/index.html'
2024-11-06 23:26:49.806 -03:00 [DBG] Request did not match any endpoints
2024-11-06 23:26:49.864 -03:00 [DBG] Response markup is scheduled to include Browser Link script injection.
2024-11-06 23:26:49.866 -03:00 [DBG] Response markup is scheduled to include browser refresh script injection.
2024-11-06 23:26:49.870 -03:00 [DBG] Response markup was updated to include Browser Link script injection.
2024-11-06 23:26:49.870 -03:00 [DBG] Response markup was updated to include browser refresh script injection.
2024-11-06 23:26:49.874 -03:00 [INF] Request finished HTTP/2 GET https://localhost:7011/swagger/index.html - 200 null text/html;charset=utf-8 163.7622ms
2024-11-06 23:26:49.893 -03:00 [INF] Request starting HTTP/2 GET https://localhost:7011/_framework/aspnetcore-browser-refresh.js - null null
2024-11-06 23:26:49.893 -03:00 [INF] Request starting HTTP/2 GET https://localhost:7011/swagger/index.js - null null
2024-11-06 23:26:49.898 -03:00 [DBG] No candidates found for the request path '/swagger/index.js'
2024-11-06 23:26:49.898 -03:00 [DBG] Request did not match any endpoints
2024-11-06 23:26:49.901 -03:00 [INF] Request finished HTTP/2 GET https://localhost:7011/swagger/index.js - 200 null application/javascript;charset=utf-8 7.834ms
2024-11-06 23:26:49.903 -03:00 [INF] Request finished HTTP/2 GET https://localhost:7011/_framework/aspnetcore-browser-refresh.js - 200 13756 application/javascript; charset=utf-8 9.5441ms
2024-11-06 23:26:49.976 -03:00 [INF] Request starting HTTP/2 GET https://localhost:7011/_vs/browserLink - null null
2024-11-06 23:26:50.014 -03:00 [INF] Request finished HTTP/2 GET https://localhost:7011/_vs/browserLink - 200 null text/javascript; charset=UTF-8 38.2344ms
2024-11-06 23:26:50.077 -03:00 [INF] Request starting HTTP/2 GET https://localhost:7011/swagger/v1/swagger.json - null null
2024-11-06 23:26:50.078 -03:00 [DBG] No candidates found for the request path '/swagger/v1/swagger.json'
2024-11-06 23:26:50.079 -03:00 [DBG] Request did not match any endpoints
2024-11-06 23:26:50.179 -03:00 [INF] Request finished HTTP/2 GET https://localhost:7011/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 102.5013ms
2024-11-06 23:26:57.900 -03:00 [DBG] Connection id "0HN7UQEH4SCNN" received FIN.
2024-11-06 23:26:57.903 -03:00 [DBG] The connection queue processing loop for 0HN7UQEH4SCNN completed.
2024-11-06 23:26:57.903 -03:00 [DBG] Connection id "0HN7UQEH4SCNN" is closed. The last processed stream ID was 9.
2024-11-06 23:26:57.905 -03:00 [DBG] Connection id "0HN7UQEH4SCNN" sending FIN because: "The Socket transport's send loop completed gracefully."
2024-11-06 23:26:57.915 -03:00 [DBG] Connection id "0HN7UQEH4SCNN" stopped.
2024-11-06 23:27:02.221 -03:00 [DBG] Connection id "0HN7UQEH4SCNO" accepted.
2024-11-06 23:27:02.222 -03:00 [DBG] Connection id "0HN7UQEH4SCNO" started.
2024-11-06 23:27:02.225 -03:00 [DBG] Connection 0HN7UQEH4SCNO established using the following protocol: "Tls13"
2024-11-06 23:27:02.227 -03:00 [INF] Request starting HTTP/2 POST https://localhost:7011/api/users/login - application/json 60
2024-11-06 23:27:02.231 -03:00 [DBG] 1 candidate(s) found for the request path '/api/users/login'
2024-11-06 23:27:02.232 -03:00 [DBG] Endpoint 'AuthServer.Users.UsersController.Login (AuthServer)' with route pattern 'api/users/login' is valid for the request path '/api/users/login'
2024-11-06 23:27:02.234 -03:00 [DBG] Request matched endpoint 'AuthServer.Users.UsersController.Login (AuthServer)'
2024-11-06 23:27:02.236 -03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2024-11-06 23:27:02.240 -03:00 [DBG] The request has an origin header: 'https://localhost:7011'.
2024-11-06 23:27:02.241 -03:00 [INF] CORS policy execution successful.
2024-11-06 23:27:02.297 -03:00 [DBG] AuthenticationScheme: Bearer was not authenticated.
2024-11-06 23:27:02.299 -03:00 [INF] Executing endpoint 'AuthServer.Users.UsersController.Login (AuthServer)'
2024-11-06 23:27:02.314 -03:00 [INF] Route matched with {action = "Login", controller = "Users"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult Login(AuthServer.Users.LoginRequest) on controller AuthServer.Users.UsersController (AuthServer).
2024-11-06 23:27:02.316 -03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2024-11-06 23:27:02.317 -03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2024-11-06 23:27:02.318 -03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)"]
2024-11-06 23:27:02.319 -03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2024-11-06 23:27:02.320 -03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)"]
2024-11-06 23:27:02.323 -03:00 [DBG] Executing controller factory for controller AuthServer.Users.UsersController (AuthServer)
2024-11-06 23:27:02.325 -03:00 [DBG] Executed controller factory for controller AuthServer.Users.UsersController (AuthServer)
2024-11-06 23:27:02.331 -03:00 [DBG] Attempting to bind parameter 'credentials' of type 'AuthServer.Users.LoginRequest' ...
2024-11-06 23:27:02.333 -03:00 [DBG] Attempting to bind parameter 'credentials' of type 'AuthServer.Users.LoginRequest' using the name '' in request data ...
2024-11-06 23:27:02.334 -03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2024-11-06 23:27:02.344 -03:00 [DBG] Connection id "0HN7UQEH4SCNO", Request id "0HN7UQEH4SCNO:00000001": started reading request body.
2024-11-06 23:27:02.345 -03:00 [DBG] Connection id "0HN7UQEH4SCNO", Request id "0HN7UQEH4SCNO:00000001": done reading request body.
2024-11-06 23:27:02.348 -03:00 [DBG] JSON input formatter succeeded, deserializing to type 'AuthServer.Users.LoginRequest'
2024-11-06 23:27:02.349 -03:00 [DBG] Done attempting to bind parameter 'credentials' of type 'AuthServer.Users.LoginRequest'.
2024-11-06 23:27:02.350 -03:00 [DBG] Done attempting to bind parameter 'credentials' of type 'AuthServer.Users.LoginRequest'.
2024-11-06 23:27:02.351 -03:00 [DBG] Attempting to validate the bound parameter 'credentials' of type 'AuthServer.Users.LoginRequest' ...
2024-11-06 23:27:02.359 -03:00 [DBG] Done attempting to validate the bound parameter 'credentials' of type 'AuthServer.Users.LoginRequest'.
2024-11-06 23:27:02.373 -03:00 [DBG] Entity Framework Core 8.0.10 initialized 'AuthServerContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:8.0.10' with options: None
2024-11-06 23:27:02.379 -03:00 [DBG] Compiling query expression: 
'DbSet<User>()
    .Include(u => u.Roles)
    .FirstOrDefault(u => u.Email == __email_0)'
2024-11-06 23:27:02.381 -03:00 [DBG] Including navigation: 'User.Roles'.
2024-11-06 23:27:02.392 -03:00 [DBG] Generated query execution expression: 
'queryContext => new SingleQueryingEnumerable<User>(
    (RelationalQueryContext)queryContext, 
    RelationalCommandCache.QueryExpression(
        Client Projections:
            0 -> Dictionary<IProperty, int> { [Property: User.ID (long) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: User.Email (string) Required Index, 1], [Property: User.Name (string) Required, 2], [Property: User.Password (string) Required, 3] }
            1 -> 0
            2 -> Dictionary<IProperty, int> { [Property: UserRole (Dictionary<string, object>).RoleId (no field, int) Indexer Required PK FK AfterSave:Throw, 4], [Property: UserRole (Dictionary<string, object>).UserId (no field, long) Indexer Required PK FK Index AfterSave:Throw, 5] }
            3 -> Dictionary<IProperty, int> { [Property: Role.Long (int) Required PK AfterSave:Throw ValueGenerated.OnAdd, 6], [Property: Role.Name (string) Required Index, 7] }
            4 -> 4
            5 -> 5
            6 -> 6
        SELECT t.ID, t.Email, t.Name, t.Password, t0.RoleId, t0.UserId, t0.Long, t0.Name
        FROM 
        (
            SELECT TOP(1) u.ID, u.Email, u.Name, u.Password
            FROM Users AS u
            WHERE u.Email == @__email_0
        ) AS t
        LEFT JOIN 
        (
            SELECT u0.RoleId, u0.UserId, r.Long, r.Name
            FROM UserRole AS u0
            INNER JOIN Roles AS r ON u0.RoleId == r.Long
        ) AS t0 ON t.ID == t0.UserId
        ORDER BY t.ID ASC, t0.RoleId ASC, t0.UserId ASC), 
    null, 
    Func<QueryContext, DbDataReader, ResultContext, SingleQueryResultCoordinator, User>, 
    AuthServer.AuthServerContext, 
    False, 
    False, 
    True
)
    .SingleOrDefault()'
2024-11-06 23:27:02.395 -03:00 [DBG] Creating DbConnection.
2024-11-06 23:27:02.395 -03:00 [DBG] Created DbConnection. (0ms).
2024-11-06 23:27:02.396 -03:00 [DBG] Opening connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 23:27:02.397 -03:00 [DBG] Opened connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 23:27:02.398 -03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2024-11-06 23:27:02.398 -03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2024-11-06 23:27:02.401 -03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (3ms).
2024-11-06 23:27:02.403 -03:00 [DBG] Executing DbCommand [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[ID], [t].[Email], [t].[Name], [t].[Password], [t0].[RoleId], [t0].[UserId], [t0].[Long], [t0].[Name]
FROM (
    SELECT TOP(1) [u].[ID], [u].[Email], [u].[Name], [u].[Password]
    FROM [Users] AS [u]
    WHERE [u].[Email] = @__email_0
) AS [t]
LEFT JOIN (
    SELECT [u0].[RoleId], [u0].[UserId], [r].[Long], [r].[Name]
    FROM [UserRole] AS [u0]
    INNER JOIN [Roles] AS [r] ON [u0].[RoleId] = [r].[Long]
) AS [t0] ON [t].[ID] = [t0].[UserId]
ORDER BY [t].[ID], [t0].[RoleId], [t0].[UserId]
2024-11-06 23:27:02.426 -03:00 [INF] Executed DbCommand (24ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[ID], [t].[Email], [t].[Name], [t].[Password], [t0].[RoleId], [t0].[UserId], [t0].[Long], [t0].[Name]
FROM (
    SELECT TOP(1) [u].[ID], [u].[Email], [u].[Name], [u].[Password]
    FROM [Users] AS [u]
    WHERE [u].[Email] = @__email_0
) AS [t]
LEFT JOIN (
    SELECT [u0].[RoleId], [u0].[UserId], [r].[Long], [r].[Name]
    FROM [UserRole] AS [u0]
    INNER JOIN [Roles] AS [r] ON [u0].[RoleId] = [r].[Long]
) AS [t0] ON [t].[ID] = [t0].[UserId]
ORDER BY [t].[ID], [t0].[RoleId], [t0].[UserId]
2024-11-06 23:27:02.428 -03:00 [DBG] Context 'AuthServerContext' started tracking 'User' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 23:27:02.429 -03:00 [DBG] Context 'AuthServerContext' started tracking 'UserRole' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 23:27:02.429 -03:00 [DBG] Context 'AuthServerContext' started tracking 'Role' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 23:27:02.430 -03:00 [DBG] Closing data reader to 'AuthServer' on server 'localhost,1433'.
2024-11-06 23:27:02.431 -03:00 [DBG] A data reader for 'AuthServer' on server 'localhost,1433' is being disposed after spending 3ms reading results.
2024-11-06 23:27:02.432 -03:00 [DBG] Closing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 23:27:02.433 -03:00 [DBG] Closed connection to database 'AuthServer' on server 'localhost,1433' (0ms).
2024-11-06 23:27:02.434 -03:00 [INF] User logged in. id=16 name=Auth Server Administrator
2024-11-06 23:27:02.504 -03:00 [DBG] List of registered output formatters, in the following order: ["Microsoft.AspNetCore.Mvc.Formatters.HttpNoContentOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StringOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StreamOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter"]
2024-11-06 23:27:02.506 -03:00 [DBG] No information found on request to perform content negotiation.
2024-11-06 23:27:02.507 -03:00 [DBG] Attempting to select an output formatter without using a content type as no explicit content types were specified for the response.
2024-11-06 23:27:02.508 -03:00 [DBG] Attempting to select the first formatter in the output formatters list which can write the result.
2024-11-06 23:27:02.509 -03:00 [DBG] Selected output formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter' and content type 'application/json' to write the response.
2024-11-06 23:27:02.510 -03:00 [INF] Executing OkObjectResult, writing value of type 'LoginResponse'.
2024-11-06 23:27:02.520 -03:00 [INF] Executed action AuthServer.Users.UsersController.Login (AuthServer) in 197.3297ms
2024-11-06 23:27:02.522 -03:00 [INF] Executed endpoint 'AuthServer.Users.UsersController.Login (AuthServer)'
2024-11-06 23:27:02.523 -03:00 [DBG] 'AuthServerContext' disposed.
2024-11-06 23:27:02.526 -03:00 [DBG] Disposing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 23:27:02.528 -03:00 [DBG] Disposed connection to database '' on server '' (1ms).
2024-11-06 23:27:02.529 -03:00 [INF] Request finished HTTP/2 POST https://localhost:7011/api/users/login - 200 null application/json; charset=utf-8 302.4337ms
2024-11-06 23:35:09.132 -03:00 [INF] Aplicação iniciada - configuração de logs inicializada.
2024-11-06 23:35:09.304 -03:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2024-11-06 23:35:09.333 -03:00 [DBG] Hosting starting
2024-11-06 23:35:09.343 -03:00 [INF] User profile is available. Using 'C:\Users\gusta\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2024-11-06 23:35:09.348 -03:00 [DBG] Reading data from file 'C:\Users\gusta\AppData\Local\ASP.NET\DataProtection-Keys\key-bf4636f6-ef08-4ac9-8613-5c8299c406a4.xml'.
2024-11-06 23:35:09.353 -03:00 [DBG] Found key {bf4636f6-ef08-4ac9-8613-5c8299c406a4}.
2024-11-06 23:35:09.358 -03:00 [DBG] Considering key {bf4636f6-ef08-4ac9-8613-5c8299c406a4} with expiration date 2025-02-02 14:46:39Z as default key.
2024-11-06 23:35:09.360 -03:00 [DBG] Forwarded activator type request from Microsoft.AspNetCore.DataProtection.XmlEncryption.DpapiXmlDecryptor, Microsoft.AspNetCore.DataProtection, Version=8.0.0.0, Culture=neutral, PublicKeyToken=adb9793829ddae60 to Microsoft.AspNetCore.DataProtection.XmlEncryption.DpapiXmlDecryptor, Microsoft.AspNetCore.DataProtection, Culture=neutral, PublicKeyToken=adb9793829ddae60
2024-11-06 23:35:09.362 -03:00 [DBG] Decrypting secret element using Windows DPAPI.
2024-11-06 23:35:09.363 -03:00 [DBG] Forwarded activator type request from Microsoft.AspNetCore.DataProtection.AuthenticatedEncryption.ConfigurationModel.AuthenticatedEncryptorDescriptorDeserializer, Microsoft.AspNetCore.DataProtection, Version=8.0.0.0, Culture=neutral, PublicKeyToken=adb9793829ddae60 to Microsoft.AspNetCore.DataProtection.AuthenticatedEncryption.ConfigurationModel.AuthenticatedEncryptorDescriptorDeserializer, Microsoft.AspNetCore.DataProtection, Culture=neutral, PublicKeyToken=adb9793829ddae60
2024-11-06 23:35:09.367 -03:00 [DBG] Opening CNG algorithm 'AES' from provider 'null' with chaining mode CBC.
2024-11-06 23:35:09.368 -03:00 [DBG] Opening CNG algorithm 'SHA256' from provider 'null' with HMAC.
2024-11-06 23:35:09.370 -03:00 [DBG] Using key {bf4636f6-ef08-4ac9-8613-5c8299c406a4} as the default key.
2024-11-06 23:35:09.370 -03:00 [DBG] Key ring with default key {bf4636f6-ef08-4ac9-8613-5c8299c406a4} was loaded during application startup.
2024-11-06 23:35:09.419 -03:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2024-11-06 23:35:09.650 -03:00 [DBG] The index {'RoleId'} was not created on entity type 'UserRole (Dictionary<string, object>)' as the properties are already covered by the index {'RoleId', 'UserId'}.
2024-11-06 23:35:09.780 -03:00 [DBG] Entity Framework Core 8.0.10 initialized 'AuthServerContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:8.0.10' with options: None
2024-11-06 23:35:09.805 -03:00 [DBG] Compiling query expression: 
'DbSet<Role>()
    .Count()'
2024-11-06 23:35:09.904 -03:00 [DBG] Generated query execution expression: 
'queryContext => new SingleQueryingEnumerable<int>(
    (RelationalQueryContext)queryContext, 
    RelationalCommandCache.QueryExpression(
        Projection Mapping:
            EmptyProjectionMember -> 0
        SELECT COUNT(*)
        FROM Roles AS r), 
    null, 
    Func<QueryContext, DbDataReader, ResultContext, SingleQueryResultCoordinator, int>, 
    AuthServer.AuthServerContext, 
    False, 
    False, 
    True
)
    .Single()'
2024-11-06 23:35:09.919 -03:00 [DBG] Creating DbConnection.
2024-11-06 23:35:09.930 -03:00 [DBG] Created DbConnection. (10ms).
2024-11-06 23:35:09.932 -03:00 [DBG] Opening connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 23:35:10.030 -03:00 [DBG] Opened connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 23:35:10.032 -03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2024-11-06 23:35:10.036 -03:00 [DBG] Created DbCommand for 'ExecuteReader' (2ms).
2024-11-06 23:35:10.037 -03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (5ms).
2024-11-06 23:35:10.041 -03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*)
FROM [Roles] AS [r]
2024-11-06 23:35:10.057 -03:00 [INF] Executed DbCommand (14ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*)
FROM [Roles] AS [r]
2024-11-06 23:35:10.063 -03:00 [DBG] Closing data reader to 'AuthServer' on server 'localhost,1433'.
2024-11-06 23:35:10.067 -03:00 [DBG] A data reader for 'AuthServer' on server 'localhost,1433' is being disposed after spending 6ms reading results.
2024-11-06 23:35:10.069 -03:00 [DBG] Closing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 23:35:10.072 -03:00 [DBG] Closed connection to database 'AuthServer' on server 'localhost,1433' (3ms).
2024-11-06 23:35:10.077 -03:00 [DBG] Compiling query expression: 
'DbSet<User>()
    .Include(user => user.Roles)'
2024-11-06 23:35:10.085 -03:00 [DBG] Including navigation: 'User.Roles'.
2024-11-06 23:35:10.145 -03:00 [DBG] Generated query execution expression: 
'queryContext => new SingleQueryingEnumerable<User>(
    (RelationalQueryContext)queryContext, 
    RelationalCommandCache.QueryExpression(
        Client Projections:
            0 -> Dictionary<IProperty, int> { [Property: User.ID (long) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: User.Email (string) Required Index, 1], [Property: User.Name (string) Required, 2], [Property: User.Password (string) Required, 3] }
            1 -> 0
            2 -> Dictionary<IProperty, int> { [Property: UserRole (Dictionary<string, object>).RoleId (no field, int) Indexer Required PK FK AfterSave:Throw, 4], [Property: UserRole (Dictionary<string, object>).UserId (no field, long) Indexer Required PK FK Index AfterSave:Throw, 5] }
            3 -> Dictionary<IProperty, int> { [Property: Role.Long (int) Required PK AfterSave:Throw ValueGenerated.OnAdd, 6], [Property: Role.Name (string) Required Index, 7] }
            4 -> 4
            5 -> 5
            6 -> 6
        SELECT u.ID, u.Email, u.Name, u.Password, t.RoleId, t.UserId, t.Long, t.Name
        FROM Users AS u
        LEFT JOIN 
        (
            SELECT u0.RoleId, u0.UserId, r.Long, r.Name
            FROM UserRole AS u0
            INNER JOIN Roles AS r ON u0.RoleId == r.Long
        ) AS t ON u.ID == t.UserId
        ORDER BY u.ID ASC, t.RoleId ASC, t.UserId ASC), 
    null, 
    Func<QueryContext, DbDataReader, ResultContext, SingleQueryResultCoordinator, User>, 
    AuthServer.AuthServerContext, 
    False, 
    False, 
    True
)'
2024-11-06 23:35:10.150 -03:00 [DBG] Opening connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 23:35:10.152 -03:00 [DBG] Opened connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 23:35:10.153 -03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2024-11-06 23:35:10.153 -03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2024-11-06 23:35:10.154 -03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2024-11-06 23:35:10.155 -03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[ID], [u].[Email], [u].[Name], [u].[Password], [t].[RoleId], [t].[UserId], [t].[Long], [t].[Name]
FROM [Users] AS [u]
LEFT JOIN (
    SELECT [u0].[RoleId], [u0].[UserId], [r].[Long], [r].[Name]
    FROM [UserRole] AS [u0]
    INNER JOIN [Roles] AS [r] ON [u0].[RoleId] = [r].[Long]
) AS [t] ON [u].[ID] = [t].[UserId]
ORDER BY [u].[ID], [t].[RoleId], [t].[UserId]
2024-11-06 23:35:10.158 -03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[ID], [u].[Email], [u].[Name], [u].[Password], [t].[RoleId], [t].[UserId], [t].[Long], [t].[Name]
FROM [Users] AS [u]
LEFT JOIN (
    SELECT [u0].[RoleId], [u0].[UserId], [r].[Long], [r].[Name]
    FROM [UserRole] AS [u0]
    INNER JOIN [Roles] AS [r] ON [u0].[RoleId] = [r].[Long]
) AS [t] ON [u].[ID] = [t].[UserId]
ORDER BY [u].[ID], [t].[RoleId], [t].[UserId]
2024-11-06 23:35:10.176 -03:00 [DBG] Context 'AuthServerContext' started tracking 'User' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 23:35:10.196 -03:00 [DBG] Context 'AuthServerContext' started tracking 'UserRole' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 23:35:10.206 -03:00 [DBG] Context 'AuthServerContext' started tracking 'Role' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 23:35:10.209 -03:00 [DBG] Context 'AuthServerContext' started tracking 'User' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 23:35:10.210 -03:00 [DBG] Context 'AuthServerContext' started tracking 'UserRole' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 23:35:10.210 -03:00 [DBG] Context 'AuthServerContext' started tracking 'Role' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 23:35:10.211 -03:00 [DBG] Closing data reader to 'AuthServer' on server 'localhost,1433'.
2024-11-06 23:35:10.212 -03:00 [DBG] A data reader for 'AuthServer' on server 'localhost,1433' is being disposed after spending 52ms reading results.
2024-11-06 23:35:10.213 -03:00 [DBG] Closing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 23:35:10.214 -03:00 [DBG] Closed connection to database 'AuthServer' on server 'localhost,1433' (0ms).
2024-11-06 23:35:10.215 -03:00 [DBG] 'AuthServerContext' disposed.
2024-11-06 23:35:10.217 -03:00 [DBG] Disposing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 23:35:10.218 -03:00 [DBG] Disposed connection to database '' on server '' (1ms).
2024-11-06 23:35:10.274 -03:00 [INF] Now listening on: https://localhost:7011
2024-11-06 23:35:10.275 -03:00 [INF] Now listening on: http://localhost:5091
2024-11-06 23:35:10.275 -03:00 [DBG] Loaded hosting startup assembly AuthServer
2024-11-06 23:35:10.276 -03:00 [DBG] Loaded hosting startup assembly Microsoft.AspNetCore.Watch.BrowserRefresh
2024-11-06 23:35:10.276 -03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.BrowserLink.Net
2024-11-06 23:35:10.277 -03:00 [INF] Application started. Press Ctrl+C to shut down.
2024-11-06 23:35:10.277 -03:00 [INF] Hosting environment: Development
2024-11-06 23:35:10.278 -03:00 [INF] Content root path: C:\Users\gusta\source\repos\AuthServer\AuthServer
2024-11-06 23:35:10.278 -03:00 [DBG] Hosting started
2024-11-06 23:35:10.650 -03:00 [DBG] Connection id "0HN7UQJ6GR21D" received FIN.
2024-11-06 23:35:10.654 -03:00 [DBG] Connection id "0HN7UQJ6GR21D" accepted.
2024-11-06 23:35:10.656 -03:00 [DBG] Connection id "0HN7UQJ6GR21D" started.
2024-11-06 23:35:10.663 -03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2024-11-06 23:35:10.673 -03:00 [DBG] Connection id "0HN7UQJ6GR21D" stopped.
2024-11-06 23:35:10.675 -03:00 [DBG] Connection id "0HN7UQJ6GR21D" sending FIN because: "The Socket transport's send loop completed gracefully."
2024-11-06 23:35:10.742 -03:00 [DBG] Connection id "0HN7UQJ6GR21E" accepted.
2024-11-06 23:35:10.744 -03:00 [DBG] Connection id "0HN7UQJ6GR21E" started.
2024-11-06 23:35:10.767 -03:00 [DBG] Connection 0HN7UQJ6GR21E established using the following protocol: "Tls13"
2024-11-06 23:35:10.799 -03:00 [INF] Request starting HTTP/2 GET https://localhost:7011/swagger/index.html - null null
2024-11-06 23:35:10.884 -03:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2024-11-06 23:35:10.897 -03:00 [DBG] No candidates found for the request path '/swagger/index.html'
2024-11-06 23:35:10.898 -03:00 [DBG] Request did not match any endpoints
2024-11-06 23:35:10.942 -03:00 [DBG] Response markup is scheduled to include Browser Link script injection.
2024-11-06 23:35:10.944 -03:00 [DBG] Response markup is scheduled to include browser refresh script injection.
2024-11-06 23:35:10.948 -03:00 [DBG] Response markup was updated to include Browser Link script injection.
2024-11-06 23:35:10.949 -03:00 [DBG] Response markup was updated to include browser refresh script injection.
2024-11-06 23:35:10.952 -03:00 [INF] Request finished HTTP/2 GET https://localhost:7011/swagger/index.html - 200 null text/html;charset=utf-8 153.8123ms
2024-11-06 23:35:10.974 -03:00 [INF] Request starting HTTP/2 GET https://localhost:7011/swagger/index.js - null null
2024-11-06 23:35:10.974 -03:00 [INF] Request starting HTTP/2 GET https://localhost:7011/_framework/aspnetcore-browser-refresh.js - null null
2024-11-06 23:35:10.977 -03:00 [DBG] No candidates found for the request path '/swagger/index.js'
2024-11-06 23:35:10.980 -03:00 [DBG] Request did not match any endpoints
2024-11-06 23:35:10.983 -03:00 [INF] Request finished HTTP/2 GET https://localhost:7011/swagger/index.js - 200 null application/javascript;charset=utf-8 8.3723ms
2024-11-06 23:35:10.986 -03:00 [INF] Request finished HTTP/2 GET https://localhost:7011/_framework/aspnetcore-browser-refresh.js - 200 13756 application/javascript; charset=utf-8 12.371ms
2024-11-06 23:35:11.048 -03:00 [INF] Request starting HTTP/2 GET https://localhost:7011/_vs/browserLink - null null
2024-11-06 23:35:11.087 -03:00 [INF] Request finished HTTP/2 GET https://localhost:7011/_vs/browserLink - 200 null text/javascript; charset=UTF-8 38.615ms
2024-11-06 23:35:11.162 -03:00 [INF] Request starting HTTP/2 GET https://localhost:7011/swagger/v1/swagger.json - null null
2024-11-06 23:35:11.164 -03:00 [DBG] No candidates found for the request path '/swagger/v1/swagger.json'
2024-11-06 23:35:11.166 -03:00 [DBG] Request did not match any endpoints
2024-11-06 23:35:11.266 -03:00 [INF] Request finished HTTP/2 GET https://localhost:7011/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 103.7453ms
2024-11-06 23:37:23.533 -03:00 [DBG] Connection id "0HN7UQJ6GR21E" is closing.
2024-11-06 23:37:23.534 -03:00 [DBG] Connection id "0HN7UQJ6GR21E" is closed. The last processed stream ID was 9.
2024-11-06 23:37:23.535 -03:00 [DBG] Connection id "0HN7UQJ6GR21E" received FIN.
2024-11-06 23:37:23.536 -03:00 [DBG] Connection id "0HN7UQJ6GR21E" sending FIN because: "The Socket transport's send loop completed gracefully."
2024-11-06 23:37:23.537 -03:00 [DBG] The connection queue processing loop for 0HN7UQJ6GR21E completed.
2024-11-06 23:37:23.539 -03:00 [DBG] Connection id "0HN7UQJ6GR21E" stopped.
2024-11-06 23:40:20.063 -03:00 [INF] Aplicação iniciada - configuração de logs inicializada.
2024-11-06 23:40:20.196 -03:00 [FTL] A aplicação falhou ao iniciar.
System.AggregateException: Some services are not able to be constructed (Error while validating the service descriptor 'ServiceType: AuthServer.Users.UsersService Lifetime: Transient ImplementationType: AuthServer.Users.UsersService': Unable to resolve service for type 'AuthServer.Security.IJwt' while attempting to activate 'AuthServer.Users.UsersService'.)
 ---> System.InvalidOperationException: Error while validating the service descriptor 'ServiceType: AuthServer.Users.UsersService Lifetime: Transient ImplementationType: AuthServer.Users.UsersService': Unable to resolve service for type 'AuthServer.Security.IJwt' while attempting to activate 'AuthServer.Users.UsersService'.
 ---> System.InvalidOperationException: Unable to resolve service for type 'AuthServer.Security.IJwt' while attempting to activate 'AuthServer.Users.UsersService'.
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateArgumentCallSites(ServiceIdentifier serviceIdentifier, Type implementationType, CallSiteChain callSiteChain, ParameterInfo[] parameters, Boolean throwIfCallSiteNotFound)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateConstructorCallSite(ResultCache lifetime, ServiceIdentifier serviceIdentifier, Type implementationType, CallSiteChain callSiteChain)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.TryCreateExact(ServiceDescriptor descriptor, ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain, Int32 slot)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.GetCallSite(ServiceDescriptor serviceDescriptor, CallSiteChain callSiteChain)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.ValidateService(ServiceDescriptor descriptor)
   --- End of inner exception stack trace ---
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.ValidateService(ServiceDescriptor descriptor)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider..ctor(ICollection`1 serviceDescriptors, ServiceProviderOptions options)
   --- End of inner exception stack trace ---
   at Microsoft.Extensions.DependencyInjection.ServiceProvider..ctor(ICollection`1 serviceDescriptors, ServiceProviderOptions options)
   at Microsoft.Extensions.DependencyInjection.ServiceCollectionContainerBuilderExtensions.BuildServiceProvider(IServiceCollection services, ServiceProviderOptions options)
   at Microsoft.Extensions.Hosting.HostApplicationBuilder.Build()
   at Microsoft.AspNetCore.Builder.WebApplicationBuilder.Build()
   at AuthServer.Program.Main(String[] args) in C:\Users\gusta\source\repos\AuthServer\AuthServer\Program.cs:line 85
2024-11-06 23:40:27.587 -03:00 [INF] Aplicação iniciada - configuração de logs inicializada.
2024-11-06 23:40:27.696 -03:00 [FTL] A aplicação falhou ao iniciar.
System.AggregateException: Some services are not able to be constructed (Error while validating the service descriptor 'ServiceType: AuthServer.Users.UsersService Lifetime: Transient ImplementationType: AuthServer.Users.UsersService': Unable to resolve service for type 'AuthServer.Security.IJwt' while attempting to activate 'AuthServer.Users.UsersService'.)
 ---> System.InvalidOperationException: Error while validating the service descriptor 'ServiceType: AuthServer.Users.UsersService Lifetime: Transient ImplementationType: AuthServer.Users.UsersService': Unable to resolve service for type 'AuthServer.Security.IJwt' while attempting to activate 'AuthServer.Users.UsersService'.
 ---> System.InvalidOperationException: Unable to resolve service for type 'AuthServer.Security.IJwt' while attempting to activate 'AuthServer.Users.UsersService'.
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateArgumentCallSites(ServiceIdentifier serviceIdentifier, Type implementationType, CallSiteChain callSiteChain, ParameterInfo[] parameters, Boolean throwIfCallSiteNotFound)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateConstructorCallSite(ResultCache lifetime, ServiceIdentifier serviceIdentifier, Type implementationType, CallSiteChain callSiteChain)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.TryCreateExact(ServiceDescriptor descriptor, ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain, Int32 slot)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.GetCallSite(ServiceDescriptor serviceDescriptor, CallSiteChain callSiteChain)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.ValidateService(ServiceDescriptor descriptor)
   --- End of inner exception stack trace ---
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.ValidateService(ServiceDescriptor descriptor)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider..ctor(ICollection`1 serviceDescriptors, ServiceProviderOptions options)
   --- End of inner exception stack trace ---
   at Microsoft.Extensions.DependencyInjection.ServiceProvider..ctor(ICollection`1 serviceDescriptors, ServiceProviderOptions options)
   at Microsoft.Extensions.DependencyInjection.ServiceCollectionContainerBuilderExtensions.BuildServiceProvider(IServiceCollection services, ServiceProviderOptions options)
   at Microsoft.Extensions.Hosting.HostApplicationBuilder.Build()
   at Microsoft.AspNetCore.Builder.WebApplicationBuilder.Build()
   at AuthServer.Program.Main(String[] args) in C:\Users\gusta\source\repos\AuthServer\AuthServer\Program.cs:line 85
2024-11-06 23:40:58.381 -03:00 [INF] Aplicação iniciada - configuração de logs inicializada.
2024-11-06 23:40:58.486 -03:00 [FTL] A aplicação falhou ao iniciar.
System.AggregateException: Some services are not able to be constructed (Error while validating the service descriptor 'ServiceType: AuthServer.Users.UsersService Lifetime: Transient ImplementationType: AuthServer.Users.UsersService': Unable to resolve service for type 'AuthServer.Security.IJwt' while attempting to activate 'AuthServer.Users.UsersService'.)
 ---> System.InvalidOperationException: Error while validating the service descriptor 'ServiceType: AuthServer.Users.UsersService Lifetime: Transient ImplementationType: AuthServer.Users.UsersService': Unable to resolve service for type 'AuthServer.Security.IJwt' while attempting to activate 'AuthServer.Users.UsersService'.
 ---> System.InvalidOperationException: Unable to resolve service for type 'AuthServer.Security.IJwt' while attempting to activate 'AuthServer.Users.UsersService'.
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateArgumentCallSites(ServiceIdentifier serviceIdentifier, Type implementationType, CallSiteChain callSiteChain, ParameterInfo[] parameters, Boolean throwIfCallSiteNotFound)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateConstructorCallSite(ResultCache lifetime, ServiceIdentifier serviceIdentifier, Type implementationType, CallSiteChain callSiteChain)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.TryCreateExact(ServiceDescriptor descriptor, ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain, Int32 slot)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.GetCallSite(ServiceDescriptor serviceDescriptor, CallSiteChain callSiteChain)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.ValidateService(ServiceDescriptor descriptor)
   --- End of inner exception stack trace ---
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.ValidateService(ServiceDescriptor descriptor)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider..ctor(ICollection`1 serviceDescriptors, ServiceProviderOptions options)
   --- End of inner exception stack trace ---
   at Microsoft.Extensions.DependencyInjection.ServiceProvider..ctor(ICollection`1 serviceDescriptors, ServiceProviderOptions options)
   at Microsoft.Extensions.DependencyInjection.ServiceCollectionContainerBuilderExtensions.BuildServiceProvider(IServiceCollection services, ServiceProviderOptions options)
   at Microsoft.Extensions.Hosting.HostApplicationBuilder.Build()
   at Microsoft.AspNetCore.Builder.WebApplicationBuilder.Build()
   at AuthServer.Program.Main(String[] args) in C:\Users\gusta\source\repos\AuthServer\AuthServer\Program.cs:line 85
2024-11-06 23:41:34.615 -03:00 [INF] Aplicação iniciada - configuração de logs inicializada.
2024-11-06 23:41:34.762 -03:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2024-11-06 23:41:34.801 -03:00 [DBG] Hosting starting
2024-11-06 23:41:34.811 -03:00 [INF] User profile is available. Using 'C:\Users\gusta\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2024-11-06 23:41:34.816 -03:00 [DBG] Reading data from file 'C:\Users\gusta\AppData\Local\ASP.NET\DataProtection-Keys\key-bf4636f6-ef08-4ac9-8613-5c8299c406a4.xml'.
2024-11-06 23:41:34.821 -03:00 [DBG] Found key {bf4636f6-ef08-4ac9-8613-5c8299c406a4}.
2024-11-06 23:41:34.826 -03:00 [DBG] Considering key {bf4636f6-ef08-4ac9-8613-5c8299c406a4} with expiration date 2025-02-02 14:46:39Z as default key.
2024-11-06 23:41:34.828 -03:00 [DBG] Forwarded activator type request from Microsoft.AspNetCore.DataProtection.XmlEncryption.DpapiXmlDecryptor, Microsoft.AspNetCore.DataProtection, Version=8.0.0.0, Culture=neutral, PublicKeyToken=adb9793829ddae60 to Microsoft.AspNetCore.DataProtection.XmlEncryption.DpapiXmlDecryptor, Microsoft.AspNetCore.DataProtection, Culture=neutral, PublicKeyToken=adb9793829ddae60
2024-11-06 23:41:34.831 -03:00 [DBG] Decrypting secret element using Windows DPAPI.
2024-11-06 23:41:34.832 -03:00 [DBG] Forwarded activator type request from Microsoft.AspNetCore.DataProtection.AuthenticatedEncryption.ConfigurationModel.AuthenticatedEncryptorDescriptorDeserializer, Microsoft.AspNetCore.DataProtection, Version=8.0.0.0, Culture=neutral, PublicKeyToken=adb9793829ddae60 to Microsoft.AspNetCore.DataProtection.AuthenticatedEncryption.ConfigurationModel.AuthenticatedEncryptorDescriptorDeserializer, Microsoft.AspNetCore.DataProtection, Culture=neutral, PublicKeyToken=adb9793829ddae60
2024-11-06 23:41:34.836 -03:00 [DBG] Opening CNG algorithm 'AES' from provider 'null' with chaining mode CBC.
2024-11-06 23:41:34.837 -03:00 [DBG] Opening CNG algorithm 'SHA256' from provider 'null' with HMAC.
2024-11-06 23:41:34.838 -03:00 [DBG] Using key {bf4636f6-ef08-4ac9-8613-5c8299c406a4} as the default key.
2024-11-06 23:41:34.839 -03:00 [DBG] Key ring with default key {bf4636f6-ef08-4ac9-8613-5c8299c406a4} was loaded during application startup.
2024-11-06 23:41:34.906 -03:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2024-11-06 23:41:35.162 -03:00 [DBG] The index {'RoleId'} was not created on entity type 'UserRole (Dictionary<string, object>)' as the properties are already covered by the index {'RoleId', 'UserId'}.
2024-11-06 23:41:35.296 -03:00 [DBG] Entity Framework Core 8.0.10 initialized 'AuthServerContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:8.0.10' with options: None
2024-11-06 23:41:35.331 -03:00 [DBG] Compiling query expression: 
'DbSet<Role>()
    .Count()'
2024-11-06 23:41:35.436 -03:00 [DBG] Generated query execution expression: 
'queryContext => new SingleQueryingEnumerable<int>(
    (RelationalQueryContext)queryContext, 
    RelationalCommandCache.QueryExpression(
        Projection Mapping:
            EmptyProjectionMember -> 0
        SELECT COUNT(*)
        FROM Roles AS r), 
    null, 
    Func<QueryContext, DbDataReader, ResultContext, SingleQueryResultCoordinator, int>, 
    AuthServer.AuthServerContext, 
    False, 
    False, 
    True
)
    .Single()'
2024-11-06 23:41:35.452 -03:00 [DBG] Creating DbConnection.
2024-11-06 23:41:35.463 -03:00 [DBG] Created DbConnection. (10ms).
2024-11-06 23:41:35.464 -03:00 [DBG] Opening connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 23:41:35.569 -03:00 [DBG] Opened connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 23:41:35.574 -03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2024-11-06 23:41:35.578 -03:00 [DBG] Created DbCommand for 'ExecuteReader' (2ms).
2024-11-06 23:41:35.580 -03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (6ms).
2024-11-06 23:41:35.584 -03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*)
FROM [Roles] AS [r]
2024-11-06 23:41:35.600 -03:00 [INF] Executed DbCommand (15ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*)
FROM [Roles] AS [r]
2024-11-06 23:41:35.606 -03:00 [DBG] Closing data reader to 'AuthServer' on server 'localhost,1433'.
2024-11-06 23:41:35.610 -03:00 [DBG] A data reader for 'AuthServer' on server 'localhost,1433' is being disposed after spending 6ms reading results.
2024-11-06 23:41:35.611 -03:00 [DBG] Closing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 23:41:35.615 -03:00 [DBG] Closed connection to database 'AuthServer' on server 'localhost,1433' (3ms).
2024-11-06 23:41:35.621 -03:00 [DBG] Compiling query expression: 
'DbSet<User>()
    .Include(user => user.Roles)'
2024-11-06 23:41:35.630 -03:00 [DBG] Including navigation: 'User.Roles'.
2024-11-06 23:41:35.692 -03:00 [DBG] Generated query execution expression: 
'queryContext => new SingleQueryingEnumerable<User>(
    (RelationalQueryContext)queryContext, 
    RelationalCommandCache.QueryExpression(
        Client Projections:
            0 -> Dictionary<IProperty, int> { [Property: User.ID (long) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: User.Email (string) Required Index, 1], [Property: User.Name (string) Required, 2], [Property: User.Password (string) Required, 3] }
            1 -> 0
            2 -> Dictionary<IProperty, int> { [Property: UserRole (Dictionary<string, object>).RoleId (no field, int) Indexer Required PK FK AfterSave:Throw, 4], [Property: UserRole (Dictionary<string, object>).UserId (no field, long) Indexer Required PK FK Index AfterSave:Throw, 5] }
            3 -> Dictionary<IProperty, int> { [Property: Role.Long (int) Required PK AfterSave:Throw ValueGenerated.OnAdd, 6], [Property: Role.Name (string) Required Index, 7] }
            4 -> 4
            5 -> 5
            6 -> 6
        SELECT u.ID, u.Email, u.Name, u.Password, t.RoleId, t.UserId, t.Long, t.Name
        FROM Users AS u
        LEFT JOIN 
        (
            SELECT u0.RoleId, u0.UserId, r.Long, r.Name
            FROM UserRole AS u0
            INNER JOIN Roles AS r ON u0.RoleId == r.Long
        ) AS t ON u.ID == t.UserId
        ORDER BY u.ID ASC, t.RoleId ASC, t.UserId ASC), 
    null, 
    Func<QueryContext, DbDataReader, ResultContext, SingleQueryResultCoordinator, User>, 
    AuthServer.AuthServerContext, 
    False, 
    False, 
    True
)'
2024-11-06 23:41:35.697 -03:00 [DBG] Opening connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 23:41:35.698 -03:00 [DBG] Opened connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 23:41:35.699 -03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2024-11-06 23:41:35.700 -03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2024-11-06 23:41:35.701 -03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2024-11-06 23:41:35.701 -03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[ID], [u].[Email], [u].[Name], [u].[Password], [t].[RoleId], [t].[UserId], [t].[Long], [t].[Name]
FROM [Users] AS [u]
LEFT JOIN (
    SELECT [u0].[RoleId], [u0].[UserId], [r].[Long], [r].[Name]
    FROM [UserRole] AS [u0]
    INNER JOIN [Roles] AS [r] ON [u0].[RoleId] = [r].[Long]
) AS [t] ON [u].[ID] = [t].[UserId]
ORDER BY [u].[ID], [t].[RoleId], [t].[UserId]
2024-11-06 23:41:35.705 -03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[ID], [u].[Email], [u].[Name], [u].[Password], [t].[RoleId], [t].[UserId], [t].[Long], [t].[Name]
FROM [Users] AS [u]
LEFT JOIN (
    SELECT [u0].[RoleId], [u0].[UserId], [r].[Long], [r].[Name]
    FROM [UserRole] AS [u0]
    INNER JOIN [Roles] AS [r] ON [u0].[RoleId] = [r].[Long]
) AS [t] ON [u].[ID] = [t].[UserId]
ORDER BY [u].[ID], [t].[RoleId], [t].[UserId]
2024-11-06 23:41:35.724 -03:00 [DBG] Context 'AuthServerContext' started tracking 'User' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 23:41:35.743 -03:00 [DBG] Context 'AuthServerContext' started tracking 'UserRole' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 23:41:35.753 -03:00 [DBG] Context 'AuthServerContext' started tracking 'Role' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 23:41:35.756 -03:00 [DBG] Context 'AuthServerContext' started tracking 'User' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 23:41:35.757 -03:00 [DBG] Context 'AuthServerContext' started tracking 'UserRole' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 23:41:35.758 -03:00 [DBG] Context 'AuthServerContext' started tracking 'Role' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 23:41:35.759 -03:00 [DBG] Closing data reader to 'AuthServer' on server 'localhost,1433'.
2024-11-06 23:41:35.760 -03:00 [DBG] A data reader for 'AuthServer' on server 'localhost,1433' is being disposed after spending 53ms reading results.
2024-11-06 23:41:35.761 -03:00 [DBG] Closing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 23:41:35.761 -03:00 [DBG] Closed connection to database 'AuthServer' on server 'localhost,1433' (0ms).
2024-11-06 23:41:35.763 -03:00 [DBG] 'AuthServerContext' disposed.
2024-11-06 23:41:35.765 -03:00 [DBG] Disposing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 23:41:35.766 -03:00 [DBG] Disposed connection to database '' on server '' (1ms).
2024-11-06 23:41:35.819 -03:00 [INF] Now listening on: https://localhost:7011
2024-11-06 23:41:35.820 -03:00 [INF] Now listening on: http://localhost:5091
2024-11-06 23:41:35.821 -03:00 [DBG] Loaded hosting startup assembly AuthServer
2024-11-06 23:41:35.821 -03:00 [DBG] Loaded hosting startup assembly Microsoft.AspNetCore.Watch.BrowserRefresh
2024-11-06 23:41:35.822 -03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.BrowserLink.Net
2024-11-06 23:41:35.823 -03:00 [INF] Application started. Press Ctrl+C to shut down.
2024-11-06 23:41:35.823 -03:00 [INF] Hosting environment: Development
2024-11-06 23:41:35.824 -03:00 [INF] Content root path: C:\Users\gusta\source\repos\AuthServer\AuthServer
2024-11-06 23:41:35.824 -03:00 [DBG] Hosting started
2024-11-06 23:41:35.919 -03:00 [DBG] Connection id "0HN7UQMPB1N02" received FIN.
2024-11-06 23:41:35.919 -03:00 [DBG] Connection id "0HN7UQMPB1N01" received FIN.
2024-11-06 23:41:35.923 -03:00 [DBG] Connection id "0HN7UQMPB1N01" accepted.
2024-11-06 23:41:35.923 -03:00 [DBG] Connection id "0HN7UQMPB1N02" accepted.
2024-11-06 23:41:35.924 -03:00 [DBG] Connection id "0HN7UQMPB1N01" started.
2024-11-06 23:41:35.925 -03:00 [DBG] Connection id "0HN7UQMPB1N02" started.
2024-11-06 23:41:35.932 -03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2024-11-06 23:41:35.932 -03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2024-11-06 23:41:35.941 -03:00 [DBG] Connection id "0HN7UQMPB1N02" stopped.
2024-11-06 23:41:35.941 -03:00 [DBG] Connection id "0HN7UQMPB1N01" stopped.
2024-11-06 23:41:35.943 -03:00 [DBG] Connection id "0HN7UQMPB1N02" sending FIN because: "The Socket transport's send loop completed gracefully."
2024-11-06 23:41:35.943 -03:00 [DBG] Connection id "0HN7UQMPB1N01" sending FIN because: "The Socket transport's send loop completed gracefully."
2024-11-06 23:41:35.997 -03:00 [DBG] Connection id "0HN7UQMPB1N03" accepted.
2024-11-06 23:41:35.998 -03:00 [DBG] Connection id "0HN7UQMPB1N03" started.
2024-11-06 23:41:36.035 -03:00 [DBG] Connection 0HN7UQMPB1N03 established using the following protocol: "Tls13"
2024-11-06 23:41:36.066 -03:00 [INF] Request starting HTTP/2 GET https://localhost:7011/swagger/index.html - null null
2024-11-06 23:41:36.131 -03:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2024-11-06 23:41:36.146 -03:00 [DBG] No candidates found for the request path '/swagger/index.html'
2024-11-06 23:41:36.148 -03:00 [DBG] Request did not match any endpoints
2024-11-06 23:41:36.216 -03:00 [DBG] Response markup is scheduled to include Browser Link script injection.
2024-11-06 23:41:36.218 -03:00 [DBG] Response markup is scheduled to include browser refresh script injection.
2024-11-06 23:41:36.225 -03:00 [DBG] Response markup was updated to include Browser Link script injection.
2024-11-06 23:41:36.227 -03:00 [DBG] Response markup was updated to include browser refresh script injection.
2024-11-06 23:41:36.231 -03:00 [INF] Request finished HTTP/2 GET https://localhost:7011/swagger/index.html - 200 null text/html;charset=utf-8 165.7969ms
2024-11-06 23:41:36.251 -03:00 [INF] Request starting HTTP/2 GET https://localhost:7011/_framework/aspnetcore-browser-refresh.js - null null
2024-11-06 23:41:36.251 -03:00 [INF] Request starting HTTP/2 GET https://localhost:7011/swagger/index.css - null null
2024-11-06 23:41:36.251 -03:00 [INF] Request starting HTTP/2 GET https://localhost:7011/swagger/index.js - null null
2024-11-06 23:41:36.256 -03:00 [DBG] No candidates found for the request path '/swagger/index.css'
2024-11-06 23:41:36.259 -03:00 [DBG] No candidates found for the request path '/swagger/index.js'
2024-11-06 23:41:36.260 -03:00 [DBG] Request did not match any endpoints
2024-11-06 23:41:36.261 -03:00 [DBG] Request did not match any endpoints
2024-11-06 23:41:36.262 -03:00 [INF] Request finished HTTP/2 GET https://localhost:7011/_framework/aspnetcore-browser-refresh.js - 200 13756 application/javascript; charset=utf-8 10.9415ms
2024-11-06 23:41:36.265 -03:00 [INF] Request finished HTTP/2 GET https://localhost:7011/swagger/index.js - 200 null application/javascript;charset=utf-8 13.8015ms
2024-11-06 23:41:36.268 -03:00 [INF] The file /index.css was not modified
2024-11-06 23:41:36.272 -03:00 [DBG] Handled. Status code: 304 File: /index.css
2024-11-06 23:41:36.273 -03:00 [INF] Request finished HTTP/2 GET https://localhost:7011/swagger/index.css - 304 null text/css 21.6635ms
2024-11-06 23:41:36.333 -03:00 [INF] Request starting HTTP/2 GET https://localhost:7011/_vs/browserLink - null null
2024-11-06 23:41:36.356 -03:00 [INF] Request finished HTTP/2 GET https://localhost:7011/_vs/browserLink - 200 null text/javascript; charset=UTF-8 23.0229ms
2024-11-06 23:41:36.436 -03:00 [INF] Request starting HTTP/2 GET https://localhost:7011/swagger/v1/swagger.json - null null
2024-11-06 23:41:36.438 -03:00 [DBG] No candidates found for the request path '/swagger/v1/swagger.json'
2024-11-06 23:41:36.439 -03:00 [DBG] Request did not match any endpoints
2024-11-06 23:41:36.528 -03:00 [INF] Request finished HTTP/2 GET https://localhost:7011/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 91.5527ms
2024-11-06 23:41:55.582 -03:00 [INF] Aplicação iniciada - configuração de logs inicializada.
2024-11-06 23:41:55.729 -03:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2024-11-06 23:41:55.760 -03:00 [DBG] Hosting starting
2024-11-06 23:41:55.770 -03:00 [INF] User profile is available. Using 'C:\Users\gusta\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2024-11-06 23:41:55.775 -03:00 [DBG] Reading data from file 'C:\Users\gusta\AppData\Local\ASP.NET\DataProtection-Keys\key-bf4636f6-ef08-4ac9-8613-5c8299c406a4.xml'.
2024-11-06 23:41:55.781 -03:00 [DBG] Found key {bf4636f6-ef08-4ac9-8613-5c8299c406a4}.
2024-11-06 23:41:55.786 -03:00 [DBG] Considering key {bf4636f6-ef08-4ac9-8613-5c8299c406a4} with expiration date 2025-02-02 14:46:39Z as default key.
2024-11-06 23:41:55.788 -03:00 [DBG] Forwarded activator type request from Microsoft.AspNetCore.DataProtection.XmlEncryption.DpapiXmlDecryptor, Microsoft.AspNetCore.DataProtection, Version=8.0.0.0, Culture=neutral, PublicKeyToken=adb9793829ddae60 to Microsoft.AspNetCore.DataProtection.XmlEncryption.DpapiXmlDecryptor, Microsoft.AspNetCore.DataProtection, Culture=neutral, PublicKeyToken=adb9793829ddae60
2024-11-06 23:41:55.790 -03:00 [DBG] Decrypting secret element using Windows DPAPI.
2024-11-06 23:41:55.791 -03:00 [DBG] Forwarded activator type request from Microsoft.AspNetCore.DataProtection.AuthenticatedEncryption.ConfigurationModel.AuthenticatedEncryptorDescriptorDeserializer, Microsoft.AspNetCore.DataProtection, Version=8.0.0.0, Culture=neutral, PublicKeyToken=adb9793829ddae60 to Microsoft.AspNetCore.DataProtection.AuthenticatedEncryption.ConfigurationModel.AuthenticatedEncryptorDescriptorDeserializer, Microsoft.AspNetCore.DataProtection, Culture=neutral, PublicKeyToken=adb9793829ddae60
2024-11-06 23:41:55.795 -03:00 [DBG] Opening CNG algorithm 'AES' from provider 'null' with chaining mode CBC.
2024-11-06 23:41:55.796 -03:00 [DBG] Opening CNG algorithm 'SHA256' from provider 'null' with HMAC.
2024-11-06 23:41:55.798 -03:00 [DBG] Using key {bf4636f6-ef08-4ac9-8613-5c8299c406a4} as the default key.
2024-11-06 23:41:55.799 -03:00 [DBG] Key ring with default key {bf4636f6-ef08-4ac9-8613-5c8299c406a4} was loaded during application startup.
2024-11-06 23:41:55.848 -03:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2024-11-06 23:41:56.086 -03:00 [DBG] The index {'RoleId'} was not created on entity type 'UserRole (Dictionary<string, object>)' as the properties are already covered by the index {'RoleId', 'UserId'}.
2024-11-06 23:41:56.230 -03:00 [DBG] Entity Framework Core 8.0.10 initialized 'AuthServerContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:8.0.10' with options: None
2024-11-06 23:41:56.255 -03:00 [DBG] Compiling query expression: 
'DbSet<Role>()
    .Count()'
2024-11-06 23:41:56.362 -03:00 [DBG] Generated query execution expression: 
'queryContext => new SingleQueryingEnumerable<int>(
    (RelationalQueryContext)queryContext, 
    RelationalCommandCache.QueryExpression(
        Projection Mapping:
            EmptyProjectionMember -> 0
        SELECT COUNT(*)
        FROM Roles AS r), 
    null, 
    Func<QueryContext, DbDataReader, ResultContext, SingleQueryResultCoordinator, int>, 
    AuthServer.AuthServerContext, 
    False, 
    False, 
    True
)
    .Single()'
2024-11-06 23:41:56.376 -03:00 [DBG] Creating DbConnection.
2024-11-06 23:41:56.387 -03:00 [DBG] Created DbConnection. (9ms).
2024-11-06 23:41:56.389 -03:00 [DBG] Opening connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 23:41:56.478 -03:00 [DBG] Opened connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 23:41:56.480 -03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2024-11-06 23:41:56.485 -03:00 [DBG] Created DbCommand for 'ExecuteReader' (2ms).
2024-11-06 23:41:56.486 -03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (6ms).
2024-11-06 23:41:56.490 -03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*)
FROM [Roles] AS [r]
2024-11-06 23:41:56.507 -03:00 [INF] Executed DbCommand (15ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*)
FROM [Roles] AS [r]
2024-11-06 23:41:56.513 -03:00 [DBG] Closing data reader to 'AuthServer' on server 'localhost,1433'.
2024-11-06 23:41:56.517 -03:00 [DBG] A data reader for 'AuthServer' on server 'localhost,1433' is being disposed after spending 6ms reading results.
2024-11-06 23:41:56.519 -03:00 [DBG] Closing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 23:41:56.523 -03:00 [DBG] Closed connection to database 'AuthServer' on server 'localhost,1433' (3ms).
2024-11-06 23:41:56.528 -03:00 [DBG] Compiling query expression: 
'DbSet<User>()
    .Include(user => user.Roles)'
2024-11-06 23:41:56.536 -03:00 [DBG] Including navigation: 'User.Roles'.
2024-11-06 23:41:56.598 -03:00 [DBG] Generated query execution expression: 
'queryContext => new SingleQueryingEnumerable<User>(
    (RelationalQueryContext)queryContext, 
    RelationalCommandCache.QueryExpression(
        Client Projections:
            0 -> Dictionary<IProperty, int> { [Property: User.ID (long) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: User.Email (string) Required Index, 1], [Property: User.Name (string) Required, 2], [Property: User.Password (string) Required, 3] }
            1 -> 0
            2 -> Dictionary<IProperty, int> { [Property: UserRole (Dictionary<string, object>).RoleId (no field, int) Indexer Required PK FK AfterSave:Throw, 4], [Property: UserRole (Dictionary<string, object>).UserId (no field, long) Indexer Required PK FK Index AfterSave:Throw, 5] }
            3 -> Dictionary<IProperty, int> { [Property: Role.Long (int) Required PK AfterSave:Throw ValueGenerated.OnAdd, 6], [Property: Role.Name (string) Required Index, 7] }
            4 -> 4
            5 -> 5
            6 -> 6
        SELECT u.ID, u.Email, u.Name, u.Password, t.RoleId, t.UserId, t.Long, t.Name
        FROM Users AS u
        LEFT JOIN 
        (
            SELECT u0.RoleId, u0.UserId, r.Long, r.Name
            FROM UserRole AS u0
            INNER JOIN Roles AS r ON u0.RoleId == r.Long
        ) AS t ON u.ID == t.UserId
        ORDER BY u.ID ASC, t.RoleId ASC, t.UserId ASC), 
    null, 
    Func<QueryContext, DbDataReader, ResultContext, SingleQueryResultCoordinator, User>, 
    AuthServer.AuthServerContext, 
    False, 
    False, 
    True
)'
2024-11-06 23:41:56.603 -03:00 [DBG] Opening connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 23:41:56.604 -03:00 [DBG] Opened connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 23:41:56.605 -03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2024-11-06 23:41:56.605 -03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2024-11-06 23:41:56.606 -03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2024-11-06 23:41:56.607 -03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[ID], [u].[Email], [u].[Name], [u].[Password], [t].[RoleId], [t].[UserId], [t].[Long], [t].[Name]
FROM [Users] AS [u]
LEFT JOIN (
    SELECT [u0].[RoleId], [u0].[UserId], [r].[Long], [r].[Name]
    FROM [UserRole] AS [u0]
    INNER JOIN [Roles] AS [r] ON [u0].[RoleId] = [r].[Long]
) AS [t] ON [u].[ID] = [t].[UserId]
ORDER BY [u].[ID], [t].[RoleId], [t].[UserId]
2024-11-06 23:41:56.610 -03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[ID], [u].[Email], [u].[Name], [u].[Password], [t].[RoleId], [t].[UserId], [t].[Long], [t].[Name]
FROM [Users] AS [u]
LEFT JOIN (
    SELECT [u0].[RoleId], [u0].[UserId], [r].[Long], [r].[Name]
    FROM [UserRole] AS [u0]
    INNER JOIN [Roles] AS [r] ON [u0].[RoleId] = [r].[Long]
) AS [t] ON [u].[ID] = [t].[UserId]
ORDER BY [u].[ID], [t].[RoleId], [t].[UserId]
2024-11-06 23:41:56.630 -03:00 [DBG] Context 'AuthServerContext' started tracking 'User' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 23:41:56.650 -03:00 [DBG] Context 'AuthServerContext' started tracking 'UserRole' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 23:41:56.660 -03:00 [DBG] Context 'AuthServerContext' started tracking 'Role' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 23:41:56.663 -03:00 [DBG] Context 'AuthServerContext' started tracking 'User' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 23:41:56.665 -03:00 [DBG] Context 'AuthServerContext' started tracking 'UserRole' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 23:41:56.665 -03:00 [DBG] Context 'AuthServerContext' started tracking 'Role' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 23:41:56.666 -03:00 [DBG] Closing data reader to 'AuthServer' on server 'localhost,1433'.
2024-11-06 23:41:56.667 -03:00 [DBG] A data reader for 'AuthServer' on server 'localhost,1433' is being disposed after spending 55ms reading results.
2024-11-06 23:41:56.668 -03:00 [DBG] Closing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 23:41:56.669 -03:00 [DBG] Closed connection to database 'AuthServer' on server 'localhost,1433' (0ms).
2024-11-06 23:41:56.670 -03:00 [DBG] 'AuthServerContext' disposed.
2024-11-06 23:41:56.672 -03:00 [DBG] Disposing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 23:41:56.673 -03:00 [DBG] Disposed connection to database '' on server '' (1ms).
2024-11-06 23:41:56.729 -03:00 [INF] Now listening on: https://localhost:7011
2024-11-06 23:41:56.730 -03:00 [INF] Now listening on: http://localhost:5091
2024-11-06 23:41:56.730 -03:00 [DBG] Loaded hosting startup assembly AuthServer
2024-11-06 23:41:56.731 -03:00 [DBG] Loaded hosting startup assembly Microsoft.AspNetCore.Watch.BrowserRefresh
2024-11-06 23:41:56.731 -03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.BrowserLink.Net
2024-11-06 23:41:56.732 -03:00 [INF] Application started. Press Ctrl+C to shut down.
2024-11-06 23:41:56.733 -03:00 [INF] Hosting environment: Development
2024-11-06 23:41:56.733 -03:00 [INF] Content root path: C:\Users\gusta\source\repos\AuthServer\AuthServer
2024-11-06 23:41:56.734 -03:00 [DBG] Hosting started
2024-11-06 23:44:01.800 -03:00 [INF] Aplicação iniciada - configuração de logs inicializada.
2024-11-06 23:44:01.961 -03:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2024-11-06 23:44:01.997 -03:00 [DBG] Hosting starting
2024-11-06 23:44:02.006 -03:00 [INF] User profile is available. Using 'C:\Users\gusta\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2024-11-06 23:44:02.011 -03:00 [DBG] Reading data from file 'C:\Users\gusta\AppData\Local\ASP.NET\DataProtection-Keys\key-bf4636f6-ef08-4ac9-8613-5c8299c406a4.xml'.
2024-11-06 23:44:02.016 -03:00 [DBG] Found key {bf4636f6-ef08-4ac9-8613-5c8299c406a4}.
2024-11-06 23:44:02.021 -03:00 [DBG] Considering key {bf4636f6-ef08-4ac9-8613-5c8299c406a4} with expiration date 2025-02-02 14:46:39Z as default key.
2024-11-06 23:44:02.023 -03:00 [DBG] Forwarded activator type request from Microsoft.AspNetCore.DataProtection.XmlEncryption.DpapiXmlDecryptor, Microsoft.AspNetCore.DataProtection, Version=8.0.0.0, Culture=neutral, PublicKeyToken=adb9793829ddae60 to Microsoft.AspNetCore.DataProtection.XmlEncryption.DpapiXmlDecryptor, Microsoft.AspNetCore.DataProtection, Culture=neutral, PublicKeyToken=adb9793829ddae60
2024-11-06 23:44:02.025 -03:00 [DBG] Decrypting secret element using Windows DPAPI.
2024-11-06 23:44:02.026 -03:00 [DBG] Forwarded activator type request from Microsoft.AspNetCore.DataProtection.AuthenticatedEncryption.ConfigurationModel.AuthenticatedEncryptorDescriptorDeserializer, Microsoft.AspNetCore.DataProtection, Version=8.0.0.0, Culture=neutral, PublicKeyToken=adb9793829ddae60 to Microsoft.AspNetCore.DataProtection.AuthenticatedEncryption.ConfigurationModel.AuthenticatedEncryptorDescriptorDeserializer, Microsoft.AspNetCore.DataProtection, Culture=neutral, PublicKeyToken=adb9793829ddae60
2024-11-06 23:44:02.030 -03:00 [DBG] Opening CNG algorithm 'AES' from provider 'null' with chaining mode CBC.
2024-11-06 23:44:02.031 -03:00 [DBG] Opening CNG algorithm 'SHA256' from provider 'null' with HMAC.
2024-11-06 23:44:02.032 -03:00 [DBG] Using key {bf4636f6-ef08-4ac9-8613-5c8299c406a4} as the default key.
2024-11-06 23:44:02.033 -03:00 [DBG] Key ring with default key {bf4636f6-ef08-4ac9-8613-5c8299c406a4} was loaded during application startup.
2024-11-06 23:44:02.089 -03:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2024-11-06 23:44:02.326 -03:00 [DBG] The index {'RoleId'} was not created on entity type 'UserRole (Dictionary<string, object>)' as the properties are already covered by the index {'RoleId', 'UserId'}.
2024-11-06 23:44:02.459 -03:00 [DBG] Entity Framework Core 8.0.10 initialized 'AuthServerContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:8.0.10' with options: None
2024-11-06 23:44:02.491 -03:00 [DBG] Compiling query expression: 
'DbSet<Role>()
    .Count()'
2024-11-06 23:44:02.591 -03:00 [DBG] Generated query execution expression: 
'queryContext => new SingleQueryingEnumerable<int>(
    (RelationalQueryContext)queryContext, 
    RelationalCommandCache.QueryExpression(
        Projection Mapping:
            EmptyProjectionMember -> 0
        SELECT COUNT(*)
        FROM Roles AS r), 
    null, 
    Func<QueryContext, DbDataReader, ResultContext, SingleQueryResultCoordinator, int>, 
    AuthServer.AuthServerContext, 
    False, 
    False, 
    True
)
    .Single()'
2024-11-06 23:44:02.606 -03:00 [DBG] Creating DbConnection.
2024-11-06 23:44:02.616 -03:00 [DBG] Created DbConnection. (9ms).
2024-11-06 23:44:02.618 -03:00 [DBG] Opening connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 23:44:02.716 -03:00 [DBG] Opened connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 23:44:02.719 -03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2024-11-06 23:44:02.722 -03:00 [DBG] Created DbCommand for 'ExecuteReader' (2ms).
2024-11-06 23:44:02.724 -03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (6ms).
2024-11-06 23:44:02.728 -03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*)
FROM [Roles] AS [r]
2024-11-06 23:44:02.745 -03:00 [INF] Executed DbCommand (15ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*)
FROM [Roles] AS [r]
2024-11-06 23:44:02.751 -03:00 [DBG] Closing data reader to 'AuthServer' on server 'localhost,1433'.
2024-11-06 23:44:02.755 -03:00 [DBG] A data reader for 'AuthServer' on server 'localhost,1433' is being disposed after spending 6ms reading results.
2024-11-06 23:44:02.757 -03:00 [DBG] Closing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 23:44:02.760 -03:00 [DBG] Closed connection to database 'AuthServer' on server 'localhost,1433' (3ms).
2024-11-06 23:44:02.765 -03:00 [DBG] Compiling query expression: 
'DbSet<User>()
    .Include(user => user.Roles)'
2024-11-06 23:44:02.773 -03:00 [DBG] Including navigation: 'User.Roles'.
2024-11-06 23:44:02.832 -03:00 [DBG] Generated query execution expression: 
'queryContext => new SingleQueryingEnumerable<User>(
    (RelationalQueryContext)queryContext, 
    RelationalCommandCache.QueryExpression(
        Client Projections:
            0 -> Dictionary<IProperty, int> { [Property: User.ID (long) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: User.Email (string) Required Index, 1], [Property: User.Name (string) Required, 2], [Property: User.Password (string) Required, 3] }
            1 -> 0
            2 -> Dictionary<IProperty, int> { [Property: UserRole (Dictionary<string, object>).RoleId (no field, int) Indexer Required PK FK AfterSave:Throw, 4], [Property: UserRole (Dictionary<string, object>).UserId (no field, long) Indexer Required PK FK Index AfterSave:Throw, 5] }
            3 -> Dictionary<IProperty, int> { [Property: Role.Long (int) Required PK AfterSave:Throw ValueGenerated.OnAdd, 6], [Property: Role.Name (string) Required Index, 7] }
            4 -> 4
            5 -> 5
            6 -> 6
        SELECT u.ID, u.Email, u.Name, u.Password, t.RoleId, t.UserId, t.Long, t.Name
        FROM Users AS u
        LEFT JOIN 
        (
            SELECT u0.RoleId, u0.UserId, r.Long, r.Name
            FROM UserRole AS u0
            INNER JOIN Roles AS r ON u0.RoleId == r.Long
        ) AS t ON u.ID == t.UserId
        ORDER BY u.ID ASC, t.RoleId ASC, t.UserId ASC), 
    null, 
    Func<QueryContext, DbDataReader, ResultContext, SingleQueryResultCoordinator, User>, 
    AuthServer.AuthServerContext, 
    False, 
    False, 
    True
)'
2024-11-06 23:44:02.837 -03:00 [DBG] Opening connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 23:44:02.838 -03:00 [DBG] Opened connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 23:44:02.839 -03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2024-11-06 23:44:02.840 -03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2024-11-06 23:44:02.840 -03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2024-11-06 23:44:02.841 -03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[ID], [u].[Email], [u].[Name], [u].[Password], [t].[RoleId], [t].[UserId], [t].[Long], [t].[Name]
FROM [Users] AS [u]
LEFT JOIN (
    SELECT [u0].[RoleId], [u0].[UserId], [r].[Long], [r].[Name]
    FROM [UserRole] AS [u0]
    INNER JOIN [Roles] AS [r] ON [u0].[RoleId] = [r].[Long]
) AS [t] ON [u].[ID] = [t].[UserId]
ORDER BY [u].[ID], [t].[RoleId], [t].[UserId]
2024-11-06 23:44:02.845 -03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[ID], [u].[Email], [u].[Name], [u].[Password], [t].[RoleId], [t].[UserId], [t].[Long], [t].[Name]
FROM [Users] AS [u]
LEFT JOIN (
    SELECT [u0].[RoleId], [u0].[UserId], [r].[Long], [r].[Name]
    FROM [UserRole] AS [u0]
    INNER JOIN [Roles] AS [r] ON [u0].[RoleId] = [r].[Long]
) AS [t] ON [u].[ID] = [t].[UserId]
ORDER BY [u].[ID], [t].[RoleId], [t].[UserId]
2024-11-06 23:44:02.863 -03:00 [DBG] Context 'AuthServerContext' started tracking 'User' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 23:44:02.882 -03:00 [DBG] Context 'AuthServerContext' started tracking 'UserRole' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 23:44:02.891 -03:00 [DBG] Context 'AuthServerContext' started tracking 'Role' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 23:44:02.895 -03:00 [DBG] Context 'AuthServerContext' started tracking 'User' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 23:44:02.896 -03:00 [DBG] Context 'AuthServerContext' started tracking 'UserRole' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 23:44:02.896 -03:00 [DBG] Context 'AuthServerContext' started tracking 'Role' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 23:44:02.897 -03:00 [DBG] Closing data reader to 'AuthServer' on server 'localhost,1433'.
2024-11-06 23:44:02.898 -03:00 [DBG] A data reader for 'AuthServer' on server 'localhost,1433' is being disposed after spending 51ms reading results.
2024-11-06 23:44:02.899 -03:00 [DBG] Closing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 23:44:02.899 -03:00 [DBG] Closed connection to database 'AuthServer' on server 'localhost,1433' (0ms).
2024-11-06 23:44:02.901 -03:00 [DBG] 'AuthServerContext' disposed.
2024-11-06 23:44:02.902 -03:00 [DBG] Disposing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 23:44:02.903 -03:00 [DBG] Disposed connection to database '' on server '' (1ms).
2024-11-06 23:44:02.957 -03:00 [INF] Now listening on: https://localhost:7011
2024-11-06 23:44:02.958 -03:00 [INF] Now listening on: http://localhost:5091
2024-11-06 23:44:02.959 -03:00 [DBG] Loaded hosting startup assembly AuthServer
2024-11-06 23:44:02.959 -03:00 [DBG] Loaded hosting startup assembly Microsoft.AspNetCore.Watch.BrowserRefresh
2024-11-06 23:44:02.960 -03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.BrowserLink.Net
2024-11-06 23:44:02.961 -03:00 [INF] Application started. Press Ctrl+C to shut down.
2024-11-06 23:44:02.961 -03:00 [INF] Hosting environment: Development
2024-11-06 23:44:02.962 -03:00 [INF] Content root path: C:\Users\gusta\source\repos\AuthServer\AuthServer
2024-11-06 23:44:02.962 -03:00 [DBG] Hosting started
2024-11-06 23:44:08.410 -03:00 [INF] Aplicação iniciada - configuração de logs inicializada.
2024-11-06 23:44:08.568 -03:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2024-11-06 23:44:08.600 -03:00 [DBG] Hosting starting
2024-11-06 23:44:08.610 -03:00 [INF] User profile is available. Using 'C:\Users\gusta\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2024-11-06 23:44:08.615 -03:00 [DBG] Reading data from file 'C:\Users\gusta\AppData\Local\ASP.NET\DataProtection-Keys\key-bf4636f6-ef08-4ac9-8613-5c8299c406a4.xml'.
2024-11-06 23:44:08.620 -03:00 [DBG] Found key {bf4636f6-ef08-4ac9-8613-5c8299c406a4}.
2024-11-06 23:44:08.625 -03:00 [DBG] Considering key {bf4636f6-ef08-4ac9-8613-5c8299c406a4} with expiration date 2025-02-02 14:46:39Z as default key.
2024-11-06 23:44:08.628 -03:00 [DBG] Forwarded activator type request from Microsoft.AspNetCore.DataProtection.XmlEncryption.DpapiXmlDecryptor, Microsoft.AspNetCore.DataProtection, Version=8.0.0.0, Culture=neutral, PublicKeyToken=adb9793829ddae60 to Microsoft.AspNetCore.DataProtection.XmlEncryption.DpapiXmlDecryptor, Microsoft.AspNetCore.DataProtection, Culture=neutral, PublicKeyToken=adb9793829ddae60
2024-11-06 23:44:08.630 -03:00 [DBG] Decrypting secret element using Windows DPAPI.
2024-11-06 23:44:08.631 -03:00 [DBG] Forwarded activator type request from Microsoft.AspNetCore.DataProtection.AuthenticatedEncryption.ConfigurationModel.AuthenticatedEncryptorDescriptorDeserializer, Microsoft.AspNetCore.DataProtection, Version=8.0.0.0, Culture=neutral, PublicKeyToken=adb9793829ddae60 to Microsoft.AspNetCore.DataProtection.AuthenticatedEncryption.ConfigurationModel.AuthenticatedEncryptorDescriptorDeserializer, Microsoft.AspNetCore.DataProtection, Culture=neutral, PublicKeyToken=adb9793829ddae60
2024-11-06 23:44:08.635 -03:00 [DBG] Opening CNG algorithm 'AES' from provider 'null' with chaining mode CBC.
2024-11-06 23:44:08.636 -03:00 [DBG] Opening CNG algorithm 'SHA256' from provider 'null' with HMAC.
2024-11-06 23:44:08.638 -03:00 [DBG] Using key {bf4636f6-ef08-4ac9-8613-5c8299c406a4} as the default key.
2024-11-06 23:44:08.639 -03:00 [DBG] Key ring with default key {bf4636f6-ef08-4ac9-8613-5c8299c406a4} was loaded during application startup.
2024-11-06 23:44:08.689 -03:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2024-11-06 23:44:08.965 -03:00 [DBG] The index {'RoleId'} was not created on entity type 'UserRole (Dictionary<string, object>)' as the properties are already covered by the index {'RoleId', 'UserId'}.
2024-11-06 23:44:09.094 -03:00 [DBG] Entity Framework Core 8.0.10 initialized 'AuthServerContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:8.0.10' with options: None
2024-11-06 23:44:09.119 -03:00 [DBG] Compiling query expression: 
'DbSet<Role>()
    .Count()'
2024-11-06 23:44:09.224 -03:00 [DBG] Generated query execution expression: 
'queryContext => new SingleQueryingEnumerable<int>(
    (RelationalQueryContext)queryContext, 
    RelationalCommandCache.QueryExpression(
        Projection Mapping:
            EmptyProjectionMember -> 0
        SELECT COUNT(*)
        FROM Roles AS r), 
    null, 
    Func<QueryContext, DbDataReader, ResultContext, SingleQueryResultCoordinator, int>, 
    AuthServer.AuthServerContext, 
    False, 
    False, 
    True
)
    .Single()'
2024-11-06 23:44:09.238 -03:00 [DBG] Creating DbConnection.
2024-11-06 23:44:09.249 -03:00 [DBG] Created DbConnection. (9ms).
2024-11-06 23:44:09.251 -03:00 [DBG] Opening connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 23:44:09.339 -03:00 [DBG] Opened connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 23:44:09.341 -03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2024-11-06 23:44:09.345 -03:00 [DBG] Created DbCommand for 'ExecuteReader' (2ms).
2024-11-06 23:44:09.347 -03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (6ms).
2024-11-06 23:44:09.351 -03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*)
FROM [Roles] AS [r]
2024-11-06 23:44:09.367 -03:00 [INF] Executed DbCommand (14ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*)
FROM [Roles] AS [r]
2024-11-06 23:44:09.373 -03:00 [DBG] Closing data reader to 'AuthServer' on server 'localhost,1433'.
2024-11-06 23:44:09.378 -03:00 [DBG] A data reader for 'AuthServer' on server 'localhost,1433' is being disposed after spending 6ms reading results.
2024-11-06 23:44:09.380 -03:00 [DBG] Closing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 23:44:09.383 -03:00 [DBG] Closed connection to database 'AuthServer' on server 'localhost,1433' (3ms).
2024-11-06 23:44:09.388 -03:00 [DBG] Compiling query expression: 
'DbSet<User>()
    .Include(user => user.Roles)'
2024-11-06 23:44:09.396 -03:00 [DBG] Including navigation: 'User.Roles'.
2024-11-06 23:44:09.456 -03:00 [DBG] Generated query execution expression: 
'queryContext => new SingleQueryingEnumerable<User>(
    (RelationalQueryContext)queryContext, 
    RelationalCommandCache.QueryExpression(
        Client Projections:
            0 -> Dictionary<IProperty, int> { [Property: User.ID (long) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: User.Email (string) Required Index, 1], [Property: User.Name (string) Required, 2], [Property: User.Password (string) Required, 3] }
            1 -> 0
            2 -> Dictionary<IProperty, int> { [Property: UserRole (Dictionary<string, object>).RoleId (no field, int) Indexer Required PK FK AfterSave:Throw, 4], [Property: UserRole (Dictionary<string, object>).UserId (no field, long) Indexer Required PK FK Index AfterSave:Throw, 5] }
            3 -> Dictionary<IProperty, int> { [Property: Role.Long (int) Required PK AfterSave:Throw ValueGenerated.OnAdd, 6], [Property: Role.Name (string) Required Index, 7] }
            4 -> 4
            5 -> 5
            6 -> 6
        SELECT u.ID, u.Email, u.Name, u.Password, t.RoleId, t.UserId, t.Long, t.Name
        FROM Users AS u
        LEFT JOIN 
        (
            SELECT u0.RoleId, u0.UserId, r.Long, r.Name
            FROM UserRole AS u0
            INNER JOIN Roles AS r ON u0.RoleId == r.Long
        ) AS t ON u.ID == t.UserId
        ORDER BY u.ID ASC, t.RoleId ASC, t.UserId ASC), 
    null, 
    Func<QueryContext, DbDataReader, ResultContext, SingleQueryResultCoordinator, User>, 
    AuthServer.AuthServerContext, 
    False, 
    False, 
    True
)'
2024-11-06 23:44:09.461 -03:00 [DBG] Opening connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 23:44:09.462 -03:00 [DBG] Opened connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 23:44:09.463 -03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2024-11-06 23:44:09.464 -03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2024-11-06 23:44:09.464 -03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2024-11-06 23:44:09.465 -03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[ID], [u].[Email], [u].[Name], [u].[Password], [t].[RoleId], [t].[UserId], [t].[Long], [t].[Name]
FROM [Users] AS [u]
LEFT JOIN (
    SELECT [u0].[RoleId], [u0].[UserId], [r].[Long], [r].[Name]
    FROM [UserRole] AS [u0]
    INNER JOIN [Roles] AS [r] ON [u0].[RoleId] = [r].[Long]
) AS [t] ON [u].[ID] = [t].[UserId]
ORDER BY [u].[ID], [t].[RoleId], [t].[UserId]
2024-11-06 23:44:09.468 -03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[ID], [u].[Email], [u].[Name], [u].[Password], [t].[RoleId], [t].[UserId], [t].[Long], [t].[Name]
FROM [Users] AS [u]
LEFT JOIN (
    SELECT [u0].[RoleId], [u0].[UserId], [r].[Long], [r].[Name]
    FROM [UserRole] AS [u0]
    INNER JOIN [Roles] AS [r] ON [u0].[RoleId] = [r].[Long]
) AS [t] ON [u].[ID] = [t].[UserId]
ORDER BY [u].[ID], [t].[RoleId], [t].[UserId]
2024-11-06 23:44:09.486 -03:00 [DBG] Context 'AuthServerContext' started tracking 'User' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 23:44:09.505 -03:00 [DBG] Context 'AuthServerContext' started tracking 'UserRole' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 23:44:09.515 -03:00 [DBG] Context 'AuthServerContext' started tracking 'Role' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 23:44:09.519 -03:00 [DBG] Context 'AuthServerContext' started tracking 'User' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 23:44:09.520 -03:00 [DBG] Context 'AuthServerContext' started tracking 'UserRole' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 23:44:09.520 -03:00 [DBG] Context 'AuthServerContext' started tracking 'Role' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 23:44:09.521 -03:00 [DBG] Closing data reader to 'AuthServer' on server 'localhost,1433'.
2024-11-06 23:44:09.522 -03:00 [DBG] A data reader for 'AuthServer' on server 'localhost,1433' is being disposed after spending 51ms reading results.
2024-11-06 23:44:09.523 -03:00 [DBG] Closing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 23:44:09.523 -03:00 [DBG] Closed connection to database 'AuthServer' on server 'localhost,1433' (0ms).
2024-11-06 23:44:09.525 -03:00 [DBG] 'AuthServerContext' disposed.
2024-11-06 23:44:09.527 -03:00 [DBG] Disposing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 23:44:09.528 -03:00 [DBG] Disposed connection to database '' on server '' (1ms).
2024-11-06 23:44:09.581 -03:00 [INF] Now listening on: https://localhost:7011
2024-11-06 23:44:09.582 -03:00 [INF] Now listening on: http://localhost:5091
2024-11-06 23:44:09.582 -03:00 [DBG] Loaded hosting startup assembly AuthServer
2024-11-06 23:44:09.583 -03:00 [DBG] Loaded hosting startup assembly Microsoft.AspNetCore.Watch.BrowserRefresh
2024-11-06 23:44:09.583 -03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.BrowserLink.Net
2024-11-06 23:44:09.584 -03:00 [INF] Application started. Press Ctrl+C to shut down.
2024-11-06 23:44:09.584 -03:00 [INF] Hosting environment: Development
2024-11-06 23:44:09.585 -03:00 [INF] Content root path: C:\Users\gusta\source\repos\AuthServer\AuthServer
2024-11-06 23:44:09.585 -03:00 [DBG] Hosting started
2024-11-06 23:46:26.132 -03:00 [INF] Aplicação iniciada - configuração de logs inicializada.
2024-11-06 23:46:26.280 -03:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2024-11-06 23:46:26.310 -03:00 [DBG] Hosting starting
2024-11-06 23:46:26.320 -03:00 [INF] User profile is available. Using 'C:\Users\gusta\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2024-11-06 23:46:26.326 -03:00 [DBG] Reading data from file 'C:\Users\gusta\AppData\Local\ASP.NET\DataProtection-Keys\key-bf4636f6-ef08-4ac9-8613-5c8299c406a4.xml'.
2024-11-06 23:46:26.331 -03:00 [DBG] Found key {bf4636f6-ef08-4ac9-8613-5c8299c406a4}.
2024-11-06 23:46:26.336 -03:00 [DBG] Considering key {bf4636f6-ef08-4ac9-8613-5c8299c406a4} with expiration date 2025-02-02 14:46:39Z as default key.
2024-11-06 23:46:26.339 -03:00 [DBG] Forwarded activator type request from Microsoft.AspNetCore.DataProtection.XmlEncryption.DpapiXmlDecryptor, Microsoft.AspNetCore.DataProtection, Version=8.0.0.0, Culture=neutral, PublicKeyToken=adb9793829ddae60 to Microsoft.AspNetCore.DataProtection.XmlEncryption.DpapiXmlDecryptor, Microsoft.AspNetCore.DataProtection, Culture=neutral, PublicKeyToken=adb9793829ddae60
2024-11-06 23:46:26.341 -03:00 [DBG] Decrypting secret element using Windows DPAPI.
2024-11-06 23:46:26.343 -03:00 [DBG] Forwarded activator type request from Microsoft.AspNetCore.DataProtection.AuthenticatedEncryption.ConfigurationModel.AuthenticatedEncryptorDescriptorDeserializer, Microsoft.AspNetCore.DataProtection, Version=8.0.0.0, Culture=neutral, PublicKeyToken=adb9793829ddae60 to Microsoft.AspNetCore.DataProtection.AuthenticatedEncryption.ConfigurationModel.AuthenticatedEncryptorDescriptorDeserializer, Microsoft.AspNetCore.DataProtection, Culture=neutral, PublicKeyToken=adb9793829ddae60
2024-11-06 23:46:26.346 -03:00 [DBG] Opening CNG algorithm 'AES' from provider 'null' with chaining mode CBC.
2024-11-06 23:46:26.347 -03:00 [DBG] Opening CNG algorithm 'SHA256' from provider 'null' with HMAC.
2024-11-06 23:46:26.349 -03:00 [DBG] Using key {bf4636f6-ef08-4ac9-8613-5c8299c406a4} as the default key.
2024-11-06 23:46:26.350 -03:00 [DBG] Key ring with default key {bf4636f6-ef08-4ac9-8613-5c8299c406a4} was loaded during application startup.
2024-11-06 23:46:26.412 -03:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2024-11-06 23:46:26.671 -03:00 [DBG] The index {'RoleId'} was not created on entity type 'UserRole (Dictionary<string, object>)' as the properties are already covered by the index {'RoleId', 'UserId'}.
2024-11-06 23:46:26.801 -03:00 [DBG] Entity Framework Core 8.0.10 initialized 'AuthServerContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:8.0.10' with options: None
2024-11-06 23:46:26.826 -03:00 [DBG] Compiling query expression: 
'DbSet<Role>()
    .Count()'
2024-11-06 23:46:26.927 -03:00 [DBG] Generated query execution expression: 
'queryContext => new SingleQueryingEnumerable<int>(
    (RelationalQueryContext)queryContext, 
    RelationalCommandCache.QueryExpression(
        Projection Mapping:
            EmptyProjectionMember -> 0
        SELECT COUNT(*)
        FROM Roles AS r), 
    null, 
    Func<QueryContext, DbDataReader, ResultContext, SingleQueryResultCoordinator, int>, 
    AuthServer.AuthServerContext, 
    False, 
    False, 
    True
)
    .Single()'
2024-11-06 23:46:26.942 -03:00 [DBG] Creating DbConnection.
2024-11-06 23:46:26.953 -03:00 [DBG] Created DbConnection. (9ms).
2024-11-06 23:46:26.955 -03:00 [DBG] Opening connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 23:46:27.047 -03:00 [DBG] Opened connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 23:46:27.050 -03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2024-11-06 23:46:27.055 -03:00 [DBG] Created DbCommand for 'ExecuteReader' (2ms).
2024-11-06 23:46:27.056 -03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (6ms).
2024-11-06 23:46:27.061 -03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*)
FROM [Roles] AS [r]
2024-11-06 23:46:27.077 -03:00 [INF] Executed DbCommand (15ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*)
FROM [Roles] AS [r]
2024-11-06 23:46:27.083 -03:00 [DBG] Closing data reader to 'AuthServer' on server 'localhost,1433'.
2024-11-06 23:46:27.088 -03:00 [DBG] A data reader for 'AuthServer' on server 'localhost,1433' is being disposed after spending 6ms reading results.
2024-11-06 23:46:27.090 -03:00 [DBG] Closing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 23:46:27.093 -03:00 [DBG] Closed connection to database 'AuthServer' on server 'localhost,1433' (3ms).
2024-11-06 23:46:27.098 -03:00 [DBG] Compiling query expression: 
'DbSet<User>()
    .Include(user => user.Roles)'
2024-11-06 23:46:27.106 -03:00 [DBG] Including navigation: 'User.Roles'.
2024-11-06 23:46:27.166 -03:00 [DBG] Generated query execution expression: 
'queryContext => new SingleQueryingEnumerable<User>(
    (RelationalQueryContext)queryContext, 
    RelationalCommandCache.QueryExpression(
        Client Projections:
            0 -> Dictionary<IProperty, int> { [Property: User.ID (long) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: User.Email (string) Required Index, 1], [Property: User.Name (string) Required, 2], [Property: User.Password (string) Required, 3] }
            1 -> 0
            2 -> Dictionary<IProperty, int> { [Property: UserRole (Dictionary<string, object>).RoleId (no field, int) Indexer Required PK FK AfterSave:Throw, 4], [Property: UserRole (Dictionary<string, object>).UserId (no field, long) Indexer Required PK FK Index AfterSave:Throw, 5] }
            3 -> Dictionary<IProperty, int> { [Property: Role.Long (int) Required PK AfterSave:Throw ValueGenerated.OnAdd, 6], [Property: Role.Name (string) Required Index, 7] }
            4 -> 4
            5 -> 5
            6 -> 6
        SELECT u.ID, u.Email, u.Name, u.Password, t.RoleId, t.UserId, t.Long, t.Name
        FROM Users AS u
        LEFT JOIN 
        (
            SELECT u0.RoleId, u0.UserId, r.Long, r.Name
            FROM UserRole AS u0
            INNER JOIN Roles AS r ON u0.RoleId == r.Long
        ) AS t ON u.ID == t.UserId
        ORDER BY u.ID ASC, t.RoleId ASC, t.UserId ASC), 
    null, 
    Func<QueryContext, DbDataReader, ResultContext, SingleQueryResultCoordinator, User>, 
    AuthServer.AuthServerContext, 
    False, 
    False, 
    True
)'
2024-11-06 23:46:27.171 -03:00 [DBG] Opening connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 23:46:27.172 -03:00 [DBG] Opened connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 23:46:27.173 -03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2024-11-06 23:46:27.173 -03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2024-11-06 23:46:27.174 -03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2024-11-06 23:46:27.175 -03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[ID], [u].[Email], [u].[Name], [u].[Password], [t].[RoleId], [t].[UserId], [t].[Long], [t].[Name]
FROM [Users] AS [u]
LEFT JOIN (
    SELECT [u0].[RoleId], [u0].[UserId], [r].[Long], [r].[Name]
    FROM [UserRole] AS [u0]
    INNER JOIN [Roles] AS [r] ON [u0].[RoleId] = [r].[Long]
) AS [t] ON [u].[ID] = [t].[UserId]
ORDER BY [u].[ID], [t].[RoleId], [t].[UserId]
2024-11-06 23:46:27.178 -03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[ID], [u].[Email], [u].[Name], [u].[Password], [t].[RoleId], [t].[UserId], [t].[Long], [t].[Name]
FROM [Users] AS [u]
LEFT JOIN (
    SELECT [u0].[RoleId], [u0].[UserId], [r].[Long], [r].[Name]
    FROM [UserRole] AS [u0]
    INNER JOIN [Roles] AS [r] ON [u0].[RoleId] = [r].[Long]
) AS [t] ON [u].[ID] = [t].[UserId]
ORDER BY [u].[ID], [t].[RoleId], [t].[UserId]
2024-11-06 23:46:27.196 -03:00 [DBG] Context 'AuthServerContext' started tracking 'User' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 23:46:27.216 -03:00 [DBG] Context 'AuthServerContext' started tracking 'UserRole' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 23:46:27.227 -03:00 [DBG] Context 'AuthServerContext' started tracking 'Role' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 23:46:27.230 -03:00 [DBG] Context 'AuthServerContext' started tracking 'User' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 23:46:27.231 -03:00 [DBG] Context 'AuthServerContext' started tracking 'UserRole' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 23:46:27.232 -03:00 [DBG] Context 'AuthServerContext' started tracking 'Role' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 23:46:27.233 -03:00 [DBG] Closing data reader to 'AuthServer' on server 'localhost,1433'.
2024-11-06 23:46:27.233 -03:00 [DBG] A data reader for 'AuthServer' on server 'localhost,1433' is being disposed after spending 53ms reading results.
2024-11-06 23:46:27.234 -03:00 [DBG] Closing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 23:46:27.235 -03:00 [DBG] Closed connection to database 'AuthServer' on server 'localhost,1433' (0ms).
2024-11-06 23:46:27.237 -03:00 [DBG] 'AuthServerContext' disposed.
2024-11-06 23:46:27.238 -03:00 [DBG] Disposing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 23:46:27.240 -03:00 [DBG] Disposed connection to database '' on server '' (1ms).
2024-11-06 23:46:27.294 -03:00 [INF] Now listening on: https://localhost:7011
2024-11-06 23:46:27.295 -03:00 [INF] Now listening on: http://localhost:5091
2024-11-06 23:46:27.296 -03:00 [DBG] Loaded hosting startup assembly AuthServer
2024-11-06 23:46:27.296 -03:00 [DBG] Loaded hosting startup assembly Microsoft.AspNetCore.Watch.BrowserRefresh
2024-11-06 23:46:27.297 -03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.BrowserLink.Net
2024-11-06 23:46:27.297 -03:00 [INF] Application started. Press Ctrl+C to shut down.
2024-11-06 23:46:27.298 -03:00 [INF] Hosting environment: Development
2024-11-06 23:46:27.299 -03:00 [INF] Content root path: C:\Users\gusta\source\repos\AuthServer\AuthServer
2024-11-06 23:46:27.299 -03:00 [DBG] Hosting started
2024-11-06 23:48:10.612 -03:00 [INF] Aplicação iniciada - configuração de logs inicializada.
2024-11-06 23:48:10.727 -03:00 [FTL] A aplicação falhou ao iniciar.
System.AggregateException: Some services are not able to be constructed (Error while validating the service descriptor 'ServiceType: AuthServer.Users.UsersService Lifetime: Transient ImplementationType: AuthServer.Users.UsersService': Unable to resolve service for type 'AuthServer.Security.IJwt' while attempting to activate 'AuthServer.Users.UsersService'.)
 ---> System.InvalidOperationException: Error while validating the service descriptor 'ServiceType: AuthServer.Users.UsersService Lifetime: Transient ImplementationType: AuthServer.Users.UsersService': Unable to resolve service for type 'AuthServer.Security.IJwt' while attempting to activate 'AuthServer.Users.UsersService'.
 ---> System.InvalidOperationException: Unable to resolve service for type 'AuthServer.Security.IJwt' while attempting to activate 'AuthServer.Users.UsersService'.
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateArgumentCallSites(ServiceIdentifier serviceIdentifier, Type implementationType, CallSiteChain callSiteChain, ParameterInfo[] parameters, Boolean throwIfCallSiteNotFound)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateConstructorCallSite(ResultCache lifetime, ServiceIdentifier serviceIdentifier, Type implementationType, CallSiteChain callSiteChain)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.TryCreateExact(ServiceDescriptor descriptor, ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain, Int32 slot)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.GetCallSite(ServiceDescriptor serviceDescriptor, CallSiteChain callSiteChain)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.ValidateService(ServiceDescriptor descriptor)
   --- End of inner exception stack trace ---
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.ValidateService(ServiceDescriptor descriptor)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider..ctor(ICollection`1 serviceDescriptors, ServiceProviderOptions options)
   --- End of inner exception stack trace ---
   at Microsoft.Extensions.DependencyInjection.ServiceProvider..ctor(ICollection`1 serviceDescriptors, ServiceProviderOptions options)
   at Microsoft.Extensions.DependencyInjection.ServiceCollectionContainerBuilderExtensions.BuildServiceProvider(IServiceCollection services, ServiceProviderOptions options)
   at Microsoft.Extensions.Hosting.HostApplicationBuilder.Build()
   at Microsoft.AspNetCore.Builder.WebApplicationBuilder.Build()
   at AuthServer.Program.Main(String[] args) in C:\Users\gusta\source\repos\AuthServer\AuthServer\Program.cs:line 85
2024-11-06 23:51:37.328 -03:00 [INF] Aplicação iniciada - configuração de logs inicializada.
2024-11-06 23:51:37.474 -03:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2024-11-06 23:51:37.503 -03:00 [DBG] Hosting starting
2024-11-06 23:51:37.513 -03:00 [INF] User profile is available. Using 'C:\Users\gusta\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2024-11-06 23:51:37.518 -03:00 [DBG] Reading data from file 'C:\Users\gusta\AppData\Local\ASP.NET\DataProtection-Keys\key-bf4636f6-ef08-4ac9-8613-5c8299c406a4.xml'.
2024-11-06 23:51:37.523 -03:00 [DBG] Found key {bf4636f6-ef08-4ac9-8613-5c8299c406a4}.
2024-11-06 23:51:37.528 -03:00 [DBG] Considering key {bf4636f6-ef08-4ac9-8613-5c8299c406a4} with expiration date 2025-02-02 14:46:39Z as default key.
2024-11-06 23:51:37.530 -03:00 [DBG] Forwarded activator type request from Microsoft.AspNetCore.DataProtection.XmlEncryption.DpapiXmlDecryptor, Microsoft.AspNetCore.DataProtection, Version=8.0.0.0, Culture=neutral, PublicKeyToken=adb9793829ddae60 to Microsoft.AspNetCore.DataProtection.XmlEncryption.DpapiXmlDecryptor, Microsoft.AspNetCore.DataProtection, Culture=neutral, PublicKeyToken=adb9793829ddae60
2024-11-06 23:51:37.532 -03:00 [DBG] Decrypting secret element using Windows DPAPI.
2024-11-06 23:51:37.533 -03:00 [DBG] Forwarded activator type request from Microsoft.AspNetCore.DataProtection.AuthenticatedEncryption.ConfigurationModel.AuthenticatedEncryptorDescriptorDeserializer, Microsoft.AspNetCore.DataProtection, Version=8.0.0.0, Culture=neutral, PublicKeyToken=adb9793829ddae60 to Microsoft.AspNetCore.DataProtection.AuthenticatedEncryption.ConfigurationModel.AuthenticatedEncryptorDescriptorDeserializer, Microsoft.AspNetCore.DataProtection, Culture=neutral, PublicKeyToken=adb9793829ddae60
2024-11-06 23:51:37.536 -03:00 [DBG] Opening CNG algorithm 'AES' from provider 'null' with chaining mode CBC.
2024-11-06 23:51:37.538 -03:00 [DBG] Opening CNG algorithm 'SHA256' from provider 'null' with HMAC.
2024-11-06 23:51:37.539 -03:00 [DBG] Using key {bf4636f6-ef08-4ac9-8613-5c8299c406a4} as the default key.
2024-11-06 23:51:37.540 -03:00 [DBG] Key ring with default key {bf4636f6-ef08-4ac9-8613-5c8299c406a4} was loaded during application startup.
2024-11-06 23:51:37.588 -03:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2024-11-06 23:51:37.823 -03:00 [DBG] The index {'RoleId'} was not created on entity type 'UserRole (Dictionary<string, object>)' as the properties are already covered by the index {'RoleId', 'UserId'}.
2024-11-06 23:51:37.949 -03:00 [DBG] Entity Framework Core 8.0.10 initialized 'AuthServerContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:8.0.10' with options: None
2024-11-06 23:51:37.974 -03:00 [DBG] Compiling query expression: 
'DbSet<Role>()
    .Count()'
2024-11-06 23:51:38.073 -03:00 [DBG] Generated query execution expression: 
'queryContext => new SingleQueryingEnumerable<int>(
    (RelationalQueryContext)queryContext, 
    RelationalCommandCache.QueryExpression(
        Projection Mapping:
            EmptyProjectionMember -> 0
        SELECT COUNT(*)
        FROM Roles AS r), 
    null, 
    Func<QueryContext, DbDataReader, ResultContext, SingleQueryResultCoordinator, int>, 
    AuthServer.AuthServerContext, 
    False, 
    False, 
    True
)
    .Single()'
2024-11-06 23:51:38.087 -03:00 [DBG] Creating DbConnection.
2024-11-06 23:51:38.098 -03:00 [DBG] Created DbConnection. (10ms).
2024-11-06 23:51:38.100 -03:00 [DBG] Opening connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 23:51:38.196 -03:00 [DBG] Opened connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 23:51:38.198 -03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2024-11-06 23:51:38.202 -03:00 [DBG] Created DbCommand for 'ExecuteReader' (2ms).
2024-11-06 23:51:38.204 -03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (5ms).
2024-11-06 23:51:38.208 -03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*)
FROM [Roles] AS [r]
2024-11-06 23:51:38.224 -03:00 [INF] Executed DbCommand (15ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*)
FROM [Roles] AS [r]
2024-11-06 23:51:38.230 -03:00 [DBG] Closing data reader to 'AuthServer' on server 'localhost,1433'.
2024-11-06 23:51:38.234 -03:00 [DBG] A data reader for 'AuthServer' on server 'localhost,1433' is being disposed after spending 6ms reading results.
2024-11-06 23:51:38.236 -03:00 [DBG] Closing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 23:51:38.239 -03:00 [DBG] Closed connection to database 'AuthServer' on server 'localhost,1433' (3ms).
2024-11-06 23:51:38.244 -03:00 [DBG] Compiling query expression: 
'DbSet<User>()
    .Include(user => user.Roles)'
2024-11-06 23:51:38.253 -03:00 [DBG] Including navigation: 'User.Roles'.
2024-11-06 23:51:38.313 -03:00 [DBG] Generated query execution expression: 
'queryContext => new SingleQueryingEnumerable<User>(
    (RelationalQueryContext)queryContext, 
    RelationalCommandCache.QueryExpression(
        Client Projections:
            0 -> Dictionary<IProperty, int> { [Property: User.ID (long) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: User.Email (string) Required Index, 1], [Property: User.Name (string) Required, 2], [Property: User.Password (string) Required, 3] }
            1 -> 0
            2 -> Dictionary<IProperty, int> { [Property: UserRole (Dictionary<string, object>).RoleId (no field, int) Indexer Required PK FK AfterSave:Throw, 4], [Property: UserRole (Dictionary<string, object>).UserId (no field, long) Indexer Required PK FK Index AfterSave:Throw, 5] }
            3 -> Dictionary<IProperty, int> { [Property: Role.Long (int) Required PK AfterSave:Throw ValueGenerated.OnAdd, 6], [Property: Role.Name (string) Required Index, 7] }
            4 -> 4
            5 -> 5
            6 -> 6
        SELECT u.ID, u.Email, u.Name, u.Password, t.RoleId, t.UserId, t.Long, t.Name
        FROM Users AS u
        LEFT JOIN 
        (
            SELECT u0.RoleId, u0.UserId, r.Long, r.Name
            FROM UserRole AS u0
            INNER JOIN Roles AS r ON u0.RoleId == r.Long
        ) AS t ON u.ID == t.UserId
        ORDER BY u.ID ASC, t.RoleId ASC, t.UserId ASC), 
    null, 
    Func<QueryContext, DbDataReader, ResultContext, SingleQueryResultCoordinator, User>, 
    AuthServer.AuthServerContext, 
    False, 
    False, 
    True
)'
2024-11-06 23:51:38.318 -03:00 [DBG] Opening connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 23:51:38.319 -03:00 [DBG] Opened connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 23:51:38.320 -03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2024-11-06 23:51:38.321 -03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2024-11-06 23:51:38.321 -03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2024-11-06 23:51:38.322 -03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[ID], [u].[Email], [u].[Name], [u].[Password], [t].[RoleId], [t].[UserId], [t].[Long], [t].[Name]
FROM [Users] AS [u]
LEFT JOIN (
    SELECT [u0].[RoleId], [u0].[UserId], [r].[Long], [r].[Name]
    FROM [UserRole] AS [u0]
    INNER JOIN [Roles] AS [r] ON [u0].[RoleId] = [r].[Long]
) AS [t] ON [u].[ID] = [t].[UserId]
ORDER BY [u].[ID], [t].[RoleId], [t].[UserId]
2024-11-06 23:51:38.326 -03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[ID], [u].[Email], [u].[Name], [u].[Password], [t].[RoleId], [t].[UserId], [t].[Long], [t].[Name]
FROM [Users] AS [u]
LEFT JOIN (
    SELECT [u0].[RoleId], [u0].[UserId], [r].[Long], [r].[Name]
    FROM [UserRole] AS [u0]
    INNER JOIN [Roles] AS [r] ON [u0].[RoleId] = [r].[Long]
) AS [t] ON [u].[ID] = [t].[UserId]
ORDER BY [u].[ID], [t].[RoleId], [t].[UserId]
2024-11-06 23:51:38.345 -03:00 [DBG] Context 'AuthServerContext' started tracking 'User' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 23:51:38.365 -03:00 [DBG] Context 'AuthServerContext' started tracking 'UserRole' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 23:51:38.375 -03:00 [DBG] Context 'AuthServerContext' started tracking 'Role' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 23:51:38.378 -03:00 [DBG] Context 'AuthServerContext' started tracking 'User' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 23:51:38.379 -03:00 [DBG] Context 'AuthServerContext' started tracking 'UserRole' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 23:51:38.380 -03:00 [DBG] Context 'AuthServerContext' started tracking 'Role' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 23:51:38.381 -03:00 [DBG] Closing data reader to 'AuthServer' on server 'localhost,1433'.
2024-11-06 23:51:38.382 -03:00 [DBG] A data reader for 'AuthServer' on server 'localhost,1433' is being disposed after spending 53ms reading results.
2024-11-06 23:51:38.382 -03:00 [DBG] Closing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 23:51:38.383 -03:00 [DBG] Closed connection to database 'AuthServer' on server 'localhost,1433' (0ms).
2024-11-06 23:51:38.385 -03:00 [DBG] 'AuthServerContext' disposed.
2024-11-06 23:51:38.386 -03:00 [DBG] Disposing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 23:51:38.388 -03:00 [DBG] Disposed connection to database '' on server '' (1ms).
2024-11-06 23:51:38.441 -03:00 [INF] Now listening on: https://localhost:7011
2024-11-06 23:51:38.442 -03:00 [INF] Now listening on: http://localhost:5091
2024-11-06 23:51:38.442 -03:00 [DBG] Loaded hosting startup assembly AuthServer
2024-11-06 23:51:38.443 -03:00 [DBG] Loaded hosting startup assembly Microsoft.AspNetCore.Watch.BrowserRefresh
2024-11-06 23:51:38.443 -03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.BrowserLink.Net
2024-11-06 23:51:38.444 -03:00 [INF] Application started. Press Ctrl+C to shut down.
2024-11-06 23:51:38.445 -03:00 [INF] Hosting environment: Development
2024-11-06 23:51:38.445 -03:00 [INF] Content root path: C:\Users\gusta\source\repos\AuthServer\AuthServer
2024-11-06 23:51:38.446 -03:00 [DBG] Hosting started
2024-11-06 23:51:38.644 -03:00 [DBG] Connection id "0HN7UQSCV2L2P" received FIN.
2024-11-06 23:51:38.644 -03:00 [DBG] Connection id "0HN7UQSCV2L2Q" received FIN.
2024-11-06 23:51:38.648 -03:00 [DBG] Connection id "0HN7UQSCV2L2P" accepted.
2024-11-06 23:51:38.648 -03:00 [DBG] Connection id "0HN7UQSCV2L2Q" accepted.
2024-11-06 23:51:38.649 -03:00 [DBG] Connection id "0HN7UQSCV2L2P" started.
2024-11-06 23:51:38.650 -03:00 [DBG] Connection id "0HN7UQSCV2L2Q" started.
2024-11-06 23:51:38.657 -03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2024-11-06 23:51:38.657 -03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2024-11-06 23:51:38.666 -03:00 [DBG] Connection id "0HN7UQSCV2L2P" stopped.
2024-11-06 23:51:38.666 -03:00 [DBG] Connection id "0HN7UQSCV2L2Q" stopped.
2024-11-06 23:51:38.668 -03:00 [DBG] Connection id "0HN7UQSCV2L2P" sending FIN because: "The Socket transport's send loop completed gracefully."
2024-11-06 23:51:38.668 -03:00 [DBG] Connection id "0HN7UQSCV2L2Q" sending FIN because: "The Socket transport's send loop completed gracefully."
2024-11-06 23:51:38.729 -03:00 [DBG] Connection id "0HN7UQSCV2L2R" accepted.
2024-11-06 23:51:38.731 -03:00 [DBG] Connection id "0HN7UQSCV2L2R" started.
2024-11-06 23:51:38.757 -03:00 [DBG] Connection 0HN7UQSCV2L2R established using the following protocol: "Tls13"
2024-11-06 23:51:38.787 -03:00 [INF] Request starting HTTP/2 GET https://localhost:7011/swagger/index.html - null null
2024-11-06 23:51:38.840 -03:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2024-11-06 23:51:38.852 -03:00 [DBG] No candidates found for the request path '/swagger/index.html'
2024-11-06 23:51:38.853 -03:00 [DBG] Request did not match any endpoints
2024-11-06 23:51:38.898 -03:00 [DBG] Response markup is scheduled to include Browser Link script injection.
2024-11-06 23:51:38.900 -03:00 [DBG] Response markup is scheduled to include browser refresh script injection.
2024-11-06 23:51:38.903 -03:00 [DBG] Response markup was updated to include Browser Link script injection.
2024-11-06 23:51:38.904 -03:00 [DBG] Response markup was updated to include browser refresh script injection.
2024-11-06 23:51:38.907 -03:00 [INF] Request finished HTTP/2 GET https://localhost:7011/swagger/index.html - 200 null text/html;charset=utf-8 120.7267ms
2024-11-06 23:51:38.924 -03:00 [INF] Request starting HTTP/2 GET https://localhost:7011/swagger/index.js - null null
2024-11-06 23:51:38.924 -03:00 [INF] Request starting HTTP/2 GET https://localhost:7011/_framework/aspnetcore-browser-refresh.js - null null
2024-11-06 23:51:38.927 -03:00 [DBG] No candidates found for the request path '/swagger/index.js'
2024-11-06 23:51:38.930 -03:00 [DBG] Request did not match any endpoints
2024-11-06 23:51:38.933 -03:00 [INF] Request finished HTTP/2 GET https://localhost:7011/swagger/index.js - 200 null application/javascript;charset=utf-8 9.0424ms
2024-11-06 23:51:38.936 -03:00 [INF] Request finished HTTP/2 GET https://localhost:7011/_framework/aspnetcore-browser-refresh.js - 200 13756 application/javascript; charset=utf-8 11.9798ms
2024-11-06 23:51:39.000 -03:00 [INF] Request starting HTTP/2 GET https://localhost:7011/_vs/browserLink - null null
2024-11-06 23:51:39.027 -03:00 [INF] Request finished HTTP/2 GET https://localhost:7011/_vs/browserLink - 200 null text/javascript; charset=UTF-8 27.2116ms
2024-11-06 23:51:39.108 -03:00 [INF] Request starting HTTP/2 GET https://localhost:7011/swagger/v1/swagger.json - null null
2024-11-06 23:51:39.110 -03:00 [DBG] No candidates found for the request path '/swagger/v1/swagger.json'
2024-11-06 23:51:39.111 -03:00 [DBG] Request did not match any endpoints
2024-11-06 23:51:39.211 -03:00 [INF] Request finished HTTP/2 GET https://localhost:7011/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 102.9296ms
2024-11-06 23:52:57.048 -03:00 [INF] Request starting HTTP/2 POST https://localhost:7011/api/users/login - application/json 60
2024-11-06 23:52:57.054 -03:00 [DBG] 1 candidate(s) found for the request path '/api/users/login'
2024-11-06 23:52:57.055 -03:00 [DBG] Endpoint 'AuthServer.Users.UsersController.Login (AuthServer)' with route pattern 'api/users/login' is valid for the request path '/api/users/login'
2024-11-06 23:52:57.057 -03:00 [DBG] Request matched endpoint 'AuthServer.Users.UsersController.Login (AuthServer)'
2024-11-06 23:52:57.058 -03:00 [DBG] Static files was skipped as the request already matched an endpoint.
2024-11-06 23:52:57.062 -03:00 [DBG] The request has an origin header: 'https://localhost:7011'.
2024-11-06 23:52:57.063 -03:00 [INF] CORS policy execution successful.
2024-11-06 23:52:57.104 -03:00 [DBG] AuthenticationScheme: Bearer was not authenticated.
2024-11-06 23:52:57.107 -03:00 [INF] Executing endpoint 'AuthServer.Users.UsersController.Login (AuthServer)'
2024-11-06 23:52:57.118 -03:00 [INF] Route matched with {action = "Login", controller = "Users"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult Login(AuthServer.Users.LoginRequest) on controller AuthServer.Users.UsersController (AuthServer).
2024-11-06 23:52:57.121 -03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2024-11-06 23:52:57.122 -03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2024-11-06 23:52:57.123 -03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)"]
2024-11-06 23:52:57.125 -03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2024-11-06 23:52:57.126 -03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)"]
2024-11-06 23:52:57.128 -03:00 [DBG] Executing controller factory for controller AuthServer.Users.UsersController (AuthServer)
2024-11-06 23:52:57.130 -03:00 [DBG] Executed controller factory for controller AuthServer.Users.UsersController (AuthServer)
2024-11-06 23:52:57.135 -03:00 [DBG] Attempting to bind parameter 'credentials' of type 'AuthServer.Users.LoginRequest' ...
2024-11-06 23:52:57.137 -03:00 [DBG] Attempting to bind parameter 'credentials' of type 'AuthServer.Users.LoginRequest' using the name '' in request data ...
2024-11-06 23:52:57.138 -03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2024-11-06 23:52:57.146 -03:00 [DBG] Connection id "0HN7UQSCV2L2R", Request id "0HN7UQSCV2L2R:0000000B": started reading request body.
2024-11-06 23:52:57.147 -03:00 [DBG] Connection id "0HN7UQSCV2L2R", Request id "0HN7UQSCV2L2R:0000000B": done reading request body.
2024-11-06 23:52:57.150 -03:00 [DBG] JSON input formatter succeeded, deserializing to type 'AuthServer.Users.LoginRequest'
2024-11-06 23:52:57.151 -03:00 [DBG] Done attempting to bind parameter 'credentials' of type 'AuthServer.Users.LoginRequest'.
2024-11-06 23:52:57.152 -03:00 [DBG] Done attempting to bind parameter 'credentials' of type 'AuthServer.Users.LoginRequest'.
2024-11-06 23:52:57.152 -03:00 [DBG] Attempting to validate the bound parameter 'credentials' of type 'AuthServer.Users.LoginRequest' ...
2024-11-06 23:52:57.157 -03:00 [DBG] Done attempting to validate the bound parameter 'credentials' of type 'AuthServer.Users.LoginRequest'.
2024-11-06 23:52:57.169 -03:00 [DBG] Entity Framework Core 8.0.10 initialized 'AuthServerContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:8.0.10' with options: None
2024-11-06 23:52:57.173 -03:00 [DBG] Compiling query expression: 
'DbSet<User>()
    .Include(u => u.Roles)
    .FirstOrDefault(u => u.Email == __email_0)'
2024-11-06 23:52:57.176 -03:00 [DBG] Including navigation: 'User.Roles'.
2024-11-06 23:52:57.187 -03:00 [DBG] Generated query execution expression: 
'queryContext => new SingleQueryingEnumerable<User>(
    (RelationalQueryContext)queryContext, 
    RelationalCommandCache.QueryExpression(
        Client Projections:
            0 -> Dictionary<IProperty, int> { [Property: User.ID (long) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: User.Email (string) Required Index, 1], [Property: User.Name (string) Required, 2], [Property: User.Password (string) Required, 3] }
            1 -> 0
            2 -> Dictionary<IProperty, int> { [Property: UserRole (Dictionary<string, object>).RoleId (no field, int) Indexer Required PK FK AfterSave:Throw, 4], [Property: UserRole (Dictionary<string, object>).UserId (no field, long) Indexer Required PK FK Index AfterSave:Throw, 5] }
            3 -> Dictionary<IProperty, int> { [Property: Role.Long (int) Required PK AfterSave:Throw ValueGenerated.OnAdd, 6], [Property: Role.Name (string) Required Index, 7] }
            4 -> 4
            5 -> 5
            6 -> 6
        SELECT t.ID, t.Email, t.Name, t.Password, t0.RoleId, t0.UserId, t0.Long, t0.Name
        FROM 
        (
            SELECT TOP(1) u.ID, u.Email, u.Name, u.Password
            FROM Users AS u
            WHERE u.Email == @__email_0
        ) AS t
        LEFT JOIN 
        (
            SELECT u0.RoleId, u0.UserId, r.Long, r.Name
            FROM UserRole AS u0
            INNER JOIN Roles AS r ON u0.RoleId == r.Long
        ) AS t0 ON t.ID == t0.UserId
        ORDER BY t.ID ASC, t0.RoleId ASC, t0.UserId ASC), 
    null, 
    Func<QueryContext, DbDataReader, ResultContext, SingleQueryResultCoordinator, User>, 
    AuthServer.AuthServerContext, 
    False, 
    False, 
    True
)
    .SingleOrDefault()'
2024-11-06 23:52:57.190 -03:00 [DBG] Creating DbConnection.
2024-11-06 23:52:57.191 -03:00 [DBG] Created DbConnection. (0ms).
2024-11-06 23:52:57.192 -03:00 [DBG] Opening connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 23:52:57.193 -03:00 [DBG] Opened connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 23:52:57.194 -03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2024-11-06 23:52:57.195 -03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2024-11-06 23:52:57.197 -03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (3ms).
2024-11-06 23:52:57.199 -03:00 [DBG] Executing DbCommand [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[ID], [t].[Email], [t].[Name], [t].[Password], [t0].[RoleId], [t0].[UserId], [t0].[Long], [t0].[Name]
FROM (
    SELECT TOP(1) [u].[ID], [u].[Email], [u].[Name], [u].[Password]
    FROM [Users] AS [u]
    WHERE [u].[Email] = @__email_0
) AS [t]
LEFT JOIN (
    SELECT [u0].[RoleId], [u0].[UserId], [r].[Long], [r].[Name]
    FROM [UserRole] AS [u0]
    INNER JOIN [Roles] AS [r] ON [u0].[RoleId] = [r].[Long]
) AS [t0] ON [t].[ID] = [t0].[UserId]
ORDER BY [t].[ID], [t0].[RoleId], [t0].[UserId]
2024-11-06 23:52:57.215 -03:00 [INF] Executed DbCommand (16ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[ID], [t].[Email], [t].[Name], [t].[Password], [t0].[RoleId], [t0].[UserId], [t0].[Long], [t0].[Name]
FROM (
    SELECT TOP(1) [u].[ID], [u].[Email], [u].[Name], [u].[Password]
    FROM [Users] AS [u]
    WHERE [u].[Email] = @__email_0
) AS [t]
LEFT JOIN (
    SELECT [u0].[RoleId], [u0].[UserId], [r].[Long], [r].[Name]
    FROM [UserRole] AS [u0]
    INNER JOIN [Roles] AS [r] ON [u0].[RoleId] = [r].[Long]
) AS [t0] ON [t].[ID] = [t0].[UserId]
ORDER BY [t].[ID], [t0].[RoleId], [t0].[UserId]
2024-11-06 23:52:57.217 -03:00 [DBG] Context 'AuthServerContext' started tracking 'User' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 23:52:57.218 -03:00 [DBG] Context 'AuthServerContext' started tracking 'UserRole' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 23:52:57.219 -03:00 [DBG] Context 'AuthServerContext' started tracking 'Role' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-11-06 23:52:57.220 -03:00 [DBG] Closing data reader to 'AuthServer' on server 'localhost,1433'.
2024-11-06 23:52:57.221 -03:00 [DBG] A data reader for 'AuthServer' on server 'localhost,1433' is being disposed after spending 4ms reading results.
2024-11-06 23:52:57.222 -03:00 [DBG] Closing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 23:52:57.223 -03:00 [DBG] Closed connection to database 'AuthServer' on server 'localhost,1433' (0ms).
2024-11-06 23:52:57.224 -03:00 [INF] User logged in. id=16 name=Auth Server Administrator
2024-11-06 23:52:57.282 -03:00 [DBG] List of registered output formatters, in the following order: ["Microsoft.AspNetCore.Mvc.Formatters.HttpNoContentOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StringOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StreamOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter"]
2024-11-06 23:52:57.284 -03:00 [DBG] No information found on request to perform content negotiation.
2024-11-06 23:52:57.285 -03:00 [DBG] Attempting to select an output formatter without using a content type as no explicit content types were specified for the response.
2024-11-06 23:52:57.286 -03:00 [DBG] Attempting to select the first formatter in the output formatters list which can write the result.
2024-11-06 23:52:57.287 -03:00 [DBG] Selected output formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter' and content type 'application/json' to write the response.
2024-11-06 23:52:57.288 -03:00 [INF] Executing OkObjectResult, writing value of type 'LoginResponse'.
2024-11-06 23:52:57.297 -03:00 [INF] Executed action AuthServer.Users.UsersController.Login (AuthServer) in 167.8826ms
2024-11-06 23:52:57.298 -03:00 [INF] Executed endpoint 'AuthServer.Users.UsersController.Login (AuthServer)'
2024-11-06 23:52:57.299 -03:00 [DBG] 'AuthServerContext' disposed.
2024-11-06 23:52:57.301 -03:00 [DBG] Disposing connection to database 'AuthServer' on server 'localhost,1433'.
2024-11-06 23:52:57.303 -03:00 [DBG] Disposed connection to database '' on server '' (1ms).
2024-11-06 23:52:57.304 -03:00 [INF] Request finished HTTP/2 POST https://localhost:7011/api/users/login - 200 null application/json; charset=utf-8 255.8998ms
